var Endian={BIG_ENDIAN:"bigEndian",LITTLE_ENDIAN:"littleEndian"},flashOnHtml5_constructingPrototype="flashOnHtml5_constructingPrototype",Endian={BIG_ENDIAN:"bigEndian",LITTLE_ENDIAN:"littleEndian"};ByteArray.prototype=[];ByteArray.prototype.constructor=ByteArray;
function ByteArray(){this.length=this.bytesAvailable=0;this.endian=Endian.BIG_ENDIAN;this.position=0;this.setPosition=function(a){a>this.length&&(this.length=a);this.position=a;this.bytesAvailable=this.length-a};this.readUnsignedInt=function(){var a;a=this.position;a=this.endian==Endian.BIG_ENDIAN?this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]:this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24;this.position+=4;this.bytesAvailable-=4;return a>>>0};this.writeUnsignedInt=function(a){var c=this.position;
this.endian==Endian.BIG_ENDIAN?(this[c]=a>>24&255,this[c+1]=a>>16&255,this[c+2]=a>>8&255,this[c+3]=a&255):(this[c]=a&255,this[c+1]=a>>8&255,this[c+2]=a>>16&255,this[c+3]=a>>24&255);this.length+=4;this.position+=4};this.flashOnHtml5_refresh=function(a){a&&(this.length=Math.max(a,this.length));this.bytesAvailable=this.length-this.position}}function Point(a,c){this.x=a||0;this.y=c||0}Point.prototype.x=null;Point.prototype.y=null;Point.prototype.add=function(a){return new Point(this.x+a.x,this.y+a.y)};
Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.degreesTo=function(a){return Math.atan2(this.y-a.y,this.x-a.x)*(180/Math.PI)};Point.prototype.distance=function(a){var c=this.x-a.x,a=this.y-a.y;return Math.sqrt(c*c+a*a)};Point.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};Point.prototype.interpolate=function(a,c){return new Point((this.x+a.x)*c,(this.y+a.y)*c)};Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};
Point.prototype.normalize=function(a){var c=this.length();this.x=this.x/c*a;this.y=this.y/c*a};Point.prototype.orbit=function(a,c,d,e){e*=Math.PI/180;this.x=a.x+c*Math.cos(e);this.y=a.y+d*Math.sin(e)};Point.prototype.offset=function(a,c){this.x+=a;this.y+=c};Point.prototype.subtract=function(a){return new Point(this.x-a.x,this.y-a.y)};Point.prototype.toString=function(){return"(x="+this.x+", y="+this.y+")"};Point.interpolate=function(a,c,d){return new Point((a.x+c.x)*d,(a.y+c.y)*d)};
Point.polar=function(a,c){return new Point(a*Math.cos(c),a*Math.sin(c))};Point.distance=function(a,c){var d=a.x-c.x,e=a.y-c.y;return Math.sqrt(d*d+e*e)};
function Rectangle(a,c,d,e){"undefined"==typeof a&&(a=0);"undefined"==typeof c&&(c=0);"undefined"==typeof d&&(d=0);"undefined"==typeof e&&(e=0);this.x=this.left=a;this.y=this.top=c;this.width=d;this.height=e;this.bottom=c+e;this.right=a+d;this.topLeft=new Point(a,c);this.bottomRight=new Point(a+d,c+e);this.size=new Point(d,e);this.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)};this.contains=function(a,c){return a>=this.x&&a<this.right&&c>=this.y&&c<this.bottom};this.containsPoint=
function(a){return this.contains(a.x,a.y)};this.containsRect=function(a){return this.contains(a.x,a.y)&&this.contains(a.right-1,a.bottom-1)};this.copyFrom=function(a){this.x=this.left=this.topLeft.x=a.x;this.y=this.top=this.topLeft.y=a.y;this.width=this.size.x=a.width;this.height=this.size.y=a.height;this.bottom=this.bottomRight.y=a.y+a.height;this.right=this.bottomRight.x=a.x+a.width};this.equals=function(a){return this.x==a.x&&this.y==a.y&&this.width==a.width&&this.height==a.height}}
function Matrix(a,c,d,e,f,h){this.a="undefined"==typeof a?1:a;this.b="undefined"==typeof c?0:c;this.c="undefined"==typeof d?0:d;this.d="undefined"==typeof e?1:e;this.tx="undefined"==typeof f?0:f;this.ty="undefined"==typeof h?0:h;this.clone=function(){return new Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)};this.rotate=function(a){var c=Math.cos(a),a=Math.sin(a);this.concat(new Matrix(c,a,-a,c,0,0))};this.scale=function(a,c){this.concat(new Matrix(a,0,0,c,0,0))};this.translate=function(a,c){this.tx+=
a;this.ty+=c};this.concat=function(a){var c=this.a*a.a+this.c*a.b,d=this.b*a.a+this.d*a.b,e=this.a*a.c+this.c*a.d,f=this.b*a.c+this.d*a.d,h=this.a*a.tx+this.c*a.ty+this.tx;this.ty=this.b*a.tx+this.d*a.ty+this.ty;this.a=c;this.b=d;this.c=e;this.d=f;this.tx=h};this.transformPoint=function(a){return new Point(this.a*a.x+this.c*a.y+this.tx,this.b*a.x+this.d*a.y+this.ty)};this.transformPointX=function(a,c){return this.a*a+this.c*c+this.tx};this.transformPointY=function(a,c){return this.b*a+this.d*c+this.ty}}
Transform.prototype={};Transform.prototype.constructor=Transform;
function Transform(a){this.concatenatedColorTransform=this.colorTransform=null;this.concatenatedMatrix=new Matrix;this.matrix=new Matrix;this.setMatrix=function(c){this.flashOnHtml5_canvasContext&&this.flashOnHtml5_canvasContext.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty);a&&(a.scaleX=c.a,a.scaleY=c.d,a.x=c.tx,a.y=c.ty);this.matrix=c};this.pixelBounds=this.perspectiveProjection=this.matrix3D=null;this.getRelativeMatrix3D=function(){throw"getRelativeMatrix3D not implemented";}}
function ColorTransform(a,c,d,e,f,h,i,j){"undefined"==typeof a&&(a=1);"undefined"==typeof c&&(c=1);"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=1);"undefined"==typeof f&&(f=0);"undefined"==typeof h&&(h=0);"undefined"==typeof i&&(i=0);"undefined"==typeof j&&(j=0);this.redMultiplier=a;this.greenMultiplier=c;this.blueMultiplier=d;this.alphaMultiplier=e;this.redOffset=f;this.greenOffset=h;this.blueOffset=i;this.alphaOffset=j}function EventPhase(){}EventPhase.AT_TARGET=2;
EventPhase.BUBBLING_PHASE=3;EventPhase.CAPTURING_PHASE=1;
function EventDispatcher(){function a(a,c){var d=null;0<=c.eventTypes.indexOf(a.type)&&(d=c.eventListenersByType[a.type]);if(d){a.currentTarget=c;for(var i=0;i<d.length;i++)d[i].listener.call(d[i].context,a)}}function c(d,f){f.parent&&c(d,f.parent);d.currentTarget=f;a(d,f)}function d(c,f){c.bubbles&&(c.currentTarget=f,a(c,f),f.parent&&d(c,f.parent))}this.addEventListener=function(a,c,d,i,j,k){-1==this.eventTypes.indexOf(a)&&(this.eventTypes.push(a),this.eventListenersByType[a]=[]);this.eventListenersByType[a].push({listener:c,
useCapture:d,context:k||this});a==Event.ENTER_FRAME&&!this.flashOnHtml5_enterFrameWasDispatched&&(this.dispatchEvent(new Event(Event.ENTER_FRAME)),this.flashOnHtml5_enterFrameWasDispatched=!0)};this.removeEventListener=function(a,c){for(var d=this.eventListenersByType[a],i=-1,j=0;j<d.length;j++)if(d[j].listener==c){i=j;break}0>i?console.log("VME: Cannot remove listener (type:"+a+") that was never registered"):(d.splice(i,1),0==d.length&&(this.eventListenersByType[a]=null))};this.dispatchEvent=function(a){if(this.eventTypes){var f=
null;0<=this.eventTypes.indexOf(a.type)&&(f=this.eventListenersByType[a.type]);if(f){a.target=this;for(var h=0;h<f.length;h++){this.parent&&f[h].useCapture&&(a.eventPhase=EventPhase.CAPTURING_PHASE,c(a,this.parent));var i=a.bubbles;a.eventPhase=EventPhase.AT_TARGET;a.currentTarget=this;f[h].listener.call(f[h].context,a);a.bubbles&&(this.parent&&!f[h].useCapture)&&(a.eventPhase=EventPhase.BUBBLING_PHASE,d(a,this.parent),a.flashOnHtml5_event&&a.flashOnHtml5_event.stopPropagation());a.bubbles=i}}else a.bubbles&&
this.parent&&(a.eventPhase=EventPhase.BUBBLING_PHASE,d(a,this.parent),a.flashOnHtml5_event&&a.flashOnHtml5_event.stopPropagation())}};this.flashOnHtml5_constructor=function(){this.eventTypes=[];this.eventListenersByType={};this.flashOnHtml5_enterFrameWasDispatched=!1};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}
function Event(a,c,d){"undefined"==typeof c&&(c=!1);"undefined"==typeof d&&(d=!1);this.bubbles=c;this.cancelable=d;this.target=this.eventPhase=this.currentTarget=null;this.type=a;this.clone=function(){alert("TODO: implement events.Event.clone()")};this.formatToString=function(){alert("TODO: implement events.Event.formatToString(className)")};this.isDefaultPrevented=function(){alert("TODO: implement events.Event.isDefaultPrevented()")};this.preventDefault=function(){this.bubbles=!1;this.flashOnHtml5_event.preventDefault()};
this.stopImmediatePropagation=function(){alert("TODO: implement events.Event.stopImmediatePropagation()")};this.stopPropagation=function(){this.bubbles=!1;this.flashOnHtml5_event.stopPropagation()};this.toString=function(){}}Event.ACTIVATE="activate";Event.ADDED="added";Event.ADDED_TO_STAGE="addedToStage";Event.CANCEL="cancel";Event.CHANGE="change";Event.CLEAR="clear";Event.CLOSE="close";Event.CLOSING="closing";Event.COMPLETE="complete";Event.CONNECT="connect";Event.COPY="copy";Event.CUT="cut";
Event.DEACTIVATE="deactivate";Event.DISPLAYING="displaying";Event.ENTER_FRAME="enterFrame";Event.EXIT_FRAME="exitFrame";Event.EXITING="exiting";Event.FRAME_CONSTRUCTED="frameConstructed";Event.FULLSCREEN="fullScreen";Event.HTML_BOUNDS_CHANGE="htmlBoundsChange";Event.HTML_DOM_INITIALIZE="htmlDOMInitialize";Event.HTML_RENDER="htmlRender";Event.ID3="id3";Event.INIT="init";Event.LOCATION_CHANGE="locationChange";Event.MOUSE_LEAVE="mouseLeave";Event.NETWORK_CHANGE="networkChange";Event.OPEN="open";
Event.PASTE="paste";Event.PREPARING="preparing";Event.REMOVED="removed";Event.REMOVED_FROM_STAGE="removedFromStage";Event.RENDER="render";Event.RESIZE="resize";Event.SCROLL="scroll";Event.SELECT="select";Event.SELECT_ALL="selectAll";Event.SOUND_COMPLETE="soundComplete";Event.STANDARD_ERROR_CLOSE="standardErrorClose";Event.STANDARD_INPUT_CLOSE="standardInputClose";Event.STANDARD_OUTPUT_CLOSE="standardOutputClose";Event.TAB_CHILDREN_CHANGE="tabChildrenChange";Event.TAB_ENABLED_CHANGE="tabEnabledChange";
Event.TAB_INDEX_CHANGE="tabIndexChange";Event.TEXT_INTERACTION_MODE_CHANGE="textInteractionModeChange";Event.UNLOAD="unload";Event.USER_IDLE="userIdle";Event.USER_PRESENT="userPresent";MouseEvent.prototype=new Event(flashOnHtml5_constructingPrototype);MouseEvent.prototype.constructor=MouseEvent;
function MouseEvent(a,c,d,e,f,h,i,j,k,l,m,n,o,s){"undefined"==typeof c&&(c=!0);d||(d=!1);e||(e=NaN);f||(f=NaN);i||(i=!1);j||(j=!1);k||(k=!1);l||(l=!1);m||(m=0);n||(n=!1);o||(o=!1);s||(s=0);this.type=a;this.bubbles=c;this.cancelable=d;this.clone=function(){return new MouseEvent(a,c,d,e,f,h,i,j,k,l,m,n,o,s)};this.updateAfterEvent=function(){}}MouseEvent.CLICK="click";MouseEvent.CONTEXT_MENU="contextMenu";MouseEvent.DOUBLE_CLICK="doubleClick";MouseEvent.MIDDLE_CLICK="middleClick";
MouseEvent.MIDDLE_MOUSE_DOWN="middleMouseDown";MouseEvent.MIDDLE_MOUSE_UP="middleMouseUp";MouseEvent.MOUSE_DOWN="mouseDown";MouseEvent.MOUSE_MOVE="mouseMove";MouseEvent.MOUSE_OUT="mouseOut";MouseEvent.MOUSE_OVER="mouseOver";MouseEvent.MOUSE_UP="mouseUp";MouseEvent.MOUSE_WHEEL="mouseWheel";MouseEvent.RIGHT_CLICK="rightClick";MouseEvent.RIGHT_MOUSE_DOWN="rightMouseDown";MouseEvent.RIGHT_MOUSE_UP="rightMouseUp";MouseEvent.ROLL_OUT="rollOut";MouseEvent.ROLL_OVER="rollOver";TouchEvent.prototype=new Event(flashOnHtml5_constructingPrototype);
TouchEvent.prototype.constructor=TouchEvent;function TouchEvent(a,c,d,e,f,h,i,j,k,l,m,n,o,s,r,q,v,p,z,w){"undefined"==typeof c&&(c=!0);d||(d=0);e||(e=0);f||(f=0);h||(h=0);i||(i=0);j||(j=0);k||(k=1);l||(l=1);m||(m=0);n||(n=1);s||(s=!1);r||(r=!1);q||(q=!1);v||(v=!1);this.type=a;this.bubbles=c;this.clone=function(){return new TouchEvent(a,c,d,e,f,h,i,j,k,l,m,n,o,s,r,q,v,p,z,w)}}TouchEvent.TOUCH_START="touchstart";TouchEvent.TOUCH_END="touchend";TouchEvent.TOUCH_MOVE="touchmove";
TouchEvent.TOUCH_CANCEL="touchcancel";var StageScaleMode={EXACT_FIT:"exactFit",NO_BORDER:"noBorder",NO_SCALE:"noScale",SHOW_ALL:"showAll"},StageAlign={BOTTOM:"B",BOTTOM_LEFT:"BL",BOTTOM_RIGHT:"BR",LEFT:"L",RIGHT:"R",TOP:"T",TOP_LEFT:"TL",TOP_RIGHT:"TR"};DisplayObject.prototype=new EventDispatcher(flashOnHtml5_constructingPrototype);DisplayObject.prototype.constructor=DisplayObject;
function DisplayObject(){function a(){var a;if(a=this.parent)if(this instanceof TraceHandle)$(this.flashOnHtml5_documentElement).css({left:a.flashOnHtml5_displayMatrix.transformPointX(this.transform.matrix.tx,this.transform.matrix.ty),top:a.flashOnHtml5_displayMatrix.transformPointY(this.transform.matrix.tx,this.transform.matrix.ty)});else{if("StageTracing_holder"===this.flashOnHtml5_documentElement.id&&a.parent){var c=a.flashOnHtml5_displayMatrix.transformPointX(this.x,this.y)+a.parent.flashOnHtml5_documentElement.offsetWidth/
2;a=a.flashOnHtml5_displayMatrix.transformPointY(this.x,this.y)+a.parent.flashOnHtml5_documentElement.offsetHeight/2;$(this.flashOnHtml5_documentElement).css({left:c,top:a})}}else $(this.flashOnHtml5_documentElement).css({left:this.x,top:this.y});return this.flashOnHtml5_displayMatrix.tx||this.flashOnHtml5_displayMatrix.ty?(this.flashOnHtml5_displayMatrix.translate(-this.flashOnHtml5_displayMatrix.tx,-this.flashOnHtml5_displayMatrix.ty),!0):!1}function c(a,c){c.flashOnHtml5_event=a;c.stageX=a.pageX;
c.stageY=a.pageY;for(var d=$(a.data.displayObject.flashOnHtml5_documentElement).offset(),e=a.pageX-d.left,d=a.pageY-d.top,f=a.data.displayObject,e=e/f.scaleX,d=d/f.scaleY,f=f.parent;f;)e/=f.scaleX,d/=f.scaleY,f=f.parent;c.localX=e;c.localY=d;c.altKey=a.altKey;c.ctrlKey=a.ctrlKey;c.delta=a.wheelDelta||0;c.buttonDown=1==a.which}function d(a){var d=new MouseEvent(MouseEvent.MOUSE_OVER);c(a,d);a.data.displayObject.dispatchEvent(d)}function e(a){var d=new MouseEvent(MouseEvent.MOUSE_OUT);c(a,d);a.data.displayObject.dispatchEvent(d)}
function f(a){var d=new MouseEvent(MouseEvent.MOUSE_DOWN);c(a,d);a.data.displayObject.dispatchEvent(d)}function h(a){var d=new MouseEvent(MouseEvent.MOUSE_UP);c(a,d);Sprite.flashOnHtml5_theDraggingSprite?(Sprite.flashOnHtml5_theDraggingSprite.flashOnHtml5_lastMouseUpPageX=a.pageX,Sprite.flashOnHtml5_theDraggingSprite.flashOnHtml5_lastMouseUpPageY=a.pageY,Sprite.flashOnHtml5_theDraggingSprite.dispatchEvent(d),a.stopPropagation()):a.data.displayObject.dispatchEvent(d)}function i(a){var d=new MouseEvent(MouseEvent.MOUSE_MOVE);
c(a,d);Sprite.flashOnHtml5_theDraggingSprite?(Sprite.flashOnHtml5_theDraggingSprite.dispatchEvent(d),a.stopPropagation()):a.data.displayObject.dispatchEvent(d)}function j(a,c){c.flashOnHtml5_event=a;c.stageX=a.originalEvent.changedTouches[0].pageX;c.stageY=a.originalEvent.changedTouches[0].pageY;for(var d=$(a.data.displayObject.flashOnHtml5_documentElement).offset(),e=c.stageX-d.left,d=c.stageY-d.top,f=a.data.displayObject,e=e/f.scaleX,d=d/f.scaleY,f=f.parent;f;)e/=f.scaleX,d/=f.scaleY,f=f.parent;
c.clientX=e;c.clientY=d;c.altKey=a.altKey;c.ctrlKey=a.ctrlKey;c.delta=a.wheelDelta||0;c.buttonDown=1==a.which}function k(a){a.preventDefault();if(!(1<a.originalEvent.touches.length)&&1==a.originalEvent.touches.length){var c=new TouchEvent(TouchEvent.TOUCH_START);j(a,c);a.data.displayObject.dispatchEvent(c)}}function l(a){a.preventDefault();if(!(1<a.originalEvent.touches.length)&&1==a.originalEvent.touches.length){var c=new TouchEvent(TouchEvent.TOUCH_MOVE);j(a,c);a.data.displayObject.dispatchEvent(c)}}
function m(a){a.preventDefault();if(!(1<a.originalEvent.changedTouches.length)&&1==a.originalEvent.changedTouches.length){var c=new TouchEvent(TouchEvent.TOUCH_END);j(a,c);a.data.displayObject.dispatchEvent(c)}}function n(a){a.preventDefault();if(!(1<a.originalEvent.touches.length)&&1==a.originalEvent.touches.length){var c=new TouchEvent(TouchEvent.TOUCH_CANCEL);j(a,c);a.data.displayObject.dispatchEvent(c)}}this.accessibilityProperties=null;this.alpha=1;this.blendMode="";this.blendShader=null;this.cacheAsBitmap=
!1;this.filters=this.cacheAsBitmapMatrix=null;this.height=0;this.mask=this.loaderInfo=null;this.mouseY=this.mouseX=0;this.name="";this.root=this.parent=this.opaqueBackground=null;this.rotation=0;this.setRotation=function(a){this.rotation!=a&&(this.transform.matrix.rotate(a*Math.PI/180),this.rotation=a,this.flashOnHtml5_refreshDisplayMatrix())};this.rotationZ=this.rotationY=this.rotationX=0;this.flashOnHtml5_displayMatrix=this.scale9Grid=null;this.flashOnHtml5_getCSSTransform=function(a){return{transform:a,
"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a}};this.flashOnHtml5_transformMatrixUpdated=function(){var c=this.transform.matrix;this.x=c.tx;this.y=c.ty;this.scaleX=c.a;this.scaleY=c.d;a.call(this)};this.flashOnHtml5_refreshDisplayMatrix=function(){var c=!1,d=this.flashOnHtml5_displayMatrix.clone();this.parent?(c=this.parent.flashOnHtml5_refreshDisplayMatrix(),this.flashOnHtml5_inheritMatrix(this.parent.flashOnHtml5_displayMatrix)):(this.flashOnHtml5_displayMatrix=this.transform.matrix.clone(),
a.call(this));d=this.flashOnHtml5_displayMatrix.a!=d.a||this.flashOnHtml5_displayMatrix.b!=d.b||this.flashOnHtml5_displayMatrix.c!=d.c||this.flashOnHtml5_displayMatrix.d!=d.d||this.flashOnHtml5_displayMatrix.tx!=d.tx||this.flashOnHtml5_displayMatrix.ty!=d.ty;return c||d};this.flashOnHtml5_inheritMatrix=function(c){this.flashOnHtml5_displayMatrix=c.clone();this.flashOnHtml5_displayMatrix.concat(this.transform.matrix);a.call(this)};this.scaleX=1;this.setScaleX=function(a){var c=this.scaleX;if(c!=a&&
(this.transform.matrix.scale(a/c,1),this.scaleX=a,this.flashOnHtml5_refreshDisplayMatrix(),this instanceof TraceHandle&&(this.x*=a/c),this.model)){var a=Math.round(this.model.photoWidth*this.scaleX),d=this.model.parentWidth;1===c?c=(this.model.parentWidth-a)/2:(c=this.flashOnHtml5_documentElement.offsetLeft+(this.flashOnHtml5_documentElement.offsetWidth-a)/2,newRight=c+a,0<c&&newRight>d?c-=Math.min(c,newRight-d):0>c&&newRight<d&&(c+=Math.min(-c,d-newRight)));$(this.flashOnHtml5_documentElement).css({width:a,
left:c})}};this.scaleY=1;this.setScaleY=function(a){var c=this.scaleY;if(c!=a&&(this.transform.matrix.scale(1,a/c),this.scaleY=a,this.flashOnHtml5_refreshDisplayMatrix(),this instanceof TraceHandle&&(this.y*=a/c),this.model)){var a=Math.round(this.model.photoHeight*this.scaleY),d=this.model.parentHeight;1===c?c=(this.model.parentHeight-a)/2:(c=this.flashOnHtml5_documentElement.offsetTop+(this.flashOnHtml5_documentElement.offsetHeight-a)/2,newBottom=c+a,0<c&&newBottom>d?c-=Math.min(c,newBottom-d):
0>c&&newBottom<d&&(c+=Math.min(-c,d-newBottom)));$(this.flashOnHtml5_documentElement).css({height:a,top:c})}};this.scaleZ=1;this.transform=this.stage=this.scrollRect=null;this.visible=!1;this.x=this.width=0;this.setX=function(a){this.x!=a&&1E-9<Math.abs(this.x-a)&&(this.x=a,this.transform.matrix.tx=a,this.flashOnHtml5_refreshDisplayMatrix())};this.y=0;this.setY=function(a){this.y!=a&&1E-9<Math.abs(this.y-a)&&(this.y=a,this.transform.matrix.ty=a,this.flashOnHtml5_refreshDisplayMatrix())};this.z=0;
this.visible=!0;this.onAddedToStage=function(a){this.stage||(this.stage=a.stage)};this.globalToLocal=function(a){var a=new Point(a.x,a.y),c=$(this.flashOnHtml5_documentElement).offset();a.x-=c.left;a.y-=c.top;a.x/=this.scaleX;a.y/=this.scaleY;for(c=this.parent;c;)a.x/=c.scaleX,a.y/=c.scaleY,c=c.parent;a.x+=this.capturedBitmap.x;a.y+=this.capturedBitmap.y;return a};this.getBounds=function(a){var c=a.holder,c=c.flashOnHtml5_displayMatrix.transformPoint(new Point(c.flashOnHtml5_bounds.width,c.flashOnHtml5_bounds.height));
return new Rectangle(a.flashOnHtml5_bounds.left+a.transform.matrix.tx,a.flashOnHtml5_bounds.top+a.transform.matrix.ty,c.x,c.y)};this.flashOnHtml5_setDomId=function(a){this.flashOnHtml5_documentElement.id=a};this.flashOnHtml5_constructor=function(){DisplayObject.prototype.flashOnHtml5_constructor.call(this);this.filters=[];this.transform=new Transform(this);this.transform.setMatrix(new Matrix(this.scaleX,0,0,this.scaleY,this.x,this.y));this.flashOnHtml5_displayMatrix=new Matrix;$(this.flashOnHtml5_documentElement).mouseover({displayObject:this},
d);$(this.flashOnHtml5_documentElement).mouseout({displayObject:this},e);$(this.flashOnHtml5_documentElement).mousedown({displayObject:this},f);$(this.flashOnHtml5_documentElement).mouseup({displayObject:this},h);$(this.flashOnHtml5_documentElement).mousemove({displayObject:this},i);this.flashOnHtml5_documentElement&&$(this.flashOnHtml5_documentElement).bind(TouchEvent.TOUCH_START,{displayObject:this},k);this.flashOnHtml5_documentElement&&$(this.flashOnHtml5_documentElement).bind(TouchEvent.TOUCH_MOVE,
{displayObject:this},l);this.flashOnHtml5_documentElement&&$(this.flashOnHtml5_documentElement).bind(TouchEvent.TOUCH_END,{displayObject:this},m);this.flashOnHtml5_documentElement&&$(this.flashOnHtml5_documentElement).bind(TouchEvent.TOUCH_CANCEL,{displayObject:this},n)};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}InteractiveObject.prototype=new DisplayObject(flashOnHtml5_constructingPrototype);InteractiveObject.prototype.constructor=InteractiveObject;
function InteractiveObject(){this.flashOnHtml5_constructor=function(){InteractiveObject.prototype.flashOnHtml5_constructor.call(this)};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}DisplayObjectContainer.prototype=new InteractiveObject(flashOnHtml5_constructingPrototype);DisplayObjectContainer.prototype.constructor=DisplayObjectContainer;
function DisplayObjectContainer(){this.flashOnHtml5_constructor=function(){this.flashOnHtml5_documentElement=document.createElement("div");this.flashOnHtml5_documentElement.className="DisplayObjectContainer";this.flashOnHtml5_bounds={left:0,top:0,width:0,height:0};this.children=[];this.numChildren=0;DisplayObjectContainer.prototype.flashOnHtml5_constructor.call(this);var a=this;window.setTimeout(function(){a.dispatchEvent({type:Event.COMPLETE})},0)};this.flashOnHtml5_refreshDisplayMatrix=function(){var a=
DisplayObjectContainer.prototype.flashOnHtml5_refreshDisplayMatrix.call(this);if(a)for(var c=0;c<this.children.length;c++)this.children[c].flashOnHtml5_inheritMatrix(this.flashOnHtml5_displayMatrix);return a};this.flashOnHtml5_getCSSTransform=function(a){return{transform:a,"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a}};this.flashOnHtml5_addObjectInDragSprite=function(a){var c=this.flashOnHtml5_documentElement,d=c.children[1],e=d.children[1],f=a.holder.flashOnHtml5_bounds,
h=a.holder.transform.matrix,i=this.parent.scaleX==this.parent.scaleY?this.parent.scaleX:Math.min(this.parent.scaleX,this.parent.scaleY),j=this.flashOnHtml5_getCSSTransform("scale("+i+","+i+")"),k=a.transform.matrix.tx*i,i=a.transform.matrix.ty*i;$(c).css(j);$(c).css({left:k,top:i});j=TracingUtils.tracedAreaForFeature(a.stageChildVO.feature);c=a.model.photoTrace[j].location.x+d.offsetWidth/2-h.tx;a=a.model.photoTrace[j].location.y+d.offsetHeight/2-h.ty;$(d).css({left:c,top:a});d=this.flashOnHtml5_getCSSTransform("matrix("+
h.a+","+h.b+","+h.c+","+h.d+","+h.tx+","+h.ty+")");$(e).css(f);$(e).css(d)};this.addChild=function(a){this.flashOnHtml5_documentElement.appendChild(a.flashOnHtml5_documentElement);"StageMain_dragSprite"==this.flashOnHtml5_documentElement.id?this.flashOnHtml5_addObjectInDragSprite(a):"StageTracing_holder"==this.flashOnHtml5_documentElement.id&&$(a.flashOnHtml5_documentElement).css({width:0,height:0});a.parent=this;this.children.push(a);this.numChildren++;a.flashOnHtml5_inheritMatrix(this.flashOnHtml5_displayMatrix);
a.flashOnHtml5_refreshDisplayMatrix();for(var c=null,d=this.parent;d&&d.flashOnHtml5_refreshBounds;d=d.parent)c=d;c&&c.flashOnHtml5_refreshBounds();a.dispatchEvent(new Event(Event.ADDED));this.stage&&(a.stage=this.stage,a.dispatchEvent(new Event(Event.ADDED_TO_STAGE)),a.refreshDisplay&&a.refreshDisplay())};this.addChildAt=function(a,c){a.parent=this;this.children.splice(c,0,a);this.numChildren++;a.dispatchEvent(new Event(Event.ADDED));this.stage||(this.stage=new Stage,this.dispatchEvent(new Event(Event.ADDED_TO_STAGE)));
this.stage&&(a.stage=this.stage,a.dispatchEvent(new Event(Event.ADDED_TO_STAGE)));c?$(this.children[c-1].flashOnHtml5_documentElement).after(a.flashOnHtml5_documentElement):$(this.flashOnHtml5_documentElement).prepend(a.flashOnHtml5_documentElement);a.refreshDisplay&&a.refreshDisplay();TracingUtils.isTracedAreaTwoSided(a.stageChildVO.tracedArea)&&a.refreshModel()};this.getChildAt=function(a){return this.children[a]};this.removeChildAt=function(a){a=this.children.splice(a,1);this.numChildren--;a=a[0];
a.parent=null;a.dispatchEvent({type:Event.REMOVED});a.stage=null;a.dispatchEvent({type:Event.REMOVED_FROM_STAGE})};this.flashOnHtml5_refreshBounds=function(){for(var a=this.flashOnHtml5_bounds.left=this.flashOnHtml5_bounds.top=this.flashOnHtml5_bounds.width=this.flashOnHtml5_bounds.height=0;a<this.numChildren;a++){var c=this.children[a];c.flashOnHtml5_refreshBounds&&c.flashOnHtml5_refreshBounds();var d;d=c.flashOnHtml5_bounds?c.flashOnHtml5_bounds:{left:0,top:0,width:0,height:0};var e=c.transform.matrix.transformPoint(new Point(d.left,
d.top)),f=c.transform.matrix.transformPoint(new Point(d.left+1*d.width,d.top)),h=c.transform.matrix.transformPoint(new Point(d.left,d.top+1*d.height)),i=c.transform.matrix.transformPoint(new Point(d.left+1*d.width,d.top+1*d.height));d=Math.min(e.x,f.x,h.x,i.x);var j=Math.min(e.y,f.y,h.y,i.y),k=Math.max(e.x,f.x,h.x,i.x),h=Math.max(e.y,f.y,h.y,i.y),e=k-d,f=h-j;if(this.flashOnHtml5_bounds.height&&f)h=Math.max(this.flashOnHtml5_bounds.top+this.flashOnHtml5_bounds.height,h),this.flashOnHtml5_bounds.top=
Math.min(this.flashOnHtml5_bounds.top,j),this.flashOnHtml5_bounds.height=h-this.flashOnHtml5_bounds.top;else if(f)this.flashOnHtml5_bounds.top=j,this.flashOnHtml5_bounds.height=f;else if(c.y||c.height)this.flashOnHtml5_bounds.top=c.y,this.flashOnHtml5_bounds.height=c.height;if(this.flashOnHtml5_bounds.width&&e)c=Math.max(this.flashOnHtml5_bounds.left+this.flashOnHtml5_bounds.width,k),this.flashOnHtml5_bounds.left=Math.min(this.flashOnHtml5_bounds.left,d),this.flashOnHtml5_bounds.width=c-this.flashOnHtml5_bounds.left;
else if(f)this.flashOnHtml5_bounds.left=d,this.flashOnHtml5_bounds.width=e;else if(c.x||c.width)this.flashOnHtml5_bounds.left=c.x,this.flashOnHtml5_bounds.width=c.width}return this.flashOnHtml5_bounds};this.flashOnHtml5_drawOnto=function(a){if(this.numChildren){var c=null,d;for(d=0;d<this.numChildren&&!c;d++)c=c||this.children[d].mask;for(d=0;d<this.numChildren;d++){var e=this.children[d];e.flashOnHtml5_drawOnto&&e!=c&&e.flashOnHtml5_drawOnto(a)}}};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&
this.flashOnHtml5_constructor()}Stage.prototype=new DisplayObjectContainer(flashOnHtml5_constructingPrototype);Stage.prototype.constructor=Stage;
function Stage(a){this.align=null;this.allowsFullScreen=!0;this.color=4294967295;this.colorCorrection="default";this.colorCorrectionSupport="defaultOff";this.displayState="normal";this.focus=null;this.frameRate=24;this.fullScreenHeight=0;this.fullScreenSourceRect=null;this.height=this.fullScreenWidth=0;this.mouseChildren=!0;this.quality="HIGH";this.scaleMode="noScale";this.showDefaultContextMenu=!0;this.softKeyboardRect=null;this.stageFocusRect=!0;this.stageHeight=0;this.stageVideos=null;this.stageWidth=
0;this.tabChildren=!0;this.textSnapshot=null;this.width=0;this.wmodeGPU=!1;if(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)this.flashOnHtml5_constructor(),a.appendChild(this.flashOnHtml5_documentElement),this.flashOnHtml5_setDomId("Stage"),Stage.flashOnHtml5_theStageJquery=$(this.flashOnHtml5_documentElement),this.fullScreenHeight=$(window).height(),this.fullScreenWidth=$(window).width(),this.height=this.stageHeight=$(a).height(),this.width=this.stageWidth=$(a).width()}
function BlendMode(){}BlendMode.ADD="add";BlendMode.ALPHA="alpha";BlendMode.DARKEN="darken";BlendMode.DIFFERENCE="difference";BlendMode.ERASE="erase";BlendMode.HARDLIGHT="hardlight";BlendMode.INVERT="invert";BlendMode.LAYER="layer";BlendMode.LIGHTEN="lighten";BlendMode.MULTIPLY="multiply";BlendMode.NORMAL="normal";BlendMode.OVERLAY="overlay";BlendMode.SCREEN="screen";BlendMode.SHADER="shader";BlendMode.SUBTRACT="subtract";Bitmap.prototype=new DisplayObject(flashOnHtml5_constructingPrototype);
Bitmap.prototype.constructor=Bitmap;
function Bitmap(a,c,d){a||(a=null);"undefined"==typeof c&&(c="auto");d||(d=!1);this.flashOnHtml5_constructor=function(){Bitmap.prototype.flashOnHtml5_constructor.call(this);this.flashOnHtml5_documentElement=document.createElement("canvas");this.flashOnHtml5_documentElement.className="Bitmap";a&&this.setBitmapData(a)};this.setBitmapData=function(a){this.bitmapData=a;null!=a?(this.width=a.width,this.height=a.height):this.height=this.width=0;for(var a=null,c=this.parent;c&&c.flashOnHtml5_refreshBounds;c=
c.parent)a=c;a&&a.flashOnHtml5_refreshBounds();this.refreshDisplay()};this.pixelSnapping=c;this.smoothing=d;this.refreshDisplay=function(){var a=this.flashOnHtml5_documentElement;if(this.bitmapData)a.width=this.bitmapData.width,a.height=this.bitmapData.height,a.getContext("2d").putImageData(this.bitmapData.imageData,0,0);else if(this.flashOnHtml5_documentElement.parentElement)a.width=$(this.flashOnHtml5_documentElement.parentElement).width(),a.height=$(this.flashOnHtml5_documentElement.parentElement).height();
else throw"Nothing to refresh";};this.onAddedToStage=function(){if(this.bitmapData){var a=this.flashOnHtml5_documentElement;a.width=this.bitmapData.width;a.height=this.bitmapData.height;a.getContext("2d");this.refreshDisplay()}};this.setVisible=function(a){null!=a&&(a?(this.flashOnHtml5_documentElement.style.visibility="visible",this.refreshDisplay()):this.flashOnHtml5_documentElement.style.visibility="hidden")};this.flashOnHtml5_drawOnto=function(a){if((!this.width||!this.height)&&(!this.imageData||
!this.imageData.width||!this.imageData.height))console.log("VME: Nothing to draw from Bitmap {width:"+this.width+",height:"+this.height+"}");else{var c=document.createElement("canvas");c.width=this.width;c.height=this.height;c=c.getContext("2d");this.bitmapData?this.bitmapData.flashOnHtml5_drawOnto(c):c.drawImage(this.flashOnHtml5_documentElement,0,0);var d,i=this.transform?this.transform.colorTransform:null;d=i||this.filters.length?new BitmapData(this.width,this.height,!0,null,c):null;i&&d.colorTransform(new Rectangle(0,
0,this.width,this.height),i);for(i=0;i<this.filters.length;i++)d.applyFilter(d,null,this.filters[i]);d&&c.putImageData(d.imageData,0,0);this.mask&&(c.globalCompositeOperation="destination-in",this.mask.flashOnHtml5_drawOnto(c));a.save();(d=this.transform?this.transform.matrix:null)?a.transform(d.a,d.b,d.c,d.d,d.tx,d.ty):(this.x||this.y)&&a.translate(this.x,this.y);a.drawImage(c.canvas,0,0);a.restore()}};this.dispose=function(){null!=this.bitmapData&&this.bitmapData.dispose();this.bitmapData=null;
this.height=this.width=0;this.flashOnHtml5_displayMatrix;this.parent=this.flashOnHtml5_documentElement=null};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}
function Graphics(a){function c(c){"undefined"==typeof c&&(c=k);var d=a.flashOnHtml5_displayMatrix.transformPoint(new Point(c.left,c.top)),e=a.flashOnHtml5_displayMatrix.transformPoint(new Point(c.left+c.width,c.top)),f=a.flashOnHtml5_displayMatrix.transformPoint(new Point(c.left,c.top+c.height)),m=a.flashOnHtml5_displayMatrix.transformPoint(new Point(c.left+c.width,c.top+c.height)),o=Math.max(d.x,e.x,f.x,m.x),s=Math.min(d.x,e.x,f.x,m.x),l=Math.max(d.y,e.y,f.y,m.y),d=Math.min(d.y,e.y,f.y,m.y),o=Math.max(o-
s,1),l=Math.max(l-d,1),e=Math.max(c.width,1),f=o/e,m=Math.max(c.height,1),t=l/m;if(1.2<f||1.2<t||k.width!=c.width||k.height!=c.height){var D;D=h.width&&h.height?j.getImageData(0,0,h.width,h.height):null;var A=j.fillStyle,B=j.strokeStyle,F=j.globalAlpha;h.width=Math.ceil(f*e);h.height=Math.ceil(t*m);j.fillStyle=A;j.strokeStyle=B;j.globalAlpha=F;j.setTransform(a.flashOnHtml5_displayMatrix.a,a.flashOnHtml5_displayMatrix.b,a.flashOnHtml5_displayMatrix.c,a.flashOnHtml5_displayMatrix.d,a.flashOnHtml5_displayMatrix.tx,
a.flashOnHtml5_displayMatrix.ty);j.translate(-c.left,-c.top);j.scale(f,t);i.css({left:s,top:d,width:o,height:l});D&&j.putImageData(D,k.left-c.left,k.top-c.top);k.left=c.left;k.top=c.top;k.width=c.width;k.height=c.height;if(n&&n.length){j.beginPath();for(c=0;c<n.length;c++)n[c].api.apply(j,n[c].args)}}}function d(d){a&&(a.width=Math.max(a.width,d.width),a.height=Math.max(a.height,d.height),"StageTracing_outline"==a.flashOnHtml5_documentElement.id&&(o*=a.flashOnHtml5_displayMatrix.a/2+a.flashOnHtml5_displayMatrix.d/
2));if(a instanceof TraceHandle||!("StageTracing_outline"!=a.flashOnHtml5_documentElement.id&&d.left>=k.left&&d.left+d.width<=k.left+k.width&&d.top>=k.top&&d.top+d.height<=k.top+k.height)){var e={};k.width?(e.left=Math.min(k.left,d.left-o),e.width=Math.max(k.left+k.width,d.left+d.width+o)-e.left):(e.left=d.left,e.width=d.width);k.height?(e.top=Math.min(k.top,d.top-o),e.height=Math.max(k.top+k.height,d.top+d.height+o)-e.top):(e.top=d.top,e.height=d.height);e.left=Math.floor(e.left);e.width=Math.ceil(e.width);
e.top=Math.floor(e.top);e.height=Math.ceil(e.height);c.call(this,e);o=20}}function e(a){return"#"+s.charAt(a>>20&15)+s.charAt(a>>16&15)+s.charAt(a>>12&15)+s.charAt(a>>8&15)+s.charAt(a>>4&15)+s.charAt(a&15)}var f=$(a.flashOnHtml5_documentElement),h=document.createElement("canvas");h.className="graphics";f.append(h);var i=$(h),j=h.getContext("2d"),k={left:0,top:0,width:0,height:0},l=0,m=0,n=[];this.flashOnHtml5_width=function(){return k.width};this.flashOnHtml5_height=function(){return k.height};this.flashOnHtml5_getCanvasBounds=
function(){return k};this.flashOnHtml5_drawOnto=function(a){h.width&&h.height&&a.drawImage(h,0,0)};this.clear=function(){h.width=h.height=k.left=k.top=k.width=k.height=0;a&&(a.width=a.height=0);this.beginFill(16777215,1)};this.beginFill=function(c,d){"undefined"==typeof d&&(d=1);a.flashOnHtml5_refreshDisplayMatrix();j.fillStyle=j.strokeStyle=e(c);j.globalAlpha=d;n=[];j.beginPath()};this.flashOnHtml5_inheritMatrixChanged=function(){c.call(this)};var o=20;this.drawCircle=function(c,e,f){a.flashOnHtml5_refreshDisplayMatrix();
var h={};a.flashOnHtml5_displayMatrix.b==-a.flashOnHtml5_displayMatrix.c&&0<=a.flashOnHtml5_displayMatrix.a&&(h.left=a.flashOnHtml5_displayMatrix.a*(c-f)+a.flashOnHtml5_displayMatrix.tx,h.width=a.flashOnHtml5_displayMatrix.a*(c+f)+a.flashOnHtml5_displayMatrix.tx-h.left);a.flashOnHtml5_displayMatrix.b==-a.flashOnHtml5_displayMatrix.c&&0<=a.flashOnHtml5_displayMatrix.d&&(h.top=a.flashOnHtml5_displayMatrix.d*(e-f)+a.flashOnHtml5_displayMatrix.ty,h.height=a.flashOnHtml5_displayMatrix.d*(e+f)+a.flashOnHtml5_displayMatrix.ty-
h.top);d(h);n.push({api:j.arc,args:[c,e,f,0,2*Math.PI]});j.arc(c,e,f,0,2*Math.PI);j.stroke()};this.drawEllipse=function(c,e,f,h){a.flashOnHtml5_refreshDisplayMatrix();var i={};a.flashOnHtml5_displayMatrix.b==-a.flashOnHtml5_displayMatrix.c&&0<=a.flashOnHtml5_displayMatrix.a&&(i.left=a.flashOnHtml5_displayMatrix.a*e+a.flashOnHtml5_displayMatrix.tx,i.width=a.flashOnHtml5_displayMatrix.a*f);a.flashOnHtml5_displayMatrix.b==-a.flashOnHtml5_displayMatrix.c&&0<=a.flashOnHtml5_displayMatrix.d&&(i.top=a.flashOnHtml5_displayMatrix.d*
c+a.flashOnHtml5_displayMatrix.ty,i.height=a.flashOnHtml5_displayMatrix.d*h);d(i);e+=f/2;c+=h/2;f=(f+h)/2/2;n.push({api:j.arc,args:[e,c,f,0,2*Math.PI]});j.arc(e,c,f,0,2*Math.PI);j.stroke()};this.endFill=function(){j.fill()};this.moveTo=function(c,e){a.flashOnHtml5_refreshDisplayMatrix();d({left:c-0.5,top:e-0.5,width:1,height:1});n.push({api:j.moveTo,args:[c,e]});j.moveTo(c,e);l=c;m=e};this.lineStyle=function(a,c,d,f,h,i,k,m){"undefined"==typeof a&&(a=NaN);"undefined"==typeof c&&(c=0);"undefined"==
typeof d&&(d=1);"undefined"==typeof h&&(h="normal");"undefined"==typeof i&&(i=null);"undefined"==typeof k&&(joins=null);"undefined"==typeof m&&(m=3);j.lineWidth=isNaN(a)?1:a;j.strokeStyle=e(c);j.globalAlpha=d;"normal"!=h&&alert("scaleMode "+h+" not yet implemented");i&&alert("caps not yet implemented");joins&&alert("joins not yet implemented");3!=m&&alert("miterLimit not yet implemented")};var s="0123456789ABCDEF";this.lineTo=function(c,e){a.flashOnHtml5_refreshDisplayMatrix();var f=Math.min(l,c),
h=Math.min(m,e),f={left:f,top:h,width:Math.max(l,c)-f,height:Math.max(m,e)-h};d(f);n.push({api:j.lineTo,args:[c,e]});j.lineTo(c,e);l=c;m=e};this.curveTo=function(a,c,e,f){var h=Math.min(l,a,e),i=Math.min(m,c,f),h={left:h,top:i,width:Math.max(l,a,e)-h,height:Math.max(m,c,f)-i};d(h);n.push({api:j.quadraticCurveTo,args:[a,c,e,f]});j.quadraticCurveTo(a,c,e,f);l=e;m=f};this.drawRect=function(c,e,f,h){a.flashOnHtml5_refreshDisplayMatrix();d({left:c,top:e,width:f,height:h});n.push({api:j.fillRect,args:[c,
e,f,h]});j.fillRect(c,e,f,h)}}Sprite.prototype=new DisplayObjectContainer(flashOnHtml5_constructingPrototype);Sprite.prototype.constructor=Sprite;
function Sprite(){function a(a){-1!==a.originalEvent.toString().indexOf("TouchEvent")?(Sprite.flashOnHtml5_lastMouseDownPageX=a.originalEvent.targetTouches[0].pageX,Sprite.flashOnHtml5_lastMouseDownPageY=a.originalEvent.targetTouches[0].pageY):(Sprite.flashOnHtml5_lastMouseDownPageX=a.pageX,Sprite.flashOnHtml5_lastMouseDownPageY=a.pageY)}function c(a){if(!("mousemove"!=a.type&&"touchmove"!=a.type))if(Sprite.flashOnHtml5_theDraggingSprite&&this==Sprite.flashOnHtml5_theDraggingSprite.flashOnHtml5_documentElement){var d,
e;"touchmove"===a.type?(d=a.touches[0].pageX,e=a.touches[0].pageY):(d=a.pageX,e=a.pageY);d=h.left+d-Sprite.flashOnHtml5_lastMouseDownPageX;e=h.top+e-Sprite.flashOnHtml5_lastMouseDownPageY;Sprite.flashOnHtml5_dragBounds?(d=Math.min(Math.max(d,i.minX),i.maxX),e=Math.min(Math.max(e,i.minY),i.maxY),$(this).css({left:d,top:e})):$(k.flashOnHtml5_documentElement).css({left:d,top:e});a.stopPropagation()}else this.removeEventListener("mousemove",c,!0),this.removeEventListener(TouchEvent.TOUCH_MOVE,c,!0),this.removeEventListener("gesturechange",
c,!0)}function d(a){if("gestureend"==a.type)e();else{-1!==a.toString().indexOf("TouchEvent")?(Sprite.flashOnHtml5_lastMouseUpPageX=a.changedTouches[0].pageX,Sprite.flashOnHtml5_lastMouseUpPageY=a.changedTouches[0].pageY):(Sprite.flashOnHtml5_lastMouseUpPageX=a.pageX,Sprite.flashOnHtml5_lastMouseUpPageY=a.pageY);if(Sprite.flashOnHtml5_theDraggingSprite&&this==Sprite.flashOnHtml5_theDraggingSprite.flashOnHtml5_documentElement){var d=h.left+Sprite.flashOnHtml5_lastMouseUpPageX-Sprite.flashOnHtml5_lastMouseDownPageX,
f=h.top+Sprite.flashOnHtml5_lastMouseUpPageY-Sprite.flashOnHtml5_lastMouseDownPageY;Sprite.flashOnHtml5_dragBounds?(d=Math.min(Math.max(d,i.minX),i.maxX),f=Math.min(Math.max(f,i.minY),i.maxY),$(this).css({left:d,top:f})):$(k.flashOnHtml5_documentElement).css({left:d,top:f})}else console.log("VME: WARN: flashOnHtml5 removing drag handler from mousemove for sprite whose dragging expired"),this.removeEventListener("mousemove",c,!0),this.removeEventListener(TouchEvent.TOUCH_MOVE,c,!0),this.removeEventListener("gesturechange",
c,!0);e();if(Sprite.flashOnHtml5_dragBounds)Sprite.flashOnHtml5_theDraggingSprite.onMouseUp(a)}}function e(){if(Sprite.flashOnHtml5_theDraggingSprite){var a=Sprite.flashOnHtml5_theDraggingSprite;a.flashOnHtml5_documentElement.removeEventListener("mousemove",c,!0);a.flashOnHtml5_documentElement.removeEventListener(TouchEvent.TOUCH_MOVE,c,!0);a.flashOnHtml5_documentElement.removeEventListener("mouseup",d,!0);a.flashOnHtml5_documentElement.removeEventListener(TouchEvent.TOUCH_END,d,!0);var e=Sprite.flashOnHtml5_lastMouseUpPageX-
Sprite.flashOnHtml5_lastMouseDownPageX;a.parent&&(e/=a.parent.flashOnHtml5_displayMatrix.a,a instanceof TraceHandle&&(e*=a.scaleX));if(Sprite.flashOnHtml5_dragBounds){var f=0;if(0<dragBoundsObject.leftX||0<dragBoundsObject.rightX)f=Math.min(Math.max(e,-dragBoundsObject.leftX),dragBoundsObject.rightX);else if(0>dragBoundsObject.leftX||0>dragBoundsObject.rightX)f=Math.min(Math.max(e,dragBoundsObject.rightX),-dragBoundsObject.leftX);a.setX(a.x+f)}else a.setX(a.x+e),a.transform.matrix.tx/=a.scaleX;f=
Sprite.flashOnHtml5_lastMouseUpPageY-Sprite.flashOnHtml5_lastMouseDownPageY;a.parent&&(f/=a.parent.flashOnHtml5_displayMatrix.d,a instanceof TraceHandle&&(f*=a.scaleY));if(Sprite.flashOnHtml5_dragBounds){var h=0;if(0<dragBoundsObject.topY||0<dragBoundsObject.bottomY)h=Math.min(Math.max(f,-dragBoundsObject.topY),dragBoundsObject.bottomY);else if(0>dragBoundsObject.topY||0>dragBoundsObject.bottomY)h=Math.min(Math.max(f,dragBoundsObject.bottomY),-dragBoundsObject.topY);a.setY(a.y+h)}else a.setY(a.y+
f),a.transform.matrix.ty/=a.scaleY;!Sprite.flashOnHtml5_dragBounds&&a instanceof StageMain&&(h=Sprite.flashOnHtml5_theDraggingSprite.scaleY,l.transform.matrix.tx+=e/Sprite.flashOnHtml5_theDraggingSprite.scaleX,l.transform.matrix.ty+=f/h,Sprite.flashOnHtml5_theDraggingSprite.renderCompleted());a instanceof TraceHandle&&(Sprite.flashOnHtml5_theDraggingSprite=null)}}var f=null;this.buttonMode=!1;this.soundTransform=this.hitArea=this.graphics=this.dropTarget=null;this.useHandCursor=!1;this.setVisible=
function(a){null!=a&&(this.visible=a);if(this.flashOnHtml5_documentElement){for(var a=!0,c=this.parent;a&&null!=c;)a=a&&c.visible,c=c.parent;this.flashOnHtml5_documentElement.style.visibility=this.visible&&a?"visible":"hidden";for(a=0;a<this.children.length;a++)this.children[a].setVisible()}};this.startDrag=function(a,e){var f,s,r,q;"undefined"==typeof e&&(e=null);Sprite.flashOnHtml5_dragBounds=e;h={left:this.flashOnHtml5_documentElement.offsetLeft,top:this.flashOnHtml5_documentElement.offsetTop};
e?(0<e.width?(r=-e.width,q=0):(r=0,q=-e.width),0<e.height?(f=-e.height,s=0):(f=0,s=-e.height),i={minX:r,maxX:q,minY:f,maxY:s},dragBoundsObject={leftX:h.left,rightX:(0==i.maxX?i.minX:i.maxX)-h.left,topY:h.top,bottomY:(0==i.maxY?i.minY:i.maxY)-h.top}):dragBoundsObject=i=null;"StageMain_dragSprite"==this.flashOnHtml5_documentElement.id?(this.parent.flashOnHtml5_documentElement.addEventListener("mousemove",c,!0),this.parent.flashOnHtml5_documentElement.addEventListener(TouchEvent.TOUCH_MOVE,c,!0),this.parent.flashOnHtml5_documentElement.addEventListener("mouseup",
d,!0),this.parent.flashOnHtml5_documentElement.addEventListener(TouchEvent.TOUCH_END,d,!0),Sprite.flashOnHtml5_theDraggingSprite=this.parent,j=Sprite.flashOnHtml5_theDraggingSprite.children[1],k=Sprite.flashOnHtml5_theDraggingSprite.children[2],l=k.children[0],document.getElementById("StageMain").style.overflow="hidden",j.setVisible(!1)):(this.flashOnHtml5_documentElement.addEventListener("mousemove",c,!0),this.flashOnHtml5_documentElement.addEventListener("touchmove",c,!0),this.flashOnHtml5_documentElement.addEventListener("gesturechange",
c,!0),this.flashOnHtml5_documentElement.addEventListener("mouseup",d,!0),this.flashOnHtml5_documentElement.addEventListener("touchend",d,!0),this.flashOnHtml5_documentElement.addEventListener("gestureend",d,!0),Sprite.flashOnHtml5_theDraggingSprite=this,k=this)};var h,i,j,k,l;this.stopDrag=e;this.stopDragMode=function(){if(Sprite.flashOnHtml5_theDraggingSprite){var a=Sprite.flashOnHtml5_theDraggingSprite;!Sprite.flashOnHtml5_dragBounds&&a instanceof StageMain&&(a.parent.model.dragModeFeature=-1,Sprite.flashOnHtml5_theDraggingSprite.model.dragFeature=
-1,Sprite.flashOnHtml5_theDraggingSprite.renderCompleted(),$(k.flashOnHtml5_documentElement).css({left:0,top:0}),k.flashOnHtml5_documentElement.removeChild(l.flashOnHtml5_documentElement));Sprite.flashOnHtml5_theDraggingSprite=null}else 0<this.parent.model.dragFeature&&(this.parent.model.dragFeature=-1,this.parent.model.dragModeFeature=-1,this.parent.model.stageMain.renderCompleted())};this.getGraphics=function(){null==this.graphics&&(this.graphics=new Graphics(this));return this.graphics};this.flashOnHtml5_constructor=
function(){Sprite.prototype.flashOnHtml5_constructor.call(this);this.graphics=null;this.transform.flashOnHtml5_canvasContext=this.getGraphics().flashOnHtml5_canvasContext;f=$(this.flashOnHtml5_documentElement);f.mousedown(a);f.bind(TouchEvent.TOUCH_START,a)};if(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)this.flashOnHtml5_constructor(),this.flashOnHtml5_documentElement.className+=" Sprite";this.flashOnHtml5_inheritMatrix=function(a){Sprite.prototype.flashOnHtml5_inheritMatrix.call(this,
a);this.getGraphics().flashOnHtml5_inheritMatrixChanged()};this.flashOnHtml5_inheritMatrixChanged=function(){Sprite.prototype.flashOnHtml5_inheritMatrixChanged.call(this);this.getGraphics().flashOnHtml5_inheritMatrixChanged()};this.flashOnHtml5_refreshBounds=function(){Sprite.prototype.flashOnHtml5_refreshBounds.call(this);var a=this.getGraphics().flashOnHtml5_getCanvasBounds();if(this.flashOnHtml5_bounds.width&&a.width){var c=Math.max(this.flashOnHtml5_bounds.left+this.flashOnHtml5_bounds.width,
a.left+a.width);this.flashOnHtml5_bounds.left=Math.min(this.flashOnHtml5_bounds.left,a.left);this.flashOnHtml5_bounds.width=c-this.flashOnHtml5_bounds.left}else a.width&&(this.flashOnHtml5_bounds.left=a.left,this.flashOnHtml5_bounds.width=a.width);this.flashOnHtml5_bounds.height&&a.height?(c=Math.max(this.flashOnHtml5_bounds.top+this.flashOnHtml5_bounds.height,a.top+a.height),this.flashOnHtml5_bounds.top=Math.min(this.flashOnHtml5_bounds.top,a.top),this.flashOnHtml5_bounds.height=c-this.flashOnHtml5_bounds.top):
a.height&&(this.flashOnHtml5_bounds.top=a.top,this.flashOnHtml5_bounds.height=a.height);return this.flashOnHtml5_bounds};this.flashOnHtml5_drawOnto=function(a,c,d){var e=this.flashOnHtml5_refreshBounds();this.width=Math.ceil(e.width);this.height=Math.ceil(e.height);var f;if(!(0==this.width||0==this.height)){f=document.createElement("canvas");f.width=this.width;f.height=this.height;f=f.getContext("2d");f.translate(-e.left,-e.top);var h=this.getGraphics().flashOnHtml5_getCanvasBounds();h.width&&h.height&&
(f.save(),f.translate(h.left,h.top),this.getGraphics().flashOnHtml5_drawOnto(f),f.restore());Sprite.prototype.flashOnHtml5_drawOnto.call(this,f);var i;this.filters&&(i=d||this.filters.length?new BitmapData(this.width,this.height,!0,null,f):null);d&&i.colorTransform(new Rectangle(0,0,this.width,this.height),d);if(this.filters)for(d=0;d<this.filters.length;d++)i.applyFilter(i,e,this.filters[d]);i&&f.putImageData(i.imageData,0,0);this.mask&&(f.globalCompositeOperation="destination-out",this.mask.flashOnHtml5_drawOnto(f));
a.save();(i=this.transform?this.transform.matrix:null)?a.transform(i.a,i.b,i.c,i.d,i.tx,i.ty):a.translate(this.x,this.y);a.translate(e.left,e.top);a.globalAlpha=this.alpha;switch(c||this.blendMode||BlendMode.NORMAL){case BlendMode.ADD:a.globalCompositeOperation="lighter";a.drawImage(f.canvas,0,0);break;case BlendMode.ERASE:a.globalCompositeOperation="destination-out";a.drawImage(f.canvas,0,0);break;case BlendMode.NORMAL:a.globalCompositeOperation="source-over";a.drawImage(f.canvas,0,0);break;case BlendMode.DARKEN:c=
a.getImageData(this.x,this.y,this.width,this.height);e=f.getImageData(0,0,this.width,this.height);for(i=0;i<4*e.height*e.width;i+=4)0<c.data[i+3]&&(e.data[i]=Math.min(c.data[i],e.data[i]),e.data[i+1]=Math.min(c.data[i+1],e.data[i+1]),e.data[i+2]=Math.min(c.data[i+2],e.data[i+2]));f.putImageData(e,0,0);a.drawImage(f.canvas,0,0);break;default:throw"unexpected blend mode";}a.restore()}};this.flashOnHtml5_makeRootOfNewStage=function(a){a.appendChild(this.flashOnHtml5_documentElement);this.width=f.width();
this.height=f.height();this.stage=new Stage(this.flashOnHtml5_documentElement);this.dispatchEvent(new Event(Event.ADDED_TO_STAGE));document.getElementById("vme").style.width="100%";document.getElementById("vme").style.backgroundColor="lightgray";document.getElementById("flashOnHtml5_vme").style.overflow="hidden";this.stage.stageWidth=a.clientWidth;this.stage.stageHeight=a.clientHeight};this.dispose=function(){this.graphics.clear();for(this.width=this.height=0;0<this.numChildren;)this.getChildAt(this.numChildren-
1).dispose(),this.removeChildAt(this.numChildren-1);for(var a in this)delete this[a]}}function LoaderContext(){this.allowLoadBytesCodeExecution=this.allowCodeImport=!1;this.applicationDomain=null;this.checkPolicyFile=!1;this.imageDecodingPolicy="";this.securityDomain=this.requestedContentParent=this.parameters=null}
function URLRequest(a){"undefined"==typeof a&&(a=null);this.contentType="";this.data=null;this.digest="";this.followRedirects=!1;this.method="GET";this.requestHeaders=null;this.url=a;this.userAgent=""}function BlurFilter(a,c,d,e){"undefined"==typeof a&&(a=4);"undefined"==typeof c&&(c=4);"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e="default");this.blurX=a;this.blurY=c;this.quality=d;this.hint=e}function BitmapFilter(){this.clone=function(){}}function BitmapFilterQuality(){}
BitmapFilterQuality.HIGH=3;BitmapFilterQuality.LOW=1;BitmapFilterQuality.MEDIUM=2;ColorMatrixFilter.prototype=new BitmapFilter;ColorMatrixFilter.prototype.constructor=ColorMatrixFilter;function ColorMatrixFilter(a){"undefined"==typeof a&&(a=null);this.matrix=a;this.clone=function(){return new ColorMatrixFilter(a.clone())}}ConvolutionFilter.prototype=new BitmapFilter;ConvolutionFilter.prototype.constructor=ConvolutionFilter;
function ConvolutionFilter(a,c,d,e,f,h,i,j,k){"undefined"==typeof a&&(a=0);"undefined"==typeof c&&(c=0);"undefined"==typeof d&&(d=null);"undefined"==typeof e&&(e=1);"undefined"==typeof f&&(f=0);"undefined"==typeof h&&(h=!0);"undefined"==typeof i&&(i=!0);"undefined"==typeof j&&(j=0);"undefined"==typeof k&&(k=0);this.matrixX=a;this.matrixY=c;this.matrix=d;this.divisor=e;this.bias=f;this.preserveAlpha=h;this.clamp=i;this.color=j;this.alpha=k}
function BitmapData(a,c,d,e,f){function h(a,c,d,e,f,h){a=a.data;a[c+0]=d;a[c+1]=e;a[c+2]=f;a[c+3]=h}function i(){this.a=this.b=this.g=this.r=0;this.next=null}var j;"undefined"===typeof e&&(e=4294967295);this.height=c||0;this.rect=new Rectangle(0,0,a,c);this.transparent=d||!1;this.width=a||0;f&&f.getImageData?j=f:(f=document.createElement("canvas"),f.width=this.width,f.height=this.height,j=f.getContext("2d"));"number"===typeof e&&(j.save(),j.fillStyle=d?"rgba("+(e>>16&255)+", "+(e>>8&255)+", "+(e&
255)+", "+1*(e>>24&255)/255+")":"#"+"0123456789ABCDEF".charAt(e>>20&15)+"0123456789ABCDEF".charAt(e>>16&15)+"0123456789ABCDEF".charAt(e>>12&15)+"0123456789ABCDEF".charAt(e>>8&15)+"0123456789ABCDEF".charAt(e>>4&15)+"0123456789ABCDEF".charAt(e&15),j.fillRect(0,0,a,c),j.restore());this.imageData=j.getImageData(0,0,this.width,this.height);this.copyPixels=function(a,c,d,e,f,h){typeof e==="undefined"&&(e=null);typeof f==="undefined"&&(f=null);typeof h==="undefined"&&(h=false);var i=a.imageData.data,a=a.imageData.width,
j=e?e.imageData.data:null,e=e?e.imageData.width:0,k=this.imageData.data,o=this.imageData.width,l,m,B,n,C,G,N;l=c.top;f=f?f.y:0;for(d=d.y;l<c.bottom;l++,f++,d++){m=4*a*l+4*c.left;B=4*e*f;n=4*o*d;C=m+4*c.width;for(G=c.left;m<C;G++,m=m+4,B=B+4,n=n+4)if((N=i[m+3])||h){k[n]=i[m];k[n+1]=i[m+1];k[n+2]=i[m+2];k[n+3]=j?(N+j[B+3])/2:N}}};this.draw=function(a,c,d,e){typeof c==="undefined"&&(c=null);typeof d==="undefined"&&(d=null);typeof e==="undefined"&&(e=null);a instanceof Sprite&&a.getGraphics().endFill();
d&&(a.width===this.width&&a.height===this.height)&&a.colorTransform(this.rect,d);if(a.flashOnHtml5_drawOnto){j.putImageData(this.imageData,0,0);if(c){j.save();j.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty);a.flashOnHtml5_drawOnto(j,e);j.restore()}else a.flashOnHtml5_drawOnto(j,e)}else throw"Unexpected source specified to draw into BitmapData";d&&this.colorTransform(this.rect,d);this.imageData=j.getImageData(0,0,this.width,this.height)};this.flashOnHtml5_drawOnto=function(a){var c=document.createElement("canvas");
c.width=this.imageData.width;c.height=this.imageData.height;c.getContext("2d").putImageData(this.imageData,0,0);a.drawImage(c,0,0)};this.colorTransform=function(a,c){var d=c.redMultiplier,e=c.greenMultiplier,f=c.blueMultiplier,h=c.alphaMultiplier,i=c.redOffset,j=c.greenOffset,k=c.blueOffset,o=c.alphaOffset;if(d!=1||i!=0||e!=1||j!=0||f!=1||k!=0||h!=1||o!=0){var l=this.imageData.data,m=Math.ceil(a.y+a.height),B,n,C,G;if(a.x==0&&a.y==0&&a.width==this.imageData.width&&a.height==this.imageData.height)if(d==
1&&e==1&&f==1)if(i==0&&j==0&&k==0&&o==0)if(h<1)for(n=3;n<l.length;n=n+4)l[n]=l[n]*h;else for(n=3;n<l.length;n=n+4)l[n]=Math.max(0,Math.min(255,l[n]*h));else for(n=0;n<l.length;n=n+4){l[n]=Math.max(0,Math.min(255,l[n]+i));l[n+1]=Math.max(0,Math.min(255,l[n+1]+j));l[n+2]=Math.max(0,Math.min(255,l[n+2]+k));l[n+3]=Math.max(0,Math.min(255,l[n+3]*h+o))}else for(n=0;n<l.length;n=n+4){l[n]=Math.max(0,Math.min(255,l[n]*d+i));l[n+1]=Math.max(0,Math.min(255,l[n+1]*e+j));l[n+2]=Math.max(0,Math.min(255,l[n+2]*
f+k));l[n+3]=Math.max(0,Math.min(255,l[n+3]*h+o))}else for(B=Math.floor(a.y);B<m;B++){n=4*(B*this.imageData.width+Math.floor(a.x));C=Math.ceil(a.x+a.width);for(G=Math.floor(a.x);G<C;G++,n=n+4){l[n]=Math.max(0,Math.min(255,l[n]*d+i));l[n+1]=Math.max(0,Math.min(255,l[n+1]*e+j));l[n+2]=Math.max(0,Math.min(255,l[n+2]*f+k));l[n+3]=Math.max(0,Math.min(255,l[n+3]*h+o))}}}};this.applyFilter=function(a,c,d){var e=parseInt(c?c.width:j.canvas.getAttribute("width")),f=parseInt(c?c.height:j.canvas.getAttribute("height")),
h=null;if(d instanceof BlurFilter)if(d.hint=="alphaonly"){var o=a.imageData,n=j,u=(d.blurX+d.blurY)/2;if(!(isNaN(u)||u<1)){var u=u|0,t=o.data,D,A,B,F,C,G,N,H,O,L,M,P=u+u+1,Q=e-1,U=f-1,E=u+1,R=E*(E+1)/2,I=new i,J=I;for(B=1;B<P;B++){J=J.next=new i;if(B==E)var T=J}J.next=I;var V=null,W=null;N=G=0;var Xa=l[u],qb=m[u];for(A=0;A<f;A++){L=H=0;O=E*(M=t[G+3]);H=H+R*M;J=I;for(B=0;B<E;B++){J.a=M;J=J.next}for(B=1;B<E;B++){F=G+((Q<B?Q:B)<<2);H=H+(J.a=M=t[F+3])*(E-B);L=L+M;J=J.next}V=I;W=T;for(D=0;D<e;D++){t[G+
3]=H*Xa>>qb;H=H-O;O=O-V.a;F=N+((F=D+u+1)<Q?F:Q)<<2;L=L+(V.a=t[F+3]);H=H+L;V=V.next;O=O+(M=W.a);L=L-M;W=W.next;G=G+4}N=N+e}for(D=0;D<e;D++){L=H=0;G=D<<2;O=E*(M=t[G+3]);H=H+R*M;J=I;for(B=0;B<E;B++){J.a=M;J=J.next}C=e;for(B=1;B<=u;B++){G=C+D<<2;H=H+(J.a=M=t[G+3])*(E-B);L=L+M;J=J.next;B<U&&(C=C+e)}G=D;V=I;W=T;for(A=0;A<f;A++){F=G<<2;t[F+3]=H*Xa>>qb;H=H-O;O=O-V.a;F=D+((F=A+E)<U?F:U)*e<<2;H=H+(L=L+(V.a=t[F+3]));V=V.next;O=O+(M=W.a);L=L-M;W=W.next;G=G+e}}n.putImageData(o,0,0)}}else if(d.hint=="blueonly"){var $a=
a.imageData,Ya=j,za=(d.blurX+d.blurY)/2;if(!(isNaN(za)||za<1)){var za=za|0,Da=$a.data,La,ia,da,ta,ab,ua,Oa,ga,ra,va,aa,Ta=za+za+1,hb=e-1,Aa=f-1,wa=za+1,ma=wa*(wa+1)/2,Fa=new i,fa=Fa;for(da=1;da<Ta;da++){fa=fa.next=new i;if(da==wa)var Ua=fa}fa.next=Fa;var Ga=null,na=null;Oa=ua=0;var eb=l[za],ib=m[za];for(ia=0;ia<f;ia++){va=ga=0;ra=wa*(ba=Da[ua]);ga=ga+ma*aa;fa=Fa;for(da=0;da<wa;da++){fa.b=aa;fa=fa.next}for(da=1;da<wa;da++){ta=ua+((hb<da?hb:da)<<2);ga=ga+(fa.b=aa=Da[ta])*(wa-da);va=va+aa;fa=fa.next}Ga=
Fa;na=Ua;for(La=0;La<e;La++){Da[ua]=ga*eb>>ib;ga=ga-ra;ra=ra-Ga.b;ta=Oa+((ta=La+za+1)<hb?ta:hb)<<2;va=va+(Ga.b=Da[ta]);ga=ga+va;Ga=Ga.next;ra=ra+(aa=na.b);va=va-aa;na=na.next;ua=ua+4}Oa=Oa+e}for(La=0;La<e;La++){va=ga=0;ua=La<<2;ra=wa*(aa=Da[ua]);ga=ga+ma*aa;fa=Fa;for(da=0;da<wa;da++){fa.b=aa;fa=fa.next}ab=e;for(da=1;da<=za;da++){ua=ab+La<<2;ga=ga+(fa.b=aa=Da[ua])*(wa-da);va=va+aa;fa=fa.next;da<Aa&&(ab=ab+e)}ua=La;Ga=Fa;na=Ua;for(ia=0;ia<f;ia++){ta=ua<<2;Da[ta]=ga*eb>>ib;ga=ga-ra;ra=ra-Ga.b;ta=La+
((ta=ia+wa)<Aa?ta:Aa)*e<<2;ga=ga+(va=va+(Ga.b=Da[ta]));Ga=Ga.next;ra=ra+(aa=na.b);va=va-aa;na=na.next;ua=ua+e}}Ya.putImageData($a,0,0)}}else{var rb=a.imageData,lb=j,Ea=(d.blurX+d.blurY)/2;if(!(isNaN(Ea)||Ea<1)){var Ea=Ea|0,S=rb.data,oa,Pa,ea,ca,jb,Y,bb,X,pa,qa,ja,Qa,Ra,Va,Wa,ka,Ha,Ia,Ja,Ma,sa,Ba,la,fb,wb=Ea+Ea+1,vb=e-1,xb=f-1,xa=Ea+1,cb=xa*(xa+1)/2,mb=new i,Z=mb;for(ea=1;ea<wb;ea++){Z=Z.next=new i;if(ea==xa)var yb=Z}Z.next=mb;var ha=null,Na=null;bb=Y=0;var Ca=l[Ea],Sa=m[Ea];for(Pa=0;Pa<f;Pa++){ka=
Ha=Ia=Ja=X=pa=qa=ja=0;Qa=xa*(Ma=S[Y]);Ra=xa*(sa=S[Y+1]);Va=xa*(Ba=S[Y+2]);Wa=xa*(la=S[Y+3]);X=X+cb*Ma;pa=pa+cb*sa;qa=qa+cb*Ba;ja=ja+cb*la;Z=mb;for(ea=0;ea<xa;ea++){Z.r=Ma;Z.g=sa;Z.b=Ba;Z.a=la;Z=Z.next}for(ea=1;ea<xa;ea++){ca=Y+((vb<ea?vb:ea)<<2);X=X+(Z.r=Ma=S[ca])*(fb=xa-ea);pa=pa+(Z.g=sa=S[ca+1])*fb;qa=qa+(Z.b=Ba=S[ca+2])*fb;ja=ja+(Z.a=la=S[ca+3])*fb;ka=ka+Ma;Ha=Ha+sa;Ia=Ia+Ba;Ja=Ja+la;Z=Z.next}ha=mb;Na=yb;for(oa=0;oa<e;oa++){S[Y+3]=la=ja*Ca>>Sa;if(la!=0){S[Y]=X*Ca>>Sa;S[Y+1]=pa*Ca>>Sa;S[Y+2]=qa*
Ca>>Sa}else S[Y]=S[Y+1]=S[Y+2]=0;X=X-Qa;pa=pa-Ra;qa=qa-Va;ja=ja-Wa;Qa=Qa-ha.r;Ra=Ra-ha.g;Va=Va-ha.b;Wa=Wa-ha.a;ca=bb+((ca=oa+Ea+1)<vb?ca:vb)<<2;ka=ka+(ha.r=S[ca]);Ha=Ha+(ha.g=S[ca+1]);Ia=Ia+(ha.b=S[ca+2]);Ja=Ja+(ha.a=S[ca+3]);X=X+ka;pa=pa+Ha;qa=qa+Ia;ja=ja+Ja;ha=ha.next;Qa=Qa+(Ma=Na.r);Ra=Ra+(sa=Na.g);Va=Va+(Ba=Na.b);Wa=Wa+(la=Na.a);ka=ka-Ma;Ha=Ha-sa;Ia=Ia-Ba;Ja=Ja-la;Na=Na.next;Y=Y+4}bb=bb+e}for(oa=0;oa<e;oa++){Ha=Ia=Ja=ka=pa=qa=ja=X=0;Y=oa<<2;Qa=xa*(Ma=S[Y]);Ra=xa*(sa=S[Y+1]);Va=xa*(Ba=S[Y+2]);
Wa=xa*(la=S[Y+3]);X=X+cb*Ma;pa=pa+cb*sa;qa=qa+cb*Ba;ja=ja+cb*la;Z=mb;for(ea=0;ea<xa;ea++){Z.r=Ma;Z.g=sa;Z.b=Ba;Z.a=la;Z=Z.next}jb=e;for(ea=1;ea<=Ea;ea++){Y=jb+oa<<2;X=X+(Z.r=Ma=S[Y])*(fb=xa-ea);pa=pa+(Z.g=sa=S[Y+1])*fb;qa=qa+(Z.b=Ba=S[Y+2])*fb;ja=ja+(Z.a=la=S[Y+3])*fb;ka=ka+Ma;Ha=Ha+sa;Ia=Ia+Ba;Ja=Ja+la;Z=Z.next;ea<xb&&(jb=jb+e)}Y=oa;ha=mb;Na=yb;for(Pa=0;Pa<f;Pa++){ca=Y<<2;S[ca+3]=la=ja*Ca>>Sa;if(la>0){S[ca]=X*Ca>>Sa;S[ca+1]=pa*Ca>>Sa;S[ca+2]=qa*Ca>>Sa}else S[ca]=S[ca+1]=S[ca+2]=0;X=X-Qa;pa=pa-Ra;
qa=qa-Va;ja=ja-Wa;Qa=Qa-ha.r;Ra=Ra-ha.g;Va=Va-ha.b;Wa=Wa-ha.a;ca=oa+((ca=Pa+xa)<xb?ca:xb)*e<<2;X=X+(ka=ka+(ha.r=S[ca]));pa=pa+(Ha=Ha+(ha.g=S[ca+1]));qa=qa+(Ia=Ia+(ha.b=S[ca+2]));ja=ja+(Ja=Ja+(ha.a=S[ca+3]));ha=ha.next;Qa=Qa+(Ma=Na.r);Ra=Ra+(sa=Na.g);Va=Va+(Ba=Na.b);Wa=Wa+(la=Na.a);ka=ka-Ma;Ha=Ha-sa;Ia=Ia-Ba;Ja=Ja-la;Na=Na.next;Y=Y+e}}lb.putImageData(rb,0,0)}}else if(d instanceof ConvolutionFilter)e!=j.canvas.getAttribute("width")||f!=j.canvas.getAttribute("height")?h=k.convolution:d.matrixX==5&&d.matrixY==
5&&d.bias==0&&d.divisor==1?ShaderConvolution5x5(a.imageData,d):d.matrixX==3&&d.matrixY==3&&d.bias==0&&d.divisor==1?ShaderConvolution3x3(a.imageData,d):h=k.convolution;else if(d instanceof ColorMatrixFilter){if(d.matrix!=null)if(e!=j.canvas.getAttribute("width")||f!=j.canvas.getAttribute("height"))h=k.colorMatrix;else if(d.matrix[3]==0&&d.matrix[8]==0&&d.matrix[13]==0&&d.matrix[15]==0&&d.matrix[16]==0&&d.matrix[17]==0&&d.matrix[18]==1&&d.matrix[19]==0)if(d.matrix[4]==0&&d.matrix[9]==0&&d.matrix[14]==
0)for(var Za=d.matrix,kb=a.imageData.data,zb=Za[0],Ab=Za[1],Ka=Za[2],Gb=Za[5],Hb=Za[6],Ib=Za[7],Bb=Za[10],sb=Za[11],tb=Za[12],nb=0;nb<kb.length;nb=nb+4){var Jb=kb[nb],Kb=kb[nb+1],Lb=kb[nb+2];kb[nb]=zb*Jb+Ab*Kb+Ka*Lb;kb[nb+1]=Gb*Jb+Hb*Kb+Ib*Lb;kb[nb+2]=Bb*Jb+sb*Kb+tb*Lb}else for(var db=d.matrix,ub=a.imageData.data,Qb=db[0],Rb=db[1],Sb=db[2],Tb=db[4],Ub=db[5],Vb=db[6],Wb=db[7],Xb=db[9],Yb=db[10],Zb=db[11],$b=db[12],ac=db[14],ob=0;ob<ub.length;ob=ob+4){var Mb=ub[ob],Nb=ub[ob+1],Ob=ub[ob+2];ub[ob]=Qb*
Mb+Rb*Nb+Sb*Ob+Tb;ub[ob+1]=Ub*Mb+Vb*Nb+Wb*Ob+Xb;ub[ob+2]=Yb*Mb+Zb*Nb+$b*Ob+ac}else for(var ya=d.matrix,pb=a.imageData.data,bc=ya[0],cc=ya[1],dc=ya[2],ec=ya[3],fc=ya[4],gc=ya[5],hc=ya[6],ic=ya[7],jc=ya[8],kc=ya[9],lc=ya[10],mc=ya[11],nc=ya[12],oc=ya[13],pc=ya[14],qc=ya[15],rc=ya[16],sc=ya[17],tc=ya[18],uc=ya[19],gb=0;gb<pb.length;gb=gb+4){var Cb=pb[gb],Db=pb[gb+1],Eb=pb[gb+2],Fb=pb[gb+3];pb[gb]=bc*Cb+cc*Db+dc*Eb+ec*Fb+fc;pb[gb+1]=gc*Cb+hc*Db+ic*Eb+jc*Fb+kc;pb[gb+2]=lc*Cb+mc*Db+nc*Eb+oc*Fb+pc;pb[gb+
3]=qc*Cb+rc*Db+sc*Eb+tc*Fb+uc}}else throw"applyFilter: filter not implemented ("+d+")";if(h!=null){h.filter=d;for(var Pb=0;Pb<h.numPassesRequired;Pb++)k.run(a,j,e,f,h,Pb)}};this.threshold=function(a,c,d,e,f,h,i,j){f=f>>>0;typeof h==="undefined"&&(h=0);typeof j==="undefined"&&(j=false);var i=0,k,l,o,m,n=(f&16711680)>>>16,F=(f&65280)>>>8,C=(f&255)>>>0,G,N,H,O;if(e=="<"&&(h&4278190080)>>0==0&&!j){f=c.top;for(k=d.y;f<c.top+c.height;f++,k++){G=f*a.width*4+c.left*4;N=k*a.width*4+d.x*4;l=c.left;for(o=d.x;l<
c.top+c.width;l++,o++){if(a.imageData.data[G]<n||a.imageData.data[G+1]<F||a.imageData.data[G+2]<C){this.imageData.data[N+3]=0;i++}G=G+4;N=N+4}}}else{f=c.top;for(k=d.y;f<c.top+c.height;f++,k++){G=f*a.width*4+c.left*4;N=k*a.width*4+d.x*4;l=c.left;for(o=d.x;l<c.top+c.width;l++,o++){m=a.imageData.data[G];H=a.imageData.data[G+1];O=a.imageData.data[G+2];switch(e){case "<":m=m<n||H<F||O<C;break;case "<=":m=m<=n||H<=F||O<=C;break;case ">":m=m>n||H>F||O>C;break;case ">=":m=m>=n||H>=F||O>=C;break;default:throw"unexpected operation";
}if(m){this.setPixel32(o,k,h);i++}else if(j){this.setPixel32(o,k,void 0);i++}G=G+4;N=N+4}}}return i};var k={gaussFact:[1,6,15,20,15,6,1],gaussWidth:7,scanForMinMaxXy:function(a,c,d){var e=c*4,f=c,h=d,i=0,j=0,a=a.data,l,o,m;for(l=0;l<d;l++){o=l*e+3;for(m=0;m<c;m++,o=o+4)if(a[o]){f=Math.min(m,f);h=Math.min(l,h);i=Math.max(m,i);j=Math.max(l,j)}}k.minX=f;k.minY=h;k.maxX=i;k.maxY=j},run:function(a,c,d,e,f,h){c.getImageData(0,0,d,e);if(h==0){a=a.imageData;k.scanForMinMaxXy(a,d,e)}else a=c.getImageData(0,
0,d,e);for(var c=Math.max(0,k.minX-f.maxInfluenceDistance),i=Math.max(0,k.minY-f.maxInfluenceDistance),j=Math.min(d,k.maxX+f.maxInfluenceDistance),e=Math.min(e,k.maxY+f.maxInfluenceDistance),l,d=d*4,o;i<e;i++)for(o=c;o<j;o++){l=i*d+o*4;f(a,a,l,o,i,h,f.filter)}},gaussBlur:function(a,c,d,e,f,i){if(i==0&&(e<=0||e>=a.width-1))h(c,d,a.data[d+0],a.data[d+1],a.data[d+2],a.data[d+3]);else if(i==1&&(f<=0||f>=a.height-1))h(c,d,a.data[d+0],a.data[d+1],a.data[d+2],a.data[d+3]);else{for(var j=0,l=0,o=0,m=0,n=
k.gaussWidth,A=0;A<n;A++){var B=e,F=f;i==0?B=e-(n-1>>1)+A:i==1&&(F=f-(n-1>>1)+A);B<0&&(B=a.width+B);F<0&&(F=a.height+F);B>=a.width&&(B=B-a.width);F>=a.height&&(F=F-a.height);var C=B+F*a.width<<2,G=a.data[C+3],B=a.data[C],F=a.data[C+1],C=a.data[C+2],N=k.gaussFact[A],j=j+B*N,l=l+F*N,o=o+C*N,m=m+G*N}h(c,d,j>>6,l>>6,o>>6,m>>6)}}};k.gaussBlur.maxInfluenceDistance=3;k.gaussBlur.numPassesRequired=2;var l=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,
388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,
364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],m=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,
18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],n=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,
67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,
41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],o=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,
24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];this.fastBlurBitmapData=function(a,c,d){if(!(isNaN(c)||c<1)){c=c|0;isNaN(d)&&(d=1);d=d|0;d>3&&(d=3);d<1&&(d=1);for(var e=
a.width,f=a.height,a=a.imageData.data,h,i,j,k,l,m,A,B,F,C,G=e-1,N=f-1,H=c+1,O=[],L=[],M=[],P=n[c],Q=o[c],U=[],E=[];d-- >0;){for(l=C=F=0;l<f;l++){h=a[C]*H;i=a[C+1]*H;j=a[C+2]*H;for(m=1;m<=c;m++){A=C+((m>G?G:m)<<2);h=h+a[A++];i=i+a[A++];j=j+a[A++]}for(k=0;k<e;k++){O[F]=h;L[F]=i;M[F]=j;if(l==0){U[k]=((A=k+H)<G?A:G)<<2;E[k]=(A=k-c)>0?A<<2:0}m=C+U[k];B=C+E[k];h=h+(a[m++]-a[B++]);i=i+(a[m++]-a[B++]);j=j+(a[m++]-a[B++]);F++}C=C+(e<<2)}for(k=0;k<e;k++){l=k;h=O[l]*H;i=L[l]*H;j=M[l]*H;for(m=1;m<=c;m++){l=l+
(m>N?0:e);h=h+O[l];i=i+L[l];j=j+M[l]}F=k<<2;for(l=0;l<f;l++){a[F]=h*P>>>Q;a[F+1]=i*P>>>Q;a[F+2]=j*P>>>Q;if(k==0){U[l]=((A=l+H)<N?A:N)*e;E[l]=(A=l-c)>0?A*e:0}m=k+U[l];B=k+E[l];h=h+(O[m]-O[B]);i=i+(L[m]-L[B]);j=j+(M[m]-M[B]);F=F+(e<<2)}}}}};k.convolution=function(a,c,d,e,f,i,j){var i=j.matrix,k=g=b=0,l,o,m,n,B,F=(j.matrixX-1)/2,C=(j.matrixY-1)/2;for(l=0;l<j.matrixY;l++){B=l*j.matrixX;for(m=0;m<j.matrixX;m++){o=(Math.max(Math.min(e-F+m,a.width-1),0)+Math.max(Math.min(f-C+l,a.height-1),0)*a.width)*4;
n=i[B+m];k=k+a.data[o]*n;g=g+a.data[o+1]*n;b=b+a.data[o+2]*n}}k=k/j.divisor;g=g/j.divisor;b=b/j.divisor;k=k+j.bias;g=g+j.bias;b=b+j.bias;h(c,d,k,g,b,a.data[(e+f*a.width<<2)+3])};k.convolution.maxInfluenceDistance=3;k.convolution.numPassesRequired=1;ShaderConvolution5x5=function(a,c){var d=c.matrix,e=a.data,f=0,h=d[0],i=d[1],j=d[2],k=d[3],l=d[4],o=d[5],m=d[6],n=d[7],F=d[8],C=d[9],G=d[10],N=d[11],H=d[12],O=d[13],L=d[14],M=d[15],P=d[16],Q=d[17],U=d[18],E=d[19],R=d[20],I=d[21],J=d[22],T=d[23],d=d[24],
V=a.width*4,W=a.width*8,Xa=V-10,qb=W-10,$a=V-9,Ya=W-9,za=V-8,Da=W-8,La=V-7,ia=W-7,da=V-6,ta=W-6,ab=V-5,ua=W-5,Oa=V-4,ga=W-4,ra=V-3,va=W-3,aa=V-2,Ta=W-2,hb=V-1,Aa=W-1,wa=V+1,ma=W+1,Fa=V+2,fa=W+2,Ua=V+3,Ga=W+3,na=V+4,eb=W+4,ib=V+5,rb=W+5,lb=V+6,Ea=W+6,S=V+7,oa=W+7,Pa=V+8,ea=W+8,ca=V+9,jb=W+9,Y=V+10,bb=W+10,X;if("Uint8ClampedArray"in window){X=new Uint8ClampedArray(e.length);if(h==0&&i==0&&k==0&&l==0&&o==0&&C==0&&M==0&&E==0&&R==0&&I==0&&T==0&&d==0)for(f=0;f<e.length;f=f+4){X[f]=e[f-W]*j+e[f-na]*m+e[f-
V]*n+e[f-Oa]*F+e[f-8]*G+e[f-4]*N+e[f]*H+e[f+4]*O+e[f+8]*L+e[f+Oa]*P+e[f+V]*Q+e[f+na]*U+e[f+W]*J;X[f+1]=e[f-Aa]*j+e[f-Ua]*m+e[f-hb]*n+e[f-ab]*F+e[f-7]*G+e[f-3]*N+e[f+1]*H+e[f+5]*O+e[f+9]*L+e[f+ra]*P+e[f+wa]*Q+e[f+ib]*U+e[f+ma]*J;X[f+2]=e[f-Ta]*j+e[f-Fa]*m+e[f-aa]*n+e[f-da]*F+e[f-6]*G+e[f-2]*N+e[f+2]*H+e[f+6]*O+e[f+10]*L+e[f+aa]*P+e[f+Fa]*Q+e[f+lb]*U+e[f+fa]*J}else for(y=0;y<a.height;y++)for(x=0;x<a.width;x++){X[f]=e[f-ea]*h+e[f-eb]*i+e[f-W]*j+e[f-ga]*k+e[f-Da]*l+e[f-Pa]*o+e[f-na]*m+e[f-V]*n+e[f-Oa]*
F+e[f-za]*C+e[f-8]*G+e[f-4]*N+e[f]*H+e[f+4]*O+e[f+8]*L+e[f+za]*M+e[f+Oa]*P+e[f+V]*Q+e[f+na]*U+e[f+Pa]*E+e[f+Da]*R+e[f+ga]*I+e[f+W]*J+e[f+eb]*T+e[f+ea]*d;X[f+1]=e[f-oa]*h+e[f-Ga]*i+e[f-Aa]*j+e[f-ua]*k+e[f-Ya]*l+e[f-S]*o+e[f-Ua]*m+e[f-hb]*n+e[f-ab]*F+e[f-$a]*C+e[f-7]*G+e[f-3]*N+e[f+1]*H+e[f+5]*O+e[f+9]*L+e[f+La]*M+e[f+ra]*P+e[f+wa]*Q+e[f+ib]*U+e[f+ca]*E+e[f+ia]*R+e[f+va]*I+e[f+ma]*J+e[f+rb]*T+e[f+jb]*d;X[f+2]=e[f-Ea]*h+e[f-fa]*i+e[f-Ta]*j+e[f-ta]*k+e[f-qb]*l+e[f-lb]*o+e[f-Fa]*m+e[f-aa]*n+e[f-da]*F+
e[f-Xa]*C+e[f-6]*G+e[f-2]*N+e[f+2]*H+e[f+6]*O+e[f+10]*L+e[f+da]*M+e[f+aa]*P+e[f+Fa]*Q+e[f+lb]*U+e[f+Y]*E+e[f+ta]*R+e[f+Ta]*I+e[f+fa]*J+e[f+Ea]*T+e[f+bb]*d;f=f+4}}else{X=new Uint8Array(e.length);for(y=0;y<a.height;y++)for(x=0;x<a.width;x++){X[f]=Math.max(Math.min(e[f-ea]*h+e[f-eb]*i+e[f-W]*j+e[f-ga]*k+e[f-Da]*l+e[f-Pa]*o+e[f-na]*m+e[f-V]*n+e[f-Oa]*F+e[f-za]*C+e[f-8]*G+e[f-4]*N+e[f]*H+e[f+4]*O+e[f+8]*L+e[f+za]*M+e[f+Oa]*P+e[f+V]*Q+e[f+na]*U+e[f+Pa]*E+e[f+Da]*R+e[f+ga]*I+e[f+W]*J+e[f+eb]*T+e[f+ea]*d,
255),0);X[f+1]=Math.max(Math.min(e[f-oa]*h+e[f-Ga]*i+e[f-Aa]*j+e[f-ua]*k+e[f-Ya]*l+e[f-S]*o+e[f-Ua]*m+e[f-hb]*n+e[f-ab]*F+e[f-$a]*C+e[f-7]*G+e[f-3]*N+e[f+1]*H+e[f+5]*O+e[f+9]*L+e[f+La]*M+e[f+ra]*P+e[f+wa]*Q+e[f+ib]*U+e[f+ca]*E+e[f+ia]*R+e[f+va]*I+e[f+ma]*J+e[f+rb]*T+e[f+jb]*d,255),0);X[f+2]=Math.max(Math.min(e[f-Ea]*h+e[f-fa]*i+e[f-Ta]*j+e[f-ta]*k+e[f-qb]*l+e[f-lb]*o+e[f-Fa]*m+e[f-aa]*n+e[f-da]*F+e[f-Xa]*C+e[f-6]*G+e[f-2]*N+e[f+2]*H+e[f+6]*O+e[f+10]*L+e[f+da]*M+e[f+aa]*P+e[f+Fa]*Q+e[f+lb]*U+e[f+Y]*
E+e[f+ta]*R+e[f+Ta]*I+e[f+fa]*J+e[f+Ea]*T+e[f+bb]*d,255),0)}}for(x=0;x<e.length;x=x+4){e[x]=X[x];e[x+1]=X[x+1];e[x+2]=X[x+2]}};ShaderConvolution3x3=function(a,c){var d=a.data,e=c.matrix[0],f=c.matrix[1],h=c.matrix[2],i=c.matrix[3],j=c.matrix[4],k=c.matrix[5],l=c.matrix[6],o=c.matrix[7],m=c.matrix[8],n=a.width*4,F=n-6,C=n-5,G=n-4,N=n-3,H=n-2,O=n-1,L=n+1,M=n+2,P=n+3,Q=n+4,U;if("Uint8ClampedArray"in window){U=new Uint8ClampedArray(d.length);for(var E=0;E<d.length;E=E+4){U[E]=d[E-Q]*e+d[E-n]*f+d[E-G]*
h+d[E-4]*i+d[E]*j+d[E+4]*k+d[E+G]*l+d[E+n]*o+d[E+G]*m;U[E+1]=d[E-P]*e+d[E-O]*f+d[E-C]*h+d[E-3]*i+d[E+1]*j+d[E+5]*k+d[E+N]*l+d[E+L]*o+d[E+C]*m;U[E+2]=d[E-M]*e+d[E-H]*f+d[E-F]*h+d[E-2]*i+d[E+2]*j+d[E+6]*k+d[E+H]*l+d[E+M]*o+d[E+F]*m}}else{U=new Uint8Array(d.length);for(E=0;E<d.length;E=E+4){U[E]=Math.max(Math.min(d[E-Q]*e+d[E-n]*f+d[E-G]*h+d[E-4]*i+d[E]*j+d[E+4]*k+d[E+G]*l+d[E+n]*o+d[E+G]*m,255),0);U[E+1]=Math.max(Math.min(d[E-P]*e+d[E-O]*f+d[E-C]*h+d[E-3]*i+d[E+1]*j+d[E+5]*k+d[E+N]*l+d[E+L]*o+d[E+C]*
m,255),0);U[E+2]=Math.max(Math.min(d[E-M]*e+d[E-H]*f+d[E-F]*h+d[E-2]*i+d[E+2]*j+d[E+6]*k+d[E+H]*l+d[E+M]*o+d[E+F]*m,255),0)}}for(E=0;E<d.length;E=E+4){d[E]=U[E];d[E+1]=U[E+1];d[E+2]=U[E+2]}};k.colorMatrix=function(a,c,d,e,f,h,i){e=i.matrix;i=a.data;a=i[d];f=i[d+1];h=i[d+2];i=i[d+3];c=c.data;c[d]=e[0]*a+e[1]*f+e[2]*h+e[3]*i+e[4];c[d+1]=e[5]*a+e[6]*f+e[7]*h+e[8]*i+e[9];c[d+2]=e[10]*a+e[11]*f+e[12]*h+e[13]*i+e[14];c[d+3]=e[15]*a+e[16]*f+e[17]*h+e[18]*i+e[19]};k.colorMatrix.maxInfluenceDistance=0;k.colorMatrix.numPassesRequired=
1;this.applyMask=function(a){for(var c=this.imageData.data,a=a.imageData.data,d=3;d<c.length;d=d+4)c[d]=a[d]};this.combineMask=function(a){for(var c=this.imageData.data,a=a.imageData.data,d=3;d<c.length;d=d+4)c[d]=Math.min(a[d],c[d])};this.getPixel=function(a,c){var d=(a+this.imageData.width*c)*4;return this.imageData.data[d]<<16|this.imageData.data[d+1]<<8|this.imageData.data[d+2]};this.getPixel32=function(a,c){var d=(a+this.imageData.width*c)*4;return(this.imageData.data[d+3]<<24|this.imageData.data[d]<<
16|this.imageData.data[d+1]<<8|this.imageData.data[d+2])>>>0};this.getPixels=function(a){var c=this.imageData.data,d=this.imageData.width,e=a.width,f=new ByteArray,h,i,j,k,l=4*e;f.flashOnHtml5_refresh(4*e*a.height);e=a.top;for(h=0;e<a.bottom;e++,h++){i=4*(d*e+a.left);j=l*h;for(k=a.left;k<a.right;k++,i=i+4,j=j+4){f[j]=c[i+3];f[j+1]=c[i];f[j+2]=c[i+1];f[j+3]=c[i+2]}}return f};this.setPixel=function(a,c,d){a=(a+this.imageData.width*c)*4;c=this.imageData.data;c[a]=d>>16&255;c[a+1]=d>>8&255;c[a+2]=d&255};
this.setPixel32=function(a,c,d){a=(a+this.imageData.width*c)*4;c=this.imageData.data;c[a+3]=d>>24&255;c[a]=d>>16&255;c[a+1]=d>>8&255;c[a+2]=d&255};this.setPixels=function(a,c){var d=this.imageData.data,e,f,h,i,j=4*a.width,k=4*this.imageData.width;e=a.top;for(f=0;f<a.bottom;e++,f++){h=j*(f+1);i=j*f;for(destPixelIndex=k*e;i<h;destPixelIndex=destPixelIndex+4,i=i+4){d[destPixelIndex+3]=c[i];d[destPixelIndex]=c[i+1];d[destPixelIndex+1]=c[i+2];d[destPixelIndex+2]=c[i+3]}}};this.clone=function(){var a=new BitmapData(this.width,
this.height,this.transparent,e);j.putImageData(this.imageData,0,0);a.imageData=j.getImageData(0,0,this.width,this.height);return a};this.dispose=function(){this.width=this.height=0;j=this.imageData=null;for(var a in this)delete this[a]};this.toDataURL=function(){return j.canvas.toDataURL()}}LoaderInfo.prototype=new EventDispatcher(flashOnHtml5_constructingPrototype);LoaderInfo.prototype.constructor=LoaderInfo;
function LoaderInfo(){this.flashOnHtml5_constructor=function(){LoaderInfo.prototype.flashOnHtml5_constructor.call(this)};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}Loader.ReadyState_ReadyToParse=4;Loader.RequestStatus_OK=200;Loader.prototype=new DisplayObjectContainer(flashOnHtml5_constructingPrototype);Loader.prototype.constructor=Loader;
function Loader(){function a(a){if(!a)return!0;for(var d=a.data,a=4*a.width*a.height;a;)if(d[a--])return!1;return!0}this.contentLoaderInfo=new LoaderInfo;this.contentLoaderInfo.loader=this;this.load=function(c){var d=this.contentLoaderInfo,e=new Image;e.onload=function(){var e=document.createElement("canvas");e.width=this.width;e.height=this.height;e=e.getContext("2d");e.drawImage(this,0,0);for(var h=e.getImageData(0,0,this.width,this.height);a(h);)console.log("VME: Loaded image has no data, retrying"),
e.drawImage(this,0,0),h=e.getImageData(0,0,this.width,this.height),a(h)&&console.log("VME: Failed to load image");d.content=new Bitmap(new BitmapData(this.width,this.height,null,null,e));d.bytes=h.data;d.bytesLoaded=h.data.length;d.bytesTotal=h.data.length;d.url=c.url;d.height=this.height;d.width=this.width;d.dispatchEvent({bubbles:!1,cancelable:!1,currentTarget:d,eventPhase:2,target:d,type:Event.COMPLETE})};e.onerror=function(){console.log('VME: Loader failed to load image with url "'+c.url+'".')};
e.src=c.url};this.close=function(){this.contentLoaderInfo.bytes=null;this.contentLoaderInfo.bytesLoaded=0;this.contentLoaderInfo.bytesTotal=0;this.contentLoaderInfo.url=null};this.unload=function(){this.contentLoaderInfo.content=null};this.flashOnHtml5_constructor=function(){Loader.prototype.flashOnHtml5_constructor.call(this)};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}TouchEvent.prototype=new Event(flashOnHtml5_constructingPrototype);
TouchEvent.prototype.constructor=TouchEvent;function TouchEvent(a,c,d,e,f,h,i,j,k,l,m,n,o,s,r,q,v,p,z,w){"undefined"==typeof c&&(c=!0);d||(d=0);e||(e=0);f||(f=0);h||(h=0);i||(i=0);j||(j=0);k||(k=1);l||(l=1);m||(m=0);n||(n=1);s||(s=!1);r||(r=!1);q||(q=!1);v||(v=!1);this.type=a;this.bubbles=c;this.clone=function(){return new TouchEvent(a,c,d,e,f,h,i,j,k,l,m,n,o,s,r,q,v,p,z,w)}}TouchEvent.TOUCH_START="touchstart";TouchEvent.TOUCH_END="touchend";TouchEvent.TOUCH_MOVE="touchmove";
TouchEvent.TOUCH_CANCEL="touchcancel";
var Features={FEATURE_LIPSTICK:1,FEATURE_LIPGLOSS:2,FEATURE_LIPLINER:3,FEATURE_EYESHADOW:4,FEATURE_EYELINER:5,FEATURE_MASCARA:6,FEATURE_BLUSH:7,FEATURE_CONTACTS:8,FEATURE_GLASSES:9,FEATURE_SUNGLASSES:10,FEATURE_HEADWEAR:11,FEATURE_EYESHADOWC:12,FEATURE_EYESHADOWL:13,FEATURE_TEETH_WHITENING:14,FEATURE_HIGHLIGHTS:15,FEATURE_HAIR_COLOR:16,FEATURE_HOT_LOOKS:17,FEATURE_POLISH:18,FEATURE_ACRYLIC:19,FEATURE_COVER:20,FEATURE_FOUNDATION:21,FEATURE_FACE_POWDER:22,FEATURE_CONCEALER:23,FEATURE_HAIRCLIPS:24,FEATURE_NECKLACE:25,
FEATURE_EARRING:26,FEATURE_LOWLIGHTS:27,FEATURE_FACIAL_HAIR:28,FEATURE_VEILS:29,FEATURE_RESERVED:30,FEATURE_LIP_BALM:31,FEATURE_PHOTO:32,FEATURE_LIP_TEXTURE:33,FEATURE_HAIR:34,FEATURE_CYOH:35,FEATURE_LIP_PLUMPING:36,FEATURE_EYEBROW_THINNING:37,FEATURE_EYEBROW_THINNING_R:38,FEATURE_EYESHADOW_R:39,FEATURE_EYELINER_R:40,FEATURE_MASCARA_R:41,FEATURE_BLUSH_R:42,FEATURE_CONCEALER_R:43,FEATURE_CONTACTS_R:44,FEATURE_EARRING_R:45,FEATURE_FACE_MASK:46,FEATURE_NOSE:47,FEATURE_TRACING:48,FEATURE_TRACING_TARGET:49,
FEATURE_TRACING_SPOT_APPLY:50,FEATURE_TRACING_DISTORT:51,FEATURE_TRACING_INITIAL:52,FEATURE_EYEBROW_PENCIL:53,FEATURE_EYEBROW_PENCIL_R:54,FEATURE_SCARF:55,FEATURE_EYE_BRIGHTEN:56,FEATURE_EYE_BRIGHTEN_R:57,FEATURE_BLEMISH_REMOVAL:58,FEATURE_LAST_INDEX:58,SIDE_BOTH:0,SIDE_LEFT:1,SIDE_RIGHT:2},ControlActions={RESET:"reset",CLEAR:"clear",CLEAR_ALL:"clearAll",VISIBLE:"visible",SHOW:"show",HIDE:"hide",ALPHA_SET:"alphaSet",ALPHA_ADD:"alphaAdd",LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down",X_SET:"xSet",Y_SET:"ySet",
NARROWER:"narrower",WIDER:"wider",TALLER:"taller",SHORTER:"shorter",BIGGER:"bigger",SMALLER:"smaller",WIDTH_SET:"widthSet",HEIGHT_SET:"heightSet",ROTATE_LEFT:"rotateLeft",ROTATE_RIGHT:"rotateRight",ROTATE_SET:"rotateSet",FLIP_X:"flipX",FLIP_Y:"flipY",SKEW_X_MORE:"skewXMore",SKEW_X_LESS:"skewXLess",SKEW_X_SET:"skewXSet",SKEW_Y_MORE:"skewYMore",SKEW_Y_LESS:"skewYLess",SKEW_Y_SET:"skewYSet",ROTATE_X_MORE:"rotateXMore",ROTATE_X_LESS:"rotateXLess",ROTATE_X_SET:"rotateXSet",ROTATE_Y_MORE:"rotateYMore",
ROTATE_Y_LESS:"rotateYLess",ROTATE_Y_SET:"rotateYSet",ZOOM_STAGE:"zoomStage"},TracedArea={TRACEDAREA_EYE_LEFT:1,TRACEDAREA_EYE_RIGHT:2,TRACEDAREA_LIPS:3,TRACEDAREA_TEETH:4,TRACEDAREA_FACE:5,TRACEDAREA_EYEBROW_LEFT:6,TRACEDAREA_EYEBROW_RIGHT:7,TRACEDAREA_NOSE:8,TRACEDAREA_CYOH:9,TRACEDAREA_EYELINER_LEFT_WINGED:10,TRACEDAREA_EYELINER_RIGHT_WINGED:11,TRACEDAREA_EYELINER_LEFT_CATEYE:12,TRACEDAREA_EYELINER_RIGHT_CATEYE:13,TRACEDAREA_EYESHADOW_LEFT_WASH:14,TRACEDAREA_EYESHADOW_RIGHT_WASH:15,TRACEDAREA_EYESHADOW_LEFT_CLASSIC_LID:16,
TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_LID:17,TRACEDAREA_EYESHADOW_LEFT_CLASSIC_CONTOUR:18,TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_CONTOUR:19,TRACEDAREA_EYESHADOW_LEFT_CLASSIC_HIGHLIGHT:20,TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_HIGHLIGHT:21,TRACEDAREA_EYESHADOW_LEFT_SMOKEY_LID:22,TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_LID:23,TRACEDAREA_EYESHADOW_LEFT_SMOKEY_CONTOUR:24,TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_CONTOUR:25,TRACEDAREA_EYESHADOW_LEFT_SMOKEY_HIGHLIGHT:26,TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_HIGHLIGHT:27,TRACEDAREA_EYESHADOW_LEFT_2TONE_LID:28,
TRACEDAREA_EYESHADOW_RIGHT_2TONE_LID:29,TRACEDAREA_EYESHADOW_LEFT_2TONE_HIGHLIGHT:30,TRACEDAREA_EYESHADOW_RIGHT_2TONE_HIGHLIGHT:31,TRACEDAREA_BLUSH_APPLE_LEFT:32,TRACEDAREA_BLUSH_APPLE_RIGHT:33,TRACEDAREA_BLUSH_FLUSH_LEFT:34,TRACEDAREA_BLUSH_FLUSH_RIGHT:35,TRACEDAREA_BLUSH_CONTOUR_LEFT:36,TRACEDAREA_BLUSH_CONTOUR_RIGHT:37,TRACEDAREA_BLUSH_SUNKISSED_LEFT:38,TRACEDAREA_BLUSH_SUNKISSED_RIGHT:39,TRACEDAREA_CONCEALER_UNDEREYE_LEFT:40,TRACEDAREA_CONCEALER_UNDEREYE_RIGHT:41,TRACEDAREA_TZONE:42,TRACEDAREA_CONTACT_LEFT:43,
TRACEDAREA_CONTACT_RIGHT:44,TRACEDAREA_EARRING_LEFT:45,TRACEDAREA_EARRING_RIGHT:46,TRACEDAREA_HAIR:47,TRACEDAREA_FACIAL_HAIR:48,TRACEDAREA_GLASSES:49,TRACEDAREA_HEADWEAR:50,TRACEDAREA_NECKLACE:51,TRACEDAREA_COVER:52,TRACEDAREA_NAILS:53,TRACEDAREA_EYESHADOW_LEFT:54,TRACEDAREA_EYESHADOW_RIGHT:55,TRACEDAREA_SCARF:56,TRACEDAREA_LAST_INDEX:56,TRACEDAREA_EYESHADOW_LEFT_CLASSIC_ALL:1001,TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_ALL:1002,TRACEDAREA_EYESHADOW_LEFT_SMOKEY_ALL:1003,TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_ALL:1004,
TRACEDAREA_EYESHADOW_LEFT_2TONE_ALL:1005,TRACEDAREA_EYESHADOW_RIGHT_2TONE_ALL:1006,STATUS_NOT_TRACED:0,STATUS_TRACED:1,STATUS_GUESSED:2,STATUS_NOT_PRESENT:3},VmeResponseEvents=function(){};VmeResponseEvents.VME_RESPONSE_EVENT="VmeResponseEvent";VmeResponseEvents.VRE_HAIR_LOADED=101;VmeResponseEvents.VRE_MODEL_LOADED=102;VmeResponseEvents.VRE_CYOH_SCAN=103;VmeResponseEvents.VRE_LAYER_DRAGGED=104;VmeResponseEvents.VRE_RENDER_COMPLETED=105;VmeResponseEvents.VRE_LOADING=106;
VmeResponseEvents.VRE_TRACING_NODE_PLACED=107;ModelLocator.model=null;
ModelLocator.prototype={photoTrace:[],looks:[],currentLook:0,dragFeature:-1,dragInstanceIndex:-1,dragSide:-1,canDrag:!0,canZoom:!0,isDraggingStage:!1,dragModeFeature:-1,stageMain:null,stageHorizontalCenter:0,stageVerticalCenter:0,stageScaleX:1,stageScaleY:1,parentWidth:0,parentHeight:0,isConfirmed:!1,isTracingMode:!1,traceStyleFillOpacity:0.25,traceStyleOutlineOpacity:0,traceStyleHandleOpacity:1,isSpotApplyMode:!1,isDistortMode:!1,hasPhoto:!1,photoWidth:0,photoHeight:0,photoOrigId:"",photoBitmapDataOrig:null,
photoId:"",photoBitmapData:null,cyohHairBitmapData:null,onChange:!1,onChangeTrigger:!1,skinTone:0,loadingCount:0,hairStats:null,cyohStats:null,lipTexture:null,lipTextureX:0,lipTextureY:0,lipTextureFlag:0,modifiedEyebrowLeft:null,modifiedEyebrowRight:null,modifiedLips:null,modifiedEyebrowLeftMatrix:null,modifiedEyebrowRightMatrix:null,modifiedLipsMatrix:null,modifiedEyebrowLeftTrace:null,modifiedEyebrowRightTrace:null,modifiedLipsTrace:null,modifiedFoundation:null,modifiedFoundationFlag:null,handBackground:!1,
isDebug:!1,debugBitmapData:null,defaultFeatureWeight:null,postProcess:null,allowUpdate:!0,tracedAreaParams:[],tracedAreaMask:[]};function ModelLocator(){if(null!=ModelLocator.model)throw Error("Only one ModelLocator instance should be instantiated");}ModelLocator.getInstance=function(){null==ModelLocator.model&&(ModelLocator.model=new ModelLocator);return ModelLocator.model};VmeResponseEvent.prototype=new Event(flashOnHtml5_constructingPrototype);VmeResponseEvent.prototype.constructor=VmeResponseEvent;
function VmeResponseEvent(a,c,d){this.responseCode=0;this.data=null;"undefined"==typeof d&&(d=null);Event.call(this,a,!0,!1);this.responseCode=c;this.data=d}function StageChildVO(){this.feature=-1;this.weight=this.side=this.instanceIndex=0;this.visible=!0;this.y=this.x=0;this.flipY=this.flipX=this.scaleY=this.scaleX=1;this.rotateY=this.rotateX=this.skewY=this.skewX=this.rotation=0;this.makeoverItem=this.parameters=null;this.tracedArea=0;this.stageChild=null}function TracedAreaVO(){}
TracedAreaVO.prototype.status=0;TracedAreaVO.prototype.location=null;TracedAreaVO.prototype.rotation=null;TracedAreaVO.prototype.scaleX=null;TracedAreaVO.prototype.scaleY=null;TracedAreaVO.prototype.points=null;TracedAreaVO.prototype.pointsZ=null;TracedAreaVO.prototype.pointsA=null;TracedAreaVO.prototype.indexLeft=null;TracedAreaVO.prototype.indexRight=null;
var MakeoverItemVO=function(){this.feature=this.key=0;this.URL=null;this.color=4294967295;this.opacity=0;this.parameters=null},ImageAdjustVO=function(){this.faceSize=this.light=this.mid=this.dark=this.avgHue=this.avgSaturation=NaN;this.adjustOpacity_mul=this.adjustB_mul=this.adjustS_mul=this.adjustBmul=this.adjustGmul=this.adjustRmul=1};function LookVO(){}LookVO.prototype={key:0,lookName:"",traceParameters:"",entryDate:null,pk_profile:0,imageAdjust:null,stageChildren:null};
var RangeVO=function(a,c,d){"undefined"==typeof a&&(a=0);"undefined"==typeof c&&(c=0);"undefined"==typeof d&&(d=0);this.avg=a;this.min=c;this.max=d},ImageStatsVO=function(){this.r=new RangeVO(0,255,0);this.g=new RangeVO(0,255,0);this.b=new RangeVO(0,255,0);this.h=new RangeVO(0,360,0);this.s=new RangeVO(0,100,0);this.br=new RangeVO(0,100,0);this.l=new RangeVO(0,255,0)};AbstractStageChild.prototype=new Sprite(flashOnHtml5_constructingPrototype);AbstractStageChild.prototype.constructor=AbstractStageChild;
function AbstractStageChild(){function a(a,c){a.applyFilter(a,a.rect,c)}function c(a,c){"undefined"==typeof a&&(a=1);"undefined"==typeof c&&(c=0);var d=c;0==d&&(d=1+0.5*(TracingUtils.faceScale()*TracingUtils.faceScale())*a);return d}function d(a,d,e){a=c(a,d);return new BlurFilter(a,a,64<=a?BitmapFilterQuality.LOW:BitmapFilterQuality.HIGH,e)}function e(a){var c=new Matrix(a.scaleX*a.flipX,a.skewY,a.skewX,a.scaleY*a.flipY);c.rotate(a.rotation*(Math.PI/180));c.translate(a.x,a.y);return c}this.model=
ModelLocator.getInstance();this.stageChildVO=null;this.myChildIndex=-1;this.isInitialized=!1;this.currentPosition=this.bounds=this.baseMaskBitmapData=this.revealBitmapData=this.holder=null;this.changed=!1;this.flashOnHtml5_constructor=function(){this.currentPosition={};this.setVisible(!1);AbstractStageChild.prototype.flashOnHtml5_constructor.call(this);this.addEventListener(Event.ENTER_FRAME,this.onInit,!1,0,!0);this.addEventListener(Event.ADDED_TO_STAGE,this.onAddedToStage,!1,0,!0)};this.onInit=
function(a){this.removeEventListener(Event.ENTER_FRAME,this.onInit);this.isInitialized=!0;this.onChange(a)&&(this.model.onChange||this.renderCompleted())};this.onAddedToStage=function(a){this.removeEventListener(Event.ADDED_TO_STAGE,this.onAddedToStage);if(this.isInitialized)this.onChange(a)};this.onChange=function(){return!1};this.onStageChange=function(){};this.dispatchChangeEvent=function(){this.model.stageMain.onChange()};this.renderCompleted=function(a){this.model.stageMain.onRenderCompleted(a)};
this.setMyChildIndex=function(a){this.myChildIndex=a;this.stageChildVO=this.model.looks[this.model.currentLook].stageChildren[this.myChildIndex]};this.getStageChildParam=function(a,c){var d=null;null!=this.stageChildVO.parameters&&""!=this.stageChildVO.parameters&&(d=JSON.parse(this.stageChildVO.parameters));var e=c;null!=d&&null!=d[a]&&(e=d[a]);return e};this.getMakeoverItemParam=function(a,c){var d=c;if(null!=this.stageChildVO&&null!=this.stageChildVO.makeoverItem){var e=JSON.parse(this.stageChildVO.makeoverItem.parameters);
null!=e&&null!=e[a]&&(d=e[a])}return d};this.getMakeoverItemVOParam=function(a,c,d){null!=a&&(a=JSON.parse(a.parameters),null!=a&&null!=a[c]&&(d=a[c]));return d};this.setStageChildParam=function(a,c){var d=JSON.parse(this.stageChildVO.parameters);null==this.stageChildVO.parameters&&(d={});d[a]=c;this.stageChildVO.parameters=JSON.stringify(d)};this.setMakeoverItemParam=function(a,c){null==this.stageChildVO.makeoverItem&&(this.stageChildVO.makeoverItem=new MakeoverItemVO);var d=JSON.parse(this.stageChildVO.makeoverItem.parameters);
d[a]=c;this.stageChildVO.makeoverItem.parameters=JSON.stringify(d)};this.sharpenFilter=function(a){var c=-a,d=c/2;return new ConvolutionFilter(5,5,[0,0,d,0,0,0,d,c,d,0,d,c,1+4*a+8*(a/2),c,d,0,d,c,d,0,0,0,d,0,0])};this.applyBitmapFilter=a;this.applyBlur=function(c,e,i){"undefined"==typeof e&&(e=1);"undefined"==typeof i&&(i=0);a(c,d(e,i))};this.getBlurAmount=c;this.getBlur=d;this.forceUpdate=function(){this.onChange(null)};this.clear=function(a,c){"undefined"==typeof c&&(c=0);a||(a=this.holder);if(null!=
a)for(a.getGraphics().clear();a.numChildren>c;)a.getChildAt(c)instanceof Bitmap&&a.getChildAt(c).dispose(),a.removeChildAt(c)};this.compare=function(a){for(var c=!1,d="",e=1;e<arguments.length;e++)if(arguments[e]instanceof TracedAreaVO){var k=arguments[e],d=d+(k.status+";");null!=k.location&&(d+=k.location.x+";"+k.location.y);var d=d+";",d=d+(k.rotation+";"+k.scaleX+";"+k.scaleY+";"+k.indexLeft+";"+k.indexRight+";"),l;if(null!=k.points)for(l=0;l<k.points.length;l++)null!=k.points[l]&&(d+=k.points[l].x+
";"+k.points[l].y),d+=";";if(null!=k.pointsZ)for(l=0;l<k.pointsZ.length;l++)d+=k.pointsZ[l],d+=";";if(null!=k.pointsA)for(l=0;l<k.pointsA.length;l++)d+=k.pointsA[l]+";"}else arguments[e]instanceof ImageAdjustVO?(k=arguments[e],d+=k.adjustRmul+";"+k.adjustGmul+";"+k.adjustBmul+";"+k.adjustS_mul+";"+k.adjustB_mul+";"):arguments[e]instanceof Bitmap?d+=arguments[e].width+";"+arguments[e].height+";":arguments[e]instanceof BitmapData?d+=arguments[e].width+";"+arguments[e].height+";":null===arguments[e]?
d+="null;":("number"!=typeof arguments[e]&&"string"!=typeof arguments[e]&&(console.log(e),console.log(typeof arguments[e]),console.log(arguments[e])),d+=JSON.stringify(arguments[e])+";");a.value!=d&&(a.value=d,c=!0);return c};this.updatePosition=function(a){"undefined"==typeof a&&(a=-1);-1==a&&(a=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature));var c=!1;0<a&&(TracingUtils.guessTracedArea(a),this.compare(this.currentPosition,this.model.photoTrace[a].location.x+this.model.photoWidth/2,
this.model.photoTrace[a].location.y+this.model.photoHeight/2,this.model.photoTrace[a].rotation,this.model.photoTrace[a].scaleX,this.model.photoTrace[a].scaleY)&&(this.holder.setX(this.model.photoTrace[a].location.x+this.model.photoWidth/2),this.holder.setY(this.model.photoTrace[a].location.y+this.model.photoHeight/2),this.holder.setRotation(this.model.photoTrace[a].rotation),this.holder.setScaleX(this.model.photoTrace[a].scaleX),this.holder.setScaleY(this.model.photoTrace[a].scaleY),c=!0));return c};
this.getPositionMatrix=function(){return e(this.stageChildVO)};this.getPositionMatrixStageChildVO=e;this.updateHolderPosition=function(){null!=this.holder&&this.holder.transform.setMatrix(this.getPositionMatrix())};this.setSmoothBitmap=function(a,c,d){"undefined"==typeof d&&(d=1);a.setBitmapData(c);a.smoothing=!0;a.alpha=d};this.createSmoothBitmap=function(a,c){"undefined"==typeof c&&(c=1);var d=new Bitmap;this.setSmoothBitmap(d,a,c);return d};this.maskBitmapData=function(a,c){var d=new Sprite;d.addChild(new Bitmap(a));
c instanceof Sprite?d.addChild(c):d.addChild(new Bitmap(c));d.getChildAt(0).cacheAsBitmap=!0;d.getChildAt(1).cacheAsBitmap=!0;d.getChildAt(0).mask=d.getChildAt(1);var e=new BitmapData(a.width,a.height,!0,0);e.draw(d);return e};this.debugCross=function(a,c,d,e,k){"undefined"==typeof e&&(e=4278255360);"undefined"==typeof k&&(k=5);if(a instanceof BitmapData)for(var l=-k;l<=k;l++)a.setPixel32(c,d+l,e),a.setPixel32(c+l,d,e);else a instanceof Graphics&&(a.beginFill(e),a.drawRect(c-k,d,2*k+1,1),a.drawRect(c,
d-k,1,2*k+1),a.endFill())};this.drawFromDrawData=function(a,c){for(var d=0,e,k=c.length,l,m,n,o=new Sprite,s=Math.round(15*TracingUtils.faceScale()),r=8,q=null,v=null;d<k;)(e=c.indexOf(",",d),l=c.substring(d,e),d=e+1,n=!1,"D"==l)?v=BlendMode.NORMAL:"E"==l?v=BlendMode.ERASE:"W"==l?(e=c.indexOf(",",d),l=c.substring(d,e),d=e+1,s=parseFloat(l)):"F"==l?(e=c.indexOf(",",d),l=c.substring(d,e),d=e+1,r=parseFloat(l)):("M"==l&&(e=c.indexOf(",",d),l=c.substring(d,e),d=e+1,n=!0),e=c.indexOf(",",d),m=c.substring(d,
e),d=e+1,n&&(a.draw(o,null,null,q),q=v,o.getGraphics().clear(),o.getGraphics().lineStyle(s),o.filters=[this.getBlur(0,r)],o.getGraphics().moveTo(parseFloat(l),parseFloat(m)-1)),o.getGraphics().lineTo(parseFloat(l),parseFloat(m)));a.draw(o,null,null,q)};this.getOpacity=function(a){"undefined"==typeof a&&(a=NaN);var c=-1,d=-1;try{c=this.getMakeoverItemParam("opacityMin",-1),d=this.getMakeoverItemParam("opacityMax",-1)}catch(e){alert(e)}if(0>c||0>d){c=this.getMakeoverItemParam("coverage","full");d=this.stageChildVO.feature;
switch(c){case "sheer":switch(d){case Features.FEATURE_CONCEALER:case Features.FEATURE_CONCEALER_R:c=0.4;d=0.8;break;case Features.FEATURE_FOUNDATION:c=0.2;d=0.6;break;case Features.FEATURE_LIPLINER:c=0.1;d=0.3;break;case Features.FEATURE_BLUSH:case Features.FEATURE_BLUSH_R:c=0.3;d=0.7;break;case Features.FEATURE_POLISH:c=0.4;d=0.6;break;default:c=0.1,d=0.5}break;case "medium":switch(d){default:c=0.3,d=0.6}break;case "sheer-medium":switch(d){default:c=0.2,d=0.6}break;case "sheer-full":switch(d){default:c=
0.2,d=0.9}break;case "medium-full":switch(d){default:c=0.3,d=0.9}break;default:switch(d){case Features.FEATURE_HAIR:case Features.FEATURE_HAIR_COLOR:case Features.FEATURE_HIGHLIGHTS:case Features.FEATURE_LOWLIGHTS:c=0;d=1;break;case Features.FEATURE_EYEBROW_PENCIL:case Features.FEATURE_EYEBROW_PENCIL_R:c=0.1;d=0.45;break;case Features.FEATURE_CONCEALER:case Features.FEATURE_CONCEALER_R:c=0.9;d=1;break;case Features.FEATURE_FOUNDATION:case Features.FEATURE_LIPSTICK:c=0.6;d=0.9;break;case Features.FEATURE_POLISH:c=
0.9;d=1;break;case Features.FEATURE_BLUSH:case Features.FEATURE_BLUSH_R:c=0.6;d=1;break;case Features.FEATURE_LIPLINER:c=0.3;d=0.6;break;default:c=0.5,d=1}}d=[c,d];c=d[0];d=d[1]}isNaN(a)&&(a=50,null!=this.stageChildVO.makeoverItem&&(a=this.stageChildVO.makeoverItem.opacity));return c+a/100*(d-c)};this.loadingCount=function(a){"undefined"==typeof a&&(a=0);this.model.loadingCount+=a;this.model.stageMain.dispatchEvent(new VmeResponseEvent(VmeResponseEvents.VME_RESPONSE_EVENT,VmeResponseEvents.VRE_LOADING,
this.model.loadingCount))};this.debug=function(a){console.log(a)};(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}StageAccessory.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageAccessory.prototype.constructor=StageAccessory;
function StageAccessory(){function a(a,c,d,e,k){var l,m=a.width/2,n=a.height/2,o=new Vector;for(l=0;l<d.length;l+=2)o.push(d[l]-m),o.push(d[l+1]-n);d=new Vector;for(l=0;l<c.length;l+=2)d.push(c[l]/a.width),d.push(c[l+1]/a.height);c=new Vector;for(l=0;l<e.length;l++)c.push(e[l]);assetBitmap.bitmapData=null;distortSprite.getGraphics().clear();distortSprite.getGraphics().beginBitmapFill(a,null,!0,!k);distortSprite.getGraphics().drawTriangles(o,c,d);distortSprite.getGraphics().endFill()}var c=this.currentURL=
this.loaderAsset=this.asset=this.assetBitmap=null,d=null,e=null;this.flashOnHtml5_constructor=function(){c={};d=new LoaderContext;e=new URLRequest;StageAccessory.prototype.flashOnHtml5_constructor.call(this)};this.distortSprite=this.holderStageChild=null;this.scale=1;this.onInit=function(a){null==this.holder&&(this.holder=new Sprite,this.holder.flashOnHtml5_setDomId("StageAccessory_holder"),this.addChild(this.holder),this.holderStageChild=new Sprite,this.holderStageChild.flashOnHtml5_setDomId("StageAccessory_holderStageChild"),
this.holder.addChild(this.holderStageChild));null==this.assetBitmap&&null!=this.holderStageChild&&(this.assetBitmap=new Bitmap,this.assetBitmap.flashOnHtml5_setDomId("StageAccessory_assetBitmap"),this.holderStageChild.addChild(this.assetBitmap),this.distortSprite=new Sprite,this.distortSprite.flashOnHtml5_setDomId("StageAccessory_distortSprite"),this.holderStageChild.addChild(this.distortSprite));StageAccessory.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||
!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||null==this.stageChildVO.makeoverItem.URL||""==this.stageChildVO.makeoverItem.URL)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==
TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.changed=this.updatePosition()||this.changed;this.changed=this.updateStageChildVOPosition()||this.changed;this.scale=parseFloat(this.getMakeoverItemParam("scale",1));this.distortSprite.setScaleX(1/this.scale);this.distortSprite.setScaleY(1/this.scale);this.compare(c,this.stageChildVO.weight)&&(this.changed=!0);this.currentURL!=this.stageChildVO.makeoverItem.URL?(this.currentURL=this.stageChildVO.makeoverItem.URL,
this.removeLoader(this.loaderAsset),this.loaderAsset=new Loader,this.loadRequest(this.loaderAsset,this.currentURL)):this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.updatePosition=function(a){"undefined"==typeof a&&(a=-1);-1==a&&(a=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature),console.log("tracedArea is "+a+" for feature "+this.stageChildVO.feature));var c=!1;0<a&&(TracingUtils.guessTracedArea(a),this.compare(this.currentPosition,this.model.photoTrace[a].location.x+
this.model.photoWidth/2,this.model.photoTrace[a].location.y+this.model.photoHeight/2,this.model.photoTrace[a].rotation,this.model.photoTrace[a].scaleX,this.model.photoTrace[a].scaleY)&&(this.holder.setX(this.model.photoTrace[a].location.x+this.model.photoWidth/2),this.holder.setY(this.model.photoTrace[a].location.y+this.model.photoHeight/2),this.holder.setRotation(this.model.photoTrace[a].rotation),this.holder.setScaleX(this.model.photoTrace[a].scaleX),this.holder.setScaleY(this.model.photoTrace[a].scaleY),
c=!0));return c};this.updateStageChildVOPosition=function(){var a=!1,c=this.getPositionMatrix();if(this.holderStageChild.transform.matrix.a!=c.a||this.holderStageChild.transform.matrix.b!=c.b||this.holderStageChild.transform.matrix.c!=c.c||this.holderStageChild.transform.matrix.d!=c.d||this.holderStageChild.transform.matrix.tx!=c.tx||this.holderStageChild.transform.matrix.ty!=c.ty)this.holderStageChild.transform.setMatrix(c),a=!0;return a};this.removeLoader=function(a){if(null!=a){try{a.close()}catch(c){alert(c)}try{a.unload()}catch(d){alert(d)}this.removeListeners(a);
this.loadingCount(-1)}};this.loadRequest=function(a,c){this.addListeners(a);e.url=c;a.load(e,d);this.loadingCount(1)};this.addListeners=function(a){a.contentLoaderInfo.addEventListener(Event.COMPLETE,this.onComplete,!1,0,!0,this)};this.removeListeners=function(a){a.contentLoaderInfo.removeEventListener(Event.COMPLETE,this.onComplete)};this.getLoadedBitmapData=function(a){var c=null;a.target.content instanceof Bitmap?c=a.target.content.bitmapData:trace("Unknown format: "+a.target.content);if(null!=
c&&this.stageChildVO.feature!=Features.FEATURE_POLISH&&this.stageChildVO.feature!=Features.FEATURE_HAIR&&this.stageChildVO.feature!=Features.FEATURE_COVER&&this.stageChildVO.feature!=Features.FEATURE_CONTACTS&&this.stageChildVO.feature!=Features.FEATURE_CONTACTS_R&&this.stageChildVO.feature!=Features.FEATURE_EARRING&&this.stageChildVO.feature!=Features.FEATURE_EARRING_R){for(var a=c,d=c=0,e=a.width-1,k=a.height-1,l=!1;!l&&d<k;){var m;for(m=c;m<=e&&!l;m++)if(0<a.getPixel32(m,d)||0<a.getPixel32(m,k))l=
!0;l||(d++,k--)}for(l=!1;!l&&c<e;){for(m=d;m<=k&&!l;m++)if(0<a.getPixel32(c,m)||0<a.getPixel32(e,m))l=!0;l||(c++,e--)}e=new BitmapData(e-c+1,k-d+1,!0,0);e.draw(a,new Matrix(1,0,0,1,-c,-d));c=e}return c};this.onComplete=function(a){this.asset=this.getLoadedBitmapData(a);this.draw(a);try{a.target.loader.unload()}catch(c){alert(c)}this.removeLoader(this.loaderAsset);this.loaderAsset=null};this.onFault=function(){null!=assetBitmap&&null!=assetBitmap.bitmapData&&(assetBitmap.bitmapData=null,this.renderCompleted());
this.removeLoader(this.loaderAsset);this.loaderAsset=null};this.setAsset=function(a,c){"undefined"==typeof c&&(c=NaN);this.setSmoothBitmap(this.assetBitmap,a);isNaN(c)&&(c=parseFloat(this.getMakeoverItemParam("scale",1)));var d=c,e=c;this.assetBitmap.setScaleX(1/d);this.assetBitmap.setScaleY(1/e);this.assetBitmap.setX(-this.assetBitmap.width/2/d);this.assetBitmap.setY(-this.assetBitmap.height/2/e)};this.doDistort=function(c,d,e,j){c?a(asset,d,e,j,c):(d=this.getStageChildParam("srcCoords",""),null!=
d&&""!=d&&(d=DataUtils.JSONDecode(d),e=DataUtils.JSONDecode(this.getStageChildParam("dstCoords","")),j=DataUtils.JSONDecode(this.getStageChildParam("indices","")),a(asset,d,e,j,c)))};this.doDistortBitmap=a;this.draw=function(){null!=this.stageChildVO&&(null!=this.stageChildVO.makeoverItem&&null!=this.asset)&&(this.setAsset(this.asset),this.updateStageChildVOPosition(),null!=TracingUtils.globalImageAdjust()&&(this.assetBitmap.filters=TracingUtils.globalImageAdjust()));this.setVisible(!0);this.renderCompleted()};
(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor()}StageBlush.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageBlush.prototype.constructor=StageBlush;
function StageBlush(){function a(a,c,d,e,f){for(var h=4*a.width*a.height,i=(d>>16&255)-(e>>16&255),k=(d>>8&255)-(e>>8&255),d=(d>>0&255)-(e>>0&255),e=0;e<h;e+=4)0<c.imageData.data[e+3]&&(a.imageData.data[e]=Math.max(0,Math.min(255,c.imageData.data[e]+i)),a.imageData.data[e+1]=Math.max(0,Math.min(255,c.imageData.data[e+1]+k)),a.imageData.data[e+2]=Math.max(0,Math.min(255,c.imageData.data[e+2]+d)),a.imageData.data[e+3]=c.imageData.data[e+3]*f)}var c,d,e,f,h,i,j,k,l,m,n,o,s,r,q={},v={};this.onInit=function(a){this.holder=
new Sprite;this.holder.flashOnHtml5_setDomId("StageBlush_holder");this.addChild(this.holder);i=new Bitmap;this.holder.addChild(i);StageBlush.prototype.onInit.call(this,a)};this.onChange=function(){(new Date).getTime();this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&(this.setVisible(!1),
this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature,parseInt(this.getMakeoverItemParam("style",0)));TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.updateHolderPosition();switch(this.getMakeoverItemParam("finish","natural")){case "dewy":case "radiant":j=
40;l=k=0;m=10;s=o=n=0;break;case "shimmer":j=40;l=k=0;m=15;o=n=40;s=0.25;break;case "stain":j=40;s=o=n=m=l=k=0;break;default:j=40,l=k=50,s=o=n=m=0}j=parseInt(this.getMakeoverItemParam("blushColorAmount",j));k=parseInt(this.getMakeoverItemParam("blushMatteAmount",k));l=parseInt(this.getMakeoverItemParam("blushMatteArea",l));m=parseInt(this.getMakeoverItemParam("blushShineAmount",m));n=parseInt(this.getMakeoverItemParam("blushParticleCoverage",n));o=parseInt(this.getMakeoverItemParam("blushParticleOpacity",
o));s=parseFloat(this.getMakeoverItemParam("blushShimmerAmount",s));if(this.compare(q,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[this.stageChildVO.tracedArea],parseInt(this.getMakeoverItemParam("style",0)),parseFloat(this.getMakeoverItemParam("blushBlur",16)),n,o,s)){this.createMask();if(0<n&&0<o){var a=c.width,d=c.height;e=new BitmapData(a,d,!0,0);var f,h,i;for(h=0;h<=a;h++)for(i=0;i<=d;i++)f=c.getPixel32(h,i)>>24&255,0<f&&100*Math.random()<n/10&&(f=MathUtils.range(f+
20-40*Math.random(),0,255),e.setPixel32(h,i,f<<24|16777215))}v={}}this.compare(v,this.stageChildVO.makeoverItem.color,this.stageChildVO.makeoverItem.opacity,j,k,l,m)&&(this.colorize(),this.changed=!0);a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.createMask=function(){(new Date).getTime();var a=this.model.photoTrace[this.stageChildVO.tracedArea],
e=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(a.points,this.stageChildVO.tracedArea)),h=MathUtils.getPolygonCenter(e),e=e[a.indexLeft],i,k;k=null==h||null==e?0:Point.distance(h,e);switch(this.stageChildVO.tracedArea){case TracedArea.TRACEDAREA_BLUSH_FLUSH_LEFT:case TracedArea.TRACEDAREA_BLUSH_FLUSH_RIGHT:i=70;k/=4;break;case TracedArea.TRACEDAREA_BLUSH_CONTOUR_LEFT:case TracedArea.TRACEDAREA_BLUSH_CONTOUR_RIGHT:i=60;k/=2;break;default:i=80,k=0}e=TracingUtils.getCurvePointsTracedArea(a);
e=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(e,this.stageChildVO.tracedArea));this.bounds=MathUtils.getBoundingBox(e);this.bounds=MathUtils.confineBoundsCoords(this.bounds,0,0,this.model.photoWidth-1,this.model.photoHeight-1);var j=Math.round(TracingUtils.faceScale()*parseInt(this.getMakeoverItemParam("blushBlur",16)));this.bounds=MathUtils.extendBoundingBox(this.bounds,0,j);e=MathUtils.widthFromBounds(this.bounds);h=MathUtils.heightFromBounds(this.bounds);if(0<e&&0<h){c=new BitmapData(e,
h,!0,16777215);TracingUtils.drawTracedShapeBlurred(c,this.stageChildVO.tracedArea,16777215,1,i,!1,k,a.rotation-180,1,1,new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y));r=TracingUtils.calculateAverage(this.model.photoBitmapData,c,this.bounds,3,this.bounds[0].x,this.bounds[0].y);c.applyFilter(c,c.rect,this.getBlur(0,j,"alphaonly"));a=4*e*h;for(i=0;i<a;i+=4)c.imageData.data[i]=255,c.imageData.data[i+1]=255,c.imageData.data[i+2]=255}a=new BitmapData(e,h,!0,0);i=new Matrix(1,0,0,1,-this.bounds[0].x,
-this.bounds[0].y);TracingUtils.drawTracedShape(a,this.stageChildVO.tracedArea,16777215,1,null,i);e=new BitmapData(e,h,!0,0);e.draw(this.model.photoBitmapData,i);0<s&&(f=new BitmapData(c.width,c.height,!0,0),f.draw(this.model.photoBitmapData,new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y)),this.applyBitmapFilter(f,this.sharpenFilter(TracingUtils.faceScale()/4*MathUtils.range(s,0,2))),f=this.maskBitmapData(f,c));h=r.r.avg<<16|r.g.avg<<8|r.b.avg;a=e.clone();a.threshold(a,a.rect,new Point(0,
0),"<",4278190080|h,16777215);a.applyFilter(a,a.rect,this.getBlur(0,8,"alphaonly"));e.applyFilter(e,e.rect,this.getBlur(0,8));e.applyMask(a);a.dispose();d=e.clone();d.combineMask(c);e.dispose()};this.drawWithColorTransformAndAlpha=a;this.colorize=function(){var p;h=new BitmapData(c.width,c.height,!0,0);0<s&&h.draw(f);a(h,c,TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),16777215,j/100);if(0<k){p=ColorUtils.ColorToHSB(r.r.avg<<16|r.g.avg<<8|r.b.avg);var v=(r.l.max-r.l.avg)/256*
(100-l)/2;p=ColorUtils.HSBtoColor(p.hue,p.saturation-v,p.brightness+v);v=c.clone();h.draw(v,null,ColorUtils.colorToColorTransform(p,16777215,k/100),BlendMode.DARKEN)}0<m&&h.draw(d,null,new ColorTransform(1,1,1,m/100),BlendMode.SCREEN);0<n&&0<o&&(p=this.stageChildVO.makeoverItem.color,p=ColorUtils.ColorToHSB(p),p=ColorUtils.HSBtoColor(p.hue,Math.max(p.saturation/2,0),Math.min(2*p.brightness,100)),h.draw(e,null,ColorUtils.colorToColorTransform(p,16777215,o/100)));this.setSmoothBitmap(i,h);i.setX(this.bounds[0].x);
i.setY(this.bounds[0].y)};StageBlush.prototype.flashOnHtml5_constructor.call(this)}StageConcealer.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageConcealer.prototype.constructor=StageConcealer;
function StageConcealer(){var a,c=8,d=50,e=5,f=2,h={},i={},j,k,l,m,n,o=!1,s,r,q,v={},p={},z={},w={},K,u,t;this.onInit=function(a){this.holder=new Sprite;K=new Bitmap;this.holder.addChild(K);this.addChild(this.holder);n=new Sprite;StageConcealer.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;
if(null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.setStageChildParam("drawData",null),this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;getTimer();this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);this.updateHolderPosition();TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_FACE);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);
TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYEBROW_LEFT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYEBROW_RIGHT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_NOSE);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_LIPS);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;o=0!=parseInt(this.getMakeoverItemParam("showCoverage",
0));e=parseFloat(this.getMakeoverItemParam("concealerColorAmount",5));c=parseFloat(this.getMakeoverItemParam("concealerFeathering",8));d=parseFloat(this.getMakeoverItemParam("concealerSpread",50));f=parseFloat(this.getMakeoverItemParam("concealerLightening",2));var a=!1;this.compare(h,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.modifiedFoundationFlag,this.model.photoTrace[this.stageChildVO.tracedArea],this.model.photoTrace[TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)?
TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT],c,d);this.createMask();v={};i={};this.compare(v,f,this.model.modifiedFoundationFlag)&&(this.createLightSkin(),a=!0);this.compare(i,this.stageChildVO.makeoverItem.color,e)&&(a=!0);if(TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&null!=this.getStageChildParam("drawData",null)&&(this.holder.transform.setMatrix(new Matrix(1,0,0,1,0,0)),o=0!=parseInt(this.getMakeoverItemParam("showCoverage",0)),s=parseFloat(this.getMakeoverItemParam("concealerBlurAmount",
50)),r=parseFloat(this.getMakeoverItemParam("concealerBlurFeathering",8)),q=parseFloat(this.getMakeoverItemParam("concealerColorAmountSpotApply",17.5)),this.compare(p,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_FACE],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_RIGHT],
this.model.photoTrace[TracedArea.TRACEDAREA_NOSE],this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],r)&&(this.createFaceMask(),w={}),this.compare(z,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.modifiedFoundationFlag,this.stageChildVO.makeoverItem.color,s,q,o)&&(this.createBlurredPhoto(),w={}),this.compare(w,this.model.photoId)&&(this.createBlurredFace(),a=!0),t!=this.getStageChildParam("drawData","")))t=this.getStageChildParam("drawData",""),a=!0;a&&(this.createConcealer(),
this.changed=!0);if(this.model.isSpotApplyMode)return a&&this.dispatchChangeEvent(),this.setVisible(!1),!0;a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.initSpotApply=function(){void 0==p.value&&(this.setStageChildParam("drawData",""),h={},this.dispatchChangeEvent())};this.createMask=function(){var a=TracingUtils.getCurvePointsTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea]),
a=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(a,this.stageChildVO.tracedArea));this.bounds=MathUtils.getBoundingBox(a);this.bounds=MathUtils.extendBoundingBox(this.bounds,0,0);this.bounds[0].x=Math.floor(this.bounds[0].x);this.bounds[0].y=Math.floor(this.bounds[0].y);this.bounds[1].x=Math.floor(this.bounds[1].x)+1;this.bounds[1].y=Math.floor(this.bounds[1].y)+1;this.bounds=MathUtils.confineBoundsCoords(this.bounds,0,0,this.model.photoWidth-1,this.model.photoHeight-1);var a=MathUtils.widthFromBounds(this.bounds),
e=MathUtils.heightFromBounds(this.bounds);TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&null!=this.getStageChildParam("drawData",null)&&(this.bounds[0].setX(0),this.bounds[0].setY(0),this.bounds[1].setX(this.model.photoWidth-1),this.bounds[1].setY(this.model.photoHeight-1),a=this.model.photoWidth,e=this.model.photoHeight);if(0<a&&0<e){var f=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y);baseMaskBitmapData=new BitmapData(a,e,!0,0);TracingUtils.drawTracedShape(baseMaskBitmapData,
this.stageChildVO.tracedArea,16777215,1,null,f);TracingUtils.drawTracedShape(baseMaskBitmapData,TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT,0,10,BlendMode.ERASE,f);j=TracingUtils.calculateAverage(null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation,baseMaskBitmapData,this.bounds,3,this.bounds[0].x,this.bounds[0].y);baseMaskBitmapData=new BitmapData(a,e,!0,1114367);TracingUtils.drawTracedShapeBlurred(baseMaskBitmapData,
this.stageChildVO.tracedArea,16777215,1,100-d,!1,0,0,1,1,f);TracingUtils.drawTracedShape(baseMaskBitmapData,TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT,0,1,BlendMode.ERASE,f);baseMaskBitmapData.applyFilter(baseMaskBitmapData,baseMaskBitmapData.rect,this.getBlur(c,0))}};this.createLightSkin=function(){var c=null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation;a=new BitmapData(baseMaskBitmapData.width,
baseMaskBitmapData.height,!0,16777215);ColorUtils.ColorToHSB(j.r.avg<<16|j.g.avg<<8|j.b.avg);var d,e,h=this.bounds[0].x,i=this.bounds[1].x,k=this.bounds[0].y,l=this.bounds[1].y,o,m,n;for(d=h;d<i;d++)for(e=k;e<l;e++)o=baseMaskBitmapData.getPixel32(d-h,e-k)&4278190080,0!=o&&(m=ColorUtils.ColorToHSB(c.getPixel(d,e)),n=j.br.max-m.brightness,m=ColorUtils.HSBtoColor(m.hue,m.saturation-n/f,m.brightness+n/f),a.setPixel32(d-h,e-k,o|m))};this.createFaceMask=function(){k=new BitmapData(this.model.photoWidth,
this.model.photoHeight,!0,16777215);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_FACE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_LIPS),0,4*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_NOSE,0,4*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_EYE_LEFT,0,9*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_EYE_RIGHT,
0,9*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_LEFT),0,TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_RIGHT),0,TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_LEFT),0,4*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,
TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_RIGHT),0,4*TracingUtils.faceScale(),BlendMode.ERASE);k.applyFilter(k,k.rect,this.getBlur(r,0))};this.createBlurredPhoto=function(){l=(null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation).clone();l.applyFilter(l,l.rect,this.getBlur(0,8*TracingUtils.faceScale()*s/50));var a=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),a=MathUtils.range(2.55*q,0,255)<<24|a;o&&(a=4278190080);
l.draw(new BitmapData(this.model.photoWidth,this.model.photoHeight,!0,a))};this.createBlurredFace=function(){var a=null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation;this.clear(n);n.addChild(new Bitmap(a));n.addChild(new Bitmap(l));n.addChild(new Bitmap(k));n.getChildAt(n.numChildren-2).cacheAsBitmap=!0;n.getChildAt(n.numChildren-1).cacheAsBitmap=!0;n.getChildAt(n.numChildren-2).mask=n.getChildAt(n.numChildren-1)};this.createConcealer=function(){if(TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&
null!=this.getStageChildParam("drawData",null)){revealBitmapData=new BitmapData(this.model.photoWidth,this.model.photoHeight,!0,16777215);TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&revealBitmapData.draw(n);revealBitmapData.draw(a);if(0<e){var c=baseMaskBitmapData.clone(),d=ColorUtils.colorToColorTransform(TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),16777215,100*(e/100));revealBitmapData.draw(c,null,d)}m=new BitmapData(this.model.photoWidth,this.model.photoHeight,
!0,16777215);m.draw(baseMaskBitmapData);null!=t&&""!=t&&this.drawFromDrawData(m,t);u=this.maskBitmapData(revealBitmapData,m);this.setSmoothBitmap(K,u)}else revealBitmapData=new BitmapData(a.width,a.height,!0,16777215),revealBitmapData.draw(a),c=baseMaskBitmapData.clone(),revealBitmapData.draw(c,null,ColorUtils.colorToColorTransform(TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),16777215,e/100)),this.setSmoothBitmap(K,revealBitmapData);K.setX(this.bounds[0].x);K.setY(this.bounds[0].y)};
StageConcealer.prototype.flashOnHtml5_constructor.call(this)}StageConcealer.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageConcealer.prototype.constructor=StageConcealer;
function StageConcealer(){var a,c=8,d=50,e=5,f=2,h={},i={},j,k,l,m,n,o=!1,s,r,q,v={},p={},z={},w={},K,u,t;this.onInit=function(a){this.holder=new Sprite;K=new Bitmap;this.holder.addChild(K);this.addChild(this.holder);n=new Sprite;StageConcealer.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;
if(null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.setStageChildParam("drawData",null),this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;getTimer();this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);this.updateHolderPosition();TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_FACE);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);
TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYEBROW_LEFT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYEBROW_RIGHT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_NOSE);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_LIPS);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;o=0!=parseInt(this.getMakeoverItemParam("showCoverage",
0));e=parseFloat(this.getMakeoverItemParam("concealerColorAmount",5));c=parseFloat(this.getMakeoverItemParam("concealerFeathering",8));d=parseFloat(this.getMakeoverItemParam("concealerSpread",50));f=parseFloat(this.getMakeoverItemParam("concealerLightening",2));var a=!1;this.compare(h,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.modifiedFoundationFlag,this.model.photoTrace[this.stageChildVO.tracedArea],this.model.photoTrace[TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)?
TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT],c,d);this.createMask();v={};i={};this.compare(v,f,this.model.modifiedFoundationFlag)&&(this.createLightSkin(),a=!0);this.compare(i,this.stageChildVO.makeoverItem.color,e)&&(a=!0);if(TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&null!=this.getStageChildParam("drawData",null)&&(this.holder.transform.setMatrix(new Matrix(1,0,0,1,0,0)),o=0!=parseInt(this.getMakeoverItemParam("showCoverage",0)),s=parseFloat(this.getMakeoverItemParam("concealerBlurAmount",
50)),r=parseFloat(this.getMakeoverItemParam("concealerBlurFeathering",8)),q=parseFloat(this.getMakeoverItemParam("concealerColorAmountSpotApply",17.5)),this.compare(p,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_FACE],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_RIGHT],
this.model.photoTrace[TracedArea.TRACEDAREA_NOSE],this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],r)&&(this.createFaceMask(),w={}),this.compare(z,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.modifiedFoundationFlag,this.stageChildVO.makeoverItem.color,s,q,o)&&(this.createBlurredPhoto(),w={}),this.compare(w,this.model.photoId)&&(this.createBlurredFace(),a=!0),t!=this.getStageChildParam("drawData","")))t=this.getStageChildParam("drawData",""),a=!0;a&&(this.createConcealer(),
this.changed=!0);if(this.model.isSpotApplyMode)return a&&this.dispatchChangeEvent(),this.setVisible(!1),!0;a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.initSpotApply=function(){void 0==p.value&&(this.setStageChildParam("drawData",""),h={},this.dispatchChangeEvent())};this.createMask=function(){var a=TracingUtils.getCurvePointsTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea]),
a=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(a,this.stageChildVO.tracedArea));this.bounds=MathUtils.getBoundingBox(a);this.bounds=MathUtils.extendBoundingBox(this.bounds,0,0);this.bounds[0].x=Math.floor(this.bounds[0].x);this.bounds[0].y=Math.floor(this.bounds[0].y);this.bounds[1].x=Math.floor(this.bounds[1].x)+1;this.bounds[1].y=Math.floor(this.bounds[1].y)+1;this.bounds=MathUtils.confineBoundsCoords(this.bounds,0,0,this.model.photoWidth-1,this.model.photoHeight-1);var a=MathUtils.widthFromBounds(this.bounds),
e=MathUtils.heightFromBounds(this.bounds);TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&null!=this.getStageChildParam("drawData",null)&&(this.bounds[0].setX(0),this.bounds[0].setY(0),this.bounds[1].setX(this.model.photoWidth-1),this.bounds[1].setY(this.model.photoHeight-1),a=this.model.photoWidth,e=this.model.photoHeight);if(0<a&&0<e){var f=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y);baseMaskBitmapData=new BitmapData(a,e,!0,0);TracingUtils.drawTracedShape(baseMaskBitmapData,
this.stageChildVO.tracedArea,16777215,1,null,f);TracingUtils.drawTracedShape(baseMaskBitmapData,TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT,0,10,BlendMode.ERASE,f);j=TracingUtils.calculateAverage(null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation,baseMaskBitmapData,this.bounds,3,this.bounds[0].x,this.bounds[0].y);baseMaskBitmapData=new BitmapData(a,e,!0,1114367);TracingUtils.drawTracedShapeBlurred(baseMaskBitmapData,
this.stageChildVO.tracedArea,16777215,1,100-d,!1,0,0,1,1,f);TracingUtils.drawTracedShape(baseMaskBitmapData,TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT,0,1,BlendMode.ERASE,f);baseMaskBitmapData.applyFilter(baseMaskBitmapData,baseMaskBitmapData.rect,this.getBlur(c,0))}};this.createLightSkin=function(){var c=null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation;a=new BitmapData(baseMaskBitmapData.width,
baseMaskBitmapData.height,!0,16777215);ColorUtils.ColorToHSB(j.r.avg<<16|j.g.avg<<8|j.b.avg);var d,e,h=this.bounds[0].x,i=this.bounds[1].x,k=this.bounds[0].y,l=this.bounds[1].y,o,m,n;for(d=h;d<i;d++)for(e=k;e<l;e++)o=baseMaskBitmapData.getPixel32(d-h,e-k)&4278190080,0!=o&&(m=ColorUtils.ColorToHSB(c.getPixel(d,e)),n=j.br.max-m.brightness,m=ColorUtils.HSBtoColor(m.hue,m.saturation-n/f,m.brightness+n/f),a.setPixel32(d-h,e-k,o|m))};this.createFaceMask=function(){k=new BitmapData(this.model.photoWidth,
this.model.photoHeight,!0,16777215);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_FACE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_LIPS),0,4*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_NOSE,0,4*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_EYE_LEFT,0,9*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracedArea.TRACEDAREA_EYE_RIGHT,
0,9*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_LEFT),0,TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_RIGHT),0,TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_LEFT),0,4*TracingUtils.faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(k,
TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_RIGHT),0,4*TracingUtils.faceScale(),BlendMode.ERASE);k.applyFilter(k,k.rect,this.getBlur(r,0))};this.createBlurredPhoto=function(){l=(null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation).clone();l.applyFilter(l,l.rect,this.getBlur(0,8*TracingUtils.faceScale()*s/50));var a=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),a=MathUtils.range(2.55*q,0,255)<<24|a;o&&(a=4278190080);
l.draw(new BitmapData(this.model.photoWidth,this.model.photoHeight,!0,a))};this.createBlurredFace=function(){var a=null==this.model.modifiedFoundation?this.model.photoBitmapData:this.model.modifiedFoundation;this.clear(n);n.addChild(new Bitmap(a));n.addChild(new Bitmap(l));n.addChild(new Bitmap(k));n.getChildAt(n.numChildren-2).cacheAsBitmap=!0;n.getChildAt(n.numChildren-1).cacheAsBitmap=!0;n.getChildAt(n.numChildren-2).mask=n.getChildAt(n.numChildren-1)};this.createConcealer=function(){if(TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&
null!=this.getStageChildParam("drawData",null)){revealBitmapData=new BitmapData(this.model.photoWidth,this.model.photoHeight,!0,16777215);TracingUtils.isTracedAreaLeftSide(this.stageChildVO.tracedArea)&&revealBitmapData.draw(n);revealBitmapData.draw(a);if(0<e){var c=baseMaskBitmapData.clone(),d=ColorUtils.colorToColorTransform(TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),16777215,100*(e/100));revealBitmapData.draw(c,null,d)}m=new BitmapData(this.model.photoWidth,this.model.photoHeight,
!0,16777215);m.draw(baseMaskBitmapData);null!=t&&""!=t&&this.drawFromDrawData(m,t);u=this.maskBitmapData(revealBitmapData,m);this.setSmoothBitmap(K,u)}else revealBitmapData=new BitmapData(a.width,a.height,!0,16777215),revealBitmapData.draw(a),c=baseMaskBitmapData.clone(),revealBitmapData.draw(c,null,ColorUtils.colorToColorTransform(TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),16777215,e/100)),this.setSmoothBitmap(K,revealBitmapData);K.setX(this.bounds[0].x);K.setY(this.bounds[0].y)};
StageConcealer.prototype.flashOnHtml5_constructor.call(this)}StageContacts.prototype=new StageAccessory(flashOnHtml5_constructingPrototype);StageContacts.prototype.constructor=StageContacts;
function StageContacts(){var a,c,d,e={},f={},h,i,j;this.onInit=function(c){this.holder=new Sprite;this.holder.cacheAsBitmap=!0;this.addChild(this.holder);a=new Sprite;this.holderStageChild=new Sprite;this.holder.addChild(this.holderStageChild);StageContacts.prototype.onInit.call(this,c)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&
(this.setVisible(!1),this.changed=!0),this.changed;if(null==this.stageChildVO.makeoverItem||null==this.stageChildVO.makeoverItem.URL||""==this.stageChildVO.makeoverItem.URL)return this.currentURL="",this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);d=this.stageChildVO.feature==Features.FEATURE_CONTACTS?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;
if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.changed=this.updatePosition()||this.changed;this.changed=this.updateStageChildVOPosition()||this.changed;this.compare(e,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[this.stageChildVO.tracedArea],this.model.photoTrace[d],this.stageChildVO.scaleX)&&(this.createMask(),f={});h=this.getMakeoverItemParam("contactData",
"").split(";");i=h.length;this.compare(f,this.stageChildVO.makeoverItem.URL,h)&&(this.clear(this.holderStageChild),j=0,this.currentURL=this.stageChildVO.makeoverItem.URL.replace("0.",j+"."),this.removeLoader(this.loaderAsset),this.loaderAsset=new Loader,this.loadRequest(this.loaderAsset,this.currentURL),this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.onComplete=function(a){a=this.getLoadedBitmapData(a);if(null!=a&&j<h.length){var d;d=new ColorTransform;
var e=h[j].split(",");4==e.length&&(d.redOffset=e[0],d.greenOffset=e[1],d.blueOffset=e[2],d.alphaMultiplier=e[3]/100);a.colorTransform(a.rect,d);for(var e=30*parseFloat(this.getMakeoverItemParam("contactScale",1)),f=e/a.width,o=e/a.height;0.5>f&&0.5>o;)d=new BitmapData(a.width/2,a.height/2,!0,0),d.draw(a,new Matrix(0.5,0,0,0.5),null,null,null,!0),a=d,f=e/a.width,o=e/a.height;d=new BitmapData(a.width*f,a.height*o,!0,0);d.draw(a,new Matrix(f,0,0,o),null,null,null,!0);a=d;d=new BitmapData(a.width,a.height,
!0,0);e=new Matrix(1,0,0,1,this.bounds[0].x+a.width/2,this.bounds[0].y+a.width/2);d.draw(c,e);a=this.maskBitmapData(a,d);a=new Bitmap(a);a.setX(-a.width/2);a.setY(-a.height/2);a.smoothing=!0;this.holderStageChild.addChild(a);j++;j<i?(this.currentURL=this.stageChildVO.makeoverItem.URL.replace("0.",j+"."),this.removeLoader(this.loaderAsset),this.loaderAsset=new Loader,this.loadRequest(this.loaderAsset,this.currentURL)):(this.removeLoader(this.loaderAsset),this.loaderAsset=null,this.holderStageChild.filters=
TracingUtils.globalImageAdjust(),this.renderCompleted())}else this.removeLoader(this.loaderAsset),this.loaderAsset=null};this.createMask=function(){if(null!=this.stageChildVO){var e=TracingUtils.getTracedAreaVO(d),f=TracingUtils.getCurvePointsTracedArea(e),f=TracingUtils.pointsToAbsolute(f,e),e=this.model.photoTrace[this.stageChildVO.tracedArea],h=new TracedAreaVO;h.location=new Point(e.location.x,e.location.y);h.scaleX=e.scaleX*this.stageChildVO.scaleX;h.scaleY=e.scaleY*this.stageChildVO.scaleY;
h.rotation=e.rotation;f=TracingUtils.pointsToRelative(f,h);this.bounds=MathUtils.getBoundingBox(f);this.bounds=MathUtils.extendBoundingBox(this.bounds,0,5);e=MathUtils.widthFromBounds(this.bounds);h=MathUtils.heightFromBounds(this.bounds);if(0<e&&0<h){c=new BitmapData(e,h,!0,0);e=-this.bounds[0].x;h=-this.bounds[0].y;a.graphics.clear();a.graphics.beginFill(16777215);a.graphics.moveTo(f[f.length-1].x+e,f[f.length-1].y+h);for(var i=0;i<f.length;i++)a.graphics.lineTo(f[i].x+e,f[i].y+h);a.graphics.endFill();
c.draw(a)}}};StageContacts.prototype.flashOnHtml5_constructor.call(this)}StageCover.prototype=new StageAccessory(flashOnHtml5_constructingPrototype);StageCover.prototype.constructor=StageCover;
function StageCover(){var a={},c=null;this.onInit=function(a){this.holder=new Sprite;this.holder.mouseEnabled=!1;this.assetBitmap=new Bitmap;this.holder.addChild(this.assetBitmap);StageCover.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible)return null!=this.holder&&this.holder.visible&&(this.holder.setVisible(!1),this.changed=
!0),null!=this.model.stageMain.filters&&(this.model.stageMain.filters=null,this.changed=!0),this.changed;if(null==this.stageChildVO.makeoverItem)return this.setAsset(null),this.holder.getGraphics().clear(),this.model.stageMain.filters=null,this.currentURL="",this.holder.visible&&(this.holder.setVisible(!1),this.changed=!0),null!=this.model.stageMain.filters&&(this.model.stageMain.filters=null,this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);
TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);this.changed=this.changed||this.updatePosition();this.currentURL!=this.stageChildVO.makeoverItem.URL&&(this.currentURL=this.stageChildVO.makeoverItem.URL,this.removeLoader(this.loaderAsset),this.loaderAsset=new Loader,this.loadRequest(this.loaderAsset,this.currentURL),this.changed=!0);var d=this.getMakeoverItemParam("colorMatrix",null);this.compare(a,d)&&(c=[new ColorMatrixFilter(d)]);this.model.stageMain.filters!=c&&(this.model.stageMain.filters=
c,this.changed=!0);this.holder.visible||(this.holder.setVisible(!0),this.changed=!0);return this.changed};this.updatePosition=function(){var a=!1,c=this.model.parentWidth/2,f=this.model.parentHeight/2,h=1,i=1,j=1;null!=this.asset&&(0<this.asset.width&&0<this.asset.height)&&(this.getMakeoverItemParam("stretch",!1)?(i=this.model.parentWidth/this.asset.width,j=this.model.parentHeight/this.asset.height):j=i=h=Math.min(this.model.parentHeight/this.asset.height,this.model.parentWidth/this.asset.width));
if(this.holder.x!=c||this.holder.y!=f||this.holder.scaleX!=h)f=0,this.holder.setX(0),this.holder.setY(f),this.holder.setScaleX(i),this.holder.setScaleY(j),a=!0;return a};this.drawSides=function(a,c,f,h){a.graphics.clear();null!=this.stageChildVO.makeoverItem&&(this.asset.width*c<f?(c=(f-this.asset.width*c)/2,a.graphics.beginFill(this.stageChildVO.makeoverItem.color,1),a.graphics.drawRect(-f/2,-h/2,c,h),a.graphics.drawRect(f/2-c,-h/2,c,h),a.graphics.endFill()):this.asset.height*c<h&&(c=(h-this.asset.height*
c)/2,a.graphics.beginFill(this.stageChildVO.makeoverItem.color,1),a.graphics.drawRect(-f/2,-h/2,f,c),a.graphics.drawRect(-f/2,h/2-c,f,c),a.graphics.endFill()))};this.getSizedSprite=function(a,c){var f=new BitmapData(a,c,0,!0);f.draw(this.asset,new Matrix(a/this.asset.width,0,0,c/this.asset.height));return f};this.draw=function(){null!=this.stageChildVO&&(null!=this.stageChildVO.makeoverItem&&null!=this.asset)&&(this.setAsset(this.asset),this.holder.filters=TracingUtils.globalImageAdjust(),this.updatePosition(),
null==this.holder.parent&&this.model.stageMain.parent.addChild(this.holder),this.model.stageMain.filters=c);this.holder.setVisible(!0);this.renderCompleted()};StageCover.prototype.flashOnHtml5_constructor.call(this)}StageEyeLiner.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageEyeLiner.prototype.constructor=StageEyeLiner;
function StageEyeLiner(){function a(a,c){a.getGraphics().beginFill(16777215);a.getGraphics().moveTo(c[c.length-1].x,c[c.length-1].y);for(var d=0;d<c.length;d++){var e=c[d].x,f=c[d].y;k=Math.min(k,e);l=Math.max(l,e);m=Math.min(m,f);n=Math.max(n,f);a.getGraphics().lineTo(e,f)}a.getGraphics().endFill()}var c,d,e,f,h,i={},j={},k,l,m,n;this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);e=new Bitmap;this.holder.addChild(e);f=new Sprite;h=new Sprite;StageEyeLiner.prototype.onInit.call(this,
a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;c=this.stageChildVO.feature==Features.FEATURE_EYELINER;var a=this.getMakeoverItemParam("style",0);this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature,
a);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.updateHolderPosition();if(this.compare(i,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT],this.model.photoTrace[this.stageChildVO.tracedArea],a,this.getMakeoverItemParam("eyeLinerGap",
50),this.getMakeoverItemParam("thickness",50),this.getMakeoverItemParam("eyeLinerSmudge",50)))this.createMask(),j={};this.compare(j,this.stageChildVO.makeoverItem.color,this.stageChildVO.makeoverItem.opacity,this.getMakeoverItemParam("eyeLinerDarken",50))&&(this.colorize(),this.changed=!0);a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.getEyelinerCoords=
function(a,d){var e,f=0.52*2.85*this.getMakeoverItemParam("eyeLinerGap",50)/50*TracingUtils.faceScale();switch(d){case "top":e=TracingUtils.getPointsAlongTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea],!0,c,50);TracingUtils.curveBackwards(this.stageChildVO.tracedArea,e,[[0,a],[80,3*(a/4)],[100,0]],0,c,!0);break;case "bottom-inner":e=TracingUtils.getPointsAlongTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea],!1,c,100);TracingUtils.curveBackwards(this.stageChildVO.tracedArea,
e,[[0,-a],[80,3*(-a/4)],[100,0]],0,c,!1);break;case "bottom-outer":e=TracingUtils.getPointsAlongTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea],!1,c,100),e.splice(0,12),TracingUtils.curveBackwards(this.stageChildVO.tracedArea,e,[[0,-a],[80,3*(-a/4)],[100,0]],-f,c,!1)}return e};this.createMask=function(){k=2*this.model.photoWidth;m=2*this.model.photoHeight;l=-k;n=-m;f.getGraphics().clear();h.getGraphics().clear();var e=0.5+this.getMakeoverItemParam("thickness",50)/100,e=2.85*e*TracingUtils.faceScale(),
i=this.getMakeoverItemParam("style",0);switch(i){case 1:a(f,this.getEyelinerCoords(e,"top"));a(h,this.getEyelinerCoords(e,"bottom-outer"));break;case 2:a(f,this.getEyelinerCoords(e,"top"));break;case 3:a(h,this.getEyelinerCoords(e,"bottom-inner"));break;case 4:a(h,this.getEyelinerCoords(e,"bottom-outer"));break;case 5:var j=f,q;q=EyeLinerUtils.getWingedEyeShape(e,c);var v=new TracedAreaVO;v.points=q[0];v.pointsZ=q[1];v.pointsA=q[2];q=TracingUtils.getCurvePointsTracedArea(v,100);a(j,q);break;case 6:j=
f;q=EyeLinerUtils.getCatEyeShape(e,c);v=new TracedAreaVO;v.points=q[0];v.pointsZ=q[1];v.pointsA=q[2];q=TracingUtils.getCurvePointsTracedArea(v,100);a(j,q);break;default:a(f,this.getEyelinerCoords(e,"top")),a(h,this.getEyelinerCoords(e,"bottom-inner"))}k-=2*e;l+=2*e;m-=2*e;n+=2*e;e=l-k;j=n-m;q=new Matrix(1,0,0,1,-k,-m);d=new BitmapData(e,j,!0,0);d.draw(f,q);d.draw(h,q);if(5==i||6==i)TracingUtils.drawTracedShape(d,c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT,0,1,BlendMode.ERASE,
q);d.applyFilter(d,d.rect,this.getBlur(this.getMakeoverItemParam("eyeLinerSmudge",50)/50,0))};this.colorize=function(){this.setSmoothBitmap(e,d);e.setX(k);e.setY(m);var a=2.55*this.getMakeoverItemParam("eyeLinerDarken",50),a=ColorUtils.mixColors(this.stageChildVO.makeoverItem.color,0,a);e.transform.colorTransform=ColorUtils.colorToColorTransform(TracingUtils.globalColorAdjust(a));e.alpha=0.9};StageEyeLiner.prototype.flashOnHtml5_constructor.call(this)}StageEyeShadow.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);
StageEyeShadow.prototype.constructor=StageEyeShadow;
function StageEyeShadow(){var a,c,d,e,f={},h={},i={},j={};this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);StageEyeShadow.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;getTimer();if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&(this.setVisible(!1),
this.changed=!0),this.changed;d=this.stageChildVO.feature!=Features.FEATURE_EYESHADOW_R;var a=parseInt(this.getMakeoverItemParam("style",0)),c=parseInt(this.getMakeoverItemParam("area",0));this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature,a,c);null!=this.getStageChildParam("points",null)&&(this.stageChildVO.tracedArea=d?TracedArea.TRACEDAREA_EYESHADOW_LEFT:TracedArea.TRACEDAREA_EYESHADOW_RIGHT);this.updateHolderPosition();TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);
if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;if(1==parseInt(this.getMakeoverItemParam("fast",0))){if(c=a=!1,this.compare(i,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],this.model.photoTrace[TracedArea.TRACEDAREA_TEETH],this.model.modifiedLipsTrace,parseFloat(this.getMakeoverItemParam("esBlur",8)))&&(a=!0),this.compare(j,
this.stageChildVO.makeoverItem.color,this.getMakeoverItemParam("coverage","full"),this.stageChildVO.makeoverItem.opacity)&&(c=!0),a||c)this.fastMaskAndColor(a,c),this.changed=!0}else{if(this.compare(f,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[this.stageChildVO.tracedArea],this.model.photoTrace[d?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT],this.getStageChildParam("points",null),parseInt(this.getMakeoverItemParam("esReduce",0)),parseFloat(this.getMakeoverItemParam("esReduceScale",
0)),parseInt(this.getMakeoverItemParam("esBlur",8)),d?this.model.modifiedEyebrowLeftTrace:this.model.modifiedEyebrowRightTrace))(new Date).getTime(),this.createMask(),h={},this.changed=!0;this.compare(h,this.stageChildVO.makeoverItem.color,this.stageChildVO.makeoverItem.opacity,parseInt(this.getMakeoverItemParam("methodES",0)),parseInt(this.getMakeoverItemParam("mpPercent",50)),this.getMakeoverItemParam("finish","satin"),parseInt(this.getMakeoverItemParam("saturationLimit",70)),parseInt(this.getMakeoverItemParam("brightnessLimit",
70)),parseInt(this.getMakeoverItemParam("darknessLimit",30)),parseFloat(this.getMakeoverItemParam("satinCoverage",60)),parseFloat(this.getMakeoverItemParam("satinFeathering",4)),parseFloat(this.getMakeoverItemParam("metallicFactorES",0.5)),parseInt(this.getMakeoverItemParam("shimmerCoverPercentES",5)),parseInt(this.getMakeoverItemParam("shimmerOpacityES",60)))&&((new Date).getTime(),this.colorize(),this.changed=!0)}a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>
1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.fastDrawShape=function(a,c,d,e,f){var h=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(this.model.photoTrace[d].points,d)),i=this.model.photoTrace[d].pointsZ,d=this.model.photoTrace[d].pointsA;a.getGraphics().clear();a.getGraphics().beginFill(e);MathUtils.curveThroughPoints(a.getGraphics(),h,i,d,0.1);a.getGraphics().endFill();c.draw(a,f)};this.fastMaskAndColor=
function(c){(new Date).getTime();var e=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),f=(e&16711680)>>>16,h=(e&65280)>>>8,e=(e&255)>>>0;if(c){var c=parseFloat(this.getMakeoverItemParam("esBlur",8)),i=Math.round(this.getBlurAmount(c)),j=TracingUtils.getCurvePointsTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea]);this.bounds=MathUtils.getBoundingBox(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(j,this.stageChildVO.tracedArea)));Math.max(MathUtils.widthFromBounds(this.bounds)/
20,5);this.bounds=MathUtils.extendBoundingBox(this.bounds,0,i);this.bounds=MathUtils.confineBoundsCoords(this.bounds,0,0,this.model.photoWidth-1,this.model.photoHeight-1);var j=MathUtils.widthFromBounds(this.bounds),r=MathUtils.heightFromBounds(this.bounds),i=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y);a=new BitmapData(j,r,!0,4278190080);j=new Sprite;this.fastDrawShape(j,a,this.stageChildVO.tracedArea,16777215,i);this.fastDrawShape(j,a,d?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT,
0,i);a.applyFilter(a,a.rect,this.getBlur(c,0,"blueonly"));i=a.imageData.data;j=i.length;for(c=0;c<j;c+=4)i[c+3]=i[c],i[c]=f,i[c+1]=h,i[c+2]=e}else{i=a.imageData.data;j=i.length;for(c=0;c<j;c+=4)i[c]=f,i[c+1]=h,i[c+2]=e}this.clear();f=this.createSmoothBitmap(a);f.setX(this.bounds[0].x);f.setY(this.bounds[0].y);this.holder.addChild(f)};this.adjustMask=function(){var d=this.bounds[0].x,e=this.bounds[0].y,f=MathUtils.widthFromBounds(this.bounds),h=MathUtils.heightFromBounds(this.bounds);if(0<f&&0<h){var i=
a.getPixels(new Rectangle(0,0,f,h)),d=this.model.photoBitmapData.getPixels(new Rectangle(d,e,f,h));i.setPosition(0);d.setPosition(0);for(e=0;e<i.length;e+=4)f=i.readUnsignedInt()>>24,0<f?(h=ColorUtils.colorToLuminance(d.readUnsignedInt()),h<c.l.avg&&(h=MathUtils.range(255*((h-c.l.min)/(c.l.avg-c.l.min)),0,255),f>h&&(i.setPosition(i.position-4),i.writeUnsignedInt(h<<24|16777215)))):d.setPosition(d.position+4)}};this.createMask=function(){if(null!=this.stageChildVO&&null!=this.model.photoBitmapData){var e;
if(null!=this.getStageChildParam("points",null)){e=new TracedAreaVO;e.location=new Point(this.model.photoTrace[this.stageChildVO.tracedArea].location.x,this.model.photoTrace[this.stageChildVO.tracedArea].location.y);e.rotation=this.model.photoTrace[this.stageChildVO.tracedArea].rotation;e.scaleX=this.model.photoTrace[this.stageChildVO.tracedArea].scaleX;e.scaleY=this.model.photoTrace[this.stageChildVO.tracedArea].scaleY;e.indexLeft=-1;e.indexRight=-1;e.points=TracingUtils.arrayToPoints(this.getStageChildParam("points",
null),d);e.pointsZ=[];e.pointsA=[];for(var f=0;f<e.points.length;f++)e.pointsZ.push(0.5),e.pointsA.push(0.5)}else e=this.model.photoTrace[this.stageChildVO.tracedArea];f=Math.round(TracingUtils.faceScale()*parseInt(this.getMakeoverItemParam("esBlur",8)));this.bounds=MathUtils.getBoundingBox(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(TracingUtils.getCurvePointsTracedArea(e),e)));this.bounds=MathUtils.extendBoundingBox(this.bounds,0,f);this.bounds=MathUtils.confineBounds(this.bounds,
new Point(0,0),new Point(this.model.photoWidth-1,this.model.photoHeight-1));var h=MathUtils.widthFromBounds(this.bounds),i=MathUtils.heightFromBounds(this.bounds);0<h&&0<i&&(a=new BitmapData(h,i,!0,0),h=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y),TracingUtils.drawTracedShapeBlurred(a,e,16777215,1,parseInt(this.getMakeoverItemParam("esReduce",0)),!1,0,0,1,parseInt(this.getMakeoverItemParam("esReduceScale",0)),h),TracingUtils.drawTracedShape(a,d?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT,
0,1+2*TracingUtils.faceScale(),BlendMode.ERASE,h),e=a.clone(),c=TracingUtils.calculateAverage(this.model.photoBitmapData,a,this.bounds,2,this.bounds[0].x,this.bounds[0].y),40>c.br.min&&this.adjustMask(),TracingUtils.drawTracedShape(a,TracingUtils.getTracedAreaVO(d?TracedArea.TRACEDAREA_EYEBROW_LEFT:TracedArea.TRACEDAREA_EYEBROW_RIGHT),0,-1-TracingUtils.faceScale(),BlendMode.ERASE,h),c=TracingUtils.calculateAverage(this.model.photoBitmapData,a,this.bounds,2,this.bounds[0].x,this.bounds[0].y),a=e,a.applyFilter(a,
a.rect,this.getBlur(0,f,"alphaonly")))}};this.eyeShadowRender=function(a,d,f,h,i,j,r){var d=f[0].x,i=f[1].x,q=f[0].y,v=f[1].y,p=MathUtils.widthFromBounds(f),z=MathUtils.heightFromBounds(f);if(0<p&&0<z){var f=new BitmapData(p,z,!0,0),w=new ByteArray,K=j>>16&255,u=j>>8&255,t=j&255;Math.max(ColorUtils.colorToLuminance(j),1);var K=ColorUtils.RGBtoYUV(K,u,t),D,u=parseInt(this.getMakeoverItemParam("methodES",-1));if(-1==u)switch(r){case "matte":case "stain":u=4;break;case "metallic":case "metallicshimmer":u=
6;break;default:u=5}D=ColorUtils.ColorToHSB(j);var t=Math.max(D.brightness,1),A,B,F,C=1,G=0,N,H=D.saturation/100,O,L,M=Math.max(c.br.max-c.br.avg,0.01),P,j=h.getPixels(new Rectangle(0,0,p,z)),Q=this.model.photoBitmapData.getPixels(new Rectangle(d,q,p,z));j.setPosition(0);Q.setPosition(0);switch(u){case 4:u=100/c.br.max;C=t/c.br.avg;C=Math.min(C+(1-C)/100*parseInt(this.getMakeoverItemParam("mpPercent",50)),u);G=t-c.br.avg*C;Math.max(1-C,0);O=0;L=Math.min(50,c.br.avg*C+G);for(u=0;u<j.length;u+=4)t=
j.readUnsignedInt()>>24,0!=t?(A=ColorUtils.ColorToHSB(Q.readUnsignedInt()),F=MathUtils.range(255*((A.brightness-O)/(L-O)),0,255),t=Math.min(t,F),B=A.brightness*C+G,w.writeUnsignedInt(t<<24|ColorUtils.HSBtoColor(D.hue,D.saturation,B))):(w.writeUnsignedInt(0),Q.setPosition(Q.position+4));w.setPosition(0);f.setPixels(f.rect,w);break;case 5:u=100/c.br.max;C=t/c.br.avg;C=Math.min(C+(1-C)/100*parseInt(this.getMakeoverItemParam("mpPercent",50)),u);G=t-c.br.avg*C;N=Math.max(1-C,0);O=0;L=Math.min(50,c.br.avg*
C+G);H=D.saturation/50;t=D.hue/60;u=Math.floor(t);F=t-u;var U=1-F,E=h.imageData.data,R=f.imageData.data;L-=O;switch(u){case 0:for(u=0;u<j.length;u+=4)t=E[u+3],w=Q.readUnsignedInt(),0<t&&(w=Math.max(w>>16&255,w>>8&255,w&255)/2.55,t=Math.min(t,255*((w-O)/L)),P=MathUtils.range((w-(c.br.max-M))/M,0,1),A=Math.max(Math.min((D.saturation-(w-c.br.avg)*H)/100,1),0),B=Math.max(Math.min(2.55*(w*(C+N*P/2)+G),255),0),R[u]=B,R[u+1]=B*(1-A*U),R[u+2]=B*(1-A),R[u+3]=t);break;case 1:for(u=0;u<j.length;u+=4)t=E[u+3],
w=Q.readUnsignedInt(),0<t&&(w=Math.max(Math.max(w>>16&255,w>>8&255),w&255)/2.55,t=Math.min(t,255*((w-O)/L)),P=MathUtils.range((w-(c.br.max-M))/M,0,1),A=Math.max(Math.min((D.saturation-(w-c.br.avg)*H)/100,1),0),B=Math.max(Math.min(2.55*(w*(C+N*P/2)+G),255),0),R[u]=B*(1-A*F),R[u+1]=B,R[u+2]=B*(1-A),R[u+3]=t);break;case 2:for(u=0;u<j.length;u+=4)t=E[u+3],w=Q.readUnsignedInt(),0<t&&(w=Math.max(Math.max(w>>16&255,w>>8&255),w&255)/2.55,t=Math.min(t,255*((w-O)/L)),P=MathUtils.range((w-(c.br.max-M))/M,0,
1),A=Math.max(Math.min((D.saturation-(w-c.br.avg)*H)/100,1),0),B=Math.max(Math.min(2.55*(w*(C+N*P/2)+G),255),0),R[u]=B*(1-A),R[u+1]=B,R[u+2]=B*(1-A*U),R[u+3]=t);break;case 3:for(u=0;u<j.length;u+=4)t=E[u+3],w=Q.readUnsignedInt(),0<t&&(w=Math.max(Math.max(w>>16&255,w>>8&255),w&255)/2.55,t=Math.min(t,255*((w-O)/L)),P=MathUtils.range((w-(c.br.max-M))/M,0,1),A=Math.max(Math.min((D.saturation-(w-c.br.avg)*H)/100,1),0),B=Math.max(Math.min(2.55*(w*(C+N*P/2)+G),255),0),R[u]=B*(1-A),R[u+1]=B*(1-A*F),R[u+2]=
B,R[u+3]=t);break;case 4:for(u=0;u<j.length;u+=4)t=E[u+3],w=Q.readUnsignedInt(),0<t&&(w=Math.max(Math.max(w>>16&255,w>>8&255),w&255)/2.55,t=Math.min(t,255*((w-O)/L)),P=MathUtils.range((w-(c.br.max-M))/M,0,1),A=Math.max(Math.min((D.saturation-(w-c.br.avg)*H)/100,1),0),B=Math.max(Math.min(2.55*(w*(C+N*P/2)+G),255),0),R[u]=B*(1-A*U),R[u+1]=B*(1-A),R[u+2]=B,R[u+3]=t);break;case 5:for(u=0;u<j.length;u+=4)t=E[u+3],w=Q.readUnsignedInt(),0<t&&(w=Math.max(Math.max(w>>16&255,w>>8&255),w&255)/2.55,t=Math.min(t,
255*((w-O)/L)),P=MathUtils.range((w-(c.br.max-M))/M,0,1),A=Math.max(Math.min((D.saturation-(w-c.br.avg)*H)/100,1),0),B=Math.max(Math.min(2.55*(w*(C+N*P/2)+G),255),0),R[u]=B,R[u+1]=B*(1-A),R[u+2]=B*(1-A*F),R[u+3]=t)}break;case 6:u=100/c.br.max;C=t/c.br.avg;C=Math.min(C+(1-C)/100*parseInt(this.getMakeoverItemParam("mpPercent",50)),u);G=t-c.br.avg*C;N=Math.max(1-C,0);O=0;L=Math.min(50,c.br.avg*C+G);for(u=0;u<j.length;u+=4)t=j.readUnsignedInt()>>24,0!=t?(A=ColorUtils.ColorToHSB(Q.readUnsignedInt()),B=
A.brightness,F=MathUtils.range(255*((B-O)/(L-O)),0,255),t=Math.min(t,F),P=MathUtils.range((A.brightness-(c.br.max-M))/M,0,1),B=B*(C+N*P)+G,A=D.saturation-(B-c.br.avg)*H,A*=1-P*H/4,F=(D.hue+P*e+360)%360,w.writeUnsignedInt(t<<24|ColorUtils.HSBtoColor(F,A,B))):(w.writeUnsignedInt(0),Q.setPosition(Q.position+4));w.setPosition(0);f.setPixels(f.rect,w)}if("satin"==r){if(0<p&&0<z){var I=new BitmapData(p,z,!1,0),u=TracingUtils.combineByteArrays(TracingUtils.getEdgesByteArray(0,d,q,i,v),TracingUtils.getEdgesByteArray(1,
d,q,i,v),TracingUtils.getEdgesByteArray(2,d,q,i,v),TracingUtils.getEdgesByteArray(3,d,q,i,v)),t=0;u.setPosition(0);j.setPosition(0);u.setPosition(0);I.setPixels(I.rect,u);for(u=0;u<z;u++)for(D=0;D<p;D++)0==(j.readUnsignedInt()>>>24&255)&&(I.setPixel(D,u,0),t++);u=parseFloat(this.getMakeoverItemParam("satinCoverage",60));D=TracingUtils.buildHistogram(I);D[0]-=t;t=TracingUtils.findThreshold(D,100*(1-u/100));j.setPosition(0);for(u=0;u<z;u++)for(D=0;D<p;D++)0<(h.getPixel32(D,u)>>24&255)&&((I.getPixel(D,
u)&255)>=t?I.setPixel(D,u,0):I.setPixel(D,u,16777215));I.applyFilter(I,I.rect,this.getBlur(0,parseFloat(this.getMakeoverItemParam("satinFeathering",4))))}h=f.clone();h.applyFilter(h,h.rect,this.getBlur(0,2*TracingUtils.faceScale()+1));for(u=0;u<z;u++)for(D=0;D<p;D++)w=f.getPixel(D,u),t=h.getPixel(D,u),C=I.getPixel(D,u)&255,f.setPixel(D,u,ColorUtils.mixColors(w,t,C))}if("metallic"==r||"metallicshimmer"==r)I=TracingUtils.faceScale()/4,I*=MathUtils.range(parseFloat(this.getMakeoverItemParam("metallicFactorES",
0.5)),0,2),this.applyBitmapFilter(f,this.sharpenFilter(I));I=1;"stain"==r&&(I=0.4);I=this.createSmoothBitmap(f,I);I.setX(d);I.setY(q);a.addChild(I);if("shimmer"==r||"metallicshimmer"==r){a=new BitmapData(p,z,!0,16777215);r=parseInt(this.getMakeoverItemParam("shimmerCoverPercentES",5));p=2.55*parseInt(this.getMakeoverItemParam("shimmerOpacityES",60));z=Math.max(Math.round(TracingUtils.faceScale()),1);j.setPosition(0);for(u=q;u<=v;u++)for(D=d;D<=i;D++)if(t=j.readUnsignedInt()>>>24&255,0<t&&100*Math.random()<
r){w=ColorUtils.colorToLuminance(this.model.photoBitmapData.getPixel(D,u));I=ColorUtils.YUVtoColor(K.y+w,K.u,K.v);h=Math.random()*z;C=Math.random()*p;for(H=0;H<h;H++)M=MathUtils.range(C-H/h*C,0,255),M*=t/255,a.setPixel32(D+H-d,u-q,Math.min(M+(a.getPixel32(D+H-d,u-q)>>24&255),255)<<24|I),0<H&&(a.setPixel32(D-H-d,u-q,Math.min(M+(a.getPixel32(D-H-d,u-q)>>24&255),255)<<24|I),a.setPixel32(D-d,u+H-q,Math.min(M+(a.getPixel32(D-d,u+H-q)>>24&255),255)<<24|I),a.setPixel32(D-d,u-H-q,Math.min(M+(a.getPixel32(D-
d,u-H-q)>>24&255),255)<<24|I))}f.draw(a)}}};this.colorize=function(){this.clear();if(null!=this.stageChildVO&&null!=this.stageChildVO.makeoverItem){getTimer();var d=this.getMakeoverItemParam("finish","satin"),f=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),h=ColorUtils.ColorToHSB(f),f=h.saturation,i=parseInt(this.getMakeoverItemParam("saturationLimit",70));f>i&&(f=i+(f-i)/2);var i=h.brightness,j=parseInt(this.getMakeoverItemParam("brightnessLimit",70));i>j&&(i=j+(i-j)/2);j=
parseInt(this.getMakeoverItemParam("darknessLimit",30));i<j&&(i=j-(j-i)/2);f=ColorUtils.HSBtoColor(h.hue,f,i);h=h.hue;60<=h&&300>=h?e=Math.max(60-h,-8):(60>h&&(h+=360),e=Math.min(h-300,8));this.eyeShadowRender(this.holder,this.model.photoBitmapData,this.bounds,a,c,f,d)}};StageEyeShadow.prototype.flashOnHtml5_constructor.call(this)}StageEyebrowPencil.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageEyebrowPencil.prototype.constructor=StageEyebrowPencil;
function StageEyebrowPencil(){var a,c,d={},e={};this.onInit=function(c){this.holder=new Sprite;this.addChild(this.holder);a=new Bitmap;this.holder.addChild(a);StageEyebrowPencil.prototype.onInit.call(this,c)};this.onChange=function(){changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&
(this.setVisible(!1),changed=!0),changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),changed=!0),changed;this.updateHolderPosition();this.compare(d,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[this.stageChildVO.tracedArea],
this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_RIGHT],this.model.modifiedEyebrowLeftTrace,this.model.modifiedEyebrowRightTrace,this.getMakeoverItemParam("eyebrowPencilSmudge",5))&&(this.createMask(),e={});this.compare(e,this.stageChildVO.makeoverItem.color,this.stageChildVO.makeoverItem.opacity,parseInt(this.getMakeoverItemParam("dummy",50)))&&(this.colorize(),changed=!0);var a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-
a)>1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),changed=!0);return changed};this.createMask=function(){var a=TracingUtils.getTracedAreaVO(this.stageChildVO.tracedArea),d=TracingUtils.getCurvePointsTracedArea(a),d=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(d,a));this.bounds=MathUtils.getBoundingBox(d);this.bounds=MathUtils.extendBoundingBox(this.bounds,3,5);this.bounds[0].x=Math.floor(this.bounds[0].x);this.bounds[0].y=Math.floor(this.bounds[0].y);
this.bounds[1].x=Math.floor(this.bounds[1].x)+1;this.bounds[1].y=Math.floor(this.bounds[1].y)+1;this.bounds=MathUtils.confineBounds(this.bounds,new Point(0,0),new Point(this.model.photoWidth-1,this.model.photoHeight-1));var d=MathUtils.widthFromBounds(this.bounds),e=MathUtils.heightFromBounds(this.bounds);0<d&&0<e&&(c=new BitmapData(d,e,!0,0),d=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y),TracingUtils.drawTracedShape(c,a,16777215,1,null,d),c.applyFilter(c,c.rect,this.getBlur(parseFloat(this.getMakeoverItemParam("eyebrowPencilSmudge",
5)),0)))};this.colorize=function(){this.setSmoothBitmap(a,c);a.setX(this.bounds[0].x);a.setY(this.bounds[0].y);a.transform.colorTransform=ColorUtils.colorToColorTransform(TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color))};StageEyebrowPencil.prototype.flashOnHtml5_constructor.call(this)}StageEyeBrighten.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageEyeBrighten.prototype.constructor=StageEyeBrighten;
function StageEyeBrighten(){var a,c,d={},e={};this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);c=new Bitmap;this.holder.addChild(c);StageEyeBrighten.prototype.onInit.call(this,a)};this.onChange=function(){changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),changed=!0),changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);
if(null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&(this.setVisible(!1),changed=!0),changed;TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),changed=!0),changed;this.updateHolderPosition();this.compare(d,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[this.stageChildVO.tracedArea],
this.getMakeoverItemParam("maskExtend",10),this.getMakeoverItemParam("maskBlur",16))&&(this.createMask(),e={});this.compare(e,this.stageChildVO.makeoverItem.color,this.getMakeoverItemParam("methodEB",1),this.getMakeoverItemParam("brighteningAmount",50))&&(this.colorize(),changed=!0);var a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>1/256&&(this.holder.alpha=a,changed=!0);this.visible||(this.setVisible(!0),changed=!0);return changed};this.createMask=function(){var c=
TracingUtils.getTracedAreaVO(this.stageChildVO.tracedArea),d=TracingUtils.getCurvePointsTracedArea(c),d=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(d,c));this.bounds=MathUtils.getBoundingBox(d);this.bounds=MathUtils.extendBoundingBox(this.bounds,3,this.getMakeoverItemParam("maskExtend",10));this.bounds[0].x=Math.floor(this.bounds[0].x);this.bounds[0].y=Math.floor(this.bounds[0].y);this.bounds[1].x=Math.floor(this.bounds[1].x)+1;this.bounds[1].y=Math.floor(this.bounds[1].y)+1;this.bounds=
TracingUtils.confineBounds(this.bounds);c=MathUtils.widthFromBounds(this.bounds);d=MathUtils.heightFromBounds(this.bounds);0<c&&0<d&&(a=new BitmapData(c,d,!0,0),c=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y),TracingUtils.drawTracedShape(a,this.stageChildVO.tracedArea,16777215,this.getMakeoverItemParam("maskExtend",10),null,c),a.applyFilter(a,a.rect,this.getBlur(this.getMakeoverItemParam("maskBlur",16),0)))};this.colorize=function(){getTimer();var d=MathUtils.widthFromBounds(this.bounds),
e=MathUtils.heightFromBounds(this.bounds);if(0<d&&0<e){var i=new BitmapData(d,e,!0,16777215),j=new ByteArray,k=i.imageData.data,l=1+this.getMakeoverItemParam("brighteningAmount",50)/250,m=this.getMakeoverItemParam("methodEB",1),n,o,s,r=0;if(1==m)for(n=0;n<e;n++)for(m=0;m<d;m++)o=a.imageData.data[r+3],0<o&&(j=ColorUtils.ColorToHSB(this.model.photoBitmapData.getPixel(m+this.bounds[0].x,n+this.bounds[0].y)),s=ColorUtils.HSBtoColor(j.hue,j.saturation,Math.min(j.brightness*l,100)),k[r]=s>>16&255,k[r+1]=
s>>8&255,k[r+2]=s&255,k[r+3]=o),r+=4;else if(2==m){m=this.getMakeoverItemParam("brighteningAmount",50)/2;r=HairColoring.levels3(0,0,64-m/2,64+m,192-m,192+m/2);for(n=0;n<e;n++)for(m=0;m<d;m++)o=a.getPixel32(m,n)>>24&255,0<o?(s=this.model.photoBitmapData.getPixel(m+this.bounds[0].x,n+this.bounds[0].y),k=s>>16&255,l=s>>8&255,s&=255,s=o<<24|r[k]<<16|r[l]<<8|r[s],j.writeUnsignedInt(s)):j.writeUnsignedInt(0)}else{var m=this.getMakeoverItemParam("brighteningAmount",50)/2,r=HairColoring.levels3(0,0,64-0.8*
m/2,64+0.8*m,192-0.8*m,192+0.8*m/2),q=HairColoring.levels3(0,0,64-0.9*m/2,64+0.9*m,192-0.9*m,192+0.9*m/2),v=HairColoring.levels3(0,0,64-1*m/2,64+1*m,192-1*m,192+1*m/2);for(n=0;n<e;n++)for(m=0;m<d;m++)o=a.getPixel32(m,n)>>24&255,0<o?(s=this.model.photoBitmapData.getPixel(m+this.bounds[0].x,n+this.bounds[0].y),k=s>>16&255,l=s>>8&255,s&=255,s=o<<24|r[k]<<16|q[l]<<8|v[s],j.writeUnsignedInt(s)):j.writeUnsignedInt(0)}}this.setSmoothBitmap(c,i);c.setX(this.bounds[0].x);c.setY(this.bounds[0].y)};StageEyeBrighten.prototype.flashOnHtml5_constructor.call(this)}
StageFoundation.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageFoundation.prototype.constructor=StageFoundation;
function StageFoundation(){function a(a,c){for(var d=a.imageData.data,e=d.length,f=c.imageData.data,h=0;h<e;h+=4)d[h+3]=Math.min(d[h],f[h]),d[h]=255,d[h+1]=255,d[h+2]=255}function c(a,c){for(var d=4*c.width*c.height,e=3;e<d;e+=4)a.imageData.data[e]=c.imageData.data[e];return a}function d(a,c,d,e){for(var f=(e>>16&255)-(d>>16&255),h=(e>>8&255)-(d>>8&255),d=(e>>0&255)-(d>>0&255),e=a.length,i=0;i<e;i+=4)if(0<a[i+3]){var j=Math.round(0.299*a[i]+0.587*a[i+1]+0.114*a[i+2]);c[i]=Math.max(0,Math.min(255,
j+f));c[i+1]=Math.max(0,Math.min(255,j+h));c[i+2]=Math.max(0,Math.min(255,j+d));c[i+3]=a[i+3]}}var e,f,h,i,j,k,l,m,n,o,s,r,q,v={},p={},z={},w={},K={},u={},t={},D,A,B,F,C,G,N,H,O="";this.onInit=function(a){this.holder=new Sprite;q=new Bitmap;this.holder.addChild(q);this.addChild(this.holder);s=new Sprite;s.addChild(new Bitmap);i=new Sprite;s.addChild(i);j=new Sprite;s.addChild(j);k=new Sprite;s.addChild(k);StageFoundation.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||
!this.model.hasPhoto||this.model.isTracingMode||null===this.stageChildVO||!this.stageChildVO.visible||null===this.stageChildVO.makeoverItem||4294967295===this.stageChildVO.makeoverItem.color)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;H=parseInt(this.getMakeoverItemParam("style",0));this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature,H);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_FACE);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);
TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYEBROW_LEFT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_EYEBROW_RIGHT);TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_LIPS);this.updateHolderPosition();if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)===TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;
var a=1==parseInt(this.getMakeoverItemParam("fast",0));if(a){F=parseInt(this.getMakeoverItemParam("foundationColorAmount",40));var c=!1,d=!1;this.compare(u,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_FACE],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_RIGHT],this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],
this.model.modifiedEyebrowLeftTrace,this.model.modifiedEyebrowRightTrace,this.model.modifiedLipsTrace,parseFloat(this.getMakeoverItemParam("foundationBlur",40)))&&(c=!0);this.compare(t,this.stageChildVO.makeoverItem.color,F)&&(d=!0);if(c||d)this.fastMaskAndColor(c,d),this.changed=!0}else{D=this.getMakeoverItemParam("finish","natural");switch(D){case "illuminating":A=50;B=0;F=45;C=40;G=60;break;case "matte":A=50;B=0;F=35;C=50;G=60;break;default:A=50,B=0,F=40,C=30,G=60}A=parseInt(this.getMakeoverItemParam("foundationSkinUniformity",
A));B=parseInt(this.getMakeoverItemParam("foundationSkinSmoothing",B));F=parseInt(this.getMakeoverItemParam("foundationColorAmount",F));C=parseInt(this.getMakeoverItemParam("foundationMatteAmount",C));G=parseInt(this.getMakeoverItemParam("foundationMatteArea",G));d=c=!1;N=0==H&&""==this.getStageChildParam("drawData","");(new Date).getTime();this.compare(v,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_FACE],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT],
this.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYEBROW_RIGHT],this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],this.model.modifiedEyebrowLeftTrace,this.model.modifiedEyebrowRightTrace,this.model.modifiedLipsTrace,parseFloat(this.getMakeoverItemParam("foundationBlur",40)))&&(this.createFaceMask(),p={},z={},w={});(new Date).getTime();this.compare(p,A,B,this.getMakeoverItemParam("edgeMask",
0),this.getMakeoverItemParam("edgeMaskThreshold",25),this.getMakeoverItemParam("edgeMaskBlur",5))&&(this.createBase(),c=!0);(new Date).getTime();this.compare(z,this.stageChildVO.makeoverItem.color,F)&&(this.createColor(),c=!0);(new Date).getTime();this.compare(w,this.stageChildVO.makeoverItem.color,C,G)&&(this.createMatte(),c=!0);c&&(this.setSmoothBitmap(s.getChildAt(0),this.model.photoBitmapData),revealBitmapData=new BitmapData(this.model.photoWidth,this.model.photoHeight,!1),revealBitmapData.draw(s),
d=!0);O!=this.getStageChildParam("drawData","")&&(O=this.getStageChildParam("drawData",""),K={});this.compare(K,this.model.photoWidth,this.model.photoHeight,this.model.photoId,H,this.model.photoTrace[this.stageChildVO.tracedArea])&&(N||this.createMask(),d=!0);d&&(this.createFoundation(),N||(this.model.modifiedFoundation=new BitmapData(this.model.photoWidth,this.model.photoHeight,!1),this.model.modifiedFoundation.draw(this.model.photoBitmapData),this.model.modifiedFoundation.draw(r),this.model.modifiedFoundationFlag=
getTimer()+"",this.model.onChange?this.model.onChangeTrigger=!0:this.dispatchChangeEvent()),this.changed=!0);if(this.model.isSpotApplyMode)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed}c=TracingUtils.globalOpacityAdjust(this.getOpacity());a&&(c*=F/100);Math.abs(this.holder.alpha-c)>1/256&&(this.holder.alpha=c,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.fastDrawShape=function(a,c,d,e,f){var h=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(this.model.photoTrace[d].points,
d)),i=this.model.photoTrace[d].pointsZ,d=this.model.photoTrace[d].pointsA;a.getGraphics().clear();a.getGraphics().beginFill(e);MathUtils.curveThroughPoints(a.getGraphics(),h,i,d,0.1);a.getGraphics().endFill();c.draw(a,f)};this.fastMaskAndColor=function(a){(new Date).getTime();var c=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),d=(c&16711680)>>>16,e=(c&65280)>>>8,c=(c&255)>>>0;if(a){var a=parseFloat(this.getMakeoverItemParam("foundationBlur",40)),h=Math.round(this.getBlurAmount(a)),
i=TracingUtils.getCurvePointsTracedArea(this.model.photoTrace[TracedArea.TRACEDAREA_FACE]);this.bounds=MathUtils.getBoundingBox(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(i,TracedArea.TRACEDAREA_FACE)));Math.max(MathUtils.widthFromBounds(this.bounds)/20,5);this.bounds=MathUtils.extendBoundingBox(this.bounds,0,h);this.bounds=MathUtils.confineBoundsCoords(this.bounds,0,0,this.model.photoWidth-1,this.model.photoHeight-1);var i=MathUtils.widthFromBounds(this.bounds),j=MathUtils.heightFromBounds(this.bounds),
h=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y);f=new BitmapData(i,j,!0,4278190080);i=new Sprite;this.fastDrawShape(i,f,TracedArea.TRACEDAREA_FACE,16777215,h);this.fastDrawShape(i,f,TracedArea.TRACEDAREA_LIPS,0,h);this.fastDrawShape(i,f,TracedArea.TRACEDAREA_TEETH,0,h);this.fastDrawShape(i,f,TracedArea.TRACEDAREA_EYE_LEFT,0,h);this.fastDrawShape(i,f,TracedArea.TRACEDAREA_EYE_RIGHT,0,h);this.fastDrawShape(i,f,TracedArea.TRACEDAREA_EYEBROW_LEFT,0,h);this.fastDrawShape(i,f,TracedArea.TRACEDAREA_EYEBROW_RIGHT,
0,h);f.applyFilter(f,f.rect,this.getBlur(a,0,"blueonly"));h=f.imageData.data;i=h.length;for(a=0;a<i;a+=4)h[a+3]=h[a],h[a]=d,h[a+1]=e,h[a+2]=c}else{h=f.imageData.data;i=h.length;for(a=0;a<i;a+=4)h[a]=d,h[a+1]=e,h[a+2]=c}this.setSmoothBitmap(q,f);q.setX(this.bounds[0].x);q.setY(this.bounds[0].y)};this.createMask=function(){l=new BitmapData(this.model.photoWidth,this.model.photoHeight,!0,16777215);TracingUtils.drawTracedShape(l,this.stageChildVO.tracedArea);l.applyFilter(l,l.rect,this.getBlur(parseFloat(this.getMakeoverItemParam("foundationBlur",
40)),0));baseMaskBitmapData=l.clone();null!==O&&""!==O&&this.drawFromDrawData(l,O)};this.createFoundation=function(){N?this.setSmoothBitmap(q,revealBitmapData):(r=this.maskBitmapData(revealBitmapData,l),this.setSmoothBitmap(q,r));q.setX(0);q.setY(0)};this.combineMaskAndTurnTransparent=a;this.newMaskBitmapData=c;this.createFaceMask=function(){(new Date).getTime();var d=parseFloat(this.getMakeoverItemParam("foundationBlur",40)),i=this.getBlurAmount(d),j=TracingUtils.getCurvePointsTracedArea(this.model.photoTrace[TracedArea.TRACEDAREA_FACE]);
this.bounds=MathUtils.getBoundingBox(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(j,TracedArea.TRACEDAREA_FACE)));j=Math.floor(Math.max(MathUtils.widthFromBounds(this.bounds)/20,5));this.bounds=MathUtils.extendBoundingBox(this.bounds,0,i);this.bounds=MathUtils.confineBoundsCoords(this.bounds,0,0,this.model.photoWidth-1,this.model.photoHeight-1);var i=MathUtils.widthFromBounds(this.bounds),k=MathUtils.heightFromBounds(this.bounds),l=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y);
e=new BitmapData(i,k,!0,4294967295);var p=TracingUtils.faceScale();TracingUtils.drawTracedShape(e,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_LIPS),0,4*p,null,l);TracingUtils.drawTracedShape(e,TracedArea.TRACEDAREA_EYE_LEFT,0,9*p,null,l);TracingUtils.drawTracedShape(e,TracedArea.TRACEDAREA_EYE_RIGHT,0,9*p,null,l);TracingUtils.drawTracedShape(e,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_LEFT),0,p,null,l);TracingUtils.drawTracedShape(e,TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_RIGHT),
0,p,null,l);(new Date).getTime();e.applyFilter(e,e.rect,this.getBlur(d/4,0,"blueonly"));(new Date).getTime();f=new BitmapData(i,k,!0,4278190080);TracingUtils.drawTracedShape(f,TracedArea.TRACEDAREA_FACE,16777215,1,null,l);(new Date).getTime();f.applyFilter(f,f.rect,this.getBlur(d,0,"blueonly"));(new Date).getTime();a(f,e);(new Date).getTime();m=TracingUtils.calculateAverage(this.model.photoBitmapData,f,this.bounds,j,this.bounds[0].x,this.bounds[0].y);(new Date).getTime();n=m.r.avg<<16|m.g.avg<<8|
m.b.avg;o=ColorUtils.colorToLuminance(n);o|=o<<16|o<<8;(new Date).getTime();h=new BitmapData(i,k,!0,0);h.draw(this.model.photoBitmapData,l);h=c(h,f)};this.createBase=function(){if(null!=h&&null!=this.stageChildVO.makeoverItem&&(0<A||0<B)){this.clear(i);var a=h.clone();0<A&&(a.applyFilter(a,a.rect,new ColorMatrixFilter(ColorUtils.createSatMatrix(100-A))),a.colorTransform(a.rect,ColorUtils.colorToColorTransform(n,o)));if(1==this.getMakeoverItemParam("edgeMask",0)){var c=h.width,d=h.height,e=this.getMakeoverItemParam("edgeMaskThreshold",
25),f=new BitmapData(c,d,!0,0);for(y=1;y<d-1;y++){var j=y+this.bounds[0].y;for(x=1;x<c-1;x++){var k=x+this.bounds[0].x,l=this.model.photoBitmapData.getPixel(k-1,j-1),m=l>>16&255,p=l>>8&255,l=l&255,r=this.model.photoBitmapData.getPixel(k,j-1),v=r>>15&510,Xa=r>>7&510,r=r<<1&510,z=this.model.photoBitmapData.getPixel(k+1,j-1),s=z>>16&255,Ya=z>>8&255,z=z&255,F=this.model.photoBitmapData.getPixel(k-1,j),q=F>>15&510,D=F>>7&510,F=F<<1&510,w=this.model.photoBitmapData.getPixel(k+1,j),C=w>>15&510,u=w>>7&510,
w=w<<1&510,t=this.model.photoBitmapData.getPixel(k-1,j+1),G=t>>16&255,K=t>>8&255,t=t&255,H=this.model.photoBitmapData.getPixel(k,j+1),N=H>>15&510,O=H>>7&510,H=H<<1&510,aa=this.model.photoBitmapData.getPixel(k+1,j+1),k=aa>>16&255,Ta=aa>>8&255,aa=aa&255;Math.round(0.299*Math.min(m+v+s-G-N-k,255)+0.587*Math.min(p+Xa+Ya-K-O-Ta,255)+0.114*Math.min(l+r+z-t-H-aa,255))<e&&(Math.round(0.299*Math.min(G+N+k-m-v-s,255)+0.587*Math.min(K+O+Ta-p-Xa-Ya,255)+0.114*Math.min(t+H+aa-l-r-z,255))<e&&Math.round(0.299*Math.min(m+
q+G-s-C-k,255)+0.587*Math.min(p+D+K-Ya-u-Ta,255)+0.114*Math.min(l+F+t-z-w-aa,255))<e&&Math.round(0.299*Math.min(s+C+k-m-q-G,255)+0.587*Math.min(Ya+u+Ta-p-D-K,255)+0.114*Math.min(z+w+aa-l-F-t,255))<e)&&f.setPixel32(x,y,4294967295)}}c=this.getMakeoverItemParam("edgeMaskBlur",5);this.applyBlur(f,c);a=this.maskBitmapData(a,f)}0<B&&a.applyFilter(a,a.rect,this.getBlur(0,1+B/10));i.addChild(this.createSmoothBitmap(a));i.setX(this.bounds[0].x);i.setY(this.bounds[0].y);i.alpha=1}else i.alpha=0};this.desaturateAndColorTransform=
d;this.createColor=function(){this.clear(j);if(null!==h&&null!==this.stageChildVO.makeoverItem){var a=new BitmapData(h.width,h.height,!0,0),c=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color);d(h.imageData.data,a.imageData.data,o,c);j.addChild(this.createSmoothBitmap(a));j.alpha=F/100;j.setX(this.bounds[0].x);j.setY(this.bounds[0].y)}};this.createMatte=function(){k.alpha=C/100;if(null!=h&&null!=this.stageChildVO.makeoverItem&&0<G&&0<C){this.clear(k);var a=ColorUtils.ColorToHSB(ColorUtils.mixColors(n,
TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),2.55*F));brightnessIncrease=(m.l.max-m.l.avg)/256*(100-G);for(var c=ColorUtils.HSBtoColor(a.hue,a.saturation-brightnessIncrease/2,a.brightness+brightnessIncrease/2),a=f.clone(),d=(c&16711680)>>>16,e=(c&65280)>>>8,c=(c&255)>>>0,i=a.imageData.data,j=i.length,l=0;l<j;l+=4)i[l]=d,i[l+1]=e,i[l+2]=c;k.addChild(this.createSmoothBitmap(a));k.blendMode=BlendMode.DARKEN;k.setX(this.bounds[0].x);k.setY(this.bounds[0].y)}};StageFoundation.prototype.flashOnHtml5_constructor.call(this)}
StageHair.prototype=new StageAccessory(flashOnHtml5_constructingPrototype);StageHair.prototype.constructor=StageHair;
function StageHair(){var a,c,d,e=!1,f,h,i,j,k,l,m={},n={},o={},s={},r,q,v,p,z,w,K,u=1,t=1;this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);this.holderStageChild=new Sprite;this.holder.addChild(this.holderStageChild);this.assetBitmap=new Bitmap;this.holderStageChild.addChild(this.assetBitmap);this.distortSprite=new Sprite;StageHair.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||
this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;if(null==this.stageChildVO.makeoverItem||
null==this.stageChildVO.makeoverItem.URL||""==this.stageChildVO.makeoverItem.URL)this.visible&&(this.setVisible(!1),this.changed=!0);else{this.changed=this.updatePosition()||this.changed;this.changed=this.updateStageChildVOPosition()||this.changed;var h=parseFloat(this.getMakeoverItemParam("scale",1));this.scale!=h&&(this.changed=!0);this.scale=h;this.distortSprite.scaleX=1/this.scale;this.distortSprite.scaleY=1/this.scale;if(this.currentURL!=this.stageChildVO.makeoverItem.URL)this.currentURL=this.stageChildVO.makeoverItem.URL,
h=this.getStageChildParam("url",null),this.currentURL!=h&&(this.setStageChildParam("srcCoords",""),this.setStageChildParam("dstCoords",""),this.setStageChildParam("url","")),m={},n={},o={},c=d=f=this.asset=a=null,this.visible||(j=this.assetBitmap.bitmapData=null,this.setAsset(j)),e=!1,this.removeLoader(this.loaderAsset),this.loaderAsset=new Loader,this.loadRequest(this.loaderAsset,this.currentURL),K=w=-1;else if(this.checkColorize()&&(this.changed=!0),this.compare(s,this.getStageChildParam("srcCoords",
""),this.getStageChildParam("dstCoords","")))this.doDistort(),this.changed=!0;this.checkHighlight()&&(this.changed=!0);this.checkLowlight()&&(this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0)}return this.changed};this.checkHighlight=function(){var a,d=!1;a=this.getLinkedMakeoverItem(Features.FEATURE_HIGHLIGHTS);null!=a?(a=parseInt(this.getMakeoverItemVOParam(a,"style",1)),0==a&&(a=1),a=MathUtils.range(a,1,4),w!=a?(w=a,c=null,this.removeLoader(p),p=new Loader,r=this.getHighlightURL(this.currentURL,
a),this.loadRequest(p,r),d=!0):d=this.colorizeHighlights()||d):0<u&&(u=0,this.updateFinal(),d=!0);return d};this.checkLowlight=function(){var a,c=!1;a=this.getLinkedMakeoverItem(Features.FEATURE_LOWLIGHTS);null!=a?(a=parseInt(this.getMakeoverItemVOParam(a,"style",4)),0==a&&(a=4),a=MathUtils.range(a,1,4),K!=a?(K=a,d=null,this.removeLoader(z),z=new Loader,q=this.getHighlightURL(this.currentURL,a),this.loadRequest(z,q),c=!0):c=this.colorizeLowlights()||c):0<t&&(t=0,this.updateFinal(),c=!0);return c};
this.getHighlightURL=function(a,c){return 0<a.indexOf("_h.")?a.replace("_h.","_h"+c+"."):a.replace(".swf","_h"+c+".swf").replace(".png","_h"+c+".png")};this.getShadowURL=function(a){return 0<a.indexOf("_h.")?a.replace("_h.","_s."):a.replace(".swf","_s.swf").replace(".png","_s.png")};this.getLinkedStageChild=function(a){var c=null,a=TracingUtils.findStageChildren(a,this.stageChildVO.instanceIndex,0,!1);null!=a&&0<a.length&&(c=a[0]);return c};this.getLinkedMakeoverItem=function(a){var c=null,a=this.getLinkedStageChild(a);
null!=a&&null!=a.makeoverItem&&(c=a.makeoverItem);return c};this.getHairColor=function(){l=4294967295;if(null!=this.stageChildVO&&null!=this.stageChildVO.makeoverItem){l=this.stageChildVO.makeoverItem.color;var a=this.getLinkedMakeoverItem(Features.FEATURE_HAIR_COLOR);null!=a&&(l=a.color)}};this.onComplete=function(f){var h=f.target.url;0<h.indexOf("/")&&h.substr(h.lastIndexOf("/"));if(f.target.loader==this.loaderAsset){this.asset=this.getLoadedBitmapData(f);k=null;this.model.hairStats=k;if(null!=
this.asset){e=!0;var h=this.asset.width,i=this.asset.height;this.bounds=[];this.bounds.push(new Point(0,0));this.bounds.push(new Point(h,i));k=TracingUtils.calculateAverage(this.asset,this.asset,this.bounds,5);this.model.hairStats=k;this.model.stageMain.dispatchEvent(new VmeResponseEvent(VmeResponseEvents.VME_RESPONSE_EVENT,VmeResponseEvents.VRE_HAIR_LOADED));this.checkColorize();this.colorizeHighlights();this.colorizeLowlights();this.renderCompleted()}this.removeLoader(this.loaderAsset);this.loaderAsset=
null}else f.target.loader==p?(c=this.getLoadedBitmapData(f),this.colorizeHighlights()&&this.renderCompleted(),this.removeLoader(p),p=null):f.target.loader==z?(d=this.getLoadedBitmapData(f),this.colorizeLowlights()&&this.renderCompleted(),this.removeLoader(z),z=null):f.target.loader==v?(a=this.getLoadedBitmapData(f),null!=a&&e&&(this.updateFinal(),this.renderCompleted()),this.removeLoader(v),v=null):trace("StateHair: onComplete loader could not be identified");try{f.target.loader.unload()}catch(j){}};
this.onFault=function(a){a.target.loader==this.loaderAsset?(this.removeLoader(this.loaderAsset),this.loaderAsset=null):a.target.loader==p?(this.removeLoader(p),p=null):a.target.loader==z?(this.removeLoader(z),z=null):a.target.loader==v&&(this.removeLoader(v),v=null)};this.checkColorize=function(){var a=!1;if(e){this.getHairColor();var c=0,d=0;null!=this.stageChildVO&&null!=this.stageChildVO.makeoverItem&&(c=this.stageChildVO.makeoverItem.color,d=this.stageChildVO.makeoverItem.opacity);this.compare(m,
this.currentURL,l,c,d,this.model.looks[this.model.currentLook].imageAdjust,parseInt(this.getMakeoverItemParam("method",0)),parseInt(this.getMakeoverItemParam("hairDark1",255)),parseInt(this.getMakeoverItemParam("hairDark2",255)),parseFloat(this.getMakeoverItemParam("desaturate",0)),parseFloat(this.getMakeoverItemParam("equalize",0)),!!this.getMakeoverItemParam("doCurves",!1),!!this.getMakeoverItemParam("doColortransform",!1),parseInt(this.getMakeoverItemParam("xR0",0)),parseInt(this.getMakeoverItemParam("yR0",
0)),parseInt(this.getMakeoverItemParam("xR1",0)),parseInt(this.getMakeoverItemParam("yR1",0)),parseInt(this.getMakeoverItemParam("xR2",0)),parseInt(this.getMakeoverItemParam("yR2",0)),parseInt(this.getMakeoverItemParam("xG0",0)),parseInt(this.getMakeoverItemParam("yG0",0)),parseInt(this.getMakeoverItemParam("xG1",0)),parseInt(this.getMakeoverItemParam("yG1",0)),parseInt(this.getMakeoverItemParam("xG2",0)),parseInt(this.getMakeoverItemParam("yG2",0)),parseInt(this.getMakeoverItemParam("xB0",0)),parseInt(this.getMakeoverItemParam("yB0",
0)),parseInt(this.getMakeoverItemParam("xB1",0)),parseInt(this.getMakeoverItemParam("yB1",0)),parseInt(this.getMakeoverItemParam("xB2",0)),parseInt(this.getMakeoverItemParam("yB2",0)),parseFloat(this.getMakeoverItemParam("thickness",50)))&&(this.colorize(),a=!0)}return a};this.colorize=function(){var a=!1;if(null!=this.stageChildVO.makeoverItem&&e){if(4294967295==l||0==l)f=null,this.updateFinal();else{var a=parseFloat(this.getMakeoverItemParam("desaturate",0)),c=parseFloat(this.getMakeoverItemParam("equalize",
0)),d=!!this.getMakeoverItemParam("doCurves",!1),h=!!this.getMakeoverItemParam("doColortransform",!1),i=parseInt(this.getMakeoverItemParam("xR0",0)),j=parseInt(this.getMakeoverItemParam("yR0",0)),m=parseInt(this.getMakeoverItemParam("xR1",0)),o=parseInt(this.getMakeoverItemParam("yR1",0)),n=parseInt(this.getMakeoverItemParam("xR2",0)),p=parseInt(this.getMakeoverItemParam("yR2",0)),r=parseInt(this.getMakeoverItemParam("xG0",0)),v=parseInt(this.getMakeoverItemParam("yG0",0)),z=parseInt(this.getMakeoverItemParam("xG1",
0)),s=parseInt(this.getMakeoverItemParam("yG1",0)),q=parseInt(this.getMakeoverItemParam("xG2",0)),w=parseInt(this.getMakeoverItemParam("yG2",0)),u=parseInt(this.getMakeoverItemParam("xB0",0)),t=parseInt(this.getMakeoverItemParam("yB0",0)),K=parseInt(this.getMakeoverItemParam("xB1",0)),V=parseInt(this.getMakeoverItemParam("yB1",0)),W=parseInt(this.getMakeoverItemParam("xB2",0)),Xa=parseInt(this.getMakeoverItemParam("yB2",0));1!=this.scale&&(this.asset.width*=this.scale,this.asset.height*=this.scale);
f=HairColoring.colorizeHair(this.asset,l,50,2,k,this.bounds,a,c,d,h,i,j,m,o,n,p,r,v,z,s,q,w,u,t,K,V,W,Xa);1!=this.scale&&(this.asset.width/=this.scale,this.asset.height/=this.scale);this.updateFinal();this.colorizeHighlights();this.colorizeLowlights()}a=!0}return a};this.colorizeHighlights=function(){var a=!1;if(null!=c&&e){var d=this.getLinkedMakeoverItem(Features.FEATURE_HIGHLIGHTS);null!=d&&(this.compare(n,r,d.color,d.opacity,parseInt(this.getMakeoverItemVOParam(d,"method",-1)),parseInt(this.getMakeoverItemVOParam(d,
"amount",0)),parseFloat(this.getMakeoverItemVOParam(d,"thickness",50)))&&(h=HairColoring.colorizeHair(c,d.color,parseInt(this.getMakeoverItemVOParam(d,"thickness",50)),-1,k),a=!0),Math.abs(u-this.getOpacity(d.opacity))>1/256&&(u=this.getOpacity(d.opacity),a=!0),a&&this.updateFinal())}return a};this.colorizeLowlights=function(){var a=!1;if(null!=d&&e){var c=this.getLinkedMakeoverItem(Features.FEATURE_LOWLIGHTS);if(null!=c&&(this.compare(o,q,c.color,c.opacity,parseInt(this.getMakeoverItemVOParam(c,
"method",-1)),parseInt(this.getMakeoverItemVOParam(c,"amount",0)),parseFloat(this.getMakeoverItemVOParam(c,"thickness",50)))&&(i=HairColoring.colorizeHair(d,c.color,parseInt(this.getMakeoverItemVOParam(c,"thickness",50)),-1,k),this.updateFinal(),a=!0),Math.abs(t-this.getOpacity(c.opacity))>1/256))t=this.getOpacity(c.opacity),this.updateFinal(),a=!0}return a};this.createFaceMask=function(){for(var a=new BitmapData(this.asset.width,this.asset.height,!0,16777215),c=this.model.photoTrace[TracedArea.TRACEDAREA_FACE].points,
d=0;d<c.length;d++)0>c[d].y&&(c[d].y=0);c=TracingUtils.pointsToAbsolute(c,TracedArea.TRACEDAREA_FACE);c=TracingUtils.pointsToRelative(c,TracedArea.TRACEDAREA_HAIR);c=TracingUtils.pointsToBitmapScale(c,this.asset.width,this.asset.height);d=new Sprite;this.faceMaskSprite.getGraphics().beginFill(16777215);MathUtils.curveThroughPoints(d.getGraphics(),c,this.model.photoTrace[TracedArea.TRACEDAREA_FACE].pointsZ,this.model.photoTrace[TracedArea.TRACEDAREA_FACE].pointsA);this.faceMaskSprite.getGraphics().endFill();
a.draw(d);a.applyFilter(a,a.rect,this.getBlur(0,40));return a};this.drawHairElement=function(a,c,d){"undefined"==typeof c&&(c=null);"undefined"==typeof d&&(d=1);if(null!=a){var e=new Matrix;e.translate(-a.width/2,-a.height/2);e.translate(this.asset.width/2,this.asset.height/2);d=new ColorTransform(1,1,1,d);null!=c?j.draw(c,e,d,null,null,!0):j.draw(a,e,d,null,null,!0)}};this.updateFinal=function(){e&&(j=new BitmapData(this.asset.width,this.asset.height,!0,0),null!=this.asset&&(this.drawHairElement(a),
this.drawHairElement(this.asset,f),this.drawHairElement(c,h,u),this.drawHairElement(d,i,t)),this.doDistort())};this.doDistort=function(a,c,d,f){"undefined"==typeof a&&(a=!1);"undefined"==typeof c&&(c=null);"undefined"==typeof d&&(d=null);"undefined"==typeof f&&(f=null);if(null!=j&&e&&(a?this.doDistortBitmap(j,c,d,f,a):(a=this.getStageChildParam("srcCoords",""),null!=a&&""!=a?(c=this.DataUtils.JSONDecode(a),d=this.DataUtils.JSONDecode(this.getStageChildParam("dstCoords","")),f=this.DataUtils.JSONDecode(this.getStageChildParam("indices",
"")),this.doDistortBitmap(j,c,d,f)):(this.distortSprite.getGraphics().clear(),this.setAsset(j))),null!=TracingUtils.globalImageAdjust()))this.holderStageChild.filters=TracingUtils.globalImageAdjust()};StageHair.prototype.flashOnHtml5_constructor.call(this)}StageLipColor.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageLipColor.prototype.constructor=StageLipColor;
function StageLipColor(){var a,c,d,e,f,h,i,j,k={},l={},m={},n={};this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);h=new Bitmap;this.holder.addChild(h);StageLipColor.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&
(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;(new Date).getTime();this.updateHolderPosition();this.compare(k,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],
this.model.photoTrace[TracedArea.TRACEDAREA_TEETH],this.model.modifiedLipsTrace,parseFloat(this.getMakeoverItemParam("lipcolorSmudge",2)))&&(this.createMask(),m={},n={},this.changed=!0);j=this.getMakeoverItemParam("finish","satin");var a;a="default";switch(j){case "satin":case "glossy":case "regular":case "shimmer":a="satin";break;case "metallic":case "metallicshimmer":a="metallic"}this.compare(l,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],
this.model.photoTrace[TracedArea.TRACEDAREA_TEETH],this.model.modifiedLipsTrace,a,parseFloat(this.getMakeoverItemParam("lipcolorSmudge",2)),parseFloat(this.getMakeoverItemParam("satinCoverage",60)),parseFloat(this.getMakeoverItemParam("satinFeathering",4)),parseFloat(this.getMakeoverItemParam("metallicFactor",25)))&&((new Date).getTime(),this.createTexture(a),n={},this.addTextureLayer(),this.changed=!0);(new Date).getTime();if(("glossy"==j||"regular"==j)&&this.compare(m,parseInt(this.getMakeoverItemParam("glossHPercent",
11)),parseInt(this.getMakeoverItemParam("glossHCutoff",26)),parseInt(this.getMakeoverItemParam("glossHAmount",100)),parseInt(this.getMakeoverItemParam("glossPercent",42)),parseInt(this.getMakeoverItemParam("glossCutoff",35)),parseInt(this.getMakeoverItemParam("glossAmount",18))))this.createGloss(),this.changed=!0;(new Date).getTime();this.compare(n,this.getMakeoverItemParam("coverage","full"),j,this.stageChildVO.makeoverItem.color,this.stageChildVO.makeoverItem.opacity,this.model.looks[this.model.currentLook].imageAdjust,
parseInt(this.getMakeoverItemParam("brightnessLimit",70)),parseFloat(this.getMakeoverItemParam("shimmerFactor",15)),parseInt(this.getMakeoverItemParam("shimmerCoverPercent",16)),parseInt(this.getMakeoverItemParam("shimmerOpacity",40)),parseInt(this.getMakeoverItemParam("shadowOpacity",0)),parseFloat(this.getMakeoverItemParam("highlightOpacitySatin",100)),parseFloat(this.getMakeoverItemParam("highlightOpacityMatte",0)),parseFloat(this.getMakeoverItemParam("glossColorOpacity",15)))&&(this.colorize(),
this.changed=!0);a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.createMask=function(){var c=TracingUtils.getTracedAreaVO(TracedArea.TRACEDAREA_LIPS);this.bounds=MathUtils.getBoundingBox(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(c.points,c)));this.bounds=MathUtils.extendBoundingBox(this.bounds,3,10);this.bounds[0].x=Math.floor(this.bounds[0].x);
this.bounds[0].y=Math.floor(this.bounds[0].y);this.bounds[1].x=Math.floor(this.bounds[1].x)+1;this.bounds[1].y=Math.floor(this.bounds[1].y)+1;this.bounds=MathUtils.confineBoundsCoords(this.bounds,0,0,this.model.photoWidth-1,this.model.photoHeight-1);a=TracingUtils.getTracedAreaMask(TracedArea.TRACEDAREA_LIPS).clone();a.applyFilter(a,a.rect,this.getBlur(parseFloat(this.getMakeoverItemParam("lipcolorSmudge",2)),0));c=Math.round(Math.max(MathUtils.widthFromBounds(this.bounds)*MathUtils.heightFromBounds(this.bounds)/
4E3,2));i=TracingUtils.calculateAverage(this.model.photoBitmapData,a,this.bounds,c,this.bounds[0].x,this.bounds[0].y);this.drawShadowHighlight()};this.buildHistogramLum=function(a,c,d){var e=[],f;for(f=0;255>=f;f++)e.push(0);var h,i,j;null==d?(h=0,i=a.width,j=0,d=a.height):(h=d[0].x,i=d[1].x,j=d[0].y,d=d[1].y);var k;for(f=h;f<i;f++)for(a=j;a<d;a++)255==(c.getPixel32(f-h,a-j)>>24&255)&&(k=ColorUtils.colorToLuminance(this.model.photoBitmapData.getPixel(f,a)),e[k]++);return e};this.generateGloss=function(c,
d,e,f,h){var i=new BitmapData(a.width,a.height,!0,0),c=TracingUtils.findThreshold(c,d),j,k,d=this.bounds[0].x,l=this.bounds[1].x;j=this.bounds[0].y;var m=this.bounds[1].y,n=i.imageData.data,D=a.imageData.data,A=0;(new Date).getTime();for(k=j;k<=m;k++)for(j=d;j<=l;j++){if(255==D[A+3]){var B=this.model.photoBitmapData.getPixel(j,k);ColorUtils.colorToLuminance(B)>c&&(n[A]=255,n[A+1]=255,n[A+2]=255,n[A+3]=255)}A+=4}i.applyFilter(i,i.rect,this.getBlur(0,e));for(A=0;A<n.length;A+=4)n[A+3]<f&&(n[A]=0,n[A+
1]=0,n[A+2]=0,n[A+3]=0);i.colorTransform(i.rect,new ColorTransform(1,1,1,h/255));i.applyFilter(i,i.rect,this.getBlur(0,1.5));for(A=0;A<n.length;A+=4)n[A]=255,n[A+1]=255,n[A+2]=255;return i};this.createGloss=function(){if(null!=this.model.photoBitmapData){var c=this.buildHistogramLum(this.model.photoBitmapData,a,this.bounds),d=parseInt(this.getMakeoverItemParam("glossHPercent",11)),e=6*TracingUtils.faceScale()-2+1,h=2.55*parseInt(this.getMakeoverItemParam("glossHCutoff",26)),i=2.55*parseInt(this.getMakeoverItemParam("glossHAmount",
100)),d=this.generateGloss(c,d,e,h,i),e=parseInt(this.getMakeoverItemParam("glossPercent",42)),h=6*TracingUtils.faceScale()-2+1,i=2.55*parseInt(this.getMakeoverItemParam("glossCutoff",35)),j=2.55*parseInt(this.getMakeoverItemParam("glossAmount",18));f=this.generateGloss(c,e,h,i,j);f.draw(d)}};this.addTextureLayer=function(){TracingUtils.findStageChildren(Features.FEATURE_LIP_TEXTURE,0);this.model.onChange?this.model.onChangeTrigger=!0:this.dispatchChangeEvent()};this.createTexture=function(d){var e,
f=this.bounds[0].x,h=this.bounds[1].x,i=this.bounds[0].y,j=this.bounds[1].y,k=MathUtils.widthFromBounds(this.bounds),l=MathUtils.heightFromBounds(this.bounds);if(0<k&&0<l){switch(d){case "satin":c=new BitmapData(k,l,!0,16777215);if(0<k&&0<l){var m=new BitmapData(k,l,!1,0);(new Date).getTime();TracingUtils.combine(m,TracingUtils.getEdges(0,f,i,h,j));TracingUtils.combine(m,TracingUtils.getEdges(1,f,i,h,j));TracingUtils.combine(m,TracingUtils.getEdges(2,f,i,h,j));TracingUtils.combine(m,TracingUtils.getEdges(3,
f,i,h,j));(new Date).getTime();for(var n=0,d=0;d<k;d++)for(e=0;e<l;e++)0==(a.getPixel32(d,e)>>24&255)&&(m.setPixel(d,e,0),n++);(new Date).getTime();d=parseFloat(this.getMakeoverItemParam("satinCoverage",60));e=TracingUtils.buildHistogram(m);e[0]-=n;n=TracingUtils.findThreshold(e,100*(1-d/100));(new Date).getTime();for(d=0;d<k;d++)for(e=0;e<l;e++)0<(a.getPixel32(d,e)>>24&255)&&((m.getPixel(d,e)&255)>=n?m.setPixel(d,e,0):m.setPixel(d,e,16777215));m.applyFilter(m,m.rect,this.getBlur(parseFloat(this.getMakeoverItemParam("satinFeathering",
4)),0))}(new Date).getTime();k=new BitmapData(c.width,c.height,!1);k.draw(this.model.photoBitmapData,new Matrix(1,0,0,1,-f,-i));k.applyFilter(k,k.rect,this.getBlur(0,6*TracingUtils.faceScale()-1));var t,D,l=0;for(e=i;e<=j;e++)for(d=f;d<=h;d++)t=this.model.photoBitmapData.getPixel(d,e),D=m.imageData.data[l],i=t>>16&255,n=t>>8&255,t&=255,D/=255,n+=(k.imageData.data[l+1]-n)*D,t+=(k.imageData.data[l+2]-t)*D,c.imageData.data[l]=i+(k.imageData.data[l]-i)*D,c.imageData.data[l+1]=n,c.imageData.data[l+2]=
t,c.imageData.data[l+3]=255,l+=4;break;case "metallic":c=new BitmapData(k,l,!0,16777215);c.draw(this.model.photoBitmapData,new Matrix(1,0,0,1,-f,-i));f=parseFloat(this.getMakeoverItemParam("metallicFactor",25));this.applyBitmapFilter(c,this.sharpenFilter(f/100));break;default:c=new BitmapData(k,l,!0,16777215),c.draw(this.model.photoBitmapData,new Matrix(1,0,0,1,-f,-i))}(new Date).getTime();c.applyMask(a);this.model.lipTexture=c;this.model.lipTextureX=this.bounds[0].x;this.model.lipTextureY=this.bounds[0].y;
this.model.lipTextureFlag=getTimer()}};this.drawShadowHighlight=function(){var c,f,h=this.bounds[0].x,j=this.bounds[1].x;c=this.bounds[0].y;var k=this.bounds[1].y,l=MathUtils.widthFromBounds(this.bounds),m=MathUtils.heightFromBounds(this.bounds);if(0<l&&0<m){d=new BitmapData(l,m,!0,16777215);e=new BitmapData(l,m,!0,16777215);if(64>i.l.min&&128<i.l.max-i.l.min&&192<i.l.max&&128<i.l.max-i.l.min){var l=i.l.avg-i.l.min,m=i.l.max-i.l.avg,n=0;for(f=c;f<=k;f++)for(c=h;c<=j;c++){var K=a.imageData.data[n+
3];if(0<K){var u;u=ColorUtils.colorToLuminance(this.model.photoBitmapData.getPixel(c,f));u<i.l.avg?(u=i.l.avg-u,u/=l,u=K*MathUtils.range(u,0,1),d.imageData.data[n]=0,d.imageData.data[n+1]=0,d.imageData.data[n+2]=0,d.imageData.data[n+3]=u):(u-=i.l.avg,u/=m,u=K*MathUtils.range(u,0,1),96>u&&(u=0),e.imageData.data[n]=255,e.imageData.data[n+1]=255,e.imageData.data[n+2]=255,e.imageData.data[n+3]=u)}n+=4}}1.4142<TracingUtils.faceScale()&&e.applyFilter(e,e.rect,this.getBlur(1,0))}};this.colorize=function(){if(null!=
this.stageChildVO.makeoverItem&&TracingUtils.isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS)&&!this.model.isTracingMode){var k=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),l=ColorUtils.ColorToHSB(k),k=l.brightness,m=parseInt(this.getMakeoverItemParam("brightnessLimit",70));k>m&&(k=m+(k-m)/2);k=ColorUtils.HSBtoColor(l.hue,l.saturation,k);m=l.hue;60<=m&&300>=m?m=Math.max(m-22,60):(60>m&&(m+=360),m=Math.min(m+22,420));var l=ColorUtils.HSBtoColor(m,l.saturation/2,100),m=k>>16&255,
n=k>>8&255,v=k&255,p=ColorUtils.colorToLuminance(k),k=ColorUtils.ColorToHSB(k).saturation,z=ColorUtils.RGBtoYUV(m,n,v),w=this.bounds[0].x,K=this.bounds[1].x,u=this.bounds[0].y,t=this.bounds[1].y,n=MathUtils.widthFromBounds(this.bounds),v=MathUtils.heightFromBounds(this.bounds);if(0<n&&0<v){var m=new BitmapData(n,v,!0,16777215),D=p/i.l.avg,A=2-D;"matte"===j?A/=2:"stain"===j&&(A=0);var B;(new Date).getTime();for(var F=a.imageData.data,C=c.imageData.data,G=m.imageData.data,N=i.l.avg,H=1.14*z.v,O=0.395*
z.u+0.581*z.v,L=2.032*z.u,M=0;M<G.length;M+=4)if(B=F[M+3],0<B){var P=0.299*C[M]+0.587*C[M+1]+0.114*C[M+2],P=P<=N?P*D:p+(P-N)*A,P=Math.min(Math.max(P,0),255);G[M]=Math.min(P+H,255);G[M+1]=Math.max(P-O,0);G[M+2]=Math.min(P+L,255);G[M+3]=B}if("shimmer"===j||"metallicshimmer"===j){B=parseFloat(this.getMakeoverItemParam("shimmerFactor",15));B=MathUtils.range(B,0,100);var Q=m.clone();this.applyBitmapFilter(Q,this.sharpenFilter(B/100));for(A=0;A<v;A++)for(D=0;D<n;D++)B=Q.getPixel(D,A),F=ColorUtils.colorToLuminance(B),
p<F&&ColorUtils.colorToLuminance(m.getPixel(D,A))<F&&m.setPixel(D,A,B);Q=new BitmapData(n,v,!0,16777215);p=parseInt(this.getMakeoverItemParam("shimmerCoverPercent",16));F=parseInt(this.getMakeoverItemParam("shimmerOpacity",40));Math.max(Math.round(TracingUtils.faceScale()),1);for(A=u;A<t;A++){G=A-u;for(D=w;D<K;D++)C=D-w,B=a.getPixel32(C,G)>>24&255,0<B&&100*Math.random()<p&&(N=ColorUtils.ColorToYUV(m.getPixel(C,G)),N=ColorUtils.YUVtoColor(MathUtils.range(128-64*(z.y/255)+N.y,0,255),z.u,z.v),H=2.55*
Math.random()*F,H=MathUtils.range(H,0,255),H=Math.round(H*(B/255)),Q.setPixel32(C,G,H<<24|N))}}z=parseInt(this.getMakeoverItemParam("shadowOpacity",0));if(0===z&&(z=Math.max(k-75,0),"metallic"===j||"metallicshimmer"===j))z+=25;0<z&&m.draw(d,null,new ColorTransform(1,1,1,z/100));k=null;z=0;"metallic"===j||"metallicshimmer"===j?(k=ColorUtils.colorToColorTransform(l),l=new BitmapData(n,v,!0,16777215),l.draw(e),m.draw(l,null,k),z=0):z="satin"===j?parseFloat(this.getMakeoverItemParam("highlightOpacitySatin",
100))/100:"matte"===j||"stain"===j?parseFloat(this.getMakeoverItemParam("highlightOpacityMatte",0))/100:"glossy"===j||"regular"===j?0:1;0<z&&(null==k&&(k=new ColorTransform(1,1,1,z)),m.draw(e,null,k));"stain"===j?m.colorTransform(m.rect,new ColorTransform(1,1,1,parseFloat(this.getMakeoverItemParam("glossColorOpacity",35))/100)):"shimmer"===j?(m.colorTransform(m.rect,new ColorTransform(1,1,1,parseFloat(this.getMakeoverItemParam("glossColorOpacity",80))/100)),m.draw(Q)):"glossy"===j||"regular"===j?
m.colorTransform(m.rect,new ColorTransform(1,1,1,parseFloat(this.getMakeoverItemParam("glossColorOpacity",15))/100)):"metallicshimmer"===j&&m.draw(Q);("glossy"==j||"regular"==j)&&m.draw(f);h.setBitmapData(m);h.setX(this.bounds[0].x);h.setY(this.bounds[0].y)}}else h.setBitmapData(null)};StageLipColor.prototype.flashOnHtml5_constructor.call(this)}StageLipLiner.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageLipLiner.prototype.constructor=StageLipLiner;
function StageLipLiner(){var a,c,d,e,f,h={},i={};this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);f=new Bitmap;this.holder.addChild(f);StageLipLiner.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&
(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.updateHolderPosition();var a=parseInt(this.getMakeoverItemParam("style",0)),c=parseFloat(this.getMakeoverItemParam("thickness",50))/
100,d,e,f;switch(a){case 0:d=10*c;e=10*c;f=0;break;case 1:d=10*c;e=200;f=0;break;case 2:d=10*c;e=75;f=1;break;case 3:d=10*c;e=75;f=2;break;default:d=parseInt(this.getMakeoverItemParam("outsideFade",10)),e=parseInt(this.getMakeoverItemParam("insideFade",50)),f=parseInt(this.getMakeoverItemParam("fadeStyle",1))}d=MathUtils.range(d,2,200);e=MathUtils.range(e,2,200);f=MathUtils.range(f,0,2);this.compare(h,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_LIPS],
this.model.modifiedLipsTrace,d,e,f,c)&&(0==a?this.createLinerMask(c):this.createFillMask(d,e,f),i={});this.compare(i,this.stageChildVO.makeoverItem.color,this.stageChildVO.makeoverItem.opacity,parseInt(this.getMakeoverItemParam("brightnessLimit",70)))&&(this.colorize(),this.changed=!0);a=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-a)>1/256&&(this.holder.alpha=a,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.drawFade=
function(a,c,d){var e,f,h=Math.abs(d-c);if(c<d)for(e=c;e<d;e++){var i=(e-c)/h;for(f=0;f<a.height;f++){var r=a.getPixel(e,f)&255,r=Math.round(r*i);a.setPixel(e,f,r<<16|r<<8|r)}}else for(e=c;e>d;e--){i=(c-e)/h;for(f=0;f<a.height;f++)r=a.getPixel(e,f)&255,r=Math.round(r*i),a.setPixel(e,f,r<<16|r<<8|r)}};this.getTopBotLiner=function(a,c){var d=TracingUtils.getTracedAreaVO(this.stageChildVO.tracedArea),e=TracingUtils.getPointsAlongTracedArea(d,a,!1,100,!0),f=TracingUtils.createThicknessArray(c,50),d=[],
h,i=a?0:1,r=a?1:0,q;for(h=0;50>h;h++)q=Math.max(h,1),q=MathUtils.lineRotation(e[q-1],e[h+1])-90,d.push(MathUtils.moveVector(e[h],f[h]*i,q));for(h=0;50>h;h++)q=Math.min(50+h,98),q=MathUtils.lineRotation(e[q-1],e[q+1])-90,d.push(MathUtils.moveVector(e[50+h],f[49-h]*i,q));for(h=49;0<=h;h--)q=Math.min(50+h,98),q=MathUtils.lineRotation(e[q-1],e[q+1])+90,d.push(MathUtils.moveVector(e[50+h],f[49-h]*r,q));for(h=49;0<=h;h--)q=Math.max(h,1),q=MathUtils.lineRotation(e[q-1],e[q+1])+90,d.push(MathUtils.moveVector(e[h],
f[h]*r,q));e=new Sprite;e.getGraphics().beginFill(16777215);e.getGraphics().moveTo(d[d.length-1].x,d[d.length-1].y);for(h=0;h<d.length;h++)e.getGraphics().lineTo(d[h].x,d[h].y);e.getGraphics().endFill();return e};this.createLinerMask=function(a){var c=TracingUtils.getTracedAreaVO(this.stageChildVO.tracedArea),d=TracingUtils.getCurvePointsTracedArea(c),d=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(d,c));this.bounds=MathUtils.getBoundingBox(d);this.bounds=MathUtils.extendBoundingBox(this.bounds,
0,5);this.bounds=MathUtils.confineBounds(this.bounds,new Point(0,0),new Point(this.model.photoWidth-1,this.model.photoHeight-1));c=MathUtils.widthFromBounds(this.bounds);d=MathUtils.heightFromBounds(this.bounds);e=new BitmapData(c,d,!0,0);c=2.85*(0.5+a)*TracingUtils.faceScale();d=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y);e.draw(this.getTopBotLiner(!0,[[0,0],[10,0.7*c],[80,c],[100,c]]),d);e.draw(this.getTopBotLiner(!1,[[0,0],[10,0.7*c],[80,c],[100,c]]),d);e.applyFilter(e,e.rect,this.getBlur(4*
a,0))};this.createFillMask=function(f,h,i){var m=TracingUtils.getTracedAreaVO(this.stageChildVO.tracedArea),n=TracingUtils.getCurvePointsTracedArea(m),n=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(n,m));this.bounds=MathUtils.getBoundingBox(n);this.bounds=MathUtils.extendBoundingBox(this.bounds,3,5);this.bounds=MathUtils.confineBounds(this.bounds,new Point(0,0),new Point(this.model.photoWidth-1,this.model.photoHeight-1));var o=MathUtils.widthFromBounds(this.bounds),n=MathUtils.heightFromBounds(this.bounds);
a=new BitmapData(o,n,!0,4278190080);c=new BitmapData(o,n,!0,4278190080);d=new BitmapData(o,n,!0,4278190080);var s=TracingUtils.pointsToBounds(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(m.points,m)),this.bounds),r=new Sprite;r.getGraphics().beginFill(16777215,1);MathUtils.curveThroughPoints(r.getGraphics(),s,m.pointsZ,m.pointsA);r.getGraphics().endFill();d.draw(r);r.getGraphics().clear();var q,v,p,z,f=n/100*f;q=Math.min(f,16);for(v=1;v<=q;v++)p=v*(256/q)-1,z=f/q*(q+1-v),r.getGraphics().lineStyle(z,
p<<16|p<<8|p,1),MathUtils.curveThroughPoints(r.getGraphics(),s,m.pointsZ,m.pointsA);a.draw(r);r.getGraphics().clear();f=n/100*h;q=Math.min(f,16);for(v=1;v<=q;v++)p=v*(256/q)-1,z=f/q*(q+1-v),r.getGraphics().lineStyle(z,p<<16|p<<8|p,1),MathUtils.curveThroughPoints(r.getGraphics(),s,m.pointsZ,m.pointsA);c.draw(r);s=2*o;r=0;f=2*n;for(v=h=m=0;v<n;v++)for(q=h;q<o;q++){p=c.getPixel(q,v);z=a.getPixel(q,v);if(0<p||0<z)s=Math.min(s,q),r=Math.max(r,q),f=Math.min(f,v),m=Math.max(m,v);a.setPixel(q,v,ColorUtils.mixColors(z,
p,d.getPixel(q,v)&255))}h=s;o=r;s=f;n=m;m=Math.round(h+(o-h)/2);switch(i){case 1:this.drawFade(a,h,m);this.drawFade(a,o,m);break;case 2:this.drawFade(a,m,h),this.drawFade(a,m,o)}i=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y);TracingUtils.drawTracedShape(a,TracedArea.TRACEDAREA_TEETH,0,1,null,i);a.applyFilter(a,a.rect,this.getBlur(2,0));e=new BitmapData(a.width,a.height,!0,16777215);for(v=s;v<n;v++)for(q=h;q<o;q++)i=a.getPixel(q,v)&255,e.setPixel32(q,v,i<<24|16777215)};this.colorize=function(){this.setSmoothBitmap(f,
e);var a=TracingUtils.globalColorAdjust(this.stageChildVO.makeoverItem.color),a=ColorUtils.ColorToHSB(a),c=a.brightness,d=parseInt(this.getMakeoverItemParam("brightnessLimit",70));c>d&&(c=d+(c-d)/2);a=ColorUtils.HSBtoColor(a.hue,a.saturation,c);f.transform.colorTransform=ColorUtils.colorToColorTransform(a);f.setX(this.bounds[0].x);f.setY(this.bounds[0].y)};StageLipLiner.prototype.flashOnHtml5_constructor.call(this)}StageLipTexture.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);
StageLipTexture.prototype.constructor=StageLipTexture;
function StageLipTexture(){var a={},c;this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);c=new Bitmap;this.holder.addChild(c);StageLipTexture.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);
TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.updateHolderPosition();for(var d=this.model.looks[this.model.currentLook].stageChildren,e=null,f=!1,h=0;h<d.length&&!f;){e=d[h];if(e.feature==Features.FEATURE_LIPSTICK||e.feature==Features.FEATURE_LIPGLOSS)e.visible&&(null!=e.makeoverItem&&4294967295!=e.makeoverItem.color)&&
(f=!0);h++}if(f){if(null!=this.model.lipTexture&&this.compare(a,this.model.lipTexture,this.model.lipTextureX,this.model.lipTextureY,this.model.lipTextureFlag)&&(this.setSmoothBitmap(c,this.model.lipTexture),c.setX(this.model.lipTextureX),c.setY(this.model.lipTextureY),this.changed=!0),!this.visible)this.setVisible(!0),this.changed=!0}else this.visible&&(this.setVisible(!1),this.changed=!0);return this.changed};StageLipTexture.prototype.flashOnHtml5_constructor.call(this)}StageMain.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);
StageMain.prototype.constructor=StageMain;
function StageMain(){function a(){var a=0.1,c=0.1;0<this.model.parentWidth&&0<this.model.photoWidth&&(a=this.model.parentWidth/this.model.photoWidth);0<this.model.parentHeight&&0<this.model.photoHeight&&(c=this.model.parentHeight/this.model.photoHeight);return Math.min(a,c)}function c(a){this.zoomByValue(1+a.delta/30,new Point(a.stageX,a.stageY))}function d(a){a.hasOwnProperty("scaleX")&&this.zoomByValue(a.scaleX,new Point(this.model.parentWidth/2,this.model.parentHeight/2))}function e(a){if(this.model.canDrag){a=
this.globalToLocal(new Point(a.stageX,a.stageY));a.x+=this.model.photoWidth/2;a.y+=this.model.photoHeight/2;for(var a=!1,c=this.model.looks[this.model.currentLook].stageChildren,d=0,e=c.length-1;0<=e&&!a;e--){var f=c[e].stageChild;null!=f&&(f.visible&&TracingUtils.isFeatureDraggable(f.stageChildVO.feature)&&"0"!=f.getMakeoverItemParam("draggable","1")&&this.model.dragModeFeature==f.stageChildVO.feature)&&(d++,this.model.dragFeature=f.stageChildVO.feature,this.model.dragInstanceIndex=f.stageChildVO.instanceIndex,
this.model.dragSide=Features.SIDE_BOTH,a=!0)}a?(m.startDrag(),this.model.isDraggingStage=!1):(a=null,a=parseInt(this.model.photoWidth*this.model.stageScaleX-this.model.parentWidth),c=parseInt(this.model.photoHeight*this.model.stageScaleY-this.model.parentHeight),a=new Rectangle(Math.round((this.model.parentWidth-a)/2),Math.round((this.model.parentHeight-c)/2),a,c),this.startDrag(!1,a),this.model.isDraggingStage=!0);r=!0}}function f(){if(r)if(r=!1,this.model.isDraggingStage)this.stagePositionUpdated();
else{var a=this.model.looks[this.model.currentLook].stageChildren[q],c=TracingUtils.pointToRelative(new Point(-this.model.photoWidth/2,-this.model.photoHeight/2),a.tracedArea),d=TracingUtils.pointToRelative(new Point(m.x,m.y),a.tracedArea);m.setX(0);m.setY(0);this.model.dragFeature=-1;this.model.dragInstanceIndex=-1;this.model.dragSide=-1;0!=d.x-c.x||0!=d.y-c.y?(a.x+=d.x-c.x,a.y+=d.y-c.y,this.dispatchChangeEvent(),dispatchEvent(new VmeResponseEvent(VmeResponseEvents.VME_RESPONSE_EVENT,VmeResponseEvents.VRE_LAYER_DRAGGED,
{feature:a.feature,instanceIndex:a.instanceIndex}))):this.renderCompleted()}}function h(a){!a.buttonDown&&r&&f(a);this.model&&this.model.canDrag&&a.buttonDown&&this.model.isDraggingStage&&i()}function i(){if(this.model.stageHorizontalCenter!=this.x||this.model.stageVerticalCenter!=this.y||this.model.stageScaleX!=this.scaleX||this.model.stageScaleY!=this.scaleY){this.model.stageHorizontalCenter=this.x;this.model.stageVerticalCenter=this.y;this.model.stageScaleX=this.scaleX;this.model.stageScaleY=this.scaleY;
for(var a=this.model.looks[this.model.currentLook].stageChildren,c=0;c<a.length;c++)if(null!=a[c].stageChild&&a[c].stageChild.visible)a[c].stageChild.onStageChange();null!=this.callback&&this.callback(this.x,this.y,this.scaleX,this.scaleY)}}this.callback=null;var j=!1,k={},l=null,m=this.capturedBitmap=null,n=null,o=null,s=null,r=!1,q=0;this.onInit=function(a){this.addEventListener(MouseEvent.MOUSE_DOWN,e,!1,0,!0);this.addEventListener(TouchEvent.TOUCH_START,e,!1,0,!0);this.addEventListener(MouseEvent.MOUSE_WHEEL,
c,!1,0,!0);this.addEventListener("gestureZoom",d,!1,0,!0);StageMain.prototype.onInit.call(this,a)};this.onAddedToStage=function(a){StageMain.prototype.onAddedToStage.call(this,a);this.capturedBitmap=new Bitmap;this.capturedBitmap.flashOnHtml5_setDomId("StageMain_capturedBitmap");this.addChild(this.capturedBitmap);n=new Sprite;n.flashOnHtml5_setDomId("StageMain_dragMask");this.addChild(n);m=new Sprite;m.flashOnHtml5_setDomId("StageMain_dragSprite");this.addChild(m);s=new Bitmap;s.flashOnHtml5_setDomId("StageMain_aboveBitmap");
this.addChild(s);this.onRenderCompleted();try{this.stage.addEventListener(MouseEvent.MOUSE_MOVE,h,!1,0,!0),this.stage.addEventListener(MouseEvent.MOUSE_UP,f,!1,0,!0)}catch(c){try{parent.parent.parent.parent.addEventListener(MouseEvent.MOUSE_MOVE,h,!1,0,!0,this),parent.parent.parent.parent.addEventListener(MouseEvent.MOUSE_UP,f,!1,0,!0,this),parent.parent.parent.parent.addEventListener(MouseEvent.MOUSE_OUT,f,!1,0,!0,this)}catch(d){try{parent.addEventListener(MouseEvent.MOUSE_MOVE,h,!1,0,!0,this),parent.addEventListener(MouseEvent.MOUSE_UP,
f,!1,0,!0,this),parent.addEventListener(MouseEvent.MOUSE_OUT,f,!1,0,!0,this)}catch(e){}}}this.setVisible(!0)};this.onChange=function(){this.changed=!1;this.model.onChange=!0;for(this.model.onChangeTrigger=!0;this.model.onChangeTrigger;){this.model.onChangeTrigger=!1;j!=this.model.hasPhoto&&(j=this.model.hasPhoto);var a=this.model.looks[this.model.currentLook].stageChildren;this.syncStageToLook(a);for(var c=0;c<a.length;c++)null!=a[c].stageChild&&(this.changed=a[c].stageChild.onChange()||this.changed)}if(this.changed)this.onRenderCompleted();
return this.model.onChange=!1};this.onRenderCompleted=function(){if(null!=this.capturedBitmap)if(0<this.model.photoWidth&&0<this.model.photoHeight){this.compare(k,this.model.photoWidth,this.model.photoHeight)&&(l=new BitmapData(this.model.photoWidth,this.model.photoHeight,!1,0),n.getGraphics().clear(),n.getGraphics().beginFill(0),n.getGraphics().drawRect(0,0,this.model.photoWidth,this.model.photoHeight),n.getGraphics().endFill());var a=this.model.looks[this.model.currentLook].stageChildren;q=-1;if(-1!=
this.model.dragFeature)for(q=a.length-1;0<=q&&!(a[q].feature==this.model.dragFeature&&a[q].instanceIndex==this.model.dragInstanceIndex);)q--; -1!=q&&(o=new BitmapData(this.model.photoWidth,this.model.photoHeight,!0,0),this.clear(m));for(var c=0;c<a.length;c++){var d=a[c].stageChild;null!=d&&(d.visible&&!TracingUtils.isFeatureTracing(d.stageChildVO.feature))&&(-1==q||c<q?d.stageChildVO.feature==Features.FEATURE_CYOH?l.draw(d,null,null,BlendMode.NORMAL,null,!0):l.draw(d,null,null,null,null,!0):c==q?
(d.setX(0),d.setY(0),m.addChild(d),m.setVisible(!0)):o.draw(d,null,null,null,null,!0))}this.model.isDebug&&null!=this.model.debugBitmapData&&(-1==q?l.draw(this.model.debugBitmapData):o.draw(this.model.debugBitmapData));!this.model.isTracingMode&&null!=this.model.postProcess&&("string"==typeof this.model.postProcess||this.model.postProcess instanceof String?PostProcess.run(this.model.postProcess,l):this.model.postProcess.call(this,l));null!=this.filters&&0<this.filters.length&&l.applyFilter(l,l.rect,
this.filters[0]);this.setSmoothBitmap(this.capturedBitmap,l);this.capturedBitmap.setX(-this.model.photoWidth/2);this.capturedBitmap.setY(-this.model.photoHeight/2);this.capturedBitmap.setVisible(!0);-1==q?(n.setVisible(!1),m.setVisible(!1),s.setVisible(!1)):(this.setSmoothBitmap(s,o),s.setX(-this.model.photoWidth/2),s.setY(-this.model.photoHeight/2),s.setVisible(!0))}else this.capturedBitmap.setVisible(!1),n.setVisible(!1),this.clear(m),m.setVisible(!1),s.setVisible(!1)};this.zoom=function(a){"undefined"==
typeof a&&(a=!0);try{if(0==this.model.parentWidth&&null!=this.stage&&(this.model.parentWidth=this.stage.stageWidth),0==this.model.parentHeight&&null!=this.stage)this.model.parentHeight=this.stage.stageHeight}catch(c){alert(c)}a=a?Math.min(this.model.parentWidth/this.model.photoWidth,this.model.parentHeight/this.model.photoHeight):Math.max(this.model.parentWidth/this.model.photoWidth,this.model.parentHeight/this.model.photoHeight);0<a&&this.updateStagePosition(this.model.parentWidth/2,this.model.parentHeight/
2,a,a)};this.snapToBoundaries=function(c,d,e,f){isNaN(e)&&(e=this.scaleX);isNaN(f)&&(f=this.scaleY);e=Math.max(e,a.call(this));f=Math.max(f,a.call(this));isNaN(c)&&(c=this.x);var h=this.model.photoWidth/2*e,i=this.model.parentWidth-h,j=c-h,k=c+h;if(0<=j&&j<this.model.parentWidth&&k>=this.model.parentWidth||0<=k&&k<this.model.parentWidth&&0>j||0>k||j>this.model.parentWidth)c=Math.abs(j-0)<Math.abs(k-this.model.parentWidth)?h:i;isNaN(d)&&(d=this.y);h=this.model.photoHeight/2*f;i=this.model.parentHeight-
h;j=d-h;k=d+h;if(0<=j&&j<this.model.parentHeight&&k>=this.model.parentHeight||0<=k&&k<this.model.parentHeight&&0>j||0>k||j>this.model.parentHeight)d=Math.abs(j-0)<Math.abs(k-this.model.parentHeight)?h:i;this.updateStagePosition(c,d,e,f)};this.onMouseWheel=c;this.onGestureZoom=d;this.zoomByValue=function(c,d){if(this.model.canZoom){var e=this.model.stageHorizontalCenter,f=this.model.stageVerticalCenter;isNaN(e)&&(e=0);isNaN(f)&&(f=0);var h=parent.globalToLocal(d),e=e-h.x,f=f-h.y,e=e/this.model.stageScaleX,
f=f/this.model.stageScaleY,i=MathUtils.range(this.scaleX*c,a().call(this),50),e=e*i+h.x,f=f*i+h.y;this.snapToBoundaries(e,f,i,i)}};this.onMouseDown=e;this.onMouseUp=f;this.onMouseMove=h;this.updateStagePosition=function(a,c,d,e){"undefined"==typeof a&&(a=NaN);"undefined"==typeof c&&(c=NaN);"undefined"==typeof d&&(d=NaN);"undefined"==typeof e&&(e=NaN);isNaN(a)||(this.model&&$(this.flashOnHtml5_documentElement).css({left:this.flashOnHtml5_documentElement.offsetLeft+a-this.x}),this.setX(a));isNaN(c)||
(this.model&&$(this.flashOnHtml5_documentElement).css({top:this.flashOnHtml5_documentElement.offsetTop+c-this.y}),this.setY(c));isNaN(d)||this.setScaleX(MathUtils.roundTo(d,4));isNaN(e)||this.setScaleY(MathUtils.roundTo(e,4));this.stagePositionUpdated()};this.stagePositionUpdated=i;this.createStageChild=function(a,c){var d=null;switch(a){case Features.FEATURE_ACRYLIC:d=new StageNails;break;case Features.FEATURE_BLUSH:d=new StageBlush;break;case Features.FEATURE_BLUSH_R:d=new StageBlush;break;case Features.FEATURE_CONCEALER:d=
new StageConcealer;break;case Features.FEATURE_CONCEALER_R:d=new StageConcealer;break;case Features.FEATURE_CONTACTS:d=new StageContacts;break;case Features.FEATURE_CONTACTS_R:d=new StageContacts;break;case Features.FEATURE_COVER:d=new StageCover;break;case Features.FEATURE_CYOH:d=new StageCYOH;break;case Features.FEATURE_EARRING:d=new StageAccessory;break;case Features.FEATURE_EARRING_R:d=new StageAccessory;break;case Features.FEATURE_EYE_BRIGHTEN:d=new StageEyeBrighten;break;case Features.FEATURE_EYE_BRIGHTEN_R:d=
new StageEyeBrighten;break;case Features.FEATURE_EYEBROW_PENCIL:d=new StageEyebrowPencil;break;case Features.FEATURE_EYEBROW_PENCIL_R:d=new StageEyebrowPencil;break;case Features.FEATURE_EYEBROW_THINNING:d=new StagePhotoShaping;break;case Features.FEATURE_EYEBROW_THINNING_R:d=new StagePhotoShaping;break;case Features.FEATURE_EYELINER:d=new StageEyeLiner;break;case Features.FEATURE_EYELINER_R:d=new StageEyeLiner;break;case Features.FEATURE_EYESHADOW:d=new StageEyeShadow;break;case Features.FEATURE_EYESHADOWC:d=
new StageEyeShadow;break;case Features.FEATURE_EYESHADOWL:d=new StageEyeShadow;break;case Features.FEATURE_EYESHADOW_R:d=new StageEyeShadow;break;case Features.FEATURE_FACE_MASK:d=new StageFaceMask;break;case Features.FEATURE_FACIAL_HAIR:d=new StageHair;break;case Features.FEATURE_FACE_POWDER:d=new StageFoundation;break;case Features.FEATURE_FOUNDATION:d=new StageFoundation;break;case Features.FEATURE_GLASSES:d=new StageAccessory;break;case Features.FEATURE_HAIR:d=new StageHair;break;case Features.FEATURE_HAIR_COLOR:d=
new StagePlaceholder;break;case Features.FEATURE_HAIRCLIPS:d=new StageAccessory;break;case Features.FEATURE_HEADWEAR:d=new StageAccessory;break;case Features.FEATURE_HIGHLIGHTS:d=new StagePlaceholder;break;case Features.FEATURE_HOT_LOOKS:d=new StageAccessory;break;case Features.FEATURE_LIPGLOSS:d=new StageLipColor;break;case Features.FEATURE_LIPLINER:d=new StageLipLiner;break;case Features.FEATURE_LIPSTICK:d=new StageLipColor;break;case Features.FEATURE_LIP_PLUMPING:d=new StagePhotoShaping;break;
case Features.FEATURE_LIP_TEXTURE:d=new StageLipTexture;break;case Features.FEATURE_LOWLIGHTS:d=new StagePlaceholder;break;case Features.FEATURE_MASCARA:d=new StageMascara;break;case Features.FEATURE_MASCARA_R:d=new StageMascara;break;case Features.FEATURE_NECKLACE:d=new StageAccessory;break;case Features.FEATURE_NOSE:d=new StagePlaceholder;break;case Features.FEATURE_PHOTO:d=new StageModelImage;break;case Features.FEATURE_POLISH:d=new StageNails;break;case Features.FEATURE_SCARF:d=new StageAccessory;
break;case Features.FEATURE_SUNGLASSES:d=new StageAccessory;break;case Features.FEATURE_TEETH_WHITENING:d=new StageTeethWhitening;break;case Features.FEATURE_TRACING:d=new StageTracing;break;case Features.FEATURE_TRACING_INITIAL:d=new StageTracingInitial;break;case Features.FEATURE_TRACING_DISTORT:d=new StageTracingDistort;break;case Features.FEATURE_TRACING_TARGET:d=new StageTracingTarget;break;case Features.FEATURE_TRACING_SPOT_APPLY:d=new StageSpotApply;break;case Features.FEATURE_VEILS:d=new StageAccessory}null!=
d&&d.setMyChildIndex(c);return d};this.syncStageToLook=function(a){for(var c=0;c<a.length;c++){var d=a[c];if(null==d.stageChild&&(d.stageChild=this.createStageChild(d.feature,c,0),TracingUtils.isFeatureTracing(d.feature))){for(var e=0;e<this.numChildren&&!(this.getChildAt(e)instanceof AbstractStageChild&&this.getChildAt(e).stageChildVO.weight>d.weight);e++);this.addChildAt(d.stageChild,e)}}};if(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)this.flashOnHtml5_constructor(),this.flashOnHtml5_setDomId("StageMain")}
StageMascara.prototype=new StageAccessory(flashOnHtml5_constructingPrototype);StageMascara.prototype.constructor=StageMascara;
function StageMascara(){var a={},c={},d,e,f,h,i,j,k,l,m,n;this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);this.holderStageChild=new Sprite;this.holder.addChild(this.holderStageChild);StageMascara.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible||null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&
(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.changed=this.updatePosition()||this.changed;this.holder.setScaleX(1);this.holder.setScaleY(1);""!=this.stageChildVO.makeoverItem.URL&&
null!=this.stageChildVO.makeoverItem.URL?this.currentURL!=this.stageChildVO.makeoverItem.URL?(this.currentURL=this.stageChildVO.makeoverItem.URL,this.clear(this.holder,1),this.clear(this.holderStageChild),this.removeLoader(this.loaderAsset),this.loaderAsset=new Loader,this.loadRequest(this.loaderAsset,this.currentURL),this.changed=!0):this.compare(a,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT],
this.stageChildVO.makeoverItem.color,parseInt(this.getMakeoverItemParam("style",0)),this.getMakeoverItemParam("finish","lengthening"),parseFloat(this.getMakeoverItemParam("mascaraLength",1)),parseFloat(this.getMakeoverItemParam("mascaraVariation",50)),parseFloat(this.getMakeoverItemParam("mascaraWidth",1)),parseFloat(this.getMakeoverItemParam("mascaraCurvature",1)),parseFloat(this.getMakeoverItemParam("mascaraCluster",1)),parseFloat(this.getMakeoverItemParam("mascaraSmudge",0.5)))&&(this.alignLashes(),
this.changed=!0):(this.currentURL="",this.compare(a,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT],this.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT],this.stageChildVO.makeoverItem.color,parseInt(this.getMakeoverItemParam("style",0)),this.getMakeoverItemParam("finish","lengthening"),parseFloat(this.getMakeoverItemParam("mascaraLength",1)),parseFloat(this.getMakeoverItemParam("mascaraVariation",50)),parseFloat(this.getMakeoverItemParam("mascaraWidth",
1)),parseFloat(this.getMakeoverItemParam("mascaraCurvature",1)),parseFloat(this.getMakeoverItemParam("mascaraCluster",1)),parseFloat(this.getMakeoverItemParam("mascaraSmudge",0.5)))&&(this.draw(),this.changed=!0));this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.onComplete=function(a){l=this.getLoadedBitmapData(a);this.alignLashes();this.setVisible(!0);this.renderCompleted();this.removeLoader(this.loaderAsset);this.loaderAsset=null};this.alignLashes=function(){this.clear(this.holderStageChild);
if(null!=l){var a=TracingUtils.getPointsAlongTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea],!0,this.stageChildVO.feature==Features.FEATURE_MASCARA,50,!1);trace("mid: "+a[25]);var a=-a[25].y/70,c=62/282;m=l.clone();var d;d=70*this.stageChildVO.scaleX*this.model.photoTrace[this.stageChildVO.tracedArea].scaleX;d=282/d;2<=d&&m.applyFilter(m,m.rect,this.getBlur(0,d));n=this.createSmoothBitmap(m);n.setScaleX(70/282);n.setScaleY(70/282*(a/c));n.setX(-n.width/2);n.setY(-n.height);this.holderStageChild.addChild(n)}};
this.randomizeVariation=function(a){d=[];e=[];for(var c=0;100>c;c++)d.push(Math.random()/(100/a)),e.push(Math.random()/(100/a))};this.draw=function(){this.clear(this.holder,1);this.clear(this.holderStageChild);if(null!=this.stageChildVO.makeoverItem){f=2*this.model.photoWidth;i=2*this.model.photoHeight;h=-f;j=-i;k=0;for(var a=this.stageChildVO.feature==Features.FEATURE_MASCARA,d=[],e=TracingUtils.getPointsAlongTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea],!0,a,50,!1),l=0;l<e.length;l++)e[l].x*=
this.model.photoTrace[this.stageChildVO.tracedArea].scaleX,e[l].y*=this.model.photoTrace[this.stageChildVO.tracedArea].scaleY;d.push(e);a=TracingUtils.getPointsAlongTracedArea(this.model.photoTrace[this.stageChildVO.tracedArea],!1,a,30,!1);for(e=0;e<a.length;e++)a[e]=MathUtils.moveVector(a[e],-2.85,this.model.photoTrace[this.stageChildVO.tracedArea].rotation-90),a[e].x*=this.model.photoTrace[this.stageChildVO.tracedArea].scaleX,a[e].y*=this.model.photoTrace[this.stageChildVO.tracedArea].scaleY;d.push(a);
e=this.getLashStyle();this.compare(c,e.variation)&&this.randomizeVariation(e.variation);l=parseInt(this.getMakeoverItemParam("style",0));a=new Sprite;2!=l&&this.drawLashes(a,"up",d[0],e);1!=l&&(e.length*=0.5,e.width*=0.5,e.curvature*=0.75,this.drawLashes(a,"down",d[1],e));d=1+TracingUtils.faceScale()/10+parseFloat(this.getMakeoverItemParam("mascaraSmudge",0.5))/10;a.filters=[this.getBlur(0,d)];f-=k;h+=k;i-=k;j+=k;d=h-f+1;e=j-i+1;0<d&&0<e&&(d=new BitmapData(d,e,!0,16777215),d.draw(a,new Matrix(1,0,
0,1,-f,-i)),d=this.createSmoothBitmap(d),this.holder.addChild(d),d.setX(f),d.setY(i));a.dispose()}};this.getLashStyle=function(){var a={};switch(this.getMakeoverItemParam("finish","lengthening")){case "volumizing":a.length=1.8;a.variation=30;a.width=1.6;a.curvature=1;a.cluster=0.75;break;case "curling":a.length=1.8;a.variation=30;a.width=1.6;a.curvature=2;a.cluster=0.75;break;case "all-in-one":a.length=2;a.variation=20;a.width=1.6;a.curvature=1.5;a.cluster=0.75;break;case "natural":a.length=1.8;a.variation=
40;a.width=1.6;a.curvature=1.2;a.cluster=0.75;break;default:a.length=2,a.variation=30,a.width=1.6,a.curvature=1,a.cluster=0.75}a.length=parseFloat(this.getMakeoverItemParam("mascaraLength",a.length));a.variation=parseFloat(this.getMakeoverItemParam("mascaraVariation",a.variation));a.width=parseFloat(this.getMakeoverItemParam("mascaraWidth",a.width));a.curvature=parseFloat(this.getMakeoverItemParam("mascaraCurvature",a.curvature));a.cluster=parseFloat(this.getMakeoverItemParam("mascaraCluster",a.cluster));
return a};this.drawLashes=function(a,c,f,h){if(null!=f&&0<f.length){var i=0;null!=this.stageChildVO.makeoverItem&&(i=this.stageChildVO.makeoverItem.color);var i=ColorUtils.mixColors(i,0,128),i=TracingUtils.globalColorAdjust(i),j=f.length-1,k=Point.distance(f[0],f[j]),l=k/100*h.width,m=k/7.5*h.length,k=3*(k/80)*h.curvature,h=j/10*h.cluster/2,n=1,t=-180/j*h,D;"up"==c?(D=2,f.splice(0,10),j-=10):(D=2,k*=-1,f.splice(0,9),j-=9);this.stageChildVO.feature==Features.FEATURE_MASCARA_R&&(k*=-1,t*=-1);for(var A=
0;A<=j;A++){var B="up"==c?d[A]:e[A],F=m-m*B,B=k-k*B;A<j/D&&(F*=A/(j/D),B*=A/(j/D));var C=0,C="up"==c?50*((j/3-A)/(j/3)):50*((j/2-A)/(j/2));10>Math.abs(C)&&(B*=Math.abs(C/10));0>C&&(B*=-1);"down"==c&&(C=180-C);this.stageChildVO.feature==Features.FEATURE_MASCARA_R&&(C*=-1);n<=h?n++:n=1;a.addChild(this.drawSingleLash(f[A].x,f[A].y,l,F,B,i,1,A,C+t*(n/2-n)))}}};this.drawSingleLash=function(a,c,d,e,l,m,n,w,K){w=new Sprite;w.getGraphics().beginFill(m,n);w.getGraphics().moveTo(-d/2,0);w.getGraphics().curveTo(l-
d/2,-e/2,0,-e);w.getGraphics().curveTo(l+d/2,-e/2,d/2,0);w.getGraphics().lineTo(-d/2,0);w.getGraphics().endFill();w.setX(a);w.setY(c);w.setRotation(K);f=parseInt(Math.min(f,a));h=parseInt(Math.max(h,a));i=parseInt(Math.min(i,c));j=parseInt(Math.max(j,c));k=parseInt(Math.max(k,e));return w};StageMascara.prototype.flashOnHtml5_constructor.call(this)}StageModelImage.prototype=new StageAccessory(flashOnHtml5_constructingPrototype);StageModelImage.prototype.constructor=StageModelImage;
function StageModelImage(){this.onInit=function(a){StageModelImage.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||null==this.stageChildVO||null==this.stageChildVO.makeoverItem)return!1;1==parseInt(this.getMakeoverItemParam("bitmapReceived",0))&&(this.currentURL=this.model.photoOrigId,this.setMakeoverItemParam("bitmapReceived",0),this.bitmapReceived());this.currentURL!=this.stageChildVO.makeoverItem.URL?(this.currentURL=this.stageChildVO.makeoverItem.URL,
this.setVisible(!1),this.model.hasPhoto=!1,this.model.photoWidth=0,this.model.photoHeight=0,this.model.photoOrigId="",this.model.photoBitmapDataOrig=null,this.model.photoId="",this.model.photoBitmapData=null,this.model.modifiedFoundation=null,this.model.looks[this.model.currentLook].imageAdjust=new ImageAdjustVO,null!=this.currentURL&&""!=this.currentURL&&(this.removeLoader(this.loaderAsset),this.loaderAsset=new Loader,this.loadRequest(this.loaderAsset,this.currentURL)),this.changed=!0):this.model.hasPhoto&&
!this.visible&&(this.setVisible(!0),this.changed=!0);return this.changed};this.onComplete=function(a){this.model.photoBitmapDataOrig=this.getLoadedBitmapData(a);null!=this.model.photoBitmapDataOrig&&(this.model.photoOrigId=this.currentURL,this.bitmapReceived());this.removeLoader(this.loaderAsset);this.loaderAsset=null};this.bitmapReceived=function(){if(null!=this.model.photoBitmapDataOrig){var a=this.getMakeoverItemParam("scale",1);if(1!=a){var c=new BitmapData(this.model.photoBitmapDataOrig.width*
a,this.model.photoBitmapDataOrig.height*a,!1,16777215),d=new Matrix;d.scale(a,a);c.draw(this.model.photoBitmapDataOrig,d,null,null,null,!0);this.model.photoBitmapDataOrig=c;this.model.photoTrace=DataUtils.StringToPhotoTrace(DataUtils.modifyPhotoTrace(DataUtils.PhotoTraceToString(this.model.photoTrace),"scale",a,a))}this.model.photoBitmapData=this.model.photoBitmapDataOrig.clone();this.model.photoId=this.model.photoOrigId;this.model.photoWidth=this.model.photoBitmapData.width;this.model.photoHeight=
this.model.photoBitmapData.height;this.model.hasPhoto=!0;this.clear(this);this.addChild(this.createSmoothBitmap(this.model.photoBitmapData));this.model.stageMain.zoom("all"==this.getMakeoverItemParam("zoom","all"));this.setVisible(!1);this.dispatchChangeEvent();this.model.stageMain.dispatchEvent(new VmeResponseEvent(VmeResponseEvents.VME_RESPONSE_EVENT,VmeResponseEvents.VRE_MODEL_LOADED))}};if(!arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)this.flashOnHtml5_constructor(),this.flashOnHtml5_setDomId("StageModelImage")}
StagePlaceholder.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StagePlaceholder.prototype.constructor=StagePlaceholder;function StagePlaceholder(){this.onInit=function(a){StagePlaceholder.prototype.onInit.call(this,a)};StagePlaceholder.prototype.flashOnHtml5_constructor.call(this)}StageTeethWhitening.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageTeethWhitening.prototype.constructor=StageTeethWhitening;
function StageTeethWhitening(){var a={},c={};this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);this.teeth=new Bitmap;this.holder.addChild(this.teeth);StageTeethWhitening.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||this.model.isTracingMode||this.model.isSpotApplyMode||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=
TracingUtils.tracedAreaForFeature(this.stageChildVO.feature);if(null==this.stageChildVO.makeoverItem||4294967295==this.stageChildVO.makeoverItem.color)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);if(TracingUtils.getTracedStatus(this.stageChildVO.tracedArea)==TracedArea.STATUS_NOT_PRESENT)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.updateHolderPosition();this.compare(a,this.model.photoWidth,
this.model.photoHeight,this.model.photoId,this.model.photoTrace[this.stageChildVO.tracedArea])&&(this.createMask(),c={});this.compare(c,this.stageChildVO.makeoverItem.color,parseFloat(this.getMakeoverItemParam("whiteningAmount",1.2)))&&(this.colorize(),this.changed=!0);var d=TracingUtils.globalOpacityAdjust(this.getOpacity());Math.abs(this.holder.alpha-d)>1/256&&(this.holder.alpha=d,this.changed=!0);this.visible||(this.setVisible(!0),this.changed=!0);return this.changed};this.createMask=function(){var a=
TracingUtils.getTracedAreaVO(this.stageChildVO.tracedArea),c=TracingUtils.getCurvePointsTracedArea(a),c=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(c,a));this.bounds=MathUtils.getBoundingBox(c);this.bounds=MathUtils.extendBoundingBox(this.bounds,3,5);this.bounds[0].x=Math.floor(this.bounds[0].x);this.bounds[0].y=Math.floor(this.bounds[0].y);this.bounds[1].x=Math.floor(this.bounds[1].x)+1;this.bounds[1].y=Math.floor(this.bounds[1].y)+1;this.bounds=MathUtils.confineBounds(this.bounds,
new Point(0,0),new Point(this.model.photoWidth-1,this.model.photoHeight-1));a=MathUtils.widthFromBounds(this.bounds);c=MathUtils.heightFromBounds(this.bounds);0<a&&0<c&&(this.teethMask=new BitmapData(a,c,!0,0),a=new Matrix(1,0,0,1,-this.bounds[0].x,-this.bounds[0].y),TracingUtils.drawTracedShape(this.teethMask,TracedArea.TRACEDAREA_TEETH,16777215,1,null,a),this.applyBitmapFilter(this.teethMask,this.getBlur(0,2)))};this.colorize=function(){var a=MathUtils.widthFromBounds(this.bounds),c=MathUtils.heightFromBounds(this.bounds);
if(0<a&&0<c){var f=new BitmapData(a,c,!0,16777215),h=100*(parseFloat(this.getMakeoverItemParam("whiteningAmount",1.2))-1),h=HairColoring.levels3(0,0,64-h/2,64+h,192-h,192+h/2),i,j;for(j=0;j<c;j++)for(i=0;i<a;i++){var k=this.teethMask.getPixel32(i,j)>>24&255;if(0<k){var l=this.model.photoBitmapData.getPixel(i+this.bounds[0].x,j+this.bounds[0].y),l=k<<24|h[l>>16&255]<<16|h[l>>8&255]<<8|h[l&255];f.setPixel32(i,j,l)}}this.setSmoothBitmap(this.teeth,f);this.teeth.setX(this.bounds[0].x);this.teeth.setY(this.bounds[0].y)}};
StageTeethWhitening.prototype.flashOnHtml5_constructor.call(this)}StageTracing.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageTracing.prototype.constructor=StageTracing;StageTracing.traceHandleOffset=2;
function StageTracing(){function a(a,c){"undefined"==typeof a&&(a=null);"undefined"==typeof c&&(c=-1);var d=new TraceHandle("btn");d.flashOnHtml5_setDomId("StageTracing_TraceHandle_btn_"+(0<=c?c.toString():getTimer().toString()));d.addEventListener(MouseEvent.MOUSE_DOWN,e,!1,0,!0,this);d.addEventListener(TouchEvent.TOUCH_START,e,!1,0,!0,this);d.addEventListener(MouseEvent.MOUSE_MOVE,f,!1,0,!0,this);d.addEventListener(TouchEvent.TOUCH_MOVE,f,!1,0,!0,this);d.doubleClickEnabled=!0;d.pointA=0.5;d.pointZ=
0.5;0<=c?this.holder.addChildAt(d,c):this.holder.addChild(d);null!=a&&(d.setX(a.x),d.setY(a.y));return d}function c(a){var c=!1;null!=a&&3<this.holder.numChildren-StageTracing.traceHandleOffset&&(!a.isindexLeft&&!a.isindexRight)&&(c=!0);return c}function d(d){d.stopPropagation();var e;if(d.target instanceof TraceHandle){if(c(d.target)&&this.holder.removeChild(d.target),d.ctrlKey)for(e=this.holder.numChildren-1;0<=e;e--)c(this.holder.getChildAt(e))&&this.holder.removeChild(this.holder.getChildAt(e))}else{var d=
this.holder.globalToLocal(new Point(d.stageX,d.stageY)),f=this.model.photoTrace[this.stageChildVO.tracedArea].points.concat(this.model.photoTrace[this.stageChildVO.tracedArea].points[0]);e=this.model.photoTrace[this.stageChildVO.tracedArea].pointsZ.concat(this.model.photoTrace[this.stageChildVO.tracedArea].pointsZ[0]);var h=this.model.photoTrace[this.stageChildVO.tracedArea].pointsA.concat(this.model.photoTrace[this.stageChildVO.tracedArea].pointsA[0]),h=MathUtils.calcControlPoints(f,e,h),i=Number.MAX_VALUE,
j=-1;for(e=0;e<f.length-1;e++)for(var k=f[e],l=h[e][1],m=h[e+1][0],n=f[e+1],o=k.x,k=k.y,p=l.x-o,l=l.y-k,q=m.x-o,m=m.y-k,r=n.x-o,n=n.y-k,s=d.x,u=d.y,t=0;1>t;t+=0.1){var v=s-((t*t*r+3*(1-t)*(t*q+(1-t)*p))*t+o),w=u-((t*t*n+3*(1-t)*(t*m+(1-t)*l))*t+k),v=Math.sqrt(v*v+w*w);i>v&&(i=v,j=e)}a(d,j+StageTracing.traceHandleOffset+1)}this.updateModel();this.model.showTracedArea&&this.draw()}function e(a){a.stopPropagation();if(a.currentTarget instanceof TraceHandle)a.currentTarget.startDrag(),q=!0,this.currentTraceHandle=
a.currentTarget;else if(0==parseInt(this.getMakeoverItemParam("admin",0))&&(this.stageChildVO.tracedArea>TracedArea.TRACEDAREA_LAST_INDEX||1<this.holder.numChildren-StageTracing.traceHandleOffset))this.holder.startDrag(),q=!0}function f(a){q&&(a.buttonDown||h.call(this,a),this.model.showTracedArea&&this.draw())}function h(a){a.stopPropagation();if(q){a.currentTarget.stopDrag();q=!1;var c=TracingUtils.spriteToTracedAreaVO(this.holder),a=[],d;for(d=StageTracing.traceHandleOffset;d<this.holder.numChildren;d++)1==
parseInt(this.getMakeoverItemParam("admin",0))?a.push(TracingUtils.handleToPoint(this.holder.getChildAt(d))):a.push(TracingUtils.pointToAbsolute(TracingUtils.handleToPoint(this.holder.getChildAt(d)),c));w=this.holder.x-this.stageChildVO.x;K=this.holder.y-this.stageChildVO.y;u=this.stageChildVO.rotation-this.holder.rotation;t=this.stageChildVO.scaleX-this.holder.scaleX;D=this.stageChildVO.scaleY-this.holder.scaleY;if(1<a.length){var e=a[s],f=a[r];null!=e&&null!=f&&(c=MathUtils.pointBetween(e,f,50),
d=MathUtils.lineRotation(e,f),MathUtils.roundTo(d,4)==MathUtils.roundTo(this.holder.rotation,4)&&(d=this.holder.rotation),e=Point.distance(e,f),e=0==e||isNaN(e)?1:e/TracingUtils.absoluteLength(this.stageChildVO.tracedArea),MathUtils.roundTo(e,4)==MathUtils.roundTo(this.holder.scaleX,4)&&(e=this.holder.scaleX),1==parseInt(this.getMakeoverItemParam("admin",0))&&(this.holder.setX(c.x),this.holder.setY(c.y),this.holder.rotation=d,this.holder.setScaleX(e),this.holder.setScaleY(e),this.stageChildVO.x=c.x,
this.stageChildVO.y=c.y,this.stageChildVO.rotation=d,this.stageChildVO.scaleX=e,this.stageChildVO.scaleY=e),this.onStageChange())}c=TracingUtils.spriteToTracedAreaVO(this.holder);if(1==parseInt(this.getMakeoverItemParam("admin",0)))for(d=StageTracing.traceHandleOffset;d<this.holder.numChildren;d++)e=TracingUtils.pointToRelative(a[d-StageTracing.traceHandleOffset],c),this.holder.getChildAt(d).setX(e.x),this.holder.getChildAt(d).setY(e.y);this.updateModel();this.model.showTracedArea&&this.draw()}}var i,
j,k,l,m,n,o,s,r,q=!1;this.currentTraceHandle=null;var v={},p={},z={},w,K,u,t,D,A;this.onInit=function(a){this.addEventListener(MouseEvent.MOUSE_UP,h,!1,0,!0);this.addEventListener(TouchEvent.TOUCH_END,h,!1,0,!0);this.addEventListener(MouseEvent.DOUBLE_CLICK,d,!1,0,!0);this.holder=new Sprite;this.holder.flashOnHtml5_setDomId("StageTracing_holder");n=new Sprite;n.flashOnHtml5_setDomId("StageTracing_outline");n.addEventListener(MouseEvent.MOUSE_DOWN,e,!1,0,!0,this);n.addEventListener(TouchEvent.TOUCH_START,
e,!1,0,!0,this);n.addEventListener(MouseEvent.MOUSE_MOVE,f,!1,0,!0,this);n.addEventListener(TouchEvent.TOUCH_MOVE,f,!1,0,!0,this);n.doubleClickEnabled=!0;this.holder.addChild(n);o=new Sprite;o.flashOnHtml5_setDomId("StageTracing_outlineMask");this.holder.addChild(o);this.holder.blendMode=BlendMode.LAYER;o.blendMode=BlendMode.ERASE;this.holder.cacheAsBitmap=!0;this.addChild(this.holder);StageTracing.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||
null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;var a=this.stageChildVO.tracedArea=parseInt(this.getMakeoverItemParam("tracedArea",TracedArea.TRACEDAREA_LIPS));TracingUtils.guessTracedArea(a);var c=this.model.photoTrace[a],d=null;a<=TracedArea.TRACEDAREA_LAST_INDEX&&(d=c);this.compare(v,a,d,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.stageChildVO.visible)&&this.getFromModel();w=this.holder.x-this.stageChildVO.x;
K=this.holder.y-this.stageChildVO.y;u=parseFloat(this.stageChildVO.rotation)-this.holder.rotation;t=parseFloat(this.stageChildVO.scaleX)-this.holder.scaleX;D=parseFloat(this.stageChildVO.scaleY)-this.holder.scaleY;this.updateHolderPosition();i=parseInt(this.getMakeoverItemParam("traceColor",65535));j=parseInt(this.getMakeoverItemParam("handleColor",16711935));l=parseInt(this.getMakeoverItemParam("handleSize",4));m=parseInt(this.getMakeoverItemParam("handleOverSize",8));k=this.model.traceStyleFillOpacity;
n.alpha=1;A=null;a==TracedArea.TRACEDAREA_TEETH&&(d=TracingUtils.findStageChildren(Features.FEATURE_TRACING,-1,Features.SIDE_BOTH,!1,"tracedArea",TracedArea.TRACEDAREA_LIPS),null!=d&&0<d.length&&(A=d[0],null!=A&&(null!=A.stageChild&&A.visible&&A.stageChild.visible?k=0:A=null)));if(1<=a&&a<=TracedArea.TRACEDAREA_LAST_INDEX&&null!=c.points&&this.compare(p,c)&&null!=this.holder){for(var e=0;e<c.points.length;e++)d=e+StageTracing.traceHandleOffset<this.holder.numChildren?this.holder.getChildAt(e+StageTracing.traceHandleOffset):
this.addTraceHandle(),d.setX(c.points[e].x),d.setY(c.points[e].y),d.pointZ=c.pointsZ[e],d.pointA=c.pointsA[e],d.isindexLeft=c.indexLeft==e,d.isindexRight=c.indexRight==e;for(;this.holder.numChildren>c.points.length+StageTracing.traceHandleOffset;)this.holder.removeChildAt(this.holder.numChildren-1);s=c.indexLeft;r=c.indexRight}this.model.showTracedArea&&this.draw();this.visible||(this.setVisible(!0),this.changed=!0);this.onStageChange();this.compare(z,this.stageChildVO.x,this.stageChildVO.y,this.stageChildVO.rotation,
this.stageChildVO.scaleX,this.stageChildVO.scaleY)?this.updateModel():this.changed&&a==TracedArea.TRACEDAREA_LIPS&&this.dispatchChangeEvent();return!0};this.addTraceHandle=a;this.eraseFromMask=function(a,c,d){"undefined"==typeof c&&(c=null);"undefined"==typeof d&&(d=null);TracingUtils.isTracedOrGuessed(a)&&(null==c?c=this.model.photoTrace[a].points:this.clear(o),c=null==d?TracingUtils.pointsToAbsolute(c,a):TracingUtils.pointsToAbsolute(c,d),c=TracingUtils.pointsToRelative(c,this.stageChildVO.tracedArea),
o.getGraphics().beginFill(16711680,1),MathUtils.curveThroughPoints(o.getGraphics(),c,this.model.photoTrace[a].pointsZ,this.model.photoTrace[a].pointsA),o.getGraphics().endFill())};this.drawPoints=function(a,c,d){0<this.model.traceStyleOutlineOpacity?(n.getGraphics().lineStyle(1/(this.model.stageScaleX*this.holder.scaleX),i,this.model.traceStyleOutlineOpacity),0<this.model.traceStyleFillOpacity?(n.getGraphics().beginFill(i,k),MathUtils.curveThroughPoints(n.getGraphics(),a,c,d),n.getGraphics().endFill()):
MathUtils.curveThroughPoints(n.getGraphics(),a,c,d)):0<this.model.traceStyleFillOpacity&&(n.getGraphics().lineStyle(),n.getGraphics().beginFill(i,k),MathUtils.curveThroughPoints(n.getGraphics(),a,c,d),n.getGraphics().endFill())};this.drawPointsDefault=function(){var a,c,d=[],e=[],f=[];for(a=StageTracing.traceHandleOffset;a<this.holder.numChildren;a++)c=this.holder.getChildAt(a),d.push(TracingUtils.handleToPoint(c)),e.push(c.pointZ),f.push(c.pointA);this.drawPoints(d,e,f)};this.drawTracedArea=function(a){if(null!=
this.model.photoTrace[a]){var c=TracingUtils.pointsToAbsolute(this.model.photoTrace[a].points,a),d=DataUtils.convertToTracedAreaVO(new Point(this.stageChildVO.x,this.stageChildVO.y),this.stageChildVO.rotation,this.stageChildVO.scaleX,this.stageChildVO.scaleY),c=TracingUtils.pointsToRelative(c,d);this.drawPoints(c,this.model.photoTrace[a].pointsZ,this.model.photoTrace[a].pointsA)}};this.drawTracedAreas=function(a){for(var c=0;c<a.length;c++)this.drawTracedArea(a[c])};this.draw=function(){if(null!=
n&&null!=o){this.clear(n);var a,c,d=[];c=[];a=[];switch(this.stageChildVO.tracedArea){case TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED:case TracedArea.TRACEDAREA_EYELINER_RIGHT_WINGED:a=TracingUtils.getWingedEyeShape(3*TracingUtils.faceScale(),this.stageChildVO.tracedArea==TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED);d=TracingUtils.pointsToRelative(TracingUtils.pointsFromBitmapScale(a[0]),this.stageChildVO.tracedArea);c=a[1];a=a[2];this.drawPoints(d,c,a);break;case TracedArea.TRACEDAREA_EYELINER_LEFT_CATEYE:case TracedArea.TRACEDAREA_EYELINER_RIGHT_CATEYE:a=
TracingUtils.getCatEyeShape(3*TracingUtils.faceScale(),this.stageChildVO.tracedArea==TracedArea.TRACEDAREA_EYELINER_LEFT_CATEYE);d=TracingUtils.pointsToRelative(TracingUtils.pointsFromBitmapScale(a[0]),this.stageChildVO.tracedArea);c=a[1];a=a[2];this.drawPoints(d,c,a);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_ALL:case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_ALL:case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_ALL:this.drawTracedAreas(this.getTracedAreas());
break;case TracedArea.TRACEDAREA_CYOH:c=!1;a=TracingUtils.findStageChildren(Features.FEATURE_CYOH,-1,Features.SIDE_BOTH,!1);null!=a&&0<a.length&&1==a[0].stageChild.getMakeoverItemParam("cyohMaskMethod",0)&&(c=!0);if(c){for(c=StageTracing.traceHandleOffset;c<this.holder.numChildren;c++)d.push(TracingUtils.handleToPoint(this.holder.getChildAt(c)));c=new Point(d[s].x,d[s].y);var d=new Point(d[r].x,d[r].y),e;c=TracingUtils.pointToAbsolute(c,this.stageChildVO.tracedArea);d=TracingUtils.pointToAbsolute(d,
this.stageChildVO.tracedArea);a=new Point(c.x,d.y);e=new Point(d.x,c.y);c=TracingUtils.pointToRelative(c,this.stageChildVO.tracedArea);a=TracingUtils.pointToRelative(a,this.stageChildVO.tracedArea);e=TracingUtils.pointToRelative(e,this.stageChildVO.tracedArea);d=TracingUtils.pointToRelative(d,this.stageChildVO.tracedArea);n.getGraphics().lineStyle();n.getGraphics().beginFill(i,this.model.traceStyleFillOpacity);n.getGraphics().moveTo(c.x,c.y);n.getGraphics().lineTo(a.x,a.y);n.getGraphics().lineTo(d.x,
d.y);n.getGraphics().lineTo(e.x,e.y);n.getGraphics().lineTo(c.x,c.y);n.getGraphics().endFill();n.getGraphics().lineStyle(1/(this.model.stageScaleX*this.holder.scaleX),i,this.model.traceStyleOutlineOpacity);n.getGraphics().moveTo(c.x,c.y);n.getGraphics().lineTo(a.x,a.y);n.getGraphics().lineTo(d.x,d.y);n.getGraphics().lineTo(e.x,e.y);n.getGraphics().lineTo(c.x,c.y)}else this.drawPointsDefault();break;default:this.drawPointsDefault()}this.clear(o);switch(this.stageChildVO.tracedArea){case TracedArea.TRACEDAREA_TZONE:this.eraseFromMask(TracedArea.TRACEDAREA_NOSE);
this.eraseFromMask(TracedArea.TRACEDAREA_LIPS);this.eraseFromMask(TracedArea.TRACEDAREA_EYE_LEFT);this.eraseFromMask(TracedArea.TRACEDAREA_EYE_RIGHT);this.eraseFromMask(TracedArea.TRACEDAREA_EYEBROW_LEFT);this.eraseFromMask(TracedArea.TRACEDAREA_EYEBROW_RIGHT);break;case TracedArea.TRACEDAREA_LIPS:this.eraseFromMask(TracedArea.TRACEDAREA_TEETH)}if(this.stageChildVO.tracedArea==TracedArea.TRACEDAREA_TEETH&&null!=A){c=new TracedAreaVO;c.location=new Point(this.holder.x,this.holder.y);c.rotation=this.holder.rotation;
c.scaleX=this.holder.scaleX;c.scaleY=this.holder.scaleY;d=[];for(a=StageTracing.traceHandleOffset;a<this.holder.numChildren;a++)d.push(TracingUtils.handleToPoint(this.holder.getChildAt(a)));A.stageChild.eraseFromMask(this.stageChildVO.tracedArea,d,c)}}};this.refreshModel=function(){var a,c,d;for(a=StageTracing.traceHandleOffset;a<this.holder.numChildren;a++)c=this.holder.getChildAt(a),d=TracingUtils.handleToPoint(c),c.x=d.x*this.holder.flashOnHtml5_displayMatrix.a,c.y=d.y*this.holder.flashOnHtml5_displayMatrix.d;
this.updateModel();for(a=StageTracing.traceHandleOffset;a<this.holder.numChildren;a++)c=this.holder.getChildAt(a),d=TracingUtils.handleToPoint(c),c.x=d.x/this.holder.flashOnHtml5_displayMatrix.a,c.y=d.y/this.holder.flashOnHtml5_displayMatrix.d};this.onStageChange=function(){if(null!=this.holder){var a,c;for(a=StageTracing.traceHandleOffset;a<this.holder.numChildren;a++)c=this.holder.getChildAt(a),0<this.model.traceStyleHandleOpacity?(c.setScaleX(1/(this.model.stageScaleX*this.holder.scaleX)),c.setScaleY(1/
(this.model.stageScaleY*this.holder.scaleY)),c.color=j,c.overColor=j,c.selectableColor=j,c.onMouseOut(),c.visible=!0,c.alpha=this.model.traceStyleHandleOpacity,c.handleSize=l,c.handleOverSize=m):c.visible=!1}};this.updateModel=function(){if(null!=this.stageChildVO&&null!=this.holder){switch(this.stageChildVO.tracedArea){case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_ALL:case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_ALL:case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_ALL:for(var a=
this.getTracedAreas(),c=0;c<a.length;c++)this.model.photoTrace[a[c]].location.x+=w,this.model.photoTrace[a[c]].location.y+=K,this.model.photoTrace[a[c]].status=TracedArea.STATUS_TRACED,this.model.photoTrace[a[c]].rotation+=u,this.model.photoTrace[a[c]].location=MathUtils.rotateAroundPoint(new Point(this.holder.x,this.holder.y),this.model.photoTrace[a[c]].location,u),this.model.photoTrace[a[c]].scaleX+=t,this.model.photoTrace[a[c]].scaleY+=D;this.stageChildVO.x=this.holder.x;this.stageChildVO.y=this.holder.y;
break;default:var a=[],c=[],d=[],e,f,h;for(e=StageTracing.traceHandleOffset;e<this.holder.numChildren;e++)f=this.holder.getChildAt(e),h=TracingUtils.handleToPoint(f),1===parseInt(this.getMakeoverItemParam("admin",0))&&(h.x=Math.round(h.x),h.y=Math.round(h.y)),a.push(h),c.push(f.pointZ),d.push(f.pointA),f.isindexLeft&&(s=e-StageTracing.traceHandleOffset),f.isindexRight&&(r=e-StageTracing.traceHandleOffset);this.model.photoTrace[this.stageChildVO.tracedArea].status=TracedArea.STATUS_TRACED;this.model.photoTrace[this.stageChildVO.tracedArea].location=
new Point(this.holder.x,this.holder.y);this.model.photoTrace[this.stageChildVO.tracedArea].rotation=!isNaN(this.holder.rotation)?this.holder.rotation:0;this.model.photoTrace[this.stageChildVO.tracedArea].scaleX=this.holder.scaleX;this.model.photoTrace[this.stageChildVO.tracedArea].scaleY=this.holder.scaleY;this.model.photoTrace[this.stageChildVO.tracedArea].points=a;this.model.photoTrace[this.stageChildVO.tracedArea].pointsZ=c;this.model.photoTrace[this.stageChildVO.tracedArea].pointsA=d;this.model.photoTrace[this.stageChildVO.tracedArea].indexLeft=
s;this.model.photoTrace[this.stageChildVO.tracedArea].indexRight=r}this.compare(z,this.stageChildVO.x,this.stageChildVO.y,this.stageChildVO.rotation,this.stageChildVO.scaleX,this.stageChildVO.scaleY);this.dispatchChangeEvent()}};this.combineTracedAreas=function(a){var c=new TracedAreaVO;if(null!=a&&0<a.length){var d=0;c.location=new Point(0,0);c.rotation=0;c.scaleX=1;c.scaleY=1;for(var e=0;e<a.length;e++){var f=a[e];if(0<f&&(f<this.model.photoTrace.length&&null!=this.model.photoTrace[f])&&(f=TracingUtils.pointsToAbsolute(this.model.photoTrace[f].points,
f),null!=f))for(var h=0;h<f.length;h++)d++,c.location.x+=f[h].x,c.location.y+=f[h].y}c.location.x/=d;c.location.y/=d}return c};this.getTracedAreas=function(){var a=null;switch(this.stageChildVO.tracedArea){case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_ALL:a=[TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_LID,TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_CONTOUR,TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_HIGHLIGHT];break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_ALL:a=[TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_LID,
TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_CONTOUR,TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_HIGHLIGHT];break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_ALL:a=[TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_LID,TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_CONTOUR,TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_HIGHLIGHT];break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_ALL:a=[TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_LID,TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_CONTOUR,TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_HIGHLIGHT];
break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_ALL:a=[TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_LID,TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_HIGHLIGHT];break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_ALL:a=[TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_LID,TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_HIGHLIGHT]}return a};this.getFromModel=function(){if(null!=this.stageChildVO){var a;switch(this.stageChildVO.tracedArea){case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_ALL:case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_ALL:case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_ALL:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_ALL:a=
this.combineTracedAreas(this.getTracedAreas());break;default:a=this.model.photoTrace[this.stageChildVO.tracedArea]}null!=a&&(null!=a.location&&(this.stageChildVO.x=a.location.x,this.stageChildVO.y=a.location.y),isNaN(a.rotation)||(this.stageChildVO.rotation=a.rotation),this.stageChildVO.scaleX=a.scaleX,this.stageChildVO.scaleY=a.scaleY);this.compare(z,this.stageChildVO.x,this.stageChildVO.y,this.stageChildVO.rotation,this.stageChildVO.scaleX,this.stageChildVO.scaleY)}};if(!arguments.length||arguments[0]!=
flashOnHtml5_constructingPrototype)this.flashOnHtml5_constructor(),this.flashOnHtml5_setDomId("StageTracing"),$(this.flashOnHtml5_documentElement).css({width:0,height:0})}StageTracingTarget.prototype=new AbstractStageChild(flashOnHtml5_constructingPrototype);StageTracingTarget.prototype.constructor=StageTracingTarget;
function StageTracingTarget(){var a={},c={};this.onInit=function(a){this.holder=new Sprite;this.addChild(this.holder);StageTracingTarget.prototype.onInit.call(this,a)};this.onChange=function(){this.changed=!1;if(!this.isInitialized||!this.model.hasPhoto||null==this.stageChildVO||!this.stageChildVO.visible)return this.visible&&(this.setVisible(!1),this.changed=!0),this.changed;this.stageChildVO.tracedArea=parseInt(this.getMakeoverItemParam("tracedArea",TracedArea.TRACEDAREA_LIPS));TracingUtils.guessTracedArea(this.stageChildVO.tracedArea);
var d=null;this.stageChildVO.tracedArea<=TracedArea.TRACEDAREA_LAST_INDEX&&(d=this.model.photoTrace[this.stageChildVO.tracedArea]);this.compare(a,this.stageChildVO.tracedArea,d,this.model.photoWidth,this.model.photoHeight,this.model.photoId,this.stageChildVO.visible)&&this.getFromModel();this.updateHolderPosition();this.compare(c,this.stageChildVO.x,this.stageChildVO.y,this.stageChildVO.rotation,this.stageChildVO.scaleX,this.stageChildVO.scaleY)&&this.updateModel()};this.updateModel=function(){if(null!=
this.stageChildVO&&null!=this.holder){var a=new Point(this.holder.x,this.holder.y),c=this.stageChildVO.rotation;isNaN(c)&&(c=0);for(var f=[],h=1;h<this.holder.numChildren;h++)f.push(TracingUtils.handleToPoint(this.holder.getChildAt(h)));this.model.photoTrace[this.stageChildVO.tracedArea].status=TracedArea.STATUS_TRACED;this.model.photoTrace[this.stageChildVO.tracedArea].location=a;this.model.photoTrace[this.stageChildVO.tracedArea].rotation=c;this.model.photoTrace[this.stageChildVO.tracedArea].scaleX=
this.stageChildVO.scaleX;this.model.photoTrace[this.stageChildVO.tracedArea].scaleY=this.stageChildVO.scaleY;this.model.photoTrace[this.stageChildVO.tracedArea].points=f;this.dispatchChangeEvent()}};this.getFromModel=function(){null!=this.stageChildVO&&(null!=this.model.photoTrace[this.stageChildVO.tracedArea].location&&(this.stageChildVO.x=this.model.photoTrace[this.stageChildVO.tracedArea].location.x,this.stageChildVO.y=this.model.photoTrace[this.stageChildVO.tracedArea].location.y),null!=this.model.photoTrace[this.stageChildVO.tracedArea].rotation&&
(this.stageChildVO.rotation=this.model.photoTrace[this.stageChildVO.tracedArea].rotation),this.stageChildVO.scaleX=this.model.photoTrace[this.stageChildVO.tracedArea].scaleX,this.stageChildVO.scaleY=this.model.photoTrace[this.stageChildVO.tracedArea].scaleY,this.compare(c,this.stageChildVO.x,this.stageChildVO.y,this.stageChildVO.rotation,this.stageChildVO.scaleX,this.stageChildVO.scaleY))};this.refreshModel=function(){};StageTracingTarget.prototype.flashOnHtml5_constructor.call(this)}
TraceHandle.prototype=new Sprite(flashOnHtml5_constructingPrototype);TraceHandle.prototype.constructor=TraceHandle;
function TraceHandle(a){function c(){this.onMouseOut();this.removeEventListener(Event.ENTER_FRAME,c)}function d(){this.canUpdate&&(this.getGraphics().clear(),this.getGraphics().beginFill(16711680,0),this.getGraphics().drawCircle(0,0,this.handleOverSize),this.getGraphics().endFill(),this.selectable?this.getGraphics().beginFill(this.selectableColor,1):this.getGraphics().beginFill(this.color,1),this.getGraphics().drawCircle(0,0,this.handleSize),this.getGraphics().endFill())}function e(){this.selectable&&
this.canUpdate&&(this.getGraphics().clear(),this.getGraphics().beginFill(16711680,0),this.getGraphics().drawCircle(0,0,this.handleOverSize),this.getGraphics().endFill(),this.getGraphics().lineStyle(1,this.overColor),this.getGraphics().drawCircle(0,0,this.handleOverSize))}this.canUpdate=this.selectable=!0;this.color=16711680;this.overColor=this.selectableColor=16711935;this.handleSize=4;this.handleOverSize=8;this.id=a;this.pointA=this.pointZ=0;this.isindexRight=this.isindexLeft=!1;this.anchorY=this.anchorX=
0;this.flashOnHtml5_constructor=function(a){TraceHandle.prototype.flashOnHtml5_constructor.call(this);"undefined"==typeof a&&(a="");this.id=a;this.addEventListener(Event.ENTER_FRAME,c,!1,0,!0);this.addEventListener(MouseEvent.MOUSE_OVER,e,!1,0,!0);this.addEventListener(MouseEvent.MOUSE_OUT,d,!1,0,!0)};this.onMouseOut=d;this.onMouseOver=e;(0==arguments.length||arguments[0]!=flashOnHtml5_constructingPrototype)&&this.flashOnHtml5_constructor(a)}function ColorUtils(){}
ColorUtils.colorToColorTransform=colorToColorTransform;function colorToColorTransform(a,c,d){"undefined"==typeof c&&(c=16777215);"undefined"==typeof d&&(d=1);return new ColorTransform(1,1,1,d,(a>>16&255)-(c>>16&255),(a>>8&255)-(c>>8&255),(a&255)-(c&255),0)}ColorUtils.HSBtoColor=HSBtoColor;
function HSBtoColor(a,c,d){var e,f,h;if(0==d)return 0;var d=d/100,a=a%360/60,c=Math.max(Math.min(c/100,1),0),d=Math.max(Math.min(d,1),0),i=Math.floor(a),j=a-i,a=d*(1-c),k=d*(1-c*j),c=d*(1-c*(1-j));switch(i){case 0:e=d;f=c;h=a;break;case 1:e=k;f=d;h=a;break;case 2:e=a;f=d;h=c;break;case 3:e=a;f=k;h=d;break;case 4:e=c;f=a;h=d;break;case 5:e=d,f=a,h=k}return Math.floor(255*e)<<16|Math.floor(255*f)<<8|Math.floor(255*h)}ColorUtils.ColorToHSB=ColorToHSB;
function ColorToHSB(a){return RGBtoHSB(a>>16&255,a>>8&255,a&255)}ColorUtils.RGBtoHSB=RGBtoHSB;function RGBtoHSB(a,c,d){var e=Math.min(Math.min(a,c),d),f=Math.max(Math.max(a,c),d),h=f-e,e=0==f?0:h/f;0==e?a=0:(a=a==f?60*(c-d)/h:c==f?120+60*(d-a)/h:240+60*(a-c)/h,0>a&&(a+=360));return{hue:a,saturation:100*e,brightness:100*(f/255)}}ColorUtils.RGBtoColor=RGBtoColor;function RGBtoColor(a,c,d){return a<<16|c<<8|d}ColorUtils.ColorToRGB=ColorToRGB;
function ColorToRGB(a){return{red:a>>16&255,green:a>>8&255,blue:a&255}}ColorUtils.argbtohex32=argbtohex32;function argbtohex32(a,c,d,e){return e<<24|a<<16|c<<8|d}ColorUtils.hex32toargb=hex32toargb;function hex32toargb(a){return{alpha:a>>24&255,red:a>>16&255,green:a>>8&255,blue:a&255}}ColorUtils.hex32toargb=hex32toargb;function toHexadecimalString(a){return"0x"+a.toString(16).toUpperCase()}ColorUtils.colorToLuminance=colorToLuminance;
function colorToLuminance(a){return Math.round(0.299*(a>>16&255)+0.587*(a>>8&255)+0.114*(a&255))}ColorUtils.RGBtoYUV=RGBtoYUV;function RGBtoYUV(a,c,d){return{y:0.299*a+0.587*c+0.114*d,u:-0.147*a-0.289*c+0.436*d,v:0.615*a-0.515*c-0.1*d}}ColorUtils.ColorToYUV=ColorToYUV;function ColorToYUV(a){return RGBtoYUV(a>>16&255,a>>8&255,a&255)}ColorUtils.YUVtoRGB=YUVtoRGB;function YUVtoRGB(a,c,d){return{red:a+1.14*d,green:a-0.395*c-0.581*d,blue:a+2.032*c}}ColorUtils.YUVtoColor=YUVtoColor;
function YUVtoColor(a,c,d){a=ColorUtils.YUVtoRGB(a,c,d);return Math.max(Math.min(Math.round(a.red),255),0)<<16|Math.max(Math.min(Math.round(a.green),255),0)<<8|Math.max(Math.min(Math.round(a.blue),255),0)}ColorUtils.RGBtoYCrCb=RGBtoYCrCb;function RGBtoYCrCb(a,c,d){return{y:0.299*a+0.587*c+0.114*d,cr:128-0.168736*a-0.331264*c+0.5*d,cb:128+0.5*a-0.418688*c-0.081312*d}}ColorUtils.ColorToYCrCb=ColorToYCrCb;function ColorToYCrCb(a){return RGBtoYCrCb(a>>16&255,a>>8&255,a&255)}ColorUtils.hex2RGB=hex2RGB;
function hex2RGB(a){return{r:(a&16711680)>>16,g:(a&65280)>>8,b:a&255}}ColorUtils.RGB2hex=RGB2hex;function RGB2hex(a){return Number((a.r<<16)+(a.g<<8)+a.b)}ColorUtils.RGBtoCMYK=RGBtoCMYK;function RGBtoCMYK(a,c,d){var a=1-a/255,c=1-c/255,d=1-d/255,e=1;a<e&&(e=a);c<e&&(e=c);d<e&&(e=d);1==e?d=c=a=0:(a=(a-e)/(1-e),c=(c-e)/(1-e),d=(d-e)/(1-e));return{c:a,m:c,y:d,k:e}}ColorUtils.CMYKtoRGB=CMYKtoRGB;function CMYKtoRGB(a,c,d,e){return{r:255*(1-(a*(1-e)+e)),g:255*(1-(c*(1-e)+e)),b:255*(1-(d*(1-e)+e))}}
ColorUtils.mixColors=mixColors;function mixColors(a,c,d){var e=a>>16&255,f=a>>8&255,a=a&255,d=d/255;return e+((c>>16&255)-e)*d<<16|f+((c>>8&255)-f)*d<<8|a+((c&255)-a)*d}ColorUtils.createSatMatrix=createSatMatrix;function createSatMatrix(a){var a=a/100,c=1-a;return[0.299*c+a,0.587*c,0.114*c,0,0,0.299*c,0.587*c+a,0.114*c,0,0,0.299*c,0.587*c,0.114*c+a,0,0,0,0,0,1,0]}function DataUtils(){}DataUtils.cleanupPointsArray=cleanupPointsArray;
function cleanupPointsArray(a){for(var c=[],d=0;d<a.length;d++){var e={};e.x=MathUtils.roundTo(a[d].x,2);e.y=MathUtils.roundTo(a[d].y,2);c.push(e)}return c}DataUtils.ArrayToString=ArrayToString;function ArrayToString(a){var c="",d;if(null!=a){for(d=0;d<a.length;d++)a[d]instanceof Point?(c+=MathUtils.roundTo(a[d].x,2)+",",c+=MathUtils.roundTo(a[d].y,2)+","):c+=MathUtils.roundTo(a[d],2)+",";0<c.length&&(c=c.substr(0,c.length-1))}return"{"+c+"},"}DataUtils.PointToString=PointToString;
function PointToString(a){var c="";null!=a&&(c+=MathUtils.roundTo(a.x,2)+",",c+=MathUtils.roundTo(a.y,2)+",");return c}DataUtils.NumberToString=NumberToString;function NumberToString(a,c){"undefined"==!typeof c&&(c=2);var d;return d=""+(MathUtils.roundTo(a,c)+",")}DataUtils.parseNumber=parseNumber;function parseNumber(a){return null==a?NaN:parseFloat(a.replace("{","").replace("}",""))}DataUtils.convertXMLToTracedArea=convertXMLToTracedArea;
function convertXMLToTracedArea(){var a=new TracedAreaVO;a.status=TracedArea.STATUS_TRACED;a.location=new Point(xml.attribute("mx"),xml.attribute("my"));a.rotation=parseFloat(xml.attribute("rotation"));a.scaleX=1;a.scaleY=1;a.points=[];a.points.push(new Point(xml.child("point1").attribute("x"),xml.child("point1").attribute("y")));a.points.push(new Point(xml.child("point2").attribute("x"),xml.child("point2").attribute("y")));a.points.push(new Point(xml.child("point3").attribute("x"),xml.child("point3").attribute("y")));
a.points.push(new Point(xml.child("point4").attribute("x"),xml.child("point4").attribute("y")));return a}DataUtils.convertXMLTracing=convertXMLTracing;
function convertXMLTracing(a){for(var c=[],d=a.split(">"),a="",e=0,f=0;f<d.length-1;)"</"==d[f].substr(0,2)?e=0:"<point"==d[f].substr(0,6)&&(e++,d[f]=d[f].substr(0,6)+e+d[f].substr(6)),a+=d[f]+">",f++;try{var h=new XML(a);c.push(null);var i;i=convertXMLToTracedArea(h.child("eyeL"));convert4Pto5P(i,!0);TracingUtils.normalizeTracedArea(i,TracedArea.TRACEDAREA_EYE_LEFT);c.push(i);i=convertXMLToTracedArea(h.child("eyeR"));convert4Pto5P(i,!1);TracingUtils.normalizeTracedArea(i,TracedArea.TRACEDAREA_EYE_RIGHT);
c.push(i);i=convertXMLToTracedArea(h.child("lip"));convert4Pto7P(i);TracingUtils.normalizeTracedArea(i,TracedArea.TRACEDAREA_LIPS);c.push(i);"true"==h.child("teeth").attribute("active")?(i=convertXMLToTracedArea(h.child("teeth")),convert4Pto7P(i),TracingUtils.normalizeTracedArea(i,TracedArea.TRACEDAREA_TEETH),c.push(i)):(i=new TracedAreaVO,i.status=TracedArea.STATUS_NOT_PRESENT)}catch(j){trace(j)}return c}DataUtils.StringToPhotoTrace=StringToPhotoTrace;
function StringToPhotoTrace(a){var c=[];if(null!=a&&""!==a)if("<data>"==a.substr(0,6))c=convertXMLTracing(a);else{for(;0<=a.indexOf(String.fromCharCode(121));)a=a.replace(String.fromCharCode(121),"-");for(;0<=a.indexOf(String.fromCharCode(120));)a=a.replace(String.fromCharCode(120),",");for(;0<=a.indexOf(String.fromCharCode(119));)a=a.replace(String.fromCharCode(119),"}");for(;0<=a.indexOf(String.fromCharCode(118));)a=a.replace(String.fromCharCode(118),"{");var d;for(d=9;0<=d;d--){for(;0<=a.indexOf(String.fromCharCode(d+
65));)a=a.replace(String.fromCharCode(d+65),"0."+d+",");for(;0<=a.indexOf(String.fromCharCode(d+75));)a=a.replace(String.fromCharCode(d+75),d+",");for(;0<=a.indexOf(String.fromCharCode(d+97));)a=a.replace(String.fromCharCode(d+97),d+".");for(;0<=a.indexOf(String.fromCharCode(d+107));)a=a.replace(String.fromCharCode(d+107),"-"+d)}var e=a.split(",");c.push(null);for(d=0;d<e.length;){var a=new TracedAreaVO,f=flashOnHtml5_castToInt(e[d++]);a.status=flashOnHtml5_castToInt(e[d++]);a.location=""==e[d]?null:
new Point(parseNumber(e[d]),parseNumber(e[d+1]));d+=2;a.rotation=parseFloat(e[d++]);a.scaleX=parseFloat(e[d++]);a.scaleY=parseFloat(e[d++]);d<e.length&&-1==e[d].indexOf("{")&&(a.indexLeft=flashOnHtml5_castToInt(e[d++]),a.indexRight=flashOnHtml5_castToInt(e[d++]));for(var h=[],i=[],j=[],k=!1,l=0;2>=l;l++)if("{}"==e[d]){switch(l){case 0:a.points=null;break;case 1:a.pointsZ=null;break;case 2:a.pointsA=null}d++}else for(k=d<e.length&&-1==e[d].indexOf("{");!k;){switch(l){case 0:k=new Point(parseNumber(e[d]),
parseNumber(e[d+1]));d++;h.push(k);break;case 1:i.push(parseNumber(e[d]));break;case 2:j.push(parseNumber(e[d]))}k=d>=e.length||0<e[d].indexOf("}");d++}a.points=h;a.pointsZ=i;for(a.pointsA=j;c.length<=f;)c.push(null);c[f]=a}}return c}DataUtils.convert4Pto5P=convert4Pto5P;
function convert4Pto5P(a,c){if(4==a.points.length){var d=a.points[0],e=a.points[1],f=a.points[2],h=a.points[3],e=a.points[3],h=a.points[1],i;i=c?new Point(h.x+(f.x-h.x)/3,h.y):new Point(e.x+(f.x-e.x)/3,e.y);var j=[];j.push(e);j.push(d);j.push(h);c?(j.push(i),j.push(f)):(j.push(f),j.push(i));a.points=j}d=[];d.push(0.1);d.push(0.5);d.push(0.1);d.push(0.5);d.push(0.5);a.pointsZ=d;d=[];d.push(0.9);d.push(0.5);d.push(0.9);d.push(0.5);d.push(0.5);a.pointsA=d;a.indexLeft=0;a.indexRight=2}
DataUtils.convert4Pto7P=convert4Pto7P;
function convert4Pto7P(a){if(4==a.points.length){var c=a.points[0],d=a.points[1],e=a.points[2],f=a.points[3],h=new Point(c.x+0.25*(d.x-c.x),c.y+0.1*(c.y-d.y)),i=new Point(c.x+0.25*(f.x-c.x),c.y+0.1*(c.y-f.y)),j=Math.abs(d.x-f.x),k=Math.abs(e.y-f.y),l=new Point(e.x-j/4,e.y-0.15*k),e=new Point(e.x+j/4,e.y-0.15*k),j=[];j.push(f);j.push(i);j.push(c);j.push(h);j.push(d);j.push(e);j.push(l);a.points=j}c=[];c.push(0.1);c.push(0.5);c.push(0.2);c.push(0.5);c.push(0.1);c.push(0.5);c.push(0.5);a.pointsZ=c;c=
[];c.push(0.9);c.push(0.5);c.push(0.5);c.push(0.5);c.push(0.9);c.push(0.5);c.push(0.5);a.pointsA=c;a.indexRight=0;a.indexLeft=4}DataUtils.TracedAreaVOToString=TracedAreaVOToString;
function TracedAreaVOToString(a){var c;c=""+NumberToString(a.status,0);c=null==a.location?c+",,":c+PointToString(a.location);c+=NumberToString(a.rotation,2);c+=NumberToString(a.scaleX,4);c+=NumberToString(a.scaleY,4);c+=NumberToString(a.indexLeft,0);c+=NumberToString(a.indexRight,0);null!=a.points&&(null!=a.pointsZ&&null!=a.pointsA&&0<a.points.length+a.pointsZ.length+a.pointsA.length)&&(c+=ArrayToString(a.points),c+=ArrayToString(a.pointsZ),c+=ArrayToString(a.pointsA));return c}
DataUtils.PhotoTraceToString=PhotoTraceToString;
function PhotoTraceToString(a,c){var d="",e;if(null!=a){for(e=0;e<a.length;e++)null!=a[e]&&a[e].status!=TracedArea.STATUS_NOT_TRACED&&(d+=e+","+TracedAreaVOToString(a[e]),c||(d+="\n"));d=d.substring(0,d.length-1);if(c){for(e=9;0<=e;e--){for(;0<=d.indexOf("0."+e+",");)d=d.replace("0."+e+",",String.fromCharCode(e+65));for(;0<=d.indexOf(e+",");)d=d.replace(e+",",String.fromCharCode(e+75));for(;0<=d.indexOf(e+".");)d=d.replace(e+".",String.fromCharCode(e+97));for(;0<=d.indexOf("-"+e);)d=d.replace("-"+
e,String.fromCharCode(e+107))}for(;0<=d.indexOf("{");)d=d.replace("{",String.fromCharCode(118));for(;0<=d.indexOf("}");)d=d.replace("}",String.fromCharCode(119));for(;0<=d.indexOf(",");)d=d.replace(",",String.fromCharCode(120));for(;0<=d.indexOf("-");)d=d.replace("-",String.fromCharCode(121))}}return d}DataUtils.modifyPhotoTrace=modifyPhotoTrace;
function modifyPhotoTrace(a,c,d,e){"undefined"==typeof c&&(c="scale");"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=1);var f=null;if(null!=a){a=StringToPhotoTrace(a);for(f=1;f<a.length;f++){var h=a[f];if(null!=h&&h.status!=TracedArea.STATUS_NOT_PRESENT)switch(c){case "scale":h.location.x*=d;h.location.y*=e;h.scaleX*=d;h.scaleY*=e;break;case "offset":h.location.x+=d,h.location.y+=e}}f=PhotoTraceToString(a)}return f}DataUtils.convertToTracedAreaVO=convertToTraceAreaVO;
function convertToTraceAreaVO(a,c,d,e,f){var h=new TracedAreaVO;h.location=a;h.rotation=c;h.scaleX=d;h.scaleY=e;h.points=f;return h}DataUtils.StringToNumber=StringToNumber;function StringToNumber(a){var c=0;null!=a&&(a=a.split(","),c=new Number(a[0]));return c}DataUtils.StringToPoint=StringToPoint;function StringToPoint(a){var c=new Point(0,0);null!=a&&""!=a&&(a=a.split(","),c=new Point(a[0],a[1]));return c}DataUtils.StringToArray=StringToArray;
function StringToArray(a){var c=[];if(null!=a&&""!=a)for(var a=a.split(","),d=0;d<a.length;)c.push(new Point(a[d],a[d+1])),d+=2;return c}DataUtils.JSONDecode=JSONDecode;function JSONDecode(a){var c={};if(null!=a)try{c=JSON2.decode(a)}catch(d){alert(d)}return c}function MathUtils(){}MathUtils.EPSILON=1E-6;MathUtils.roundTo=function(a,c){var d=0;isNaN(a)||(d=Math.pow(10,c),d=Math.round(a*d)/d);return d};MathUtils.range=function(a,c,d){return Math.max(Math.min(a,d),c)};
MathUtils.rotateAroundPoint=function(a,c,d){var e=new Point;e.x=c.x-a.x;e.y=c.y-a.y;e=MathUtils.rotatePoint(e,d);e.x+=a.x;e.y+=a.y;return e};MathUtils.rotatePoint=function(a,c){var d=0;isNaN(c)||(d=c*(Math.PI/180));var e=Math.sin(d),d=Math.cos(d),f=new Point;f.x=a.x*d-a.y*e;f.y=a.y*d+a.x*e;return f};MathUtils.moveVector=function(a,c,d){c=MathUtils.rotatePoint(new Point(c,0),d);c.x+=a.x;c.y+=a.y;return c};
MathUtils.getBoundingBox=function(a){if(null!=a){for(var c=a[0].x,d=c,e=a[0].y,f=e,h=1;h<a.length&&null!=a[h];h++){var i=a[h].x,j=a[h].y;c>i&&(c=i);d<i&&(d=i);e>j&&(e=j);f<j&&(f=j)}c=Math.round(c);d=Math.round(d);e=Math.round(e);f=Math.round(f);return[new Point(c,e),new Point(d,f)]}return[new Point(0,0),new Point(0,0)]};
MathUtils.extendBoundingBox=function(a,c,d){if(null!=a){c||(c=0);d||(d=0);var e=a[0].x,f=a[0].y,h=a[1].x,a=a[1].y,i=Math.round((h-e)/100*c+d),c=Math.round((a-f)/100*c+d),h=h+i,a=a+c;return[new Point(e-i,f-c),new Point(h,a)]}return[]};MathUtils.confineBounds=function(a,c,d){var e=[],f=a[0],a=a[1];null!=c&&(f.x=Math.max(f.x,c.x),f.y=Math.max(f.y,c.y));null!=d&&(a.x=Math.min(a.x,d.x),a.y=Math.min(a.y,d.y));e.push(f);e.push(a);return e};
MathUtils.confineBoundsCoords=function(a,c,d,e,f){var h=a[0],a=a[1];c>h.x&&(h.x=c);d>h.y&&(h.y=d);a.x>e&&(a.x=e);a.y>f&&(a.y=f);return[h,a]};MathUtils.unionBounds=function(a,c){var d=[];d.push(new Point(Math.min(a[0].x,c[0].x),Math.min(a[0].y,c[0].y)));d.push(new Point(Math.max(a[1].x,c[1].x),Math.max(a[1].y,c[1].y)));return d};
MathUtils.intersectionBounds=function(a,c){var d=[];d.push(new Point(Math.max(a[0].x,c[0].x),Math.max(a[0].y,c[0].y)));d.push(new Point(Math.min(a[1].x,c[1].x),Math.min(a[1].y,c[1].y)));return d};MathUtils.widthFromBounds=function(a){return Math.abs(a[1].x-a[0].x+1)};MathUtils.heightFromBounds=function(a){return Math.abs(a[1].y-a[0].y+1)};MathUtils.lineRotation=function(a,c){var d=Math.atan(-1*(a.y-c.y)/(a.x-c.x)),e=0;isNaN(d)||(e=-d*(180/Math.PI),a.x>=c.x&&(e+=180));return e};
MathUtils.pointBetween=function(a,c,d){d||(d=50);var e=new Point;e.x=a.x+(c.x-a.x)/100*d;e.y=a.y+(c.y-a.y)/100*d;return e};
MathUtils.lineIntersect=function(a,c,d,e,f){var h=null,i=c.y-a.y,j=a.x-c.x,k=e.y-d.y,l=d.x-e.x,m=i*l-k*j;if(0!=m){var h=c.x*a.y-a.x*c.y,n=e.x*d.y-d.x*e.y,h=new Point((j*n-l*h)/m,(k*h-i*n)/m);if(f&&(Math.pow(h.x-c.x+(h.y-c.y),2)>Math.pow(a.x-c.x+(a.y-c.y),2)||Math.pow(h.x-a.x+(h.y-a.y),2)>Math.pow(a.x-c.x+(a.y-c.y),2)||Math.pow(h.x-e.x+(h.y-e.y),2)>Math.pow(d.x-e.x+(d.y-e.y),2)||Math.pow(h.x-d.x+(h.y-d.y),2)>Math.pow(d.x-e.x+(d.y-e.y),2)))h=null}return h};
MathUtils.isPolygonClockwise=function(a){for(var c=0,d=0;d<a.length;d++)var e=(d+1)%a.length,c=c+(a[d].x*a[e].y-a[d].y*a[e].x);return 0<c};MathUtils.getPolygonArea=getPolygonArea;function getPolygonArea(a){for(var c=0,d=0;d<a.length;d++)var e=(d+1)%a.length,c=c+(a[d].x*a[e].y-a[d].y*a[e].x);return Math.abs(0.5*c)}
MathUtils.getPolygonCenter=function(a){for(var c=0,d=0,e=0;e<a.length;e++)var f=(e+1)%a.length,c=c+(a[e].x+a[f].x)*(a[e].y*a[f].x-a[e].x*a[f].y),d=d+(a[e].y+a[f].y)*(a[e].y*a[f].x-a[e].x*a[f].y);c/=6*getPolygonArea(a);d/=6*getPolygonArea(a);return new Point(Math.abs(c),Math.abs(d))};
MathUtils.growPolygon=function(a,c,d,e,f){e||(e=1);f||(f=1);var h=[];if(null!=a){var i,j,k;if(d){MathUtils.isPolygonClockwise(a)||(c=-c);for(d=0;d<a.length;d++){e=a[(d+a.length-1)%a.length];f=a[(d+1)%a.length];i=a[d];k=Point.distance(i,e);var l=Point.distance(i,f);k=(k+l)/2;e=MathUtils.moveVector(i,k,MathUtils.lineRotation(i,e));f=MathUtils.moveVector(i,k,MathUtils.lineRotation(i,f));j=MathUtils.lineRotation(e,f);h.push(MathUtils.moveVector(a[d],c,j-90))}}else{l=MathUtils.getPolygonCenter(a);for(d=
0;d<a.length;d++)i=a[d],j=MathUtils.lineRotation(l,i),k=Point.distance(l,i),k=MathUtils.moveVector(l,k*(1+c/100),j),h.push(new Point(i.x+(k.x-i.x)*e,i.y+(k.y-i.y)*f))}}return h};MathUtils.calcControlPoints=calcControlPoints;
function calcControlPoints(a,c,d){var e=[];if(null!=a&&1<a.length){var f=a.length-1,f=a.length,h;for(h=0;h<f;h++){var i=0>h-1?a[a.length-2]:a[h-1],j=a[h],k=h+1==a.length?a[1]:a[h+1],l=Point.distance(i,j);0.001>l&&(l=0.001);var m=Point.distance(j,k);0.001>m&&(m=0.001);var n=Point.distance(i,k);0.001>n&&(n=0.001);n=Math.acos((m*m+l*l-n*n)/(2*m*l));isNaN(n)&&(n=0);var o=new Point(i.x-j.x,i.y-j.y),s=new Point(j.x,j.y),r=new Point(k.x-j.x,k.y-j.y);l>m?o.normalize(m):m>l&&r.normalize(l);o.offset(j.x,j.y);
r.offset(j.x,j.y);var i=s.y-o.y,q=s.y-r.y,o=s.x-o.x+(s.x-r.x);0==o&&(o=0.001);i=Math.atan((i+q)/o);o=q=0.5;null!=c&&(null!=c[h]&&!isNaN(c[h]))&&(o=c[h]);null!=d&&(null!=d[h]&&!isNaN(d[h]))&&(q=d[h]);n/=Math.PI;l=Math.min(l,m)*o;l*=1-q+q*n;n=i+Math.PI/2;m=Point.polar(l,n);l=Point.polar(l,n+Math.PI);l.offset(j.x,j.y);m.offset(j.x,j.y);e[h]=Point.distance(m,k)>Point.distance(l,k)?[m,l]:[l,m]}}return e}MathUtils.preprocessPointArray=preprocessPointArray;
function preprocessPointArray(a){for(var a=a.slice(),c=[],d=0;d<a.length;d++){if(!(a[d]instanceof Point))throw Error("Array must contain Point objects");0<d&&a[d].x==a[d-1].x&&a[d].y==a[d-1].y&&c.push(d)}for(d=c.length-1;0<=d;d--)a.splice(c[d],1);return a}MathUtils.curveThroughPoints=curveThroughPoints;
function curveThroughPoints(a,c,d,e,f){try{var h=preprocessPointArray(c);h.push(h[0]);d instanceof Array&&(d=d.concat(d[0]));e instanceof Array&&(e=e.concat(e[0]));if(2<h.length){var i=h.length,j=calcControlPoints(h,d,e);a.moveTo(h[0].x,h[0].y);var k,l,m;for(k=0;k<i-1;k++){var n=h[k],o=j[k][1],s=j[k+1][0],r=h[k+1],q=n.x,v=n.y,p=o.x-q,z=o.y-v,w=s.x-q,K=s.y-v,u=r.x-q,t=r.y-v;m=f;"undefined"==typeof m&&(m=5/Point.distance(n,r),isNaN(m)&&(m=0.02),m=MathUtils.range(m,0.02,0.5));for(l=m;1>l;l+=m)a.lineTo((l*
l*u+3*(1-l)*(l*w+(1-l)*p))*l+q,(l*l*t+3*(1-l)*(l*K+(1-l)*z))*l+v);a.lineTo(r.x,r.y)}}else 2==h.length&&(a.moveTo(h[0].x,h[0].y),a.lineTo(h[1].x,h[1].y))}catch(D){alert(D)}}MathUtils.m00=-0.5;MathUtils.m01=1.5;MathUtils.m02=-1.5;MathUtils.m03=0.5;MathUtils.m10=1;MathUtils.m11=-2.5;MathUtils.m12=2;MathUtils.m13=-0.5;MathUtils.m20=-0.5;MathUtils.m21=0;MathUtils.m22=0.5;MathUtils.m23=0;MathUtils.m30=0;MathUtils.m31=1;MathUtils.m32=0;MathUtils.m33=0;
MathUtils.spline=function(a,c,d){var e,f=c-3,h,i,j;1<=f&&(a=MathUtils.range(a,0,1)*f,e=Math.min(Math.floor(a),c-4),a-=e,c=d[e],f=d[e+1],h=d[e+2],i=d[e+3],j=MathUtils.m00*c+MathUtils.m01*f+MathUtils.m02*h+MathUtils.m03*i,e=MathUtils.m10*c+MathUtils.m11*f+MathUtils.m12*h+MathUtils.m13*i,d=MathUtils.m20*c+MathUtils.m21*f+MathUtils.m22*h+MathUtils.m23*i,c=MathUtils.m30*c+MathUtils.m31*f+MathUtils.m32*h+MathUtils.m33*i,h=((j*a+e)*a+d)*a+c);return h};
MathUtils.interpolateSpline=function(a,c,d,e,f,h,i){var j=d,d=d+e-1,k,l,m,n,o,s,r,q,v,e=a[j];l=m=n=c[j];k=a[j+1];o=c[j+1];for(var p=0;p<i;p++){j<=d&&p>a[j]&&(l=m,m=n,n=o,e=a[j],j++,j<=d&&(k=a[j]),o=j<d?c[j+1]:n);var z=(p-e)/(k-e);v=MathUtils.m00*l+MathUtils.m01*m+MathUtils.m02*n+MathUtils.m03*o;q=MathUtils.m10*l+MathUtils.m11*m+MathUtils.m12*n+MathUtils.m13*o;r=MathUtils.m20*l+MathUtils.m22*n;s=MathUtils.m31*m;f[h+p]=((v*z+q)*z+r)*z+s}};
MathUtils.resample=function(a,c,d,e,f,h){var i,j,k,l,m,n,o,s,r,q,v,p=4*e,z=4*e,w=a.length,K=0,u=0,t=0,D=0;v=Array(d+2);for(i=e=0;i<d;i++){for(;h[e+1]<i;)e++;v[i]=e+Number(i-h[e])/(h[e+1]-h[e])}v[d]=d;v[d+1]=d;i=1;h=j=v[1];a.setPosition(p);q=a.readUnsignedInt();k=q>>24&255;l=q>>16&255;m=q>>8&255;n=q&255;p+=4*f;a.setPosition(p);q=a.readUnsignedInt();o=q>>24&255;s=q>>16&255;r=q>>8&255;q&=255;p+=4*f;for(e=1;e<=d;){var A=i*k+(1-i)*o,B=i*l+(1-i)*s,F=i*m+(1-i)*r,C=i*n+(1-i)*q;i<j?(K+=A*i,u+=B*i,t+=F*i,D+=
C*i,j-=i,i=1,k=o,l=s,m=r,n=q,p<w&&(a.setPosition(p),q=a.readUnsignedInt(),o=q>>24&255,s=q>>16&255,r=q>>8&255,q&=255),p+=4*f):(K+=A*j,u+=B*j,t+=F*j,D+=C*j,c.setPosition(z),c.writeUnsignedInt(parseInt(Math.min(K/h,255))<<24|parseInt(Math.min(u/h,255))<<16|parseInt(Math.min(t/h,255))<<8|parseInt(Math.min(D/h,255))),z+=4*f,K=u=t=D=0,i-=j,h=j=v[e+1]-v[e],e++)}};MathUtils.lerp=function(a,c,d){return c+a*(d-c)};
MathUtils.mixColors=function(a,c,d){var e=c>>16&255,f=c>>8&255,h=c&255,i=d>>16&255,j=d>>8&255,k=d&255,c=lerp(a,c>>24&255,d>>24&255),e=lerp(a,e,i),f=lerp(a,f,j),h=lerp(a,h,k);return c<<24|e<<16|f<<8|h};
MathUtils.circumCircle=function(a,c,d,e,f,h,i,j,k){var l,m;if(Math.abs(e-h)<EPSILON&&Math.abs(h-j)<EPSILON)return!1;Math.abs(h-e)<EPSILON?(m=(f+d)/2,i=-(i-f)/(j-h)*(m-(f+i)/2)+(h+j)/2):(Math.abs(j-h)<EPSILON?(l=-(f-d)/(h-e),d=(d+f)/2,e=(e+h)/2,m=(i+f)/2):(l=-(f-d)/(h-e),m=-(i-f)/(j-h),d=(d+f)/2,e=(e+h)/2,m=(l*d-m*((f+i)/2)+(h+j)/2-e)/(l-m)),i=l*(m-d)+e);f-=m;h-=i;j=f*f+h*h;l=Math.sqrt(j);f=a-m;h=c-i;k[0]=m;k[1]=i;k[2]=l;return f*f+h*h<=j?!0:!1};
MathUtils.triangulate=function(a){for(var c=[],d=a.length,e=0;e<3*d;e++)c[e]=new Triangle;var f=null,h=null,i=0,j=0,k=200,l,m,n,o,s,r,q,v,p,z;z=0;j=4*d;f=[];for(h=0;h<j;h++)f[h]=!1;h=[];for(o=0;o<k;o++)h[o]=new Edge;p=a[0].x;i=a[0].y;m=p;z=i;for(var e=1;e<d;e++)if(a[e].x<p&&(p=a[e].x),a[e].x>m&&(m=a[e].x),a[e].y<i&&(i=a[e].y),a[e].y>z)z=a[e].y;e=m-p;n=z-i;e=e>n?e:n;p=(m+p)/2;i=(z+i)/2;a[d+0]=new Point;a[d+0].x=p-2*e;a[d+0].y=i-e;a[d+1]=new Point;a[d+1].x=p;a[d+1].y=i+2*e;a[d+2]=new Point;a[d+2].x=
p+2*e;a[d+2].y=i-e;c[0].p1=d;c[0].p2=d+1;c[0].p3=d+2;f[0]=!1;z=1;for(e=0;e<d;e++){m=a[e].x;n=a[e].y;var i=0,w=[0,0,0];for(p=0;p<z;p++)if(!f[p]&&(l=a[c[p].p1].x,o=a[c[p].p1].y,s=a[c[p].p2].x,r=a[c[p].p2].y,q=a[c[p].p3].x,v=a[c[p].p3].y,l=circumCircle(m,n,l,o,s,r,q,v,w),o=w[0],s=w[2],o+s<m&&(f[p]=!0),l)){if(i+3>=k){trace("crazy if statement");k+=100;l=[];for(o=0;o<k;o++)l[o]=new Edge;for(o=0;o<h.length;o++)l[o]=h[o];h=l}h[i+0].p1=c[p].p1;h[i+0].p2=c[p].p2;h[i+1].p1=c[p].p2;h[i+1].p2=c[p].p3;h[i+2].p1=
c[p].p3;h[i+2].p2=c[p].p1;i+=3;c[p].p1=c[z-1].p1;c[p].p2=c[z-1].p2;c[p].p3=c[z-1].p3;f[p]=f[z-1];z--;p--}for(p=0;p<i-1;p++)for(m=p+1;m<i;m++)if(h[p].p1==h[m].p2&&h[p].p2==h[m].p1&&(h[p].p1=-1,h[p].p2=-1,h[m].p1=-1,h[m].p2=-1),h[p].p1==h[m].p1&&h[p].p2==h[m].p2)h[p].p1=-1,h[p].p2=-1,h[m].p1=-1,h[m].p2=-1;for(p=0;p<i;p++)if(!(-1==h[p].p1||-1==h[p].p2)){if(z>=j)return null;c[z].p1=h[p].p1;c[z].p2=h[p].p2;c[z].p3=e;f[z]=!1;z++}}for(e=0;e<z;e++)if(c[e].p1>=d||c[e].p2>=d||c[e].p3>=d)c[e]=c[z-1],z--,e--;
c.length=z;a.length-=3;return c};TracingUtils={};TracingUtils.model=ModelLocator.getInstance();TracingUtils.startTime=[];TracingUtils._message=[];TracingUtils.initializeFeatureWeight=function(){TracingUtils.model.defaultFeatureWeight=[];var a;for(a=0;a<Features.FEATURE_LAST_INDEX;a++)TracingUtils.model.defaultFeatureWeight.push(0);for(a=0;a<arguments.length;a++)TracingUtils.model.defaultFeatureWeight[arguments[a]]=100*(a+1)};
TracingUtils.isFeatureColorBased=function(a){return a==Features.FEATURE_BLUSH||a==Features.FEATURE_BLUSH_R||a==Features.FEATURE_CONCEALER||a==Features.FEATURE_CONCEALER_R||a==Features.FEATURE_CYOH||a==Features.FEATURE_EYELINER||a==Features.FEATURE_EYELINER_R||a==Features.FEATURE_EYEBROW_PENCIL||a==Features.FEATURE_EYEBROW_PENCIL_R||a==Features.FEATURE_EYESHADOW||a==Features.FEATURE_EYESHADOW_R||a==Features.FEATURE_EYESHADOWC||a==Features.FEATURE_EYESHADOWL||a==Features.FEATURE_EYE_BRIGHTEN||a==Features.FEATURE_EYE_BRIGHTEN_R||
a==Features.FEATURE_FACE_POWDER||a==Features.FEATURE_FOUNDATION||a==Features.FEATURE_HAIR_COLOR||a==Features.FEATURE_HIGHLIGHTS||a==Features.FEATURE_LIPGLOSS||a==Features.FEATURE_LIPLINER||a==Features.FEATURE_LIPSTICK||a==Features.FEATURE_LOWLIGHTS||a==Features.FEATURE_MASCARA||a==Features.FEATURE_MASCARA_R||a==Features.FEATURE_POLISH||a==Features.FEATURE_TEETH_WHITENING?!0:!1};
TracingUtils.isFeatureDraggable=function(a){return a==Features.FEATURE_EARRING||a==Features.FEATURE_EARRING_R||a==Features.FEATURE_FACIAL_HAIR||a==Features.FEATURE_GLASSES||a==Features.FEATURE_HAIR||a==Features.FEATURE_HAIRCLIPS||a==Features.FEATURE_HEADWEAR||a==Features.FEATURE_NECKLACE||a==Features.FEATURE_SCARF||a==Features.FEATURE_SUNGLASSES||a==Features.FEATURE_VEILS?!0:!1};
TracingUtils.isFeatureTracing=function(a){return a==Features.FEATURE_TRACING||a==Features.FEATURE_TRACING_DISTORT||a==Features.FEATURE_TRACING_INITIAL||a==Features.FEATURE_TRACING_SPOT_APPLY||a==Features.FEATURE_TRACING_TARGET?!0:!1};TracingUtils.handleToPoint=function(a){var c=new Point;c.x=a.x;c.y=a.y;return c};TracingUtils.pointToHandle=function(a){var c=new TraceHandle;c.x=a.x;c.y=a.y;return c};TracingUtils.isTraced=isTraced;
function isTraced(a){var c=!1;0<a&&(TracingUtils.model.photoTrace.length>a&&null!=TracingUtils.model.photoTrace[a])&&(c=TracingUtils.model.photoTrace[a].status==TracedArea.STATUS_TRACED||TracingUtils.model.photoTrace[a].status==TracedArea.STATUS_NOT_PRESENT);return c}TracingUtils.isTracedOrGuessed=isTracedOrGuessed;
function isTracedOrGuessed(a){var c=!1;"number"==typeof a||a instanceof Number?0<a&&(TracingUtils.model.photoTrace.length>a&&null!=TracingUtils.model.photoTrace[a])&&(c=TracingUtils.model.photoTrace[a].status==TracedArea.STATUS_TRACED||TracingUtils.model.photoTrace[a].status==TracedArea.STATUS_GUESSED):a instanceof TracedAreaVO&&(c=a.status==TracedArea.STATUS_TRACED||a.status==TracedArea.STATUS_GUESSED);return c}TracingUtils.getTracedStatus=getTracedStatus;
function getTracedStatus(a){var c=-1;0<a&&a<TracingUtils.model.photoTrace.length&&null!=TracingUtils.model.photoTrace[a]&&(c=TracingUtils.model.photoTrace[a].status);return c}TracingUtils.isTracedFace=function(){return null!=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_FACE].location&&null!=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_FACE].rotation&&null!=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_FACE].scaleX&&null!=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_FACE].scaleY};
TracingUtils.isFeatureTwoSided=function(a){var c=TracingUtils.getFeatureLeftSide(a),a=0!=TracingUtils.getFeatureRightSide(a);return 0!=c||a};TracingUtils.getFeatureOtherSide=function(a){return TracingUtils.isFeatureLeftSide(a)?TracingUtils.getFeatureRightSide(a):TracingUtils.getFeatureLeftSide(a)};TracingUtils.isFeatureLeftSide=function(a){return 0!=TracingUtils.getFeatureRightSide(a)};TracingUtils.isFeatureRightSide=function(a){return 0!=TracingUtils.getFeatureLeftSide(a)};
TracingUtils.getFeatureLeftSide=function(a){var c=0;switch(a){case Features.FEATURE_BLUSH_R:c=Features.FEATURE_BLUSH;break;case Features.FEATURE_CONCEALER_R:c=Features.FEATURE_CONCEALER;break;case Features.FEATURE_CONTACTS_R:c=Features.FEATURE_CONTACTS;break;case Features.FEATURE_EYEBROW_PENCIL_R:c=Features.FEATURE_EYEBROW_PENCIL;break;case Features.FEATURE_EYELINER_R:c=Features.FEATURE_EYELINER;break;case Features.FEATURE_EYESHADOW_R:c=Features.FEATURE_EYESHADOW;break;case Features.FEATURE_EARRING_R:c=
Features.FEATURE_EARRING;break;case Features.FEATURE_EYEBROW_THINNING_R:c=Features.FEATURE_EYEBROW_THINNING;break;case Features.FEATURE_EYE_BRIGHTEN_R:c=Features.FEATURE_EYE_BRIGHTEN;break;case Features.FEATURE_MASCARA_R:c=Features.FEATURE_MASCARA}return c};
TracingUtils.getFeatureRightSide=function(a){var c=0;switch(a){case Features.FEATURE_BLUSH:c=Features.FEATURE_BLUSH_R;break;case Features.FEATURE_CONCEALER:c=Features.FEATURE_CONCEALER_R;break;case Features.FEATURE_CONTACTS:c=Features.FEATURE_CONTACTS_R;break;case Features.FEATURE_EYEBROW_PENCIL:c=Features.FEATURE_EYEBROW_PENCIL_R;break;case Features.FEATURE_EYELINER:c=Features.FEATURE_EYELINER_R;break;case Features.FEATURE_EYESHADOW:case Features.FEATURE_EYESHADOWC:case Features.FEATURE_EYESHADOWL:c=
Features.FEATURE_EYESHADOW_R;break;case Features.FEATURE_EARRING:c=Features.FEATURE_EARRING_R;break;case Features.FEATURE_EYEBROW_THINNING:c=Features.FEATURE_EYEBROW_THINNING_R;break;case Features.FEATURE_EYE_BRIGHTEN:c=Features.FEATURE_EYE_BRIGHTEN_R;break;case Features.FEATURE_MASCARA:c=Features.FEATURE_MASCARA_R}return c};
TracingUtils.tracedAreaForFeature=function(a,c,d){"undefined"==typeof c&&(c=0);"undefined"==typeof d&&(d=0);var e=0;switch(a){case Features.FEATURE_LIPSTICK:case Features.FEATURE_LIPGLOSS:case Features.FEATURE_LIPLINER:case Features.FEATURE_LIP_PLUMPING:case Features.FEATURE_LIP_TEXTURE:e=TracedArea.TRACEDAREA_LIPS;break;case Features.FEATURE_TEETH_WHITENING:e=TracedArea.TRACEDAREA_TEETH;break;case Features.FEATURE_EYESHADOW:case Features.FEATURE_EYESHADOWC:case Features.FEATURE_EYESHADOWL:switch(c){case 1:switch(d){case 1:e=
TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_CONTOUR;break;case 2:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_HIGHLIGHT;break;default:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_LID}break;case 2:switch(d){case 1:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_CONTOUR;break;case 2:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_HIGHLIGHT;break;default:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_LID}break;case 3:switch(d){case 1:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_HIGHLIGHT;break;default:e=
TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_LID}break;case 4:switch(d){case 1:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_2;break;case 2:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_3;break;case 3:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_4;break;default:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_1}break;default:e=TracedArea.TRACEDAREA_EYESHADOW_LEFT_WASH}break;case Features.FEATURE_EYESHADOW_R:switch(c){case 1:switch(d){case 1:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_CONTOUR;break;case 2:e=
TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_HIGHLIGHT;break;default:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_LID}break;case 2:switch(d){case 1:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_CONTOUR;break;case 2:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_HIGHLIGHT;break;default:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_LID}break;case 3:switch(d){case 1:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_HIGHLIGHT;break;default:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_LID}break;case 4:switch(d){case 1:e=
TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_2;break;case 2:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_3;break;case 3:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_4;break;default:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_1}break;default:e=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_WASH}break;case Features.FEATURE_EYELINER:switch(c){case 5:e=TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED;break;case 6:e=TracedArea.TRACEDAREA_EYELINER_LEFT_CATEYE;break;default:e=TracedArea.TRACEDAREA_EYE_LEFT}break;case Features.FEATURE_EYELINER_R:switch(c){case 5:e=
TracedArea.TRACEDAREA_EYELINER_RIGHT_WINGED;break;case 6:e=TracedArea.TRACEDAREA_EYELINER_RIGHT_CATEYE;break;default:e=TracedArea.TRACEDAREA_EYE_RIGHT}break;case Features.FEATURE_BLUSH:switch(c){case 1:e=TracedArea.TRACEDAREA_BLUSH_FLUSH_LEFT;break;case 2:e=TracedArea.TRACEDAREA_BLUSH_CONTOUR_LEFT;break;case 3:e=TracedArea.TRACEDAREA_BLUSH_SUNKISSED_LEFT;break;default:e=TracedArea.TRACEDAREA_BLUSH_APPLE_LEFT}break;case Features.FEATURE_BLUSH_R:switch(c){case 1:e=TracedArea.TRACEDAREA_BLUSH_FLUSH_RIGHT;
break;case 2:e=TracedArea.TRACEDAREA_BLUSH_CONTOUR_RIGHT;break;case 3:e=TracedArea.TRACEDAREA_BLUSH_SUNKISSED_RIGHT;break;default:e=TracedArea.TRACEDAREA_BLUSH_APPLE_RIGHT}break;case Features.FEATURE_MASCARA:case Features.FEATURE_EYE_BRIGHTEN:e=TracedArea.TRACEDAREA_EYE_LEFT;break;case Features.FEATURE_MASCARA_R:case Features.FEATURE_EYE_BRIGHTEN_R:e=TracedArea.TRACEDAREA_EYE_RIGHT;break;case Features.FEATURE_CONTACTS:e=TracedArea.TRACEDAREA_CONTACT_LEFT;break;case Features.FEATURE_CONTACTS_R:e=TracedArea.TRACEDAREA_CONTACT_RIGHT;
break;case Features.FEATURE_EYEBROW_PENCIL:case Features.FEATURE_EYEBROW_THINNING:e=TracedArea.TRACEDAREA_EYEBROW_LEFT;break;case Features.FEATURE_EYEBROW_PENCIL_R:case Features.FEATURE_EYEBROW_THINNING_R:e=TracedArea.TRACEDAREA_EYEBROW_RIGHT;break;case Features.FEATURE_HEADWEAR:case Features.FEATURE_HAIRCLIPS:case Features.FEATURE_VEILS:e=TracedArea.TRACEDAREA_HEADWEAR;break;case Features.FEATURE_GLASSES:case Features.FEATURE_SUNGLASSES:e=TracedArea.TRACEDAREA_GLASSES;break;case Features.FEATURE_SCARF:e=
TracedArea.TRACEDAREA_SCARF;break;case Features.FEATURE_NECKLACE:e=TracedArea.TRACEDAREA_NECKLACE;break;case Features.FEATURE_EARRING:e=TracedArea.TRACEDAREA_EARRING_LEFT;break;case Features.FEATURE_EARRING_R:e=TracedArea.TRACEDAREA_EARRING_RIGHT;break;case Features.FEATURE_CYOH:e=TracedArea.TRACEDAREA_CYOH;break;case Features.FEATURE_HAIR:case Features.FEATURE_HAIR_COLOR:case Features.FEATURE_HIGHLIGHTS:case Features.FEATURE_LOWLIGHTS:e=TracedArea.TRACEDAREA_HAIR;break;case Features.FEATURE_CONCEALER:e=
TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_LEFT;break;case Features.FEATURE_CONCEALER_R:e=TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_RIGHT;break;case Features.FEATURE_FOUNDATION:case Features.FEATURE_FACE_POWDER:case Features.FEATURE_BLEMISH_REMOVAL:switch(c){case 1:e=TracedArea.TRACEDAREA_TZONE;break;default:e=TracedArea.TRACEDAREA_FACE}break;case Features.FEATURE_FACE_MASK:e=TracedArea.TRACEDAREA_FACE;break;case Features.FEATURE_NOSE:e=TracedArea.TRACEDAREA_NOSE;break;case Features.FEATURE_FACIAL_HAIR:e=
TracedArea.TRACEDAREA_FACIAL_HAIR;break;case Features.FEATURE_POLISH:e=TracedArea.TRACEDAREA_NAILS;break;case Features.FEATURE_COVER:e=TracedArea.TRACEDAREA_COVER;break;default:e=TracedArea.TRACEDAREA_FACE}return e};TracingUtils.isTracedAreaTwoSided=function(a){return 0!=TracingUtils.getTracedAreaLeftSide(a)||0!=TracingUtils.getTracedAreaRightSide(a)};TracingUtils.getTracedAreaOtherSide=function(a){return isTracedAreaLeftSide(a)?TracingUtils.getTracedAreaRightSide(a):TracingUtils.getTracedAreaLeftSide(a)};
TracingUtils.isTracedAreaLeftSide=isTracedAreaLeftSide;function isTracedAreaLeftSide(a){return 0!=TracingUtils.getTracedAreaRightSide(a)}TracingUtils.isTracedAreaRightSide=function(a){return 0!=TracingUtils.getTracedAreaLeftSide(a)};
TracingUtils.getTracedAreaLeftSide=function(a){var c=0;switch(a){case TracedArea.TRACEDAREA_EYE_RIGHT:c=TracedArea.TRACEDAREA_EYE_LEFT;break;case TracedArea.TRACEDAREA_EYEBROW_RIGHT:c=TracedArea.TRACEDAREA_EYEBROW_LEFT;break;case TracedArea.TRACEDAREA_EYELINER_RIGHT_WINGED:c=TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED;break;case TracedArea.TRACEDAREA_EYELINER_RIGHT_CATEYE:c=TracedArea.TRACEDAREA_EYELINER_LEFT_CATEYE;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT;
break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_WASH:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_WASH;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_LID:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_LID;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_CONTOUR:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_CONTOUR;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_HIGHLIGHT:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_HIGHLIGHT;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_LID:c=
TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_LID;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_CONTOUR:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_CONTOUR;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_HIGHLIGHT:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_HIGHLIGHT;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_LID:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_LID;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_HIGHLIGHT:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_HIGHLIGHT;
break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_1:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_1;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_2:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_2;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_3:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_3;break;case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_4:c=TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_4;break;case TracedArea.TRACEDAREA_BLUSH_RIGHT:c=TracedArea.TRACEDAREA_BLUSH_LEFT;break;case TracedArea.TRACEDAREA_BLUSH_APPLE_RIGHT:c=
TracedArea.TRACEDAREA_BLUSH_APPLE_LEFT;break;case TracedArea.TRACEDAREA_BLUSH_FLUSH_RIGHT:c=TracedArea.TRACEDAREA_BLUSH_FLUSH_LEFT;break;case TracedArea.TRACEDAREA_BLUSH_CONTOUR_RIGHT:c=TracedArea.TRACEDAREA_BLUSH_CONTOUR_LEFT;break;case TracedArea.TRACEDAREA_BLUSH_SUNKISSED_RIGHT:c=TracedArea.TRACEDAREA_BLUSH_SUNKISSED_LEFT;break;case TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_RIGHT:c=TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_LEFT;break;case TracedArea.TRACEDAREA_EARRING_RIGHT:c=TracedArea.TRACEDAREA_EARRING_LEFT;
break;case TracedArea.TRACEDAREA_CONTACT_RIGHT:c=TracedArea.TRACEDAREA_CONTACT_LEFT}return c};
TracingUtils.getTracedAreaRightSide=function(a){var c=0;switch(a){case TracedArea.TRACEDAREA_EYE_LEFT:c=TracedArea.TRACEDAREA_EYE_RIGHT;break;case TracedArea.TRACEDAREA_EYEBROW_LEFT:c=TracedArea.TRACEDAREA_EYEBROW_RIGHT;break;case TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED:c=TracedArea.TRACEDAREA_EYELINER_RIGHT_WINGED;break;case TracedArea.TRACEDAREA_EYELINER_LEFT_CATEYE:c=TracedArea.TRACEDAREA_EYELINER_RIGHT_CATEYE;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT;
break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_WASH:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_WASH;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_LID:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_LID;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_CONTOUR:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_CONTOUR;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_HIGHLIGHT:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_HIGHLIGHT;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_LID:c=
TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_LID;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_CONTOUR:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_CONTOUR;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_HIGHLIGHT:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_HIGHLIGHT;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_LID:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_LID;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_HIGHLIGHT:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_HIGHLIGHT;
break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_1:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_1;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_2:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_2;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_3:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_3;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_4:c=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_4;break;case TracedArea.TRACEDAREA_BLUSH_LEFT:c=TracedArea.TRACEDAREA_BLUSH_RIGHT;break;case TracedArea.TRACEDAREA_BLUSH_APPLE_LEFT:c=
TracedArea.TRACEDAREA_BLUSH_APPLE_RIGHT;break;case TracedArea.TRACEDAREA_BLUSH_FLUSH_LEFT:c=TracedArea.TRACEDAREA_BLUSH_FLUSH_RIGHT;break;case TracedArea.TRACEDAREA_BLUSH_CONTOUR_LEFT:c=TracedArea.TRACEDAREA_BLUSH_CONTOUR_RIGHT;break;case TracedArea.TRACEDAREA_BLUSH_SUNKISSED_LEFT:c=TracedArea.TRACEDAREA_BLUSH_SUNKISSED_RIGHT;break;case TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_LEFT:c=TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_RIGHT;break;case TracedArea.TRACEDAREA_CONTACT_LEFT:c=TracedArea.TRACEDAREA_CONTACT_RIGHT;
break;case TracedArea.TRACEDAREA_EARRING_LEFT:c=TracedArea.TRACEDAREA_EARRING_RIGHT}return c};TracingUtils.doesTracedAreaHavePoints=doesTracedAreaHavePoints;
function doesTracedAreaHavePoints(a){return a==TracedArea.TRACEDAREA_CONTACT_LEFT||a==TracedArea.TRACEDAREA_CONTACT_RIGHT||a==TracedArea.TRACEDAREA_EARRING_LEFT||a==TracedArea.TRACEDAREA_EARRING_RIGHT||a==TracedArea.TRACEDAREA_BLUSH_LEFT||a==TracedArea.TRACEDAREA_BLUSH_RIGHT||a==TracedArea.TRACEDAREA_EYESHADOW_LEFT||a==TracedArea.TRACEDAREA_EYESHADOW_RIGHT||a==TracedArea.TRACEDAREA_HAIR||a==TracedArea.TRACEDAREA_FACIAL_HAIR||a==TracedArea.TRACEDAREA_GLASSES||a==TracedArea.TRACEDAREA_HEADWEAR||a==
TracedArea.TRACEDAREA_SCARF||a==TracedArea.TRACEDAREA_NECKLACE||a==TracedArea.TRACEDAREA_COVER||a==TracedArea.TRACEDAREA_NAILS?!1:!0}TracingUtils.isTracedAreaValid=isTracedAreaValid;
function isTracedAreaValid(a){var c=!0;if(TracingUtils.model.photoTrace[a].status==TracedArea.STATUS_TRACED){if(isNaN(TracingUtils.model.photoTrace[a].scaleX)||isNaN(TracingUtils.model.photoTrace[a].scaleY)||0==TracingUtils.model.photoTrace[a].scaleX||0==TracingUtils.model.photoTrace[a].scaleY||null==TracingUtils.model.photoTrace[a].location)c=!1;if(doesTracedAreaHavePoints(a)&&(null==TracingUtils.model.photoTrace[a].points||0==TracingUtils.model.photoTrace[a].points.length))c=!1}return c}
TracingUtils.normalizeTracedArea=normalizeTracedArea;function normalizeTracedArea(a,c){"undefined"==typeof c&&(c=0);if(null!=a.points&&0<=a.indexLeft&&a.indexLeft<a.points.length&&0<=a.indexRight&&a.indexRight<a.points.length){for(var d=Point.distance(a.points[a.indexLeft],a.points[a.indexRight]),d=0>=d||isNaN(d)?1:d/TracingUtils.absoluteLength(c),e=a.scaleX/d,f=a.scaleY/d,h=0;h<a.points.length;h++)a.points[h].x*=e,a.points[h].y*=f;a.scaleX=d;a.scaleY=d}}
TracingUtils.pointsToTraceArea=function(a,c,d,e,f){f||(f=1);var h=new TracedAreaVO,i,j,k,l;if(1<c.length){i=MathUtils.pointBetween(c[d],c[e],50);j=MathUtils.lineRotation(c[d],c[e]);f=Point.distance(c[d],c[e])/TracingUtils.absoluteLength(a);k=[];l=[];for(var m=0;m<c.length;m++)a!=TracedArea.TRACEDAREA_FACE&&(m==d||m==e)?(k.push(0.1),l.push(0.9)):(k.push(0.5),l.push(0.5)),c[m].x-=i.x,c[m].y-=i.y,c[m]=MathUtils.rotatePoint(c[m],-j),c[m].x/=f,c[m].y/=f}else i=c[0],j=0;h.status=TracedArea.STATUS_TRACED;
h.location=TracingUtils.pointFromBitmapScale(i);h.rotation=j;h.scaleX=f;h.scaleY=f;h.indexLeft=d;h.indexRight=e;h.points=c;h.pointsZ=k;for(h.pointsA=l;TracingUtils.model.photoTrace.length<=a;)TracingUtils.model.photoTrace.push(new TracedAreaVO);TracingUtils.model.photoTrace[a]=h};
TracingUtils.setTracingCoordinates=function(a){TracingUtils.model.photoTrace=[];var c,d,e;if(41==a.length){e=a[0].x;a.shift();for(d=0;d<a.length;d++)a[d].x/=e,a[d].y/=e;d=[];d.push(a[11]);d.push(a[9]);d.push(a[7]);d.push(a[5]);d.push(a[6]);d.push(a[8]);d.push(a[10]);d.push(a[32]);d.push(a[30]);d.push(a[12]);d.push(a[14]);d.push(a[29]);d.push(a[15]);d.push(a[13]);d.push(a[31]);d.push(a[33]);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_FACE,d,0,8);c=[];c.push(a[3]);c.push(a[36]);c.push(a[20]);
c.push(a[37]);c.push(a[4]);c.push(a[39]);c.push(a[21]);c.push(a[38]);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_LIPS,c,0,4);e=TracingUtils.pointFromBitmapScale(MathUtils.pointBetween(a[23],a[24]));d=MathUtils.lineRotation(a[23],a[24]);var f=Point.distance(a[23],a[24]);setupEyeShape(e,d,f/TracingUtils.absoluteLength(TracedArea.TRACEDAREA_EYE_LEFT),TracedArea.TRACEDAREA_EYE_LEFT);TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].status=TracedArea.STATUS_TRACED;e=TracingUtils.pointFromBitmapScale(MathUtils.pointBetween(a[25],
a[26]));d=MathUtils.lineRotation(a[25],a[26]);a=Point.distance(a[25],a[26]);setupEyeShape(e,d,a/TracingUtils.absoluteLength(TracedArea.TRACEDAREA_EYE_RIGHT),TracedArea.TRACEDAREA_EYE_RIGHT);TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].status=TracedArea.STATUS_TRACED}else if(66==a.length)e=[],e.push(a[23]),e.push(a[28]),e.push(a[24]),e.push(a[27]),TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYE_LEFT,e,0,2),e=[],e.push(a[25]),e.push(a[32]),e.push(a[26]),e.push(a[31]),TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYE_RIGHT,
e,0,2),d=Point.distance(a[12],a[13])/10,f=[],e=MathUtils.lineRotation(a[12],a[13]),f.push(a[12]),f.push(MathUtils.moveVector(a[18],d,e-90)),f.push(MathUtils.moveVector(a[16],d,e-90)),f.push(MathUtils.moveVector(a[19],d,e-90)),f.push(a[13]),f.push(MathUtils.moveVector(a[19],d,e+90)),f.push(MathUtils.moveVector(a[16],d,e+90)),f.push(MathUtils.moveVector(a[18],d,e+90)),TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYEBROW_LEFT,f,0,4),f=[],e=MathUtils.lineRotation(a[14],a[15]),f.push(a[14]),f.push(MathUtils.moveVector(a[20],
d,e-90)),f.push(MathUtils.moveVector(a[17],d,e-90)),f.push(MathUtils.moveVector(a[21],d,e-90)),f.push(a[15]),f.push(MathUtils.moveVector(a[21],d,e+90)),f.push(MathUtils.moveVector(a[17],d,e+90)),f.push(MathUtils.moveVector(a[20],d,e+90)),TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYEBROW_RIGHT,f,0,4),d=new Point(a[3].x,a[3].y),f=new Point(a[4].x,a[4].y),c=[],c.push(a[3]),c.push(a[56]),c.push(a[54]),c.push(a[57]),c.push(a[4]),c.push(a[59]),c.push(a[55]),c.push(a[58]),TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_LIPS,
c,0,4),e=Point.distance(d,f),c=Point.distance(a[61],a[64]),c>e/25?(c=[],c.push(d),c.push(a[60]),c.push(a[61]),c.push(a[62]),c.push(f),c.push(a[65]),c.push(a[64]),c.push(a[63]),TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_TEETH,c,0,4)):(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH]=new TracedAreaVO,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH].status=TracedArea.STATUS_NOT_PRESENT);else if(72==a.length){d=a.slice(0,20);for(e=19;0<e;)d.splice(e,1),e-=2;d.splice(9,1);
d.splice(4,1);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_FACE,d,0,3);e=[];e.push(a[20]);e.push(a[22]);e.push(a[24]);e.push(a[26]);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYE_LEFT,e,0,2);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYEBROW_LEFT,a.slice(28,34),0,3);e=[];e.push(a[40]);e.push(a[38]);e.push(a[36]);e.push(a[34]);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYE_RIGHT,e,1,3);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYEBROW_RIGHT,a.slice(42,
48),0,3);c=a.slice(48,60);c.splice(11,1);c.splice(7,1);c.splice(5,1);c.splice(1,1);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_LIPS,c,0,4);e=Point.distance(a[60],a[66]);c=Point.distance(a[63],a[69]);c>e/18?(c=a.slice(60,72),c[0]=MathUtils.moveVector(c[0],5*(e/100),MathUtils.lineRotation(a[60],a[66])),c[6]=MathUtils.moveVector(c[6],5*(e/100),MathUtils.lineRotation(a[60],a[66])+180),c.splice(11,1),c.splice(7,1),c.splice(5,1),c.splice(1,1),TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_TEETH,
c,0,4)):(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH]=new TracedAreaVO,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH].status=TracedArea.STATUS_NOT_PRESENT)}else{d=a.slice(0,15).concat(a.slice(68,77).reverse());for(e=23;0<e;)d.splice(e,1),e-=2;TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_FACE,d,0,7);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYEBROW_RIGHT,a.slice(15,21),3,0);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYEBROW_LEFT,a.slice(21,27),
0,3);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYE_LEFT,a.slice(27,31),0,2);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_EYE_RIGHT,a.slice(32,36).reverse(),1,3);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_NOSE,a.slice(38,45),1,5);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_LIPS,a.slice(48,60),0,6);TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_CONTACT_LEFT,a.slice(31,32),0,0,faceScale());TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_CONTACT_RIGHT,
a.slice(36,37),0,0,faceScale());c=Math.abs(a[61].y-a[64].y);3<c?TracingUtils.pointsToTraceArea(TracedArea.TRACEDAREA_TEETH,a.slice(60,66),0,3):(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH]=new TracedAreaVO,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH].status=TracedArea.STATUS_NOT_PRESENT)}};
function setupPoints(a,c,d,e,f,h,i,j){"undefined"==typeof f&&(f=0);"undefined"==typeof h&&(h=3);"undefined"==typeof i&&(i=1);"undefined"==typeof j&&(j=1);var e=e.split(","),k,l=0;for(k=l<e.length&&-1==e[l].indexOf("{");!k;)a.length==f||a.length==h?(c.push(0.1),d.push(0.9)):(c.push(0.5),d.push(0.5)),a.push(new Point(DataUtils.parseNumber(e[l])*i,DataUtils.parseNumber(e[l+1])*j)),l+=2,k=l>=e.length||0<e[l-1].indexOf("}")}TracingUtils.setupEyeshadow=setupEyeshadow;
function setupEyeshadow(a,c,d,e){"undefined"==typeof d&&(d=0);"undefined"==typeof e&&(e=3);var f=isTracedAreaLeftSide(a),h=f?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;guessTracedArea(h);if(getTracedStatus(h)==TracedArea.STATUS_NOT_PRESENT)TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_NOT_PRESENT;else{var i=f?TracedArea.TRACEDAREA_EYEBROW_LEFT:TracedArea.TRACEDAREA_EYEBROW_RIGHT;guessTracedArea(i);var j=TracingUtils.model.photoTrace[h].scaleX;null!=TracingUtils.model.photoTrace[h].points&&
TracingUtils.model.photoTrace[h].points.length>TracingUtils.model.photoTrace[h].indexLeft&&TracingUtils.model.photoTrace[h].points.length>TracingUtils.model.photoTrace[h].indexRight&&(j=Point.distance(TracingUtils.model.photoTrace[h].points[TracingUtils.model.photoTrace[h].indexLeft],TracingUtils.model.photoTrace[h].points[TracingUtils.model.photoTrace[h].indexRight])*TracingUtils.model.photoTrace[h].scaleX/TracingUtils.absoluteLength(h));var f=f?-1:1,k=1;if(0<Point.distance(TracingUtils.model.photoTrace[h].location,
TracingUtils.model.photoTrace[i].location)){for(var k=MathUtils.getPolygonCenter(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(TracingUtils.model.photoTrace[i].points,i))),i=TracingUtils.getCurvePointsTracedArea(TracingUtils.model.photoTrace[h],10),l=new Point,m=1;m<i.length;m++)0>i[m-1].x&&-0<=i[m].x&&(l=MathUtils.pointBetween(i[m-1],i[m]));l=TracingUtils.pointToBitmapScale(TracingUtils.pointToAbsolute(l,h));Point.distance(k,l);k=1}i=[];l=[];m=[];setupPoints(i,l,m,c,d,e,f,k);TracingUtils.model.photoTrace[a].status=
TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=new Point(TracingUtils.model.photoTrace[h].location.x,TracingUtils.model.photoTrace[h].location.y);TracingUtils.model.photoTrace[a].rotation=TracingUtils.model.photoTrace[h].rotation;TracingUtils.model.photoTrace[a].scaleX=j;TracingUtils.model.photoTrace[a].scaleY=j;TracingUtils.model.photoTrace[a].indexLeft=d;TracingUtils.model.photoTrace[a].indexRight=e;TracingUtils.model.photoTrace[a].points=i;TracingUtils.model.photoTrace[a].pointsZ=
l;TracingUtils.model.photoTrace[a].pointsA=m}}
TracingUtils.setupEyeShape=function(a,c,d,e){"undefined"==typeof c&&(c=0);"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=TracedArea.TRACEDAREA_EYE_LEFT);checkPhotoTraceElement(e);var f,h=[],i=[],j=[],k=isTracedAreaLeftSide(e);f=1*(k?-1:1);h.push(new Point(-35,0));h.push(new Point(3*f,-18));h.push(new Point(35,0));k?(h.push(new Point(-22*f,5)),h.push(new Point(6*f,12))):(h.push(new Point(6*f,12)),h.push(new Point(-22*f,5)));i.push(0.1);i.push(0.5);i.push(0.1);i.push(0.5);i.push(0.5);j.push(0.9);
j.push(0.5);j.push(0.9);j.push(0.5);j.push(0.5);TracingUtils.model.photoTrace[e].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[e].location=a;TracingUtils.model.photoTrace[e].rotation=c;TracingUtils.model.photoTrace[e].scaleX=d;TracingUtils.model.photoTrace[e].scaleY=d;TracingUtils.model.photoTrace[e].indexLeft=0;TracingUtils.model.photoTrace[e].indexRight=2;TracingUtils.model.photoTrace[e].points=h;TracingUtils.model.photoTrace[e].pointsZ=i;TracingUtils.model.photoTrace[e].pointsA=
j};
TracingUtils.setupLipShape=function(a,c,d,e){"undefined"==typeof c&&(c=0);"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=TracedArea.TRACEDAREA_LIPS);checkPhotoTraceElement(e);var f=[],h=[],i=[];f.push(new Point(-60,0));f.push(new Point(-15,-15));f.push(new Point(0,-10));f.push(new Point(15,-15));f.push(new Point(60,0));f.push(new Point(28,21));f.push(new Point(-28,21));h.push(0.1);h.push(0.5);h.push(0.5);h.push(0.5);h.push(0.1);h.push(0.5);h.push(0.5);i.push(0.9);i.push(0.5);i.push(0.5);i.push(0.5);
i.push(0.9);i.push(0.5);i.push(0.5);TracingUtils.model.photoTrace[e].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[e].location=a;TracingUtils.model.photoTrace[e].rotation=c;TracingUtils.model.photoTrace[e].scaleX=d;TracingUtils.model.photoTrace[e].scaleY=d;TracingUtils.model.photoTrace[e].indexLeft=0;TracingUtils.model.photoTrace[e].indexRight=4;TracingUtils.model.photoTrace[e].points=f;TracingUtils.model.photoTrace[e].pointsZ=h;TracingUtils.model.photoTrace[e].pointsA=i};
TracingUtils.checkPhotoTraceElement=checkPhotoTraceElement;function checkPhotoTraceElement(a){if(0<a&&a<=TracedArea.TRACEDAREA_LAST_INDEX){for(;TracingUtils.model.photoTrace.length<=a;)TracingUtils.model.photoTrace.push(new TracedAreaVO);null==TracingUtils.model.photoTrace[a]&&(TracingUtils.model.photoTrace[a]=new TracedAreaVO)}}TracingUtils.guessTracedArea=guessTracedArea;
function guessTracedArea(a){if(0<a&&a<=TracedArea.TRACEDAREA_LAST_INDEX&&(!isTraced(a)||!isTracedAreaValid(a))){checkPhotoTraceElement(a);var c=[],d=[],e=[],f,h=new Point,i=isTracedAreaLeftSide(a),j;switch(a){case TracedArea.TRACEDAREA_LIPS:c=0;getTracedStatus(TracedArea.TRACEDAREA_EYE_LEFT)==TracedArea.STATUS_TRACED?c=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].scaleX:getTracedStatus(TracedArea.TRACEDAREA_EYE_RIGHT)==TracedArea.STATUS_TRACED&&(c=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].scaleX);
0==c&&(c=0.16*TracingUtils.model.photoWidth/absoluteLength(a));getTracedStatus(TracedArea.TRACEDAREA_EYE_LEFT)==TracedArea.STATUS_TRACED&&getTracedStatus(TracedArea.TRACEDAREA_EYE_RIGHT)==TracedArea.STATUS_TRACED?(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location),
h=MathUtils.moveVector(i,165*c,f+90)):getTracedStatus(TracedArea.TRACEDAREA_EYE_LEFT)==TracedArea.STATUS_TRACED?(f=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].rotation,h=MathUtils.moveVector(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,183*c,f+90-26)):getTracedStatus(TracedArea.TRACEDAREA_EYE_RIGHT)==TracedArea.STATUS_TRACED?(f=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].rotation,h=MathUtils.moveVector(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,
183*c,f+90+26)):(h=new Point(0,TracingUtils.model.photoHeight/2/3),f=0);TracingUtils.setupLipShape(h,f,c);break;case TracedArea.TRACEDAREA_TEETH:guessTracedArea(TracedArea.TRACEDAREA_LIPS);i=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points;f=0.8*Point.distance(i[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexLeft],i[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexRight]);isNaN(f);for(f=0;f<TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points.length;f++)c.push(new Point(0.8*
TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points[f].x,0.5*TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points[f].y)),d.push(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].pointsZ[f]),e.push(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].pointsA[f]);i=TracingUtils.pointToAbsolute(MathUtils.getPolygonCenter(i),TracedArea.TRACEDAREA_LIPS);f=new Point(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location.x,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location.y);
h=MathUtils.pointBetween(i,f);f=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].rotation;TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f;TracingUtils.model.photoTrace[a].scaleX=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].scaleX;TracingUtils.model.photoTrace[a].scaleY=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].scaleY;TracingUtils.model.photoTrace[a].indexLeft=
TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexLeft;TracingUtils.model.photoTrace[a].indexRight=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexRight;TracingUtils.model.photoTrace[a].points=c;TracingUtils.model.photoTrace[a].pointsZ=d;TracingUtils.model.photoTrace[a].pointsA=e;break;case TracedArea.TRACEDAREA_EYE_LEFT:case TracedArea.TRACEDAREA_EYE_RIGHT:c=0;i?getTracedStatus(TracedArea.TRACEDAREA_EYE_RIGHT)==TracedArea.STATUS_TRACED&&(c=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].scaleX):
getTracedStatus(TracedArea.TRACEDAREA_EYE_LEFT)==TracedArea.STATUS_TRACED&&(c=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].scaleX);0==c&&getTracedStatus(TracedArea.TRACEDAREA_LIPS)==TracedArea.STATUS_TRACED&&(c=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].scaleX);0==c&&(c=0.09*TracingUtils.model.photoWidth/absoluteLength(a));f=0;getTracedStatus(TracedArea.TRACEDAREA_LIPS)==TracedArea.STATUS_TRACED&&(f=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].rotation);
f+=i?6:-6;isTraced(TracedArea.TRACEDAREA_LIPS)?h=MathUtils.moveVector(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,183*TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].scaleX,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].rotation+(a==TracedArea.TRACEDAREA_EYE_LEFT?-26:26)-90):(h.x=TracingUtils.model.photoWidth/2/5,a==TracedArea.TRACEDAREA_EYE_LEFT&&(h.x=-h.x));TracingUtils.setupEyeShape(h,f,c,a);break;case TracedArea.TRACEDAREA_NOSE:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);
guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS))&&(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,
i)+90,h=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i,40));setupPoints(c,d,e,"{-48,0,-38,-30,0,8,36,-29,52,-0,21,18,-20,18}",-1,-1,faceScaleX(),faceScaleY());TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f;TracingUtils.model.photoTrace[a].scaleX=1;TracingUtils.model.photoTrace[a].scaleY=1;TracingUtils.model.photoTrace[a].points=c;TracingUtils.model.photoTrace[a].pointsZ=
d;TracingUtils.model.photoTrace[a].pointsA=e;TracingUtils.model.photoTrace[a].indexLeft=0;TracingUtils.model.photoTrace[a].indexRight=4;break;case TracedArea.TRACEDAREA_CYOH:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS))&&(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,
TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i)+90,h=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i,50));setupPoints(c,d,e,"{-165,-50,-150,-100,-90,-250,90,-250,150,-100,165,-50,140,-330,-140,-330}",-1,-1,1,1);TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=
f;TracingUtils.model.photoTrace[a].scaleX=faceScaleX();TracingUtils.model.photoTrace[a].scaleY=faceScaleY();TracingUtils.model.photoTrace[a].points=c;TracingUtils.model.photoTrace[a].pointsZ=d;TracingUtils.model.photoTrace[a].pointsA=e;TracingUtils.model.photoTrace[a].indexLeft=0;TracingUtils.model.photoTrace[a].indexRight=3;break;case TracedArea.TRACEDAREA_FACE:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);
isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS))&&(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i)+90,h=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,
i,50));setupPoints(c,d,e,"{-165,-50,-65,165,65,165,165,-50,90,-250,-90,-250}",-1,-1,1,1);TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f;TracingUtils.model.photoTrace[a].scaleX=faceScaleX();TracingUtils.model.photoTrace[a].scaleY=faceScaleY();TracingUtils.model.photoTrace[a].points=c;TracingUtils.model.photoTrace[a].pointsZ=d;TracingUtils.model.photoTrace[a].pointsA=e;TracingUtils.model.photoTrace[a].indexLeft=
0;TracingUtils.model.photoTrace[a].indexRight=3;break;case TracedArea.TRACEDAREA_EYELINER_RIGHT_WINGED:case TracedArea.TRACEDAREA_EYELINER_RIGHT_CATEYE:case TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED:case TracedArea.TRACEDAREA_EYELINER_LEFT_CATEYE:j=isTracedAreaLeftSide(a)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;guessTracedArea(j);h=new Point(TracingUtils.model.photoTrace[j].location.x,TracingUtils.model.photoTrace[j].location.y);i=1*(i?-1:1);f=1;a==TracedArea.TRACEDAREA_EYELINER_RIGHT_WINGED||
a==TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED?c.push(new Point(50*i,0*f)):c.push(new Point(50*i,-2*f));d.push(0.1);e.push(0.9);TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=TracingUtils.model.photoTrace[j].rotation;TracingUtils.model.photoTrace[a].scaleX=TracingUtils.model.photoTrace[j].scaleX;TracingUtils.model.photoTrace[a].scaleY=TracingUtils.model.photoTrace[j].scaleY;TracingUtils.model.photoTrace[a].indexLeft=
0;TracingUtils.model.photoTrace[a].indexRight=0;TracingUtils.model.photoTrace[a].points=c;TracingUtils.model.photoTrace[a].pointsZ=d;TracingUtils.model.photoTrace[a].pointsA=e;break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_WASH:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_WASH:setupEyeshadow(a,"{-40.1,1.85,-22.5,-22.9,19.85,-28.6,61.75,-8,42.15,3.45,14.05,-9.65,-18.55,-10}",0,3);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_LID:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_LID:setupEyeshadow(a,
"{-43.7,3.6,-22.15,-22.85,10.35,-27.55,41.4,-18.1,56.6,-8.6,37.55,4,16.55,-8.5,-14.65,-9.6}",0,4);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_CONTOUR:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_CONTOUR:setupEyeshadow(a,"{-31.5,-23.35,-16.15,-31.5,22.35,-33.95,61.95,-15.35,57.8,-9.8,38.7,-20.3,17.7,-27.05,-2.15,-29.1}",0,4);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_HIGHLIGHT:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_HIGHLIGHT:setupEyeshadow(a,"{-8.5,-36.75,35.15,-40.85,60.95,-28.9,63.25,-17.35,32.7,-32.5}",
0,3);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_LID:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_LID:setupEyeshadow(a,"{-45.1,4.85,-20.9,-22.9,26.35,-22.6,57.4,-4.9,30.75,12.6,-0.05,18.5,-25.4,10.25}",0,3);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_CONTOUR:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_CONTOUR:setupEyeshadow(a,"{-32.4,-21.8,11,-33.35,62.6,-17.3,58.1,-7.15,37.65,-19.35,11.35,-26.85,-14.9,-26}",0,4);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_HIGHLIGHT:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_HIGHLIGHT:setupEyeshadow(a,
"{-12.4,-34,38.8,-38.8,63.3,-28.25,62.75,-19.3,23.25,-32.85}",0,3);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_LID:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_LID:setupEyeshadow(a,"{-43.3,2.9,-17.55,-24,23.05,-25.15,53.4,-6.8,36.35,0.7,13.6,-9.65,-11.85,-11.4}",0,3);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_HIGHLIGHT:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_HIGHLIGHT:setupEyeshadow(a,"{-33.65,-19.8,-12.3,-31.65,27.55,-28.75,58.05,-10.4,54.4,-7.1,30.85,-22.25,-4.6,-28.55}",
0,3);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_1:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_1:setupEyeshadow(a,"{-39,-2,-21,-26,4,-32,34,-22,47,2,29,17,8,18,-11,0}",0,4);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_2:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_2:setupEyeshadow(a,"{-39,0,-21,-27,-2,-36,19,-35,45,-22,50,1,35,-7,2,-23,-25,-17}",0,5);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_3:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_3:setupEyeshadow(a,"{-36,-11,-18,-34,-1,-41,25,-39,45,-24,51,-7,34,-20,21,-28,3,-31,-16,-28}",
0,5);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT_QUAD_4:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT_QUAD_4:setupEyeshadow(a,"{-2,-41,22,-53,48,-50,56,-26,33,-36}",0,2);break;case TracedArea.TRACEDAREA_EYESHADOW_LEFT:case TracedArea.TRACEDAREA_EYESHADOW_RIGHT:j=isTracedAreaLeftSide(a)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;guessTracedArea(j);trace("tracedArea "+a+" is guessed");TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=
new Point(TracingUtils.model.photoTrace[j].location.x,TracingUtils.model.photoTrace[j].location.y);TracingUtils.model.photoTrace[a].rotation=TracingUtils.model.photoTrace[j].rotation;TracingUtils.model.photoTrace[a].scaleX=TracingUtils.model.photoTrace[j].scaleX;TracingUtils.model.photoTrace[a].scaleY=TracingUtils.model.photoTrace[j].scaleY;break;case TracedArea.TRACEDAREA_CONTACT_LEFT:case TracedArea.TRACEDAREA_CONTACT_RIGHT:j=i?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;guessTracedArea(j);
guessTracedArea(i?TracedArea.TRACEDAREA_EYE_RIGHT:TracedArea.TRACEDAREA_EYE_LEFT);f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location);h=MathUtils.moveVector(TracingUtils.model.photoTrace[j].location,8*TracingUtils.model.photoTrace[j].scaleX,f-90+(i?-5:5));TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=
f;TracingUtils.model.photoTrace[a].scaleX=TracingUtils.model.photoTrace[j].scaleX;TracingUtils.model.photoTrace[a].scaleY=TracingUtils.model.photoTrace[j].scaleY;break;case TracedArea.TRACEDAREA_BLUSH_LEFT:case TracedArea.TRACEDAREA_BLUSH_RIGHT:case TracedArea.TRACEDAREA_BLUSH_APPLE_LEFT:case TracedArea.TRACEDAREA_BLUSH_APPLE_RIGHT:case TracedArea.TRACEDAREA_BLUSH_FLUSH_LEFT:case TracedArea.TRACEDAREA_BLUSH_FLUSH_RIGHT:case TracedArea.TRACEDAREA_BLUSH_CONTOUR_LEFT:case TracedArea.TRACEDAREA_BLUSH_CONTOUR_RIGHT:case TracedArea.TRACEDAREA_BLUSH_SUNKISSED_LEFT:case TracedArea.TRACEDAREA_BLUSH_SUNKISSED_RIGHT:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);
guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);guessTracedArea(TracedArea.TRACEDAREA_FACE);f=1;var k,l;switch(a){case TracedArea.TRACEDAREA_BLUSH_APPLE_LEFT:case TracedArea.TRACEDAREA_BLUSH_APPLE_RIGHT:c.push(new Point(-38,0*f));c.push(new Point(0,-40*f));c.push(new Point(38,0*f));c.push(new Point(0,40*f));d.push(0.5);d.push(0.5);d.push(0.5);d.push(0.5);e.push(0.5);e.push(0.5);e.push(0.5);e.push(0.5);j=0.9;k=i?-5:5;l=i?-33:33;break;case TracedArea.TRACEDAREA_BLUSH_FLUSH_LEFT:case TracedArea.TRACEDAREA_BLUSH_FLUSH_RIGHT:i?
(c.push(new Point(-53,0)),c.push(new Point(0,-38)),c.push(new Point(53,0)),c.push(new Point(40,52))):(c.push(new Point(-53,0)),c.push(new Point(40,-52)),c.push(new Point(53,0)),c.push(new Point(0,38)));d.push(0.5);d.push(0.5);d.push(0.5);d.push(0.5);e.push(0.5);e.push(0.5);e.push(0.5);e.push(0.5);j=1;k=i?-5:5;l=i?55:125;break;case TracedArea.TRACEDAREA_BLUSH_CONTOUR_LEFT:case TracedArea.TRACEDAREA_BLUSH_CONTOUR_RIGHT:c.push(new Point(-80,0*f));c.push(new Point(20,-20*f));c.push(new Point(70,0*f));
c.push(new Point(20,20*f));d.push(0.1);d.push(0.5);d.push(0.1);d.push(0.5);e.push(0.9);e.push(0.5);e.push(0.9);e.push(0.5);j=1.2;k=i?-40:40;l=(i?-23:23)+90;break;case TracedArea.TRACEDAREA_BLUSH_LEFT:case TracedArea.TRACEDAREA_BLUSH_RIGHT:j=0.9,k=i?-5:5,l=0,c=null}var h=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,50),m=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,
TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,50);f=MathUtils.lineRotation(h,m);h=MathUtils.moveVector(i?h:m,Point.distance(h,m)*j,f+k+(i?180:0));TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f+l;TracingUtils.model.photoTrace[a].scaleX=faceScaleX();TracingUtils.model.photoTrace[a].scaleY=faceScaleY();null!=c&&(TracingUtils.model.photoTrace[a].indexLeft=0,TracingUtils.model.photoTrace[a].indexRight=
2,TracingUtils.model.photoTrace[a].points=c,TracingUtils.model.photoTrace[a].pointsZ=d,TracingUtils.model.photoTrace[a].pointsA=e);break;case TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_LEFT:case TracedArea.TRACEDAREA_CONCEALER_UNDEREYE_RIGHT:setupEyeshadow(a,"{-60,-14,-45,0,6,11,56,1,77,9,60,47,7,52,-58,12}",0,4);break;case TracedArea.TRACEDAREA_TZONE:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&
(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS))&&(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i)+90,h=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i,40));setupPoints(c,d,e,"{135,-185,-135,-185,-41,-153,-26,-65,-53,-64,-79,-10,-13,-25,-38,38,0,155.45,41.8,38.1,12.45,-24.65,84.7,-3.75,57.45,-64.25,25.45,-65.85,37.2,-154.25}",
-1,-1,faceScaleX(),faceScaleY());TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f;TracingUtils.model.photoTrace[a].scaleX=1;TracingUtils.model.photoTrace[a].scaleY=1;TracingUtils.model.photoTrace[a].indexLeft=0;TracingUtils.model.photoTrace[a].indexRight=1;TracingUtils.model.photoTrace[a].points=c;TracingUtils.model.photoTrace[a].pointsZ=d;TracingUtils.model.photoTrace[a].pointsA=e;break;case TracedArea.TRACEDAREA_HAIR:case TracedArea.TRACEDAREA_HEADWEAR:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);
guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS))&&(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,
i)+90,h=i);TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f;TracingUtils.model.photoTrace[a].scaleX=2*faceScaleX();TracingUtils.model.photoTrace[a].scaleY=2*faceScaleY();break;case TracedArea.TRACEDAREA_FACIAL_HAIR:guessTracedArea(TracedArea.TRACEDAREA_LIPS);TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=new Point(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location.x,
TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location.y);TracingUtils.model.photoTrace[a].rotation=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].rotation;TracingUtils.model.photoTrace[a].scaleX=2*faceScaleX();TracingUtils.model.photoTrace[a].scaleY=2*faceScaleY();break;case TracedArea.TRACEDAREA_EARRING_LEFT:case TracedArea.TRACEDAREA_EARRING_RIGHT:j=isTracedAreaLeftSide(a)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;guessTracedArea(j);TracingUtils.model.photoTrace[a].status=
TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=MathUtils.moveVector(TracingUtils.model.photoTrace[j].location,120*faceScale(),90+(i?45:-45));TracingUtils.model.photoTrace[a].rotation=0;TracingUtils.model.photoTrace[a].scaleX=2*faceScale();TracingUtils.model.photoTrace[a].scaleY=2*faceScale();break;case TracedArea.TRACEDAREA_SCARF:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&
(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS))&&(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i)+90,h=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i,40),h=MathUtils.moveVector(h,200*faceScaleY(),
f+90));TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f;TracingUtils.model.photoTrace[a].scaleX=2*faceScaleX();TracingUtils.model.photoTrace[a].scaleY=2*faceScaleY();break;case TracedArea.TRACEDAREA_NECKLACE:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);guessTracedArea(TracedArea.TRACEDAREA_LIPS);isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&
(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS))&&(i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50),f=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i)+90,h=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].location,i,40),h=MathUtils.moveVector(h,200*faceScaleY(),
f+90));TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=f;TracingUtils.model.photoTrace[a].scaleX=1.85*faceScaleX();TracingUtils.model.photoTrace[a].scaleY=1.85*faceScaleY();break;case TracedArea.TRACEDAREA_GLASSES:guessTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);guessTracedArea(TracedArea.TRACEDAREA_EYE_RIGHT);i=MathUtils.pointBetween(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,
TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location,50);TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=i;TracingUtils.model.photoTrace[a].rotation=MathUtils.lineRotation(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].location,TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].location);TracingUtils.model.photoTrace[a].scaleX=1.85*faceScaleX();TracingUtils.model.photoTrace[a].scaleY=1.85*faceScaleY();
break;case TracedArea.TRACEDAREA_EYEBROW_LEFT:case TracedArea.TRACEDAREA_EYEBROW_RIGHT:j=isTracedAreaLeftSide(a)?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;guessTracedArea(j);h=MathUtils.moveVector(TracingUtils.model.photoTrace[j].location,37*TracingUtils.model.photoTrace[j].scaleX,TracingUtils.model.photoTrace[j].rotation-90+(isTracedAreaLeftSide(a)?-15:15));setupPoints(c,d,e,"{-52.45,0,-43,-18.8,5.35,-30.4,42.8,-21.05,52.5,0,33.95,-10.45,6,-13.3,-35.6,-2.1}",0,4,i?-1:1,1);TracingUtils.model.photoTrace[a].status=
TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=h;TracingUtils.model.photoTrace[a].rotation=TracingUtils.model.photoTrace[j].rotation;TracingUtils.model.photoTrace[a].scaleX=TracingUtils.model.photoTrace[j].scaleX;TracingUtils.model.photoTrace[a].scaleY=TracingUtils.model.photoTrace[j].scaleY;TracingUtils.model.photoTrace[a].points=c;TracingUtils.model.photoTrace[a].pointsZ=d;TracingUtils.model.photoTrace[a].pointsA=e;TracingUtils.model.photoTrace[a].indexLeft=0;TracingUtils.model.photoTrace[a].indexRight=
4;break;case TracedArea.TRACEDAREA_COVER:TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;TracingUtils.model.photoTrace[a].location=new Point(0,0);TracingUtils.model.photoTrace[a].rotation=0;TracingUtils.model.photoTrace[a].scaleX=TracingUtils.model.photoWidth/990;TracingUtils.model.photoTrace[a].scaleY=TracingUtils.model.photoHeight/1320;break;case TracedArea.TRACEDAREA_NAILS:i=497*(faceScale()/1.6)/2;f=903*(faceScale()/1.6)/2;TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED;
TracingUtils.model.photoTrace[a].location=new Point(-TracingUtils.model.photoWidth/2+i,TracingUtils.model.photoHeight/2-f);TracingUtils.model.photoTrace[a].rotation=0;TracingUtils.model.photoTrace[a].scaleX=1;TracingUtils.model.photoTrace[a].scaleY=1;TracingUtils.model.photoTrace[a].points=[];TracingUtils.model.photoTrace[a].points.push(new Point(-i,-f));TracingUtils.model.photoTrace[a].points.push(new Point(i,-f));TracingUtils.model.photoTrace[a].points.push(new Point(i,f));TracingUtils.model.photoTrace[a].points.push(new Point(-i,
f));TracingUtils.model.photoTrace[a].pointsZ=[];TracingUtils.model.photoTrace[a].pointsZ.push(0.1);TracingUtils.model.photoTrace[a].pointsZ.push(0.1);TracingUtils.model.photoTrace[a].pointsZ.push(0.1);TracingUtils.model.photoTrace[a].pointsZ.push(0.1);TracingUtils.model.photoTrace[a].pointsA=[];TracingUtils.model.photoTrace[a].pointsZ.push(0.9);TracingUtils.model.photoTrace[a].pointsZ.push(0.9);TracingUtils.model.photoTrace[a].pointsZ.push(0.9);TracingUtils.model.photoTrace[a].pointsZ.push(0.9);TracingUtils.model.photoTrace[a].indexLeft=
0;TracingUtils.model.photoTrace[a].indexRight=2;break;default:TracingUtils.model.photoTrace[a].status=TracedArea.STATUS_GUESSED,TracingUtils.model.photoTrace[a].location=new Point(0,0),TracingUtils.model.photoTrace[a].rotation=0,TracingUtils.model.photoTrace[a].scaleX=1,TracingUtils.model.photoTrace[a].scaleY=1}}}
TracingUtils.getTraceFeatureForFeature=function(a){var c=0;switch(a){case Features.FEATURE_LIPSTICK:case Features.FEATURE_LIPGLOSS:case Features.FEATURE_LIPLINER:case Features.FEATURE_LIP_PLUMPING:case Features.FEATURE_TEETH_WHITENING:case Features.FEATURE_EYEBROW_PENCIL:case Features.FEATURE_EYEBROW_PENCIL_R:case Features.FEATURE_EYESHADOW:case Features.FEATURE_EYESHADOWC:case Features.FEATURE_EYESHADOWL:case Features.FEATURE_EYESHADOW_R:case Features.FEATURE_EYELINER:case Features.FEATURE_EYELINER_R:case Features.FEATURE_EYEBROW_THINNING:case Features.FEATURE_EYEBROW_THINNING_R:case Features.FEATURE_EYE_BRIGHTEN:case Features.FEATURE_EYE_BRIGHTEN_R:case Features.FEATURE_BLUSH:case Features.FEATURE_BLUSH_R:case Features.FEATURE_MASCARA:case Features.FEATURE_MASCARA_R:case Features.FEATURE_CYOH:case Features.FEATURE_FACE_POWDER:case Features.FEATURE_FOUNDATION:case Features.FEATURE_CONCEALER:case Features.FEATURE_CONCEALER_R:case Features.FEATURE_NOSE:case Features.FEATURE_BLEMISH_REMOVAL:c=Features.FEATURE_TRACING;
break;case Features.FEATURE_CONTACTS:case Features.FEATURE_CONTACTS_R:case Features.FEATURE_COVER:case Features.FEATURE_EARRING:case Features.FEATURE_EARRING_R:case Features.FEATURE_FACIAL_HAIR:case Features.FEATURE_GLASSES:case Features.FEATURE_HAIR:case Features.FEATURE_HAIR_COLOR:case Features.FEATURE_HEADWEAR:case Features.FEATURE_HIGHLIGHTS:case Features.FEATURE_HAIRCLIPS:case Features.FEATURE_LOWLIGHTS:case Features.FEATURE_NECKLACE:case Features.FEATURE_SCARF:case Features.FEATURE_SUNGLASSES:case Features.FEATURE_VEILS:c=
Features.FEATURE_TRACING_TARGET}return c};TracingUtils.calculateAverage=calculateAverage;
function calculateAverage(a,c,d,e,f,h){"undefined"==typeof e&&(e=1);"undefined"==typeof f&&(f=0);"undefined"==typeof h&&(h=0);e=Math.round(e);0>=e&&(e=1);var i,j,k,l,m,n,o,s,r=l=0,q=0,v=0,p=new ImageStatsVO,z=0,w=0;j=Math.round(d[0].x);var K=Math.round(d[0].y),u=Math.round(d[1].x),t=Math.round(d[1].y);1===e&&(m=u,n=j,o=t,s=K);var D=[];for(i=0;256>i;i++)D.push(0);for(i=j;i<u;i+=e)for(j=K;j<t;j+=e)if(k=c.getPixel32(i-f,j-h)>>24&255,0<k&&1===e&&(m=Math.min(m,i),n=Math.max(n,i),o=Math.min(o,j),s=Math.max(s,
j)),64<=k)k=a.getPixel(i,j),l=k>>16&255,r=k>>8&255,q=k&255,p.r.avg+=l,p.r.min=Math.min(p.r.min,l),p.r.max=Math.max(p.r.max,l),p.g.avg+=r,p.g.min=Math.min(p.g.min,r),p.g.max=Math.max(p.g.max,r),p.b.avg+=q,p.b.min=Math.min(p.b.min,q),p.b.max=Math.max(p.b.max,q),l=ColorUtils.colorToLuminance(k),p.l.avg+=l,p.l.min=Math.min(p.l.min,l),p.l.max=Math.max(p.l.max,l),D[l]++,k=ColorUtils.ColorToHSB(k),p.s.min=Math.min(p.s.min,k.saturation),p.s.max=Math.max(p.s.max,k.saturation),p.s.avg+=k.saturation,p.br.min=
Math.min(p.br.min,k.brightness),p.br.max=Math.max(p.br.max,k.brightness),p.br.avg+=k.brightness,150<k.hue&&(k.hue-=360),p.h.min=Math.min(p.h.min,k.hue),p.h.max=Math.max(p.h.max,k.hue),p.h.avg+=k.hue,20<=k.brightness&&(z+=Math.cos(k.hue/180*Math.PI),w+=Math.sin(k.hue/180*Math.PI)),v++;0<v?(p.r.avg/=v,p.g.avg/=v,p.b.avg/=v,p.h.avg=180*Math.atan2(w,z)/Math.PI,p.s.avg/=v,p.br.avg/=v,p.l.avg/=v):console.log("VME: no pixels detected in calculateAverage");1===e&&(d[0]=new Point(m,o),d[1]=new Point(n,s));
return p}TracingUtils.drawShape=function(a,c,d,e,f){if(null!=a){var h=new Sprite;h.getGraphics().beginFill(16777215);MathUtils.curveThroughPoints(h.getGraphics(),c,d,e);h.getGraphics().endFill();h.cacheAsBitmap=!0;a.draw(h,null,null,f)}};TracingUtils.drawTracedShape=drawTracedShape;
function drawTracedShape(a,c,d,e,f,h){"undefined"==typeof d&&(d=16777215);"undefined"==typeof e&&(e=1);"undefined"==typeof f&&(f=null);"undefined"==typeof h&&(h=null);var i=ModelLocator.getInstance();if(null!=a&&isTracedOrGuessed(c)){var j,k;"number"==typeof c?(j=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(i.photoTrace[c].points,c)),k=i.photoTrace[c].pointsZ,c=i.photoTrace[c].pointsA):(j=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(c.points,c)),k=c.pointsZ,c=c.pointsA);
i=new Sprite;1<e&&(f==BlendMode.ERASE?j=MathUtils.growPolygon(j,e,!0):i.getGraphics().lineStyle(e,d));(new Date).getTime();i.getGraphics().beginFill(d);MathUtils.curveThroughPoints(i.getGraphics(),j,k,c);i.getGraphics().endFill();i.cacheAsBitmap=!0;a.draw(i,h,null,f)}}TracingUtils.drawTracedShapeBlurred=drawTracedShapeBlurred;
function drawTracedShapeBlurred(a,c,d,e,f,h,i,j,k,l,m){"undefined"==typeof d&&(d=16777215);"undefined"==typeof e&&(e=1);"undefined"==typeof f&&(f=50);"undefined"==typeof h&&(h=!1);"undefined"==typeof i&&(i=0);"undefined"==typeof j&&(j=0);"undefined"==typeof k&&(k=1);"undefined"==typeof l&&(l=1);"undefined"==typeof m&&(m=null);var n,o;"number"==typeof c?(n=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(TracingUtils.model.photoTrace[c].points,c)),o=TracingUtils.model.photoTrace[c].pointsZ,
c=TracingUtils.model.photoTrace[c].pointsA):(n=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(c.points,c)),o=c.pointsZ,c=c.pointsA);for(var s=MathUtils.getBoundingBox(n),s=Math.min(MathUtils.widthFromBounds(s),MathUtils.heightFromBounds(s)),s=2+Math.abs(f)/100*(s/2/2),r=new Sprite,q=0,v=1;v<=s;v++){var p=MathUtils.growPolygon(n,-1*(v-1)*(f/(s-1)),h,k,l);if(0!=i)for(var z=0;z<n.length;z++)p[z]=MathUtils.moveVector(p[z],(v-1)/(s-1)*i,j);z=(v/s-q)/(1-q);q=v/s;r.getGraphics().beginFill(d,
z);r.getGraphics().lineStyle(e,d,z);MathUtils.curveThroughPoints(r.getGraphics(),p,o,c);r.getGraphics().endFill()}a.draw(r,m)}TracingUtils.pointToBitmapScale=pointToBitmapScale;function pointToBitmapScale(a,c,d){var e=new Point;null!=a&&(e.x=a.x,e.y=a.y);c||(c=TracingUtils.model.photoWidth);d||(d=TracingUtils.model.photoHeight);e.x+=c/2;e.y+=d/2;return e}TracingUtils.pointsToBitmapScale=pointsToBitmapScale;
function pointsToBitmapScale(a,c,d){var e=[];if(null!=a)for(var f=0;f<a.length;f++)e.push(pointToBitmapScale(a[f],c,d));return e}TracingUtils.pointFromBitmapScale=function(a){return new Point(a.x-TracingUtils.model.photoWidth/2,a.y-TracingUtils.model.photoHeight/2)};TracingUtils.pointsFromBitmapScale=pointsFromBitmapScale;function pointsFromBitmapScale(a){var c=[];if(null!=a)for(var d=0;d<a.length;d++)c.push(TracingUtils.pointFromBitmapScale(a[d]));return c}TracingUtils.pointsToBounds=pointsToBounds;
function pointsToBounds(a,c){var d=[];if(null!=a)for(var e=0;e<a.length;e++)d.push(new Point(a[e].x-c[0].x,a[e].y-c[0].y));return d}TracingUtils.confineBounds=confineBounds;
function confineBounds(a){var c=[],d=a[0],a=a[1];d.x=Math.max(d.x,0);d.y=Math.max(d.y,0);a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);d.x=Math.min(d.x,TracingUtils.model.photoWidth-1);d.y=Math.min(d.y,TracingUtils.model.photoHeight-1);a.x=Math.min(a.x,TracingUtils.model.photoWidth-1);a.y=Math.min(a.y,TracingUtils.model.photoHeight-1);c.push(d);c.push(a);return c}
function findHistogramRange(a,c,d,e){var f;f=e?0:a.length-1;for(var h=0,i=0,c=Math.round(c/100*d);i<c;)i+=a[f],h+=a[f]*f,f=e?f+1:f-1;return h/i}function getBoundsForTracedArea(a){a=pointsToBitmapScale(pointsToAbsolute(TracingUtils.model.photoTrace[a].points,a));a=MathUtils.getBoundingBox(a);return a=TracingUtils.confineBounds(a)}function findIntersections(a,c,d){for(var e=[],f=0;f<a.length-1;f++){var h=MathUtils.lineIntersect(a[f],a[f+1],c,d,!0);null!=h&&e.push(h)}return e}
TracingUtils.scanPhoto=scanPhoto;
function scanPhoto(){var a={},c=TracingUtils.model.photoBitmapData.clone();TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_FACE);var d=new BitmapData(TracingUtils.model.photoWidth,TracingUtils.model.photoHeight,!0,0);TracingUtils.drawTracedShape(d,TracedArea.TRACEDAREA_FACE);var e=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_FACE].points,TracedArea.TRACEDAREA_FACE)),f=MathUtils.getBoundingBox(e),f=MathUtils.confineBounds(f,new Point(1,
1),new Point(TracingUtils.model.photoWidth-1,TracingUtils.model.photoHeight-1)),h=Math.max(MathUtils.widthFromBounds(f)/20,5),i=f[0].x,j=f[1].x,k=f[0].y,l=f[1].y,m,n,o=0,s=0,r=[],q=0,v=0,p=0,z=0,w=new BitmapData(TracingUtils.model.photoWidth,TracingUtils.model.photoHeight,!0,0);for(m=0;100>=m;m++)r.push(0);var K=0,u,t,D;for(m=i;m<=j;m+=h)for(n=k;n<=l;n+=h)if(u=d.getPixel(m,n)&255,255==u){t=c.getPixel(m,n);var A=c.getPixel(m-1,n),K=Math.max(K,Math.abs((A&255)-(t&255)),Math.abs((A>>8&255)-(t>>8&255)),
Math.abs((A>>16&255)-(t>>16&255))),B=c.getPixel(m,n-1),K=Math.max(K,Math.abs((B&255)-(t&255)),Math.abs((B>>8&255)-(t>>8&255)),Math.abs((B>>16&255)-(t>>16&255)));D=ColorUtils.ColorToHSB(t);s+=D.saturation;r[Math.round(D.brightness)]++;v+=t>>16&255;p+=t>>8&255;z+=t&255;o++}var s=0<o?s/o:0,F=findHistogramRange(r,o,3,!0),C=findHistogramRange(r,o,3,!1),G=0;for(m=0;100>=m;m++)G+=r[m]*m;var G=0<o?G/o:0,N=0,H="";if(0<o)var N=Math.round(v/o)<<16|Math.round(p/o)<<8|Math.round(z/o),O=ColorUtils.ColorToHSB(N),
q=O.hue,H=63>=O.brightness?"dark":78>=O.brightness?"medium":85>=O.brightness?"fair":"very fair";var L=new ImageAdjustVO;L.avgSaturation=s;L.avgHue=q;L.dark=F;L.mid=G;L.light=C;30>L.avgSaturation&&(L.adjustS_mul=L.avgSaturation/30);if(180<L.avgHue){var M=L.avgHue-180;L.adjustRmul=0.5+M/360;L.adjustGmul=0.5+M/360}70>L.light&&(L.adjustB_mul=L.light/70);var P=0,Q=0,U=0,E=0,R="";if(isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)){var I,J,T=getBoundsForTracedArea(TracedArea.TRACEDAREA_EYE_LEFT);drawTracedShape(w,
TracedArea.TRACEDAREA_EYE_LEFT);if(isTraced(TracedArea.TRACEDAREA_CONTACT_LEFT)){var V=pointToBitmapScale(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_CONTACT_LEFT].location),W=V.x,Xa=V.y,qb=TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_CONTACT_LEFT].scaleX,$a=0,Ya=0;for(J=T[0].y;J<=T[1].y;J++)for(I=T[0].x;I<=T[1].x;I++){var za=Math.sqrt((W-I)*(W-I)+(Xa-J)*(Xa-J));za>14*qb||za<7*qb?w.setPixel32(I,J,0):(ia=ColorUtils.colorToLuminance(c.getPixel(I,J)),$a+=ia,Ya++)}if(0<Ya){$a/=Ya;for(J=
T[0].y;J<=T[1].y;J++)for(I=T[0].x;I<=T[1].x;I++)ia=ColorUtils.colorToLuminance(c.getPixel(I,J)),(ia<$a-15||ia>$a+15)&&w.setPixel32(I,J,0)}}else{var Da=T[1].x-T[0].x,La=T[1].y-T[0].y,ia,da=0,ta=0;for(J=T[0].y;J<=T[1].y;J++)for(I=T[0].x;I<=T[0].x+Da/4;I++)4294967295==w.getPixel32(I,J)&&(ia=ColorUtils.colorToLuminance(c.getPixel(I,J)),da+=ia,ta++);var ab=0,ua=0;for(J=T[0].y;J<=T[1].y;J++)for(I=Math.floor(T[0].x+3*(Da/8));I<=Math.floor(T[0].x+5*(Da/8));I++)4294967295==w.getPixel32(I,J)&&(ia=ColorUtils.colorToLuminance(c.getPixel(I,
J)),ab+=ia,ua++);var Oa=0,ga=0;for(J=T[0].y;J<=T[1].y;J++)for(I=T[1].x-Da/4;I<=T[1].x;I++)4294967295==w.getPixel32(I,J)&&(ia=ColorUtils.colorToLuminance(c.getPixel(I,J)),Oa+=ia,ga++);var P=da/ta,Q=ab/ua,U=Oa/ga,ra=(P+U)/2,ra=ra<Q+20?250:Math.round(Math.min(P,U)),va=Math.round(Q/4),aa;for(I=T[0].x;I<=T[1].x;I++){aa=0;for(J=T[0].y;J<=T[1].y;J++){var Ta=c.getPixel(I,J);4294967295==w.getPixel32(I,J)&&(ia=ColorUtils.colorToLuminance(Ta),ia>va&&ia<ra?aa++:ia>ra?w.setPixel32(I,J,4278255360):w.setPixel32(I,
J,0))}if(0<aa&&aa<La/2)for(J=T[0].y;J<=T[1].y;J++)w.setPixel32(I,J,0)}}var hb=TracingUtils.calculateAverage(c,w,T,1),E=averageColor(hb),Aa=ColorUtils.ColorToHSB(E),R=70<=Aa.hue&&120>=Aa.hue&&30<=Aa.brightness&&10<Aa.saturation?"green":190<=Aa.hue&&290>=Aa.hue&&30<=Aa.brightness?"blue":20>Aa.saturation?"gray":38<=Aa.brightness?40<=Aa.hue?"hazel":"lightbrown":30<=Aa.brightness?"darkbrown":"black"}guessTracedArea(TracedArea.TRACEDAREA_EYEBROW_LEFT);isTracedOrGuessed(TracedArea.TRACEDAREA_EYEBROW_LEFT);
var wa=1,ma,Fa="normal";if(isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS)){var fa=getPointsAlongTracedArea(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS],!0,!1,100,!1),Ua=0,Ga=getPointsAlongTracedArea(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS],!1,!1,100,!1),na=0;for(ma=0;ma<fa.length;ma++)Ua+=fa[ma].y,na+=Ga[ma].y;var eb=Math.abs(Ua/fa.length),ib=Math.abs(na/Ga.length);if(isTracedOrGuessed(TracedArea.TRACEDAREA_TEETH)){var rb=getPointsAlongTracedArea(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH],
!0,!1,100,!1),lb=getPointsAlongTracedArea(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_TEETH],!1,!1,100,!1);for(ma=na=Ua=0;ma<rb.length;ma++)Ua+=rb[ma].y,na+=lb[ma].y;eb-=Math.abs(Ua/fa.length);ib-=Math.abs(na/Ga.length)}var Ea=Math.abs(eb)+Math.abs(ib),wa=4.6/(Point.distance(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexLeft],TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexRight])/
Ea);0.8>wa?Fa="thin":1.2>wa&&(Fa="full")}var S=0,oa=0,Pa=1,ea=1,ca=1,jb=1,Y=getAllPointsAlongTracedArea(TracedArea.TRACEDAREA_FACE,100,!0),bb=pointToBitmapScale(pointToAbsolute(new Point(0,0),TracedArea.TRACEDAREA_EYE_LEFT)),X=pointToBitmapScale(pointToAbsolute(new Point(0,0),TracedArea.TRACEDAREA_EYE_RIGHT)),pa=Point.distance(pointToBitmapScale(pointToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].indexLeft],
TracedArea.TRACEDAREA_EYE_LEFT)),pointToBitmapScale(pointToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].indexRight],TracedArea.TRACEDAREA_EYE_LEFT))),qa=Point.distance(pointToBitmapScale(pointToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].indexLeft],TracedArea.TRACEDAREA_EYE_RIGHT)),pointToBitmapScale(pointToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].indexRight],
TracedArea.TRACEDAREA_EYE_RIGHT))),ja=Math.round(Point.distance(bb,X)),Qa=(pa+qa)/2/ja,Ra=MathUtils.lineRotation(bb,X),Va=MathUtils.moveVector(bb,ja,Ra+180),Wa=MathUtils.moveVector(X,ja,Ra),ka=findIntersections(Y,Va,Wa);if(2<=ka.length)var oa=Point.distance(ka[0],ka[ka.length-1]),ea=ja/oa/0.46,Ha=pointToBitmapScale(pointToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexLeft],TracedArea.TRACEDAREA_LIPS)),Ia=pointToBitmapScale(pointToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].points[TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_LIPS].indexRight],
TracedArea.TRACEDAREA_LIPS)),Ja=Math.round(Point.distance(Ha,Ia)),Ma=isTracedOrGuessed(TracedArea.TRACEDAREA_TEETH)?1.35:1,ca=Ja/oa/Ma/0.363;else console.log("VME: unable to determine face width");var sa="medium";0.5>TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_LEFT].rotation-TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_EYE_RIGHT].rotation?sa="downturned":0.95>=ea?sa="close-set":1.05<=ea?sa="wide-set":0.49<=Qa?sa="big":0.4>=Qa&&(sa="small");var Ba=pointToBitmapScale(pointToAbsolute(new Point(0,
0),TracedArea.TRACEDAREA_LIPS)),la=MathUtils.pointBetween(bb,X),fb=Point.distance(la,Ba),wb=MathUtils.lineRotation(la,Ba),vb=MathUtils.moveVector(la,2*fb,wb-180),xb=MathUtils.moveVector(Ba,2*fb,wb),ka=findIntersections(Y,vb,xb);if(2==ka.length){var S=Math.round(Point.distance(ka[0],ka[1])),xa=Math.round(Point.distance(ka[0],la)),Pa=0.575/(xa/S);Math.round(Point.distance(ka[0],Ba));jb=xa/S/0.58}else console.log("VME: unable to determine face height");var cb=1;0<S&&0<oa&&(cb=S/oa/1.42);var mb="oval";
1.2<cb&&(mb="long");for(var Z=0;Z<Y.length;Z++)w.setPixel32(Y[Z].x,Y[Z].y,4278255360);L.faceSize=Math.min((oa+S)/2/75);L.sharpnessIndex=K/L.faceSize;var yb=imageAdjustScore(L);L.adjustOpacity_mul=MathUtils.range(0.25+(yb.overallScore-1)/4.6,0.25,1);for(var ha=0,Na=new BitmapData(c.width,c.height,!0,4294967295),Ca=ja/2,Sa=new Point(la.x,la.y),Za=!1,kb=getAvgSkinColor(),zb=ColorUtils.ColorToHSB(kb),Ab=4,Ka=null;!Za;)if(Sa=MathUtils.moveVector(Sa,Ca,wb-180),f[0].x=Sa.x-Ca/2,f[0].y=Sa.y-Ca/2,f[1].x=Sa.x+
Ca/2,f[1].y=Sa.y+Ca/2,0>f[1].x||0>f[1].y||f[0].x>TracingUtils.model.photoWidth||f[0].y>TracingUtils.model.photoHeight)Za=!0;else{for(ma=0;ma<Ca;ma++)w.setPixel32(f[0].x+ma,f[0].y,4294967295),w.setPixel32(f[0].x+ma,f[1].y,4294967295),w.setPixel32(f[0].x,f[0].y+ma,4294967295),w.setPixel32(f[1].x,f[0].y+ma,4294967295);var Gb=calculateAverage(c,Na,f,1),ha=averageColor(Gb),Ka=ColorUtils.ColorToHSB(ha),Hb=Math.abs(zb.hue-Ka.hue),Ib=Math.abs(zb.saturation-Ka.saturation);Ab--;Za=0==Ab||12<Hb||12<Ib}var Bb=
"";null!=Ka&&(Bb=30<=Ka.hue&&60>=Ka.hue&&75<=Ka.brightness&&15>Ka.saturation?"gray":30<=Ka.hue&&60>=Ka.hue&&60<=Ka.brightness?"blonde":0<Ka.hue&&30>=Ka.hue&&45<=Ka.saturation?"red":23>=Ka.brightness?"black":"medium brown");for(J=0;J<Ca;J++)for(I=0;I<Ca;I++)w.setPixel32(I,J,4278190080+N),w.setPixel32(I+Ca,J,4278190080+kb),w.setPixel32(I+2*Ca,J,4278190080+ha);var sb=!0,tb="";if(150>oa||150>S)sb=!1,tb="face too small";if(30>G||60>C)sb=!1,tb="too dark";70<F&&(sb=!1,tb="too bright");1>=s&&(sb=!1,tb="too desaturated");
a.photoUsable=sb;a.photoUsableReason=tb;a.faceRatio=cb;a.lipsThicknessRatio=wa;a.eyePositionRatio=Pa;a.eyeDistanceRatio=ea;a.lipsWidthRatio=ca;a.lipsPositionRatio=jb;a.eyeColor=R;a.eyeColorHex=E;a.hairColorHex=ha;a.hairColor=Bb;a.skinColorHex=N;a.skinColor=H;a.eyeShape=sa;a.lipShape=Fa;a.faceShape=mb;TracingUtils.model.looks[TracingUtils.model.currentLook].imageAdjust=L;TracingUtils.model.isDebug&&(TracingUtils.model.stageMain.debug("saturation: "+MathUtils.roundTo(s,2),NaN,NaN,!0),TracingUtils.model.stageMain.debug("darkRange: "+
MathUtils.roundTo(F,2)),TracingUtils.model.stageMain.debug("avg. lightness: "+MathUtils.roundTo(G,2)),TracingUtils.model.stageMain.debug("liteRange: "+MathUtils.roundTo(C,2)),TracingUtils.model.stageMain.debug("hue: "+MathUtils.roundTo(q,2)),TracingUtils.model.stageMain.debug(""),1==L.adjustS_mul?TracingUtils.model.stageMain.debug("Correct saturation: NO CHANGE"):TracingUtils.model.stageMain.debug("Correct saturation: "+Math.round(100*(1-L.adjustS_mul))+"%"),1==L.adjustRmul?TracingUtils.model.stageMain.debug("Correct hue: NO CHANGE"):
TracingUtils.model.stageMain.debug("Correct hue: "+Math.round(100*(1-L.adjustRmul))+"%"),1==L.adjustB_mul?TracingUtils.model.stageMain.debug("Correct brightness: NO CHANGE"):TracingUtils.model.stageMain.debug("Correct brightness: "+Math.round(100*(1-L.adjustB_mul))+"%"));return a}TracingUtils.imageAdjustScore=imageAdjustScore;
function imageAdjustScore(a){var c={};c.sharpnessScore=MathUtils.range(a.sharpnessIndex-5,1,5);var d=MathUtils.range(Math.abs(5-parseInt(a.avgHue/30)),1,5),e=MathUtils.range(Math.round(a.avgSaturation/6),1,5);c.colorScore=(d+e)/2;c.contrastScore=MathUtils.range((a.light-a.dark)/15,1,5);c.sizeScore=MathUtils.range(a.faceSize,1,5);c.overallScore=(c.sharpnessScore+c.colorScore+c.contrastScore+c.sizeScore)/4;return c}TracingUtils.globalColorAdjust=globalColorAdjust;
function globalColorAdjust(a){var c=TracingUtils.model.looks[TracingUtils.model.currentLook].imageAdjust;if(null!=c){if(1!=c.adjustS_mul||1!=c.adjustB_mul)var d=ColorUtils.ColorToHSB(a),a=ColorUtils.HSBtoColor(d.hue,d.saturation*c.adjustS_mul,d.brightness*c.adjustB_mul);if(1!=c.adjustRmul||1!=c.adjustGmul||1!=c.adjustBmul){var e,d=(a>>16&255)*c.adjustRmul;e=(a>>8&255)*c.adjustGmul;c=(a&255)*c.adjustBmul;a=d<<16|e<<8|c}}return a}TracingUtils.globalOpacityAdjust=globalOpacityAdjust;
function globalOpacityAdjust(a){var c=TracingUtils.model.looks[TracingUtils.model.currentLook].imageAdjust;null!=c&&1!=c.adjustOpacity_mul&&(a=MathUtils.range(a*c.adjustOpacity_mul,0,1));return a}TracingUtils.globalImageAdjust=globalImageAdjust;
function globalImageAdjust(){var a=TracingUtils.model.looks[TracingUtils.model.currentLook].imageAdjust,c=null;if(null!=a&&(1!=a.adjustS_mul||1!=a.adjustB_mul||1!=a.adjustRmul||1!=a.adjustGmul||1!=a.adjustBmul))var c=a.adjustS_mul,d=1-c,e=a.adjustB_mul,c=[new ColorMatrixFilter([(0.299*d+c)*a.adjustRmul*e,0.587*d,0.114*d,0,0,0.299*d,(0.587*d+c)*a.adjustGmul*e,0.114*d,0,0,0.299*d,0.587*d,(0.114*d+c)*a.adjustBmul*e,0,0,0,0,0,1,0])];return c}TracingUtils.isPointVisible=isPointVisible;
function isPointVisible(a){var c=!1;if(null!=a&&TracingUtils.model.hasPhoto){var d=TracingUtils.model.parentWidth,e=TracingUtils.model.parentHeight,f,c=-(d/2)-TracingUtils.model.stageHorizontalCenter;f=-(e/2)-TracingUtils.model.stageVerticalCenter;c/=TracingUtils.model.stageScaleX;f/=TracingUtils.model.stageScaleY;d=+(d/2)-TracingUtils.model.stageHorizontalCenter;e=+(e/2)-TracingUtils.model.stageVerticalCenter;d/=TracingUtils.model.stageScaleX;e/=TracingUtils.model.stageScaleY;c=a.x>=c&&a.x<=d&&a.y>=
f&&a.y<=e}return c}TracingUtils.isFeatureVisible=isFeatureVisible;function isFeatureVisible(){return!1}TracingUtils.spriteToTracedAreaVO=spriteToTracedAreaVO;function spriteToTracedAreaVO(a){var c=new TracedAreaVO;c.location=new Point(a.x,a.y);c.rotation=a.rotation;c.scaleX=a.scaleX;c.scaleY=a.scaleY;return c}TracingUtils.pointToAbsolute=pointToAbsolute;
function pointToAbsolute(a,c){var d;null!=a&&(d=new Point(a.x,a.y),"number"==typeof c?(d.x*=TracingUtils.model.photoTrace[c].scaleX,d.y*=TracingUtils.model.photoTrace[c].scaleY,d=MathUtils.rotatePoint(d,TracingUtils.model.photoTrace[c].rotation),d.x+=TracingUtils.model.photoTrace[c].location.x,d.y+=TracingUtils.model.photoTrace[c].location.y):c instanceof TracedAreaVO&&(d.x*=c.scaleX,d.y*=c.scaleY,d=MathUtils.rotatePoint(d,c.rotation),d.x+=c.location.x,d.y+=c.location.y));return d}
TracingUtils.pointsToAbsolute=pointsToAbsolute;function pointsToAbsolute(a,c){var d;if(null!=a){d=[];for(var e=0;e<a.length;e++)d.push(pointToAbsolute(a[e],c))}return d}
TracingUtils.pointToRelative=function(a,c){var d;null!=a&&(d=new Point(a.x,a.y),c instanceof Number||"number"==typeof c?(d.x-=TracingUtils.model.photoTrace[c].location.x,d.y-=TracingUtils.model.photoTrace[c].location.y,d=MathUtils.rotatePoint(d,-TracingUtils.model.photoTrace[c].rotation),d.x/=TracingUtils.model.photoTrace[c].scaleX,d.y/=TracingUtils.model.photoTrace[c].scaleY):c instanceof TracedAreaVO&&(d.x-=c.location.x,d.y-=c.location.y,d=MathUtils.rotatePoint(d,-c.rotation),d.x/=c.scaleX,d.y/=
c.scaleY));return d};TracingUtils.pointsToRelative=function(a,c){var d;if(null!=a){d=[];for(var e=0;e<a.length;e++)d.push(TracingUtils.pointToRelative(a[e],c))}return d};TracingUtils.addStageChild=function(a,c){for(var d=0;d<a.length&&!(a[d].weight>c.weight);)d++;a.splice(d,0,c)};
TracingUtils.getNextInstanceIndex=function(a){var c=TracingUtils.model.looks[TracingUtils.model.currentLook].stageChildren,d,e=-1,f;for(d=0;d<c.length;d++)f=c[d],f.feature==a&&f.instanceIndex>e&&(e=f.instanceIndex);return e+1};TracingUtils.addStageChild=function(a,c){for(var d=0;d<a.length&&!(a[d].weight>c.weight);)d++;a.splice(d,0,c)};
TracingUtils.getNextInstanceIndex=function(a){var c=TracingUtils.model.looks[TracingUtils.model.currentLook].stageChildren,d,e=-1,f;for(d=0;d<c.length;d++)f=c[d],f.feature==a&&f.instanceIndex>e&&(e=f.instanceIndex);return e+1};
TracingUtils.findWeight=function(a){for(var c=TracingUtils.model.looks[TracingUtils.model.currentLook].stageChildren,d=null,e=0,f=!1,a=TracingUtils.model.defaultFeatureWeight[a];e<c.length&&!f;){var d=c[e],h=TracingUtils.model.defaultFeatureWeight[d.feature];if(a<h)f=!0,a=0==e?d.weight-1E3:(d.weight+c[e-1].weight)/2;else if(a==h){for(var f=!0,h=d.weight,i=0;i<c.length;i++)d=c[i],a==TracingUtils.model.defaultFeatureWeight[d.feature]&&d.weight>h&&(h=d.weight);a=h}else e++}!f&&0<c.length&&(a=c[c.length-
1].weight+1E3);return a};
TracingUtils.findStageChildren=function(a,c,d,e,f,h){"undefined"==typeof a&&(a=-1);"undefined"==typeof c&&(c=-1);"undefined"==typeof d&&(d=Features.SIDE_BOTH);"undefined"==typeof e&&(e=!0);"undefined"==typeof f&&(f="");"undefined"==typeof h&&(h=0);var i=[],j=TracingUtils.model.looks[TracingUtils.model.currentLook].stageChildren,k=null,l=TracingUtils.getFeatureOtherSide(a),m=TracingUtils.isFeatureTwoSided(a);d==Features.SIDE_LEFT?TracingUtils.isFeatureRightSide(a)&&(a=TracingUtils.getFeatureOtherSide(a)):d==
Features.SIDE_RIGHT&&TracingUtils.isFeatureLeftSide(a)&&(a=TracingUtils.getFeatureOtherSide(a));for(var n=0;n<j.length;n++){var k=j[n],o=!1;if(-1==a)o=!0;else{var s=!1;if((s=!m||d!=Features.SIDE_BOTH?k.feature==a:k.feature==a||k.feature==l)&&(-1==c||k.instanceIndex==c))""!=f?null!=k.makeoverItem&&(s=JSON.parse(k.makeoverItem.parameters),null!=s&&(null!=s[f]&&s[f]==h)&&(o=!0)):o=!0}o&&i.push(k)}if(0==i.length)if(e&&0<a){if(k=new StageChildVO,k.feature=a,k.instanceIndex=-1==c?TracingUtils.getNextInstanceIndex(a):
c,k.weight=TracingUtils.findWeight(a),""!=f&&(k.makeoverItem=new MakeoverItemVO,a={},a[f]=h,k.makeoverItem.parameters=JSON.stringify(a),"tracedArea"==f&&(h==TracedArea.TRACEDAREA_TEETH?k.weight++:k.weight--)),TracingUtils.addStageChild(j,k),i.push(k),m&&d==Features.SIDE_BOTH&&0!=l)a=l,k=new StageChildVO,k.feature=a,k.instanceIndex=-1==c?TracingUtils.getNextInstanceIndex(a):c,k.weight=TracingUtils.findWeight(a),TracingUtils.addStageChild(j,k),i.push(k)}else i=null;return i};
TracingUtils.absoluteLength=absoluteLength;function absoluteLength(a){switch(a){case TracedArea.TRACEDAREA_EYE_LEFT:case TracedArea.TRACEDAREA_EYE_RIGHT:a=70;break;case TracedArea.TRACEDAREA_LIPS:a=120;break;case TracedArea.TRACEDAREA_EYEBROW_LEFT:case TracedArea.TRACEDAREA_EYEBROW_RIGHT:a=105;break;default:a=100}return a}TracingUtils.faceScale=faceScale;function faceScale(){return faceScaleArray()[0]}TracingUtils.faceScaleX=faceScaleX;function faceScaleX(){return faceScaleArray()[1]}
TracingUtils.faceScaleY=faceScaleY;function faceScaleY(){return faceScaleArray()[2]}TracingUtils.faceScaleArray=faceScaleArray;
function faceScaleArray(){var a,c,d,e,f=0;isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_LEFT)&&(f=TracedArea.TRACEDAREA_EYE_LEFT,a=TracingUtils.model.photoTrace[f].location);isTracedOrGuessed(TracedArea.TRACEDAREA_EYE_RIGHT)&&(f=TracedArea.TRACEDAREA_EYE_RIGHT,c=TracingUtils.model.photoTrace[f].location);isTracedOrGuessed(TracedArea.TRACEDAREA_LIPS)&&(f=TracedArea.TRACEDAREA_LIPS,e=TracingUtils.model.photoTrace[f].location);var h=NaN,i=NaN,j=NaN,k=NaN;null!=a&&null!=c&&(h=Point.distance(a,c),d=MathUtils.pointBetween(a,
c,50));null!=d&&null!=e&&(i=Point.distance(d,e));null!=a&&null!=e&&(j=Point.distance(a,e));null!=c&&null!=e&&(k=Point.distance(c,e));d=c=a=1;isNaN(h)?(isNaN(j)?isNaN(k)?0<f&&(a=TracingUtils.model.photoTrace[f].scaleX):a=k/183:a=j/183,d=c=a=Math.max(a,0.1)):(c=Math.round(1E3*(h/151.8))/1E3,isNaN(i)?a=d=c:(d=Math.round(1E3*(i/164.6))/1E3,a=(c+d)/2));return[a,c,d]}TracingUtils.getTracedAreaVO=getTracedAreaVO;
function getTracedAreaVO(a){var c=TracingUtils.model.photoTrace[a];switch(a){case TracedArea.TRACEDAREA_LIPS:null!=TracingUtils.model.modifiedLipsTrace&&(c=TracingUtils.model.modifiedLipsTrace);break;case TracedArea.TRACEDAREA_EYEBROW_LEFT:null!=TracingUtils.model.modifiedEyebrowLeftTrace&&(c=TracingUtils.model.modifiedEyebrowLeftTrace);break;case TracedArea.TRACEDAREA_EYEBROW_RIGHT:null!=TracingUtils.model.modifiedEyebrowRightTrace&&(c=TracingUtils.model.modifiedEyebrowRightTrace)}return c}
TracingUtils.averageColor=averageColor;function averageColor(a){return Math.round(a.r.avg)<<16|Math.round(a.g.avg)<<8|Math.round(a.b.avg)}TracingUtils.getAvgSkinColor=getAvgSkinColor;
function getAvgSkinColor(){var a=new BitmapData(TracingUtils.model.photoWidth,TracingUtils.model.photoHeight,!0,16777215);TracingUtils.drawTracedShape(a,TracedArea.TRACEDAREA_FACE);TracingUtils.drawTracedShape(a,getTracedAreaVO(TracedArea.TRACEDAREA_LIPS),0,9*faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(a,TracedArea.TRACEDAREA_TEETH,0,9*faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(a,TracedArea.TRACEDAREA_EYE_LEFT,0,9*faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(a,
TracedArea.TRACEDAREA_EYE_RIGHT,0,9*faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(a,getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_LEFT),0,9*faceScale(),BlendMode.ERASE);TracingUtils.drawTracedShape(a,getTracedAreaVO(TracedArea.TRACEDAREA_EYEBROW_RIGHT),0,9*faceScale(),BlendMode.ERASE);var c=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(TracingUtils.model.photoTrace[TracedArea.TRACEDAREA_FACE].points,TracedArea.TRACEDAREA_FACE)),c=MathUtils.getBoundingBox(c),c=MathUtils.confineBounds(c,
new Point(0,0),new Point(TracingUtils.model.photoWidth-1,TracingUtils.model.photoHeight-1)),a=TracingUtils.calculateAverage(TracingUtils.model.photoBitmapData,a,c,10);return a.r.avg<<16|a.g.avg<<8|a.b.avg}TracingUtils.isAcceptableSkinColor=isAcceptableSkinColor;function isAcceptableSkinColor(){var a=ColorUtils.ColorToHSB(color),c=!0;5>a.brightness||95<a.brightness?c=!1:60<=a.hue&&300>=a.hue&&(c=!1);return c}TracingUtils.getEdges=getEdges;
function getEdges(a,c,d,e,f){var h;switch(a){case 0:h=[1,2,1,0,0,0,-1,-2,-1];break;case 1:h=[-1,-2,-1,0,0,0,1,2,1];break;case 2:h=[1,0,-1,2,0,-2,1,0,-1];break;case 3:h=[-1,0,1,-2,0,2,-1,0,1]}a=e-c+1;f=f-d+1;h=new ConvolutionFilter(3,3,h,1);e=new BitmapData(a,f);e.copyPixels(TracingUtils.model.photoBitmapData,new Rectangle(c,d,a,f),new Point(0,0));e.applyFilter(e,new Rectangle(0,0,a,f),h);return e}TracingUtils.getEdgesByteArray=getEdgesByteArray;
function getEdgesByteArray(a,c,d,e,f){a=getEdges(a,c,d,e,f);return a.getPixels(a.rect)}TracingUtils.combine=combine;function combine(a,c){for(var d=0;d<a.imageData.data.length;d+=4){var e=Math.round(0.299*c.imageData.data[d]+0.587*c.imageData.data[d+1]+0.114*c.imageData.data[d+2]),e=Math.max(a.imageData.data[d],e);a.imageData.data[d]=e;a.imageData.data[d+1]=e;a.imageData.data[d+2]=e}}TracingUtils.combineByteArrays=combineByteArrays;
function combineByteArrays(a,c,d,e){var f=new ByteArray;a.setPosition(0);c.setPosition(0);d.setPosition(0);e.setPosition(0);for(var h=a.length/4;0<h--;){var i=Math.max(ColorUtils.colorToLuminance(a.readUnsignedInt()),ColorUtils.colorToLuminance(c.readUnsignedInt()),ColorUtils.colorToLuminance(d.readUnsignedInt()),ColorUtils.colorToLuminance(e.readUnsignedInt()));f.writeUnsignedInt(4278190080|i<<16|i<<8|i)}return f}TracingUtils.buildHistogram=buildHistogram;
function buildHistogram(a,c,d){"undefined"==typeof c&&(c=null);"undefined"==typeof d&&(d=null);var e=[],f,h;for(f=0;255>=f;f++)e.push(0);var i,j;null==d?(f=0,i=a.width,j=0,d=a.height):(f=d[0].x,i=d[1].x,j=d[0].y,d=d[1].y);var k;if(null==c)for(;f<i;f++)for(h=j;h<d;h++)k=a.getPixel(f,h)&255,e[k]++;else for(;f<i;f++)for(h=j;h<d;h++)c.getPixel(f,h)&1&&(k=a.getPixel(f,h)&255,e[k]++);return e}TracingUtils.findThreshold=findThreshold;
function findThreshold(a,c){for(var d=256,e=0,f=0,h=0;h<a.length;h++)f+=a[h];for(;e<f/100*c&&0<=d;)d--,e+=a[d];return d}TracingUtils.arrayToPoints=arrayToPoints;function arrayToPoints(a,c){"undefined"==typeof c&&(c=!1);var d=[];if(null!=a)for(var e=0;e<a.length;e+=2)d.push(new Point(a[e]*(c?-1:1),a[e+1]));return d}TracingUtils.createThicknessArray=createThicknessArray;
function createThicknessArray(a,c){for(var d=[],e,f,h,i,j=0;j<a.length;j++)if(e=f,h=i,f=Math.round((c-1)/100*a[j][0]),i=a[j][1],0<j)for(var k=i-h,l=f-e,m=e;m<f;m++)d.push(h+k/l*(m-e));d.push(i);return d}TracingUtils.curveBackwards=curveBackwards;
function curveBackwards(a,c,d,e,f,h){var i,j=c.length;if(0!=e)for(i=0;i<c.length;i++)c[i]=MathUtils.moveVector(c[i],e,TracingUtils.model.photoTrace[a].rotation-90);d=createThicknessArray(d,j);for(i=0;i<j;i++){e=MathUtils.range(j-1-i,1,j-2);e=MathUtils.lineRotation(c[e-1],c[e+1]);e=MathUtils.moveVector(c[j-1-i],d[i],e+TracingUtils.model.photoTrace[a].rotation+(f?90:-90));if(0==i){var k=MathUtils.pointBetween(c[j-1],e);c.push(MathUtils.moveVector(k,Point.distance(c[j-1],e)/2,MathUtils.lineRotation(c[j-
1],e)+(f==h?-90:90)))}c.push(e)}}TracingUtils.getCurvePointsTracedArea=getCurvePointsTracedArea;
function getCurvePointsTracedArea(a,c){"undefined"==typeof c&&(c=5);var d=[];if(null!=a&&null!=a.points)for(var e=MathUtils.calcControlPoints(a.points.concat(a.points[0]),a.pointsZ.concat(a.pointsZ[0]),a.pointsA.concat(a.pointsA[0])),f=0;f<a.points.length;f++)for(var h=a.points[f],i=e[f][1],j=e[f+1][0],k=a.points[(f+1)%a.points.length],l=h.x,h=h.y,m=i.x-l,i=i.y-h,n=j.x-l,j=j.y-h,o=k.x-l,k=k.y-h,s=0;s<=c;s++){var r=s/c;d.push(new Point((r*r*o+3*(1-r)*(r*n+(1-r)*m))*r+l,(r*r*k+3*(1-r)*(r*j+(1-r)*i))*
r+h))}return d}TracingUtils.getPointsAlongCurve=getPointsAlongCurve;
function getPointsAlongCurve(a,c,d,e){for(var c=MathUtils.calcControlPoints(a,c,d),f,h,i,j,k,l,m,n,o=[],s=0,r=0;r<a.length-2;r++){f=a[r];h=c[r][1];i=c[r+1][0];j=a[r+1];d=f.x;f=f.y;k=h.x-d;h=h.y-f;l=i.x-d;i=i.y-f;m=j.x-d;j=j.y-f;for(var q=d,v=f,p,z=1;100>=z;z++)n=z/100,p=(n*n*m+3*(1-n)*(n*l+(1-n)*k))*n+d,n=(n*n*j+3*(1-n)*(n*i+(1-n)*h))*n+f,q-=p,v-=n,v=Math.sqrt(q*q+v*v),o.push(v),s+=v,q=p,v=n}r=[];s/=e-1;for(q=v=z=p=0;q<e-1;q++){f=a[p];h=c[p][1];i=c[p+1][0];j=a[p+1];d=f.x;f=f.y;k=h.x-d;h=h.y-f;l=i.x-
d;i=i.y-f;m=j.x-d;j=j.y-f;n=z/100;for(r.push(new Point((n*n*m+3*(1-n)*(n*l+(1-n)*k))*n+d,(n*n*j+3*(1-n)*(n*i+(1-n)*h))*n+f));v<s;)v+=o[100*p+z],z++,100==z&&(p++,z=0,100*p>=o.length&&(v=s));v-=s}3<=a.length&&(f=a[a.length-3+1],r.push(new Point(f.x,f.y)));return r}TracingUtils.getTopBottomPointsTracedArea=getTopBottomPointsTracedArea;
function getTopBottomPointsTracedArea(a,c,d,e,f,h){var i,d=a.indexLeft,j=a.indexRight;if(d==j)for(;3>i;i++)e.push(a.points[d]),f.push(a.pointsZ[d]),h.push(a.pointsA[d]);else{d>j&&(d=a.indexRight,j=a.indexLeft);c?(i=d,c=j+1):(i=j,c=a.points.length+d+1);for(;i<=c;i++)d=i%a.points.length,e.push(a.points[d]),f.push(a.pointsZ[d]),h.push(a.pointsA[d])}}TracingUtils.getPointsAlongTracedArea=getPointsAlongTracedArea;
function getPointsAlongTracedArea(a,c,d,e,f){"undefined"==typeof f&&(f=!0);var h=[],i=[],j=[];getTopBottomPointsTracedArea(a,c,d,h,i,j);f&&(h=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(h,a)));var k;null!=h&&0<h.length&&(k=getPointsAlongCurve(h,i,j,e),(c&&d||!c&&!d)&&k.reverse());return k}TracingUtils.getAllPointsAlongTracedArea=getAllPointsAlongTracedArea;
function getAllPointsAlongTracedArea(a,c,d){var e=TracingUtils.model.photoTrace[a].points.concat(),f=TracingUtils.model.photoTrace[a].pointsZ.concat(),h=TracingUtils.model.photoTrace[a].pointsA.concat();e.push(e[0]);f.push(f[0]);h.push(h[0]);e.push(e[1]);f.push(f[1]);h.push(h[1]);d&&(e=pointsToBitmapScale(pointsToAbsolute(e,a)));var i;null!=e&&0<e.length&&(i=getPointsAlongCurve(e,f,h,c));return i}TracingUtils.getEyelinerPoints=getEyelinerPoints;
function getEyelinerPoints(a,c,d,e,f){getTopBottomPointsTracedArea(TracingUtils.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT],a,c,d,e,f);d.pop();e.pop();f.pop();c&&(d.reverse(),e.reverse(),f.reverse())}TracingUtils.timeStart=timeStart;function timeStart(a){startTime.push(getTimer());_message.push(a)}TracingUtils.timerStop=timerStop;function timerStop(){trace(_message.pop()+" "+(getTimer()-startTime.pop()))}function getTimer(){return(new Date).getTime()}
TracingUtils.tracedAreaMaskChanged=tracedAreaMaskChanged;
function tracedAreaMaskChanged(a){var c=TracingUtils.getTracedAreaVO(a),d;if(null==c)d="null";else{d=""+(c.status+";");null!=c.location&&(d+=c.location.x+";"+c.location.y);d=d+";"+(c.rotation+";"+c.scaleX+";"+c.scaleY+";"+c.indexLeft+";"+c.indexRight+";");var e;if(null!=c.points)for(e=0;e<c.points.length;e++)null!=c.points[e]&&(d+=c.points[e].x+";"+c.points[e].y),d+=";";if(null!=c.pointsZ)for(e=0;e<c.pointsZ.length;e++)d+=c.pointsZ[e],d+=";";if(null!=c.pointsA)for(e=0;e<c.pointsA.length;e++)d+=c.pointsA[e]+
";"}c=!1;TracingUtils.model.tracedAreaParams[a]!=d&&(TracingUtils.model.tracedAreaParams[a]=d,c=!0);return c}TracingUtils.getTracedAreaMask=getTracedAreaMask;
function getTracedAreaMask(a){if(tracedAreaMaskChanged(a)||tracedAreaMaskChanged(TracedArea.TRACEDAREA_TEETH)){var c=TracingUtils.getTracedAreaVO(a),d;d=MathUtils.getBoundingBox(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(c.points,c)));d=MathUtils.extendBoundingBox(d,3,10);d[0].x=Math.floor(d[0].x);d[0].y=Math.floor(d[0].y);d[1].x=Math.floor(d[1].x)+1;d[1].y=Math.floor(d[1].y)+1;d=MathUtils.confineBoundsCoords(d,0,0,TracingUtils.model.photoWidth-1,TracingUtils.model.photoHeight-
1);mask=new BitmapData(MathUtils.widthFromBounds(d),MathUtils.heightFromBounds(d),!0,0);d=new Matrix(1,0,0,1,-d[0].x,-d[0].y);TracingUtils.drawTracedShape(mask,c,16777215,1,null,d);TracingUtils.drawTracedShape(mask,TracedArea.TRACEDAREA_TEETH,0,1,BlendMode.ERASE,d);TracingUtils.model.tracedAreaMask[a]=mask}return TracingUtils.model.tracedAreaMask[a]}function EyeLinerUtils(){}EyeLinerUtils.model=ModelLocator.getInstance();EyeLinerUtils.getEyelinerPoints=getEyelinerPoints;
function getEyelinerPoints(a,c,d,e,f){TracingUtils.getTopBottomPointsTracedArea(EyeLinerUtils.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT],a,c,d,e,f);d.pop();e.pop();f.pop();c&&(d.reverse(),e.reverse(),f.reverse())}EyeLinerUtils.offsetPoints=offsetPoints;
function offsetPoints(a,c,d,e,f){var h=0,i;for(i=0;i<f.length-1;i++)h+=Point.distance(f[i],f[i+1]);var c=h*c/100,j=0;for(i=0;i<f.length;i++){var k=2*a,l=Math.max((j+c)/h,0),k=d?k*l:k*(1-l),k=0<a?Math.max(k,0):Math.min(k,0);i<f.length-1&&(j+=Point.distance(f[i],f[i+1]));f[i]=MathUtils.moveVector(f[i],k,e-90)}}EyeLinerUtils.getWingedEyeShape=getWingedEyeShape;
function getWingedEyeShape(a,c){var d=[],e=[],f=[],h=c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;getEyelinerPoints(!0,c,d,e,f);d=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(d,h));e[e.length-1]=0.5;f[f.length-1]=0.5;var i=a/1.3;offsetPoints(i,0,!0,EyeLinerUtils.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT].rotation,d);var j=[],k=[],l=[];TracingUtils.getTopBottomPointsTracedArea(EyeLinerUtils.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:
TracedArea.TRACEDAREA_EYE_RIGHT],!1,c,j,k,l);j=TracingUtils.getPointsAlongCurve(j,k,l,20);c&&j.reverse();for(var k=[],l=[],m=0;m<j.length;m++)k.push(0.5),l.push(0.5);j=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(j,h));offsetPoints(-i,30,!1,EyeLinerUtils.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT].rotation,j);i=c?TracedArea.TRACEDAREA_EYELINER_LEFT_WINGED:TracedArea.TRACEDAREA_EYELINER_RIGHT_WINGED;d=d.concat(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(EyeLinerUtils.model.photoTrace[i].points,
h)),j);e=e.concat(EyeLinerUtils.model.photoTrace[i].pointsZ,k);f=f.concat(EyeLinerUtils.model.photoTrace[i].pointsA,l);return[d,e,f]}EyeLinerUtils.getCatEyeShape=getCatEyeShape;
function getCatEyeShape(a,c){var d=[],e=[],f=[],h=c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT;getEyelinerPoints(!0,c,d,e,f);d=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(d,h));e[e.length-1]=0.5;f[f.length-1]=0.5;offsetPoints(a,0,!0,EyeLinerUtils.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT].rotation,d);var i=[],j=[],k=[];getEyelinerPoints(!1,c,i,j,k);i=TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(i,h));
j[0]=0.5;k[0]=0.5;offsetPoints(a/-2,0,!1,EyeLinerUtils.model.photoTrace[c?TracedArea.TRACEDAREA_EYE_LEFT:TracedArea.TRACEDAREA_EYE_RIGHT].rotation,i);i.splice(0,1);j.splice(0,1);k.splice(0,1);var l=c?TracedArea.TRACEDAREA_EYELINER_LEFT_CATEYE:TracedArea.TRACEDAREA_EYELINER_RIGHT_CATEYE,d=d.concat(TracingUtils.pointsToBitmapScale(TracingUtils.pointsToAbsolute(EyeLinerUtils.model.photoTrace[l].points,h)),i),e=e.concat(EyeLinerUtils.model.photoTrace[l].pointsZ,j),f=f.concat(EyeLinerUtils.model.photoTrace[l].pointsA,
k);return[d,e,f]}function HairColoring(){}HairColoring.toLumFilter=null;HairColoring.lookupFilter=null;HairColoring.lookupEqFilter=null;HairColoring.statsB=null;HairColoring.statsL=null;HairColoring.getRecommendedHairColors=function(a,c){var d=[];if(null!=a&&null!=c)for(var e=0;e<a.length;e++){var f=!1,h=ColorUtils.ColorToHSB(a[e]),i=MathUtils.range(h.saturation/2,20,32);h.brightness<c.br.avg+i&&(f=!0);d.push(f)}return d};
HairColoring.drawGraph=function(a,c,d,e){var f,h=0,i=0,j=0;for(f=0;f<c.length;f++)h=Math.max(h,c[f]),i+=c[f]*f,j+=c[f];i/=j;h/=100;for(f=0;f<c.length;f++){a.setPixel32(d+1+f,e,4294901760);a.setPixel32(d+1+f,e+100+1,4294901760);for(var j=c[f]/h,k=0;100>k;k++)f==i?a.setPixel32(d+1+f,e+100-k,-16711936):k<j?a.setPixel32(d+1+f,e+100-k,4284900864):a.setPixel32(d+1+f,e+100-k,-3407668)}};
HairColoring.buildStats=function(a,c){statsB=[];statsL=[];var d;for(d=0;100>=d;d++)statsB.push(0);for(d=0;200>=d;d++)statsL.push(0);var e,f=c[1].x,h=c[0].y,i=c[1].y;for(d=c[0].x;d<f;d++)for(e=h;e<i;e++){var j=a.getPixel32(d,e);if(0<(j>>24&255)){var j=ColorUtils.ColorToHSB(j&16777215),k=j.brightness+100-j.saturation;statsB[j.brightness]++;statsL[k]++}}};
HairColoring.makeTable=function(a,c){var d=a.length,e=[],f=[];e.push(a[0]);f.push(c[0]);e=e.concat(a);f=f.concat(c);e.push(a[d-1]);f.push(c[d-1]);for(var d=[],h=0;256>h;h++)d.push(0);for(h=0;1024>h;h++){var i=h/1024,j=Math.round(MathUtils.spline(i,e.length,e)),i=Math.round(MathUtils.spline(i,e.length,f)),j=MathUtils.range(j,0,255),i=MathUtils.range(i,0,255);d[j]=i}return d};
HairColoring.levels3=function(a,c,d,e,f,h){a=[a,d,f,255];c=[c,e,h,255];255==f&&(a=[0,d,f],c=[0,e,h]);return HairColoring.makeTable(a,c)};HairColoring.desaturate=function(a,c,d){2!=d&&(d=new Shader(new toLumFilter),d.data.alpha.value[0]=c,a.applyFilter(a,a.rect,new ShaderFilter(d)))};
HairColoring.equalize=function(a,c,d){var e,f,h=0,i=[],j;if(2==d){var k=[];for(e=0;256>e;e++)k.push(0);j=a.getPixels(a.rect);for(e=j.position=0;e<j.length;e+=4)f=j.readUnsignedInt(),0<f&&(f=ColorUtils.colorToLuminance(f),k[f]+=1);for(e=0;256>e;e++)h+=k[e],i.push(h)}else{e=a.clone();j=new Shader(new toLumFilter);j.data.alpha.value[0]=c;e.applyFilter(e,e.rect,new ShaderFilter(j));j=e.histogram(e.rect);j[0][0]-=j[3][0];for(e=0;256>e;e++)h+=j[0][e],i.push(h)}h=255/h;for(e=0;256>e;e++)i[e]=Math.round(i[e]*
h);if(2==d){j=a.getPixels(a.rect);j.position=0;c=new ByteArray;for(e=0;e<j.length;e+=4)f=j.readUnsignedInt(),0<f&&(d=ColorUtils.colorToLuminance(f),f=f&4278190080|i[d]<<16|i[d]<<8|i[d]),c.writeUnsignedInt(f);c.position=0;a.setPixels(a.rect,c)}else{d=new BitmapData(256,3,!1,0);for(e=0;256>e;e++)d.setPixel32(e,0,i[e]),d.setPixel32(e,1,i[e]),d.setPixel32(e,2,i[e]);i=new Shader(new lookupEqFilter);i.data.lookup.input=d;i.data.alpha.value[0]=c;a.applyFilter(a,a.rect,new ShaderFilter(i))}};
HairColoring.applyCurves=function(a,c,d,e,f,h,i,j,k,l,m,n,o,s,r,q,v,p,z,w,K,u){var d=ModelLocator.getInstance(),t;if(null!=a){getTimer();e=HairColoring.levels3(e,f,h,i,j,k);l=HairColoring.levels3(l,m,n,o,s,r);q=HairColoring.levels3(q,v,p,z,w,K);if(null!=d.debugBitmapData){for(v=0;256>v;v++)d.debugBitmapData.setPixel32(0,v,4294901760),d.debugBitmapData.setPixel32(255,v,4294901760),d.debugBitmapData.setPixel32(v,0,4294901760),d.debugBitmapData.setPixel32(v,255,4294901760),m=255-e[v],d.debugBitmapData.setPixel32(v,
m,4294901760|d.debugBitmapData.getPixel32(v,m)),m=255-l[v],d.debugBitmapData.setPixel32(v,m,4278255360|d.debugBitmapData.getPixel32(v,m)),m=255-q[v],d.debugBitmapData.setPixel32(v,m,4278190335|d.debugBitmapData.getPixel32(v,m));for(t=-5;5>=t;t++)d.debugBitmapData.setPixel32(h+t,255-i+0,4294901760),d.debugBitmapData.setPixel32(h+0,255-i+t,4294901760),d.debugBitmapData.setPixel32(j+t,255-k+0,4294901760),d.debugBitmapData.setPixel32(j+0,255-k+t,4294901760),d.debugBitmapData.setPixel32(n+t,255-o+0,4278255360),
d.debugBitmapData.setPixel32(n+0,255-o+t,4278255360),d.debugBitmapData.setPixel32(s+t,255-r+0,4278255360),d.debugBitmapData.setPixel32(s+0,255-r+t,4278255360),d.debugBitmapData.setPixel32(p+t,255-z+0,4278190335),d.debugBitmapData.setPixel32(p+0,255-z+t,4278190335),d.debugBitmapData.setPixel32(w+t,255-K+0,4278190335),d.debugBitmapData.setPixel32(w+0,255-K+t,4278190335)}if(2==u){h=c[0].x;i=c[1].x;k=c[0].y;c=c[1].y;k=h=0;i=a.width-1;c=a.height-1;t=new BitmapData(a.width,a.height,!0,16777215);j=new ByteArray;
a=a.getPixels(a.rect);a.position=0;for(m=k;m<=c;m++)for(v=h;v<=i;v++)k=a.readUnsignedInt(),0!=k&&(k=k&4278190080|e[k>>16&255]<<16|l[k>>8&255]<<8|q[k&255]),j.writeUnsignedInt(k);j.position=0;t.setPixels(t.rect,j)}else{c=new BitmapData(256,3,!1,0);for(t=0;256>t;t++)c.setPixel32(t,0,e[t]),c.setPixel32(t,1,l[t]),c.setPixel32(t,2,q[t]);t=new BitmapData(a.width,a.height,!0,16777215);t.draw(a);a=new Shader(new lookupFilter);a.data.lookup.input=c;t.applyFilter(t,t.rect,new ShaderFilter(a))}}return t};
HairColoring.initMatrix=function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]};HairColoring.mm=function(a,c){for(var d=[],e=Math.sqrt(a.length),f=0;f<e;f++){for(var h=[],i=0;i<e;i++)h.push(a[i+f*e]);for(i=0;i<e;i++){for(var j=0,k=0;k<e;k++)j+=c[i+k*e]*h[k];d.push(j)}}return d};
HairColoring.adjustSaturation=function(a,c){c=MathUtils.range(c,-100,100);if(0==c||isNaN(c))return a;var d=1+c/100,e=1-d;return HairColoring.mm(a,[0.299*e+d,0.587*e,0.114*e,0,0,0.299*e,0.587*e+d,0.114*e,0,0,0.299*e,0.587*e,0.114*e+d,0,0,0,0,0,1,0,0,0,0,0,1])};HairColoring.adjustBrightness=function(a,c){return HairColoring.mm(a,[c,0,0,0,0,0,c,0,0,0,0,0,c,0,0,0,0,0,1,0,0,0,0,0,1])};
HairColoring.adjustContrast=function(a,c){return HairColoring.mm(a,[c,0,0,0,128-128*c,0,c,0,0,128-128*c,0,0,c,0,128-128*c,0,0,0,1,0,0,0,0,0,1])};
HairColoring.adjustHue=function(a,c){c=MathUtils.range(c,-180,180)/180*Math.PI;if(0==c||isNaN(c))return a;var d=Math.cos(c),e=Math.sin(c);return HairColoring.mm(a,[0.213+0.787*d+-0.213*e,0.715+-0.715*d+-0.715*e,0.072+-0.072*d+0.928*e,0,0,0.213+-0.213*d+0.14*e,0.715+d*(1-0.715)+0.14*e,0.072+-0.072*d+-0.28*e,0,0,0.213+-0.213*d+-0.787*e,0.715+-0.715*d+0.715*e,0.072+0.928*d+0.072*e,0,0,0,0,0,1,0,0,0,0,0,1])};
HairColoring.colorizeHair=function(a,c,d,e,f,h,i,j,k,l){"undefined"==typeof d&&(d=50);"undefined"==typeof e&&(e=-1);"undefined"==typeof f&&(f=null);"undefined"==typeof h&&(h=null);"undefined"==typeof i&&(i=0);"undefined"==typeof j&&(j=0);"undefined"==typeof k&&(k=!1);"undefined"==typeof l&&(l=!1);var m=getTimer(),n=ModelLocator.getInstance(),o,s;o=ColorUtils.ColorToHSB(c);var r=a.clone();0<=e&&null!=f&&(s=ColorUtils.ColorToHSB(ColorUtils.RGBtoColor(f.r.avg,f.g.avg,f.b.avg)),HairColoring.debug("ORIG "+
Math.round(f.r.avg)+","+Math.round(f.g.avg)+","+Math.round(f.b.avg)+" ["+Math.round(f.br.avg)+" TO "+Math.round(o.brightness)+"] "+Math.round(s.hue)+","+Math.round(s.saturation)+","+Math.round(s.brightness),NaN,NaN,!0));if(0==e||2==e){l=!0;j=i=0;k=!1;s=Math.round(f.br.avg);var q=Math.round(f.r.avg),v=Math.round(f.g.avg),p=Math.round(f.b.avg);if(10<Math.abs(o.brightness-s)){if(10>=s&&30<=o.brightness||40>=s&&75<=o.brightness||90<=o.brightness||40<o.brightness-s)j=0.75,s=50,q=Math.min(128,c>>16&255),
v=Math.min(128,c>>8&255),p=Math.min(128,c&255);k=!0;75<=o.brightness&&(40>=s||0<j)?(HairColoring.debug("high"),MathUtils.range(2*((c>>16&255)-q),0,160),MathUtils.range(2*((c>>8&255)-v),0,160),MathUtils.range(2*((c&255)-p),0,160)):50<=o.brightness&&20>=f.br.avg?(HairColoring.debug("mid"),10<f.br.avg&&(j=0,s=Math.round(f.br.avg),q=Math.round(f.r.avg),v=Math.round(f.g.avg),p=Math.round(f.b.avg)),MathUtils.range((c>>16&255)-q-60,0,100),MathUtils.range((c>>8&255)-v-60,0,100),MathUtils.range((c&255)-p-
60,0,100),MathUtils.range(5.1*s,64,192),MathUtils.range(5.1*s,64,192),MathUtils.range(5.1*s,64,192)):40>=f.br.avg?(HairColoring.debug("low"),MathUtils.range((c>>16&255)-q,-50,100),MathUtils.range((c>>8&255)-v,-50,100),MathUtils.range((c&255)-p,-50,100)):50<=f.br.avg&&o.brightness<f.br.avg?(HairColoring.debug("darken"),s=MathUtils.range(2.55*o.brightness,40,255),MathUtils.range(4*s,0,255)):(HairColoring.debug("regular"),MathUtils.range(0.8*((c>>16&255)-q),-60,60),MathUtils.range(0.8*((c>>8&255)-v),
-60,60),MathUtils.range(0.8*((c&255)-p),-60,60))}}1==e&&(s=ColorUtils.ColorToHSB(ColorUtils.RGBtoColor(f.r.avg,f.g.avg,f.b.avg)),i=MathUtils.range(Point.distance(new Point(s.hue,s.saturation),new Point(35,40))/50,0,0.9),j=MathUtils.range(Math.abs(o.brightness-f.br.avg)/100,0,0.9),l=k=!0);switch(e){case 0:case 1:case 2:case 3:r=a.clone();d=f;n.debugBitmapData=null;0<i&&(HairColoring.desaturate(r,i,e),d=TracingUtils.calculateAverage(r,r,h,5),HairColoring.debug("DESATURATED ("+MathUtils.roundTo(i,2)+
") "+Math.round(d.r.avg)+","+Math.round(d.g.avg)+","+Math.round(d.b.avg)+" ["+Math.round(d.br.avg)+"]"));0<j&&(HairColoring.equalize(r,j,e),d=TracingUtils.calculateAverage(r,r,h,5),HairColoring.debug("EQUALIZED ("+MathUtils.roundTo(j,2)+") "+Math.round(d.r.avg)+","+Math.round(d.g.avg)+","+Math.round(d.b.avg)+" ["+Math.round(d.br.avg)+"]"));k&&(1==e&&(d=2.55*(o.brightness-d.br.avg),0>d?(Math.max(d/1.5,0),MathUtils.range(85-d/2,0,255),MathUtils.range(85+d/2,0,255),MathUtils.range(170-d/2,0,255),MathUtils.range(170+
d/2,0,255),Math.max(d/1.5-4,0),MathUtils.range(85-d/2+4,0,255),MathUtils.range(85+d/2-4,0,255),MathUtils.range(170-d/2+4,0,255),MathUtils.range(170+d/2-4,0,255),Math.max(d/1.5-8,0),MathUtils.range(85-d/2+8,0,255),MathUtils.range(85+d/2-8,0,255),MathUtils.range(170-d/2+8,0,255)):(Math.max(d/1.5,0),MathUtils.range(85-d/2,0,255),MathUtils.range(85+d/1.5,0,255),MathUtils.range(170+d/2,0,255),Math.max(d/1.5-4,0),MathUtils.range(85-d/2+4,0,255),MathUtils.range(85+d/1.5-4,0,255),MathUtils.range(170+d/2-
4,0,255),Math.max(d/1.5-8,0),MathUtils.range(85-d/2+8,0,255),MathUtils.range(85+d/1.5-8,0,255)),MathUtils.range(170+d/2-8,0,255)),n.isDebug&&(n.debugBitmapData=new BitmapData(256,256,!0,1077952576)),d=TracingUtils.calculateAverage(r,r,h,5),HairColoring.debug("CURVES "+Math.round(d.r.avg)+","+Math.round(d.g.avg)+","+Math.round(d.b.avg)+" ["+Math.round(d.br.avg)+"]"));l&&(l=(c>>16&255)-d.r.avg,n=(c>>8&255)-d.g.avg,e=(c&255)-d.b.avg,10>o.saturation?(c=HairColoring.initMatrix(),c=HairColoring.adjustSaturation(c,
-100),c=HairColoring.adjustBrightness(c,o.brightness/d.br.avg),r.applyFilter(r,r.rect,new ColorMatrixFilter(c))):(0<=l&&20>l&&(o=(c>>16&255)/d.r.avg,l=0,n=(c>>8&255)/o-d.g.avg,e=(c&255)/o-d.b.avg),o=new ColorTransform,o.redOffset=l,o.greenOffset=n,o.blueOffset=e,r.colorTransform(r.rect,o),o=TracingUtils.calculateAverage(r,r,h,5),HairColoring.debug("COLORTRANSFORM "+Math.round(o.r.avg)+","+Math.round(o.g.avg)+","+Math.round(o.b.avg))));HairColoring.debug("HairColoring in "+(getTimer()-m)+"");break;
case -1:r=a.clone(),15>o.saturation?(m=f.r.avg<<16|f.g.avg<<8|f.b.avg,s=ColorUtils.ColorToHSB(m),m=2*o.saturation-100,c=o.hue-s.hue,180<c&&(c-=360),o=o.brightness/s.brightness,h=HairColoring.initMatrix(),h=HairColoring.adjustSaturation(h,m),h=HairColoring.adjustHue(h,c),h=HairColoring.adjustBrightness(h,o),r.applyFilter(r,r.rect,new ColorMatrixFilter(h))):(o=new ColorTransform,o.redOffset=(c>>16&255)-f.r.avg,o.greenOffset=(c>>8&255)-f.g.avg,o.blueOffset=(c&255)-f.b.avg,50<d?(o.alphaOffset=0,o.alphaMultiplier=
d/50):50>d&&(o.alphaOffset=5.1*(d-50),o.alphaMultiplier=2-d/50),r.colorTransform(r.rect,o))}return r};HairColoring.debug=function(a,c,d,e){"undefined"==typeof c&&(c=NaN);"undefined"==typeof d&&(d=NaN);"undefined"==typeof e&&(e=!1);var f=ModelLocator.getInstance();f.isDebug&&f.stageMain.debug(a,c,d,e)};function PostProcess(){}PostProcess.vignetteBitmapData=null;
PostProcess.run=function(a,c){for(var d=a.split(";"),e=0;e<d.length;e++){var f=d[e].replace("vmePostProcess(","").replace(")",""),h=f,i=f.indexOf(",");0<i&&(h=f.substr(0,i),f=f.substr(i+1));i=f.split(",");switch(h){case "'colorMatrix'":f=JSON.parse(f);this.postProcessColorMatrix(c,f);break;case "'sharpen'":f=0<=i.length&&0<parseFloat(i[0])?parseFloat(i[0]):0.25;this.postProcessSharpen(c,f);break;case "'soften'":f=0<=i.length&&0<parseInt(i[0])?parseInt(i[0]):32;h=1<=i.length&&0<parseFloat(i[1])?parseFloat(i[1]):
0.35;this.postProcessSoften(c,f,h);break;case "'vignette'":f=0<=i.length&&0<parseInt(i[0])?parseInt(i[0]):0,this.postProcessVignette(c,f)}}};PostProcess.postProcessColorMatrix=function(a,c){a.applyFilter(a,a.rect,new ColorMatrixFilter(c))};PostProcess.postProcessSoften=function(a,c,d){var e=a.clone();e.fastBlurBitmapData(e,c,1);e.colorTransform(e.rect,new ColorTransform(1,1,1,d));a.draw(e)};
PostProcess.sharpenFilter=function(a){var c=-a,d=c/2;return new ConvolutionFilter(5,5,[0,0,d,0,0,0,d,c,d,0,d,c,1+4*a+8*(a/2),c,d,0,d,c,d,0,0,0,d,0,0])};
PostProcess.sharpen25=function(a,c){var d=a.imageData,e=d.data,f,h,i;f=this.sharpenFilter(c).matrix;var j=f[2],k=f[6],l=f[7],m=f[8],n=f[10],o=f[11],s=f[12],r=f[13],q=f[14],v=f[16],p=f[17],z=f[18],w=f[22],K=4*d.width,u=8*d.width,t=K-6,D=K-5,A=K-4,B=K-3,F=K-2,C=u-2,G=K-1,N=u-1,H=K+1,O=u+1,L=K+2,M=u+2,P=K+3,Q=K+4,U=K+5,E=K+6,R;if("Uint8ClampedArray"in window){R=new Uint8ClampedArray(e.length);for(h=2;h<d.height-2;h++){f=4*h*d.width;for(i=2;i<d.width-2;i++)R[f]=e[f-u]*j+e[f-Q]*k+e[f-K]*l+e[f-A]*m+e[f-
8]*n+e[f-4]*o+e[f]*s+e[f+4]*r+e[f+8]*q+e[f+A]*v+e[f+K]*p+e[f+Q]*z+e[f+u]*w,R[f+1]=e[f-N]*j+e[f-P]*k+e[f-G]*l+e[f-D]*m+e[f-7]*n+e[f-3]*o+e[f+1]*s+e[f+5]*r+e[f+9]*q+e[f+B]*v+e[f+H]*p+e[f+U]*z+e[f+O]*w,R[f+2]=e[f-C]*j+e[f-L]*k+e[f-F]*l+e[f-t]*m+e[f-6]*n+e[f-2]*o+e[f+2]*s+e[f+6]*r+e[f+10]*q+e[f+F]*v+e[f+L]*p+e[f+E]*z+e[f+M]*w,f+=4}}else{R=new Uint8Array(e.length);for(h=2;h<d.height-2;h++){f=4*h*d.width;for(i=2;i<d.width-2;i++)R[f]=Math.max(Math.min(e[f-u]*j+e[f-Q]*k+e[f-K]*l+e[f-A]*m+e[f-8]*n+e[f-4]*
o+e[f]*s+e[f+4]*r+e[f+8]*q+e[f+A]*v+e[f+K]*p+e[f+Q]*z+e[f+u]*w,255),0),R[f+1]=Math.max(Math.min(e[f-N]*j+e[f-P]*k+e[f-G]*l+e[f-D]*m+e[f-7]*n+e[f-3]*o+e[f+1]*s+e[f+5]*r+e[f+9]*q+e[f+B]*v+e[f+H]*p+e[f+U]*z+e[f+O]*w,255),0),R[f+2]=Math.max(Math.min(e[f-C]*j+e[f-L]*k+e[f-F]*l+e[f-t]*m+e[f-6]*n+e[f-2]*o+e[f+2]*s+e[f+6]*r+e[f+10]*q+e[f+F]*v+e[f+L]*p+e[f+E]*z+e[f+M]*w,255),0),f+=4}}for(h=2;h<d.height-2;h++){f=4*h*d.width;for(i=2;i<d.width-2;i++)e[f]=R[f],e[f+1]=R[f+1],e[f+2]=R[f+2],f+=4}};
PostProcess.postProcessSharpen=function(a,c){this.sharpen25(a,c)};PostProcess.postProcessVignette=function(a,c){var d=a.width,e=a.height;if(null==this.vignetteBitmapData||this.vignetteBitmapData.width!=d||this.vignetteBitmapData.height!=e){this.vignetteBitmapData=new BitmapData(d,e,!0,4278190080|c);for(var f=3,h=this.vignetteBitmapData.imageData.data,i=d/2,j=e/2,k=0;k<e;k++)for(var l=128*(Math.abs(k-j)*Math.abs(k-j)/e),m=0;m<d;m++)h[f]=Math.sqrt(128*(Math.abs(m-i)*Math.abs(m-i)/d)+l),f+=4}a.draw(this.vignetteBitmapData)};
var debugConsole_$;function debugConsoleInit(){debugConsole_$=$("#debugConsole");debugConsole_$.length||(debugConsole_$=$("<div id='debugConsole'/>"),$("#vme").append(debugConsole_$),debugConsole_$.append("<span>Debug output:</span>"))}function printDebug(a){debugConsoleInit();debugConsole_$.append("<br><span>"+a+"</span>");debugConsole_$.scrollTop=debugConsole_$.scrollHeight}
function flashOnHtml5_debugBitmapData(a){debugConsoleInit();for(var c=a.imageData.width,d=a.imageData.height,e=a.imageData.data,f=!1,h=0;h<d&&!f;h++)for(var i=0;i<c;i++)if(e[4*(c*h+i)]||e[4*(c*h+i)+1]||e[4*(c*h+i)+2]||e[4*(c*h+i)+3]){f=!0;break}f?(c=$("<canvas class='debug-bitmapData'/>")[0],debugConsole_$.append(c),c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a.imageData,0,0),debugConsole_$.scrollTop=debugConsole_$.scrollHeight):printDebug("bitmapData is empty")}
function flashOnHtml5_debugGraphics(a){var c=$("<canvas class='debug-graphics'/>")[0];debugConsole_$.append(c);c.width=a.flashOnHtml5_width();c.height=a.flashOnHtml5_height();a.flashOnHtml5_drawOnto(c.getContext("2d"))}function flashOnHtml5_debugSprite(a){var c=$("<canvas class='debug-graphics'/>")[0];debugConsole_$.append(c);c.width=a.width;c.height=a.height;a.flashOnHtml5_drawOnto(c.getContext("2d"))}
function flashOnHtml5_debugContext(a){var c=$("<canvas class='debug-graphics'/>")[0];c.width=a.canvas.width;c.height=a.canvas.height;debugConsole_$.append(c);c.getContext("2d").drawImage(a.canvas,0,0)}function doTestSetTracingShapes(){vmeHtml5||(vmeHtml5=new vme($("#vme")[0]),vmeHtml5.applyMakeoverItem(Features.FEATURE_PHOTO,0,0,0,0,"",0,0,modelURL,makeoverParams));vmeHtml5.setTracingCoordinates(points);printDebug(vmeHtml5.getPhotoTrace())}
function doTestEditTracingShapes(){vmeHtml5||(vmeHtml5=new vme($("#vme")[0]),vmeHtml5.applyMakeoverItem(Features.FEATURE_PHOTO,0,0,0,0,"",0,0,modelURL,makeoverParams));vmeHtml5.startTracingMode(Features.FEATURE_LIPSTICK)}
function doTestApplyProduct(){vmeHtml5||(vmeHtml5=new vme($("#vme")[0]),vmeHtml5.setTracingCoordinates(points),vmeHtml5.applyMakeoverItem(Features.FEATURE_PHOTO,0,Features.SIDE_BOTH,0,0,"",0,0,modelURL,makeoverParams));vmeHtml5.applyMakeoverItem(Features.FEATURE_LIPSTICK,0,Features.SIDE_BOTH,16711680,0,$("#ddlFinish").val().toLowerCase())}
function doTestFinishEffects(){vmeHtml5||(vmeHtml5=new vme($("#vme")[0]),vmeHtml5.applyMakeoverItem(Features.FEATURE_PHOTO,0,0,0,0,"",0,0,"assets/models/Ricellys.jpg"));vmeHtml5.setPhotoTrace("NLeS13a0Pyb1Mb003Nb003NKOvpj9PKlg7Plb9Pyc9PyhN1dRlbL6KKyD2h35wxvBFFFBa5wxvJFFFJa5w");vmeHtml5.applyMakeoverItem(FEATURE_PHOTO.FEATURE_LIPSTICK,0,0,16711680);vmeHtml5.applyMakeoverItem(1,-1,0,15916990,15,"natural",0,0,null,'{"opacity":50,"spotApplyErase":0}',null)}
function zoomIn(){if(vmeHtml5){var a=vmeHtml5.getPosition()[2],a=a+0.1;vmeHtml5.setPosition(NaN,NaN,a,a)}else alert("Please load a model image first.")}function zoomOut(){if(vmeHtml5){var a=vmeHtml5.getPosition()[2],a=a-0.1;vmeHtml5.setPosition(NaN,NaN,a,a)}else alert("Please load a model image first.")}
function zoomWithPinch(a){var c=a.originalEvent;-1==vmeHtml5.model.dragModeFeature&&("gesturechange"==a.type?(a.preventDefault(),1<c.scale?(a=vmeHtml5.getPosition(),a=a[2],a+=0.1,1.2>a&&vmeHtml5.setPosition(NaN,NaN,a,a)):1>c.scale&&(a=vmeHtml5.getPosition(),a=a[2],a-=0.1,0.5061<a&&vmeHtml5.setPosition(NaN,NaN,a,a))):"gestureend"==a.type&&a.preventDefault())}
function dragModeOn(a){if(vmeHtml5){var c=vmeHtml5.model;-1==c.dragModeFeature&&(c.dragModeFeature=a);if(c.dragModeFeature!=a)return!1;if(c.canDrag){for(var d=!1,e=c.looks[c.currentLook].stageChildren,f=0,h=e.length-1;0<=h&&!d;h--){var i=e[h].stageChild;null!=i&&(i.visible&&TracingUtils.isFeatureDraggable(i.stageChildVO.feature)&&"0"!=i.getMakeoverItemParam("draggable","1")&&a==i.stageChildVO.feature)&&(f++,c.dragFeature=i.stageChildVO.feature,c.dragInstanceIndex=i.stageChildVO.instanceIndex,c.dragSide=
Features.SIDE_BOTH,d=!0)}if(d)return c.stageMain.onRenderCompleted(),c.isDraggingStage=!1,isDragging=!0;c.dragModeFeature=-1;return!1}}else alert("Please load a model image first.")}function dragModeOff(){vmeHtml5?vmeHtml5.model.stageMain.children[2].stopDragMode():alert("Please load a model image first.")}vme.prototype=new Sprite(flashOnHtml5_constructingPrototype);vme.prototype.constructor=vme;
function vme(a,c){function d(c,d,e,f,h,i,j,k,l,m,n){c=parseInt(c);"undefined"==typeof e&&(e=Features.SIDE_BOTH);f="undefined"==typeof f?0:parseInt(f);h="undefined"==typeof h?0:parseInt(h);"undefined"==typeof i&&(i="");"undefined"==typeof j&&(j=0);"undefined"==typeof k&&(k=0);"undefined"==typeof l&&(l="");"undefined"==typeof m&&(m="{}");"undefined"==typeof n&&(n=null);if(0==c){I=I||a;f="";try{if("application"!=Security.sandboxType)f=I.loaderURL,f=f.substring(f.indexOf(":")+3,f.indexOf("/",8)),0<f.indexOf(":")&&
(f=f.substr(0,f.indexOf(":"))),f=f.substr(Math.max(f.lastIndexOf(".",f.length-7)+1,0));else{var o=I.applicationDomain;if(o.hasDefinition("flash.desktop.NativeApplication")){var p=o.getDefinition("flash.desktop.NativeApplication");p&&p.nativeApplication.applicationDescriptor.inScopeNamespaces()}}}catch(q){alert(q)}if(h=""!=f)if(h=""!=m){j="";k=f.length;for(h=0;h<f.length;h++)i=f.charCodeAt(h),k^=i*h;for(h=0;h<f.length;h++)i=f.charCodeAt(h),j+=(k*i%46656).toString(36),k+=i;h='{"photoTrace":"'+j+'"}'==
m}h&&(this.model.isConfirmed=!0)}else if(o=TracingUtils.findStageChildren(c,d,e),null!=o){for(p=0;p<o.length;p++)this.setMakeoverItem(o[p],o[p].feature,f,h,i,j,k,l,m),o[p].visible=!0,null!=n&&(o[p].parameters=n);this.normalizeWeights();this.model.allowUpdate&&this.dispatchChangeEvent()}}function e(a,c){"undefined"==typeof c&&(c=!0);var d,e=!1;c&&(s(null,ControlActions.CLEAR_ALL),k(Features.FEATURE_POLISH,-1,0,ControlActions.HIDE),e=!0,this.model.onChange=!0);for(var f=0;f<a.length;f++){var h=a[f];
d=TracingUtils.findStageChildren(h.feature,h.instanceIndex,h.side);if(null!=d){e=!0;this.model.onChange=!0;var i=null;null!=h.makeoverItem?i=h.makeoverItem.parameters:void 0!=h.parameters&&(i=h.parameters);var j=0;if("string"==typeof h.color){var l=h.color.split(",");3==l.length&&(j=MathUtils.range(l[0],0,255)<<16|MathUtils.range(l[1],0,255)<<8|MathUtils.range(l[2],0,255))}else j=h.color;for(l=0;l<d.length;l++){var m=d[l];this.setMakeoverItem(m,h.feature,j,h.coverage,h.finish,h.style,h.area,h.URL,
i);void 0!=h.x&&(m.x=h.x);void 0!=h.y&&(m.y=h.y);void 0!=h.scaleX&&(m.scaleX=h.scaleX);void 0!=h.scaleY&&(m.scaleY=h.scaleY);void 0!=h.flipX&&(m.flipX=h.flipX);void 0!=h.flipY&&(m.flipY=h.flipY);void 0!=h.rotation&&(m.rotation=h.rotation);void 0!=h.weight&&(m.weight=h.weight);void 0!=h.parameters&&(m.parameters=h.parameters);m.visible=void 0!=h.visible?h.visible:!0}}}e&&(this.sortLook(),this.dispatchChangeEvent())}function f(a,c){c||(c=0);for(var d=null,e=this.model.looks[this.model.currentLook].stageChildren,
f,h=0;h<e.length;h++)if(f=e[h],f.feature==a&&f.instanceIndex==c){d=f.makeoverItem;break}return d}function h(a,c,d){for(var e=null,f=this.model.looks[this.model.currentLook].stageChildren,h,i=0;i<f.length;i++)if(h=f[i],h.feature==a&&h.instanceIndex==c){null!=h.makeoverItem&&(a=JSON.parse(h.makeoverItem.parameters),void 0!=a[d]&&(e=a[d]));break}return e}function i(a,c){c||(c=0);for(var d=this.model.looks[this.model.currentLook].stageChildren,e=null,f=0;f<d.length;f++)if(d[f].feature==a&&d[f].instanceIndex==
c){e=d[f];break}return e}function j(a){var c=TracingUtils.getTraceFeatureForFeature(a.feature);if(0==a.tracedArea)a.tracedArea=TracingUtils.tracedAreaForFeature(a.feature);else if(a.tracedArea==TracedArea.TRACEDAREA_EYESHADOW_LEFT||a.tracedArea==TracedArea.TRACEDAREA_EYESHADOW_RIGHT)c=Features.FEATURE_TRACING_TARGET;var d=TracingUtils.isFeatureLeftSide(a.feature)?Features.SIDE_LEFT:Features.SIDE_RIGHT,a=TracingUtils.findStageChildren(c,-1,d,!0,"tracedArea",a.tracedArea),c=null;null!=a&&(c=a[0]);return c}
function k(a,c,d,e,f){a="undefined"==typeof a?-1:parseInt(a);c="undefined"==typeof c?-1:parseInt(c);d="undefined"==typeof d?Features.SIDE_BOTH:parseInt(d);e||(e="");"undefined"==typeof f&&(f=1);var h=TracingUtils.findStageChildren(a,c,d);if(null!=h){if(this.model.isTracingMode&&-1!=a)if(a==Features.FEATURE_EYESHADOW&&-1==c){a=0;null!=h[0].makeoverItem&&(a=DataUtils.JSONDecode(h[0].makeoverItem.parameters).style);var c=[],i=[];if(d==Features.SIDE_BOTH||d==Features.SIDE_LEFT){switch(a){case 1:h=TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_ALL;
break;case 2:h=TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_ALL;break;case 3:h=TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_ALL;break;default:h=TracedArea.TRACEDAREA_EYESHADOW_LEFT_WASH}c=TracingUtils.findStageChildren(Features.FEATURE_TRACING,-1,d,!0,"tracedArea",h)}if(d==Features.SIDE_BOTH||d==Features.SIDE_RIGHT){switch(a){case 1:h=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_ALL;break;case 2:h=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_ALL;break;case 3:h=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_ALL;
break;default:h=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_WASH}i=TracingUtils.findStageChildren(Features.FEATURE_TRACING,-1,d,!0,"tracedArea",h)}h=c.concat(i)}else for(d=0;d<h.length;d++)TracingUtils.isFeatureTracing(h[d].feature)||(h[d]=j(h[d]));s(h,e,f);this.dispatchChangeEvent()}}function l(a,c,d,e,f,h){a||(a=-1);c||(c=0);d||(d=Features.SIDE_BOTH);e||(e=-1);f||(f=!1);h||(h=!1);var i=null;f&&this.stopTracingModeInternal();if(0<e)i=[new StageChildVO];else if(0<a&&(i=TracingUtils.findStageChildren(a,
c,d),a==Features.FEATURE_EYESHADOW&&-1==c)){f=0;null!=i[0].makeoverItem&&(f=JSON.parse(i[0].makeoverItem.parameters).style);var k=[],l=[];if(d==Features.SIDE_BOTH||d==Features.SIDE_LEFT){switch(f){case 1:i=TracedArea.TRACEDAREA_EYESHADOW_LEFT_CLASSIC_ALL;break;case 2:i=TracedArea.TRACEDAREA_EYESHADOW_LEFT_SMOKEY_ALL;break;case 3:i=TracedArea.TRACEDAREA_EYESHADOW_LEFT_2TONE_ALL;break;default:i=TracedArea.TRACEDAREA_EYESHADOW_LEFT_WASH}k=TracingUtils.findStageChildren(Features.FEATURE_TRACING,-1,d,
!0,"tracedArea",i)}if(d==Features.SIDE_BOTH||d==Features.SIDE_RIGHT){switch(f){case 1:i=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_CLASSIC_ALL;break;case 2:i=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_SMOKEY_ALL;break;case 3:i=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_2TONE_ALL;break;default:i=TracedArea.TRACEDAREA_EYESHADOW_RIGHT_WASH}l=TracingUtils.findStageChildren(Features.FEATURE_TRACING,-1,d,!0,"tracedArea",i)}i=k.concat(l)}if(null!=i)for(f=0;f<i.length;f++){k=null;if(0<e){l=Features.FEATURE_TRACING;if(e==
TracedArea.TRACEDAREA_EYESHADOW_LEFT||e==TracedArea.TRACEDAREA_EYESHADOW_RIGHT)l=Features.FEATURE_TRACING_TARGET;l=TracingUtils.findStageChildren(l,-1,d,!0,"tracedArea",e);null!=l&&(k=l[0])}else TracingUtils.isFeatureTracing(a)?(l=TracingUtils.findStageChildren(a,-1,d,!0),null!=l&&(k=l[0])):k=a==Features.FEATURE_EYESHADOW&&-1==c?i[f]:j(i[f]);null!=k&&(null==k.makeoverItem&&(k.makeoverItem=new MakeoverItemVO),l=JSON.parse(k.makeoverItem.parameters),0<e?l.tracedArea=e:0<i[f].tracedArea&&(l.tracedArea=
i[f].tracedArea),k.makeoverItem.parameters=JSON.stringify(l),k.visible=!0)}this.model.isTracingMode=!0;this.model.showTracedArea=h;this.dispatchChangeEvent()}function m(){this.stopTracingModeInternal();this.model.isTracingMode=!1;this.dispatchChangeEvent()}function n(a,c,d){if(null!=a){null==a.makeoverItem&&(a.makeoverItem=new MakeoverItemVO);var e=JSON.parse(a.makeoverItem.parameters);e[c]=d;a.makeoverItem.parameters=JSON.stringify(e)}}function o(a,c,d){if(null!=a){var e=JSON.parse(a.parameters);
e[c]=d;a.parameters=JSON.stringify(e)}}function s(a,c,d){c||(c="");"undefined"==typeof d&&(d=1);null==a&&(a=this.model.looks[this.model.currentLook].stageChildren);for(var e,f=0;f<a.length;f++)switch(c){case ControlActions.RESET:e=a[f];e.x=0;e.y=0;e.scaleX=1;e.scaleY=1;e.flipX=1;e.flipY=1;e.rotation=0;o(e,"srcCoords","");o(e,"dstCoords","");o(e,"points",null);break;case ControlActions.CLEAR:e=a[f];e.makeoverItem=null;break;case ControlActions.CLEAR_ALL:e=a[f];e.feature!=Features.FEATURE_PHOTO&&(e.makeoverItem=
null);break;case ControlActions.VISIBLE:e=a[f];e.visible=!e.visible;break;case ControlActions.SHOW:e=a[f];e.setVisible(!0);break;case ControlActions.HIDE:e=a[f];e.setVisible(!1);break;case ControlActions.ALPHA_SET:e=a[f];null==e.makeoverItem&&(e.makeoverItem=new MakeoverItemVO);e.makeoverItem.opacity=d;break;case ControlActions.ALPHA_ADD:e=a[f];null==e.makeoverItem&&(e.makeoverItem=new MakeoverItemVO);e.makeoverItem.opacity=MathUtils.range(e.makeoverItem.opacity+d,0,100);break;case ControlActions.LEFT:e=
a[f];e.x-=d;break;case ControlActions.RIGHT:e=a[f];e.x+=d;break;case ControlActions.UP:e=a[f];e.y-=d;break;case ControlActions.DOWN:e=a[f];e.y+=d;break;case ControlActions.X_SET:e=a[f];e.x=d;break;case ControlActions.Y_SET:e=a[f];e.y=d;break;case ControlActions.WIDER:e=a[f];e.scaleX+=d/100;break;case ControlActions.NARROWER:e=a[f];e.scaleX-=d/100;break;case ControlActions.TALLER:e=a[f];e.scaleY+=d/100;break;case ControlActions.SHORTER:e=a[f];e.scaleY-=d/100;break;case ControlActions.BIGGER:e=a[f];
e.scaleX+=d/100;e.scaleY+=d/100;break;case ControlActions.SMALLER:e=a[f];e.scaleX-=d/100;e.scaleY-=d/100;break;case ControlActions.WIDTH_SET:e=a[f];e.scaleX=d;break;case ControlActions.HEIGHT_SET:e=a[f];e.scaleY=d;break;case ControlActions.FLIP_X:e=a[f];e.flipX*=-1;break;case ControlActions.FLIP_Y:e=a[f];e.flipY*=-1;break;case ControlActions.SKEW_X_MORE:e=a[f];e.skewX+=d;break;case ControlActions.SKEW_X_LESS:e=a[f];e.skewX-=d;break;case ControlActions.SKEW_X_SET:e=a[f];e.skewX=d;break;case ControlActions.SKEW_Y_MORE:e=
a[f];e.skewY+=d;break;case ControlActions.SKEW_Y_LESS:e=a[f];e.skewY-=d;break;case ControlActions.SKEW_Y_SET:e=a[f];e.skewY=d;break;case ControlActions.ROTATE_X_MORE:e=a[f];e.rotateX+=d;break;case ControlActions.ROTATE_X_LESS:e=a[f];e.rotateX-=d;break;case ControlActions.ROTATE_X_SET:e=a[f];e.rotateX=d;break;case ControlActions.ROTATE_Y_MORE:e=a[f];e.rotateY+=d;break;case ControlActions.ROTATE_Y_LESS:e=a[f];e.rotateY-=d;break;case ControlActions.ROTATE_Y_SET:e=a[f];e.rotateY=d;break;case ControlActions.ROTATE_LEFT:e=
a[f];e.rotation=(e.rotation+360-d)%360;break;case ControlActions.ROTATE_RIGHT:e=a[f];e.rotation=(e.rotation+360+d)%360;break;case ControlActions.ROTATE_SET:e=a[f];e.rotation=d;break;case ControlActions.ZOOM_STAGE:e=this.model.stageHorizontalCenter/this.model.stageScaleX;var h=this.model.stageVerticalCenter/this.model.stageScaleY;isNaN(e)&&(e=0);isNaN(h)&&(h=0);this.model.stageScaleX=d;this.model.stageScaleY=d;this.model.stageHorizontalCenter=e*this.model.stageScaleX;this.model.stageVerticalCenter=
h*this.model.stageScaleY;break;default:e=a[f],n(e,c,d)}}function r(){return this.model.isTracingMode}function q(a,c){a||(a=0);"undefined"==typeof c&&(c=!0);if(0==a)return DataUtils.PhotoTraceToString(this.model.photoTrace,c);var d=this.model.photoTrace[a];null==d&&(d=new TracedAreaVO,d.rotation=0);for(var e=[],f=0;f<a;f++)e.push(null);e.push(d);return DataUtils.PhotoTraceToString(e,c)}function v(a){for(var a=DataUtils.StringToPhotoTrace(a),c=0;c<a.length;c++)if(null!=a[c]){for(;this.model.photoTrace.length<=
c;)this.model.photoTrace.push(new TracedAreaVO);this.model.photoTrace[c]=a[c]}this.dispatchChangeEvent()}function p(a,c,d,e){if("undefined"==typeof a||null==a)a=this.getPhotoTrace();"undefined"==typeof c&&(c="scale");"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=1);return DataUtils.modifyPhotoTrace(a,c,d,e)}function z(a){J.callback=a}function w(a){return TracingUtils.isFeatureTwoSided(a)}function K(a){return TracingUtils.getFeatureOtherSide(a)}function u(){return TracingUtils.faceScaleArray()}
function t(a){var c=null;if("string"==typeof a)switch(a){case "face":c=[TracedArea.TRACEDAREA_FACE];break;case "eyeslips":c=[TracedArea.TRACEDAREA_EYE_LEFT,TracedArea.TRACEDAREA_EYE_RIGHT,TracedArea.TRACEDAREA_LIPS];break;case "eyesbrows":c=[TracedArea.TRACEDAREA_EYE_LEFT,TracedArea.TRACEDAREA_EYE_RIGHT,TracedArea.TRACEDAREA_EYEBROW_LEFT,TracedArea.TRACEDAREA_EYEBROW_RIGHT];break;case "eyes":c=[TracedArea.TRACEDAREA_EYE_LEFT,TracedArea.TRACEDAREA_EYE_RIGHT];break;case "eyeleft":c=[TracedArea.TRACEDAREA_EYE_LEFT,
TracedArea.TRACEDAREA_EYEBROW_LEFT];break;case "eyeright":c=[TracedArea.TRACEDAREA_EYE_RIGHT,TracedArea.TRACEDAREA_EYEBROW_RIGHT];break;case "lips":c=[TracedArea.TRACEDAREA_LIPS];break;case "nails":c=[TracedArea.TRACEDAREA_NAILS]}else if(a instanceof Array)for(var d=0;d<a.length;d++)if(a[d]instanceof Number||"number"==typeof a[d]){var e=a[d];0<e&&e<=TracedArea.TRACEDAREA_LAST_INDEX&&(null==c&&(c=[]),c.push(e))}return c}function D(a,c,d,e){c||(c=0);d||(d=0);e||(e=25);try{if(0==this.model.parentWidth&&
null!=this.stage&&(this.model.parentWidth=this.stage.stageWidth),0==this.model.parentHeight&&null!=this.stage)this.model.parentHeight=this.stage.stageHeight}catch(f){console.log(f)}0<c&&(this.model.parentWidth=c);0<d&&(this.model.parentHeight=d);if("string"==typeof a&&"full"==a)this.zoomToFullSize(!1);else if("string"==typeof a&&"all"==a)this.zoomToFullSize(!0);else if(a=t(a),null!=a){c=[];for(d=0;d<a.length;d++)TracingUtils.isTraced(a[d])||TracingUtils.guessTracedArea(a[d]),TracingUtils.isTracedOrGuessed(a[d])&&
(c=c.concat(TracingUtils.pointsToAbsolute(this.model.photoTrace[a[d]].points,a[d])));0<c.length?this.zoomToArea(c,e):this.zoomToFullSize(!0)}}function A(a,c,d,e,f,h){"undefined"==typeof a&&(a=NaN);"undefined"==typeof c&&(c=NaN);"undefined"==typeof d&&(d=NaN);"undefined"==typeof e&&(e=NaN);f||(f=0);h||(h=0);0<f&&(this.model.parentWidth=f);0<h&&(this.model.parentHeight=h);isNaN(a)&&(a=this.model.stageHorizontalCenter,isNaN(a)&&(a=0),f=new Point(this.model.parentWidth/2,this.model.parentHeight/2),a-=
f.x,a/=this.model.stageScaleX,a=a*d+f.x);isNaN(c)&&(c=this.model.stageVerticalCenter,isNaN(c)&&(c=0),f=new Point(this.model.parentWidth/2,this.model.parentHeight/2),c-=f.y,c/=this.model.stageScaleY,c=c*e+f.y);J.snapToBoundaries(a,c,d,e)}function B(){return[this.model.stageHorizontalCenter,this.model.stageVerticalCenter,this.model.stageScaleX,this.model.stageScaleY]}function F(a,c,d){"undefined"==typeof c&&(c=10);"undefined"==typeof d&&(d="BitmapData");var e=this.model.photoWidth,f=this.model.photoHeight,
h=e/2,i=f/2;if(null!=a&&(a=t(a),null!=a)){for(var j=[],k=0;k<a.length;k++)TracingUtils.isTracedOrGuessed(a[k])&&(j=j.concat(TracingUtils.pointsToAbsolute(this.model.photoTrace[a[k]].points,a[k])));0<j.length&&(i=MathUtils.getBoundingBox(j),i=MathUtils.extendBoundingBox(i,c),i=MathUtils.confineBounds(i,new Point(-this.model.photoWidth/2,-this.model.photoHeight/2),new Point(this.model.photoWidth/2,this.model.photoHeight/2)),e=MathUtils.widthFromBounds(i),f=MathUtils.heightFromBounds(i),h=-i[0].x,i=
-i[0].y)}c=null;0<e&&0<f&&(h=new Matrix(1,0,0,1,h,i),c=new BitmapData(e,f,!1,0),c.draw(J.capturedBitmap,h),this.model.isTracingMode||(h=this.getStageChild(Features.FEATURE_COVER),null!=h&&(h.visible&&null!=h.makeoverItem&&2==J.parent.numChildren)&&c.draw(h.stageChild.getSizedSprite(e,f))));switch(d.toLowerCase()){case "png":d=c.toDataURL();break;case "jpg":d=c.toDataURL("image/jpeg");break;default:d=c}return d}function C(a,c,d){this.model.traceStyleFillOpacity=a;this.model.traceStyleOutlineOpacity=
c;this.model.traceStyleHandleOpacity=d;this.dispatchChangeEvent()}function G(a,c,d,e){"undefined"==typeof c&&(c=-1);d||(d=0);"undefined"==typeof e&&(e=Features.SIDE_BOTH);if(null!=a&&a instanceof Boolean&&this.model.isSpotApplyMode!=a){this.model.isSpotApplyMode=a;var f,h=null;if(a){f=this.model.looks[this.model.currentLook].stageChildren;for(a=0;a<f.length;a++)f[a].feature==Features.FEATURE_CONCEALER&&f[a].stageChild.initSpotApply();f=TracingUtils.findStageChildren(Features.FEATURE_TRACING_SPOT_APPLY);
null!=f&&0<f.length&&(h=f[0],h.setVisible(!0),null==h.makeoverItem&&(h.makeoverItem=new MakeoverItemVO),a=DataUtils.JSONDecode(h.makeoverItem.parameters),a.feature=c,a.instanceIndex=d,a.side=e,h.makeoverItem.parameters=JSON2.encode(a))}else{f=this.model.looks[this.model.currentLook].stageChildren;for(a=0;a<f.length;a++)h=f[a],h.feature==Features.FEATURE_TRACING_SPOT_APPLY&&h.setVisible(!1)}this.dispatchChangeEvent()}return this.model.isSpotApplyMode}function N(a,c){this.model.canDrag=a;this.model.canZoom=
c}function H(a){a||(a=null);null!=a&&a instanceof Boolean&&this.model.handBackground!=a&&((thix.model.handBackground=a)&&TracingUtils.guessTracedArea(TracedArea.TRACEDAREA_NAILS),TracingUtils.findStageChildren(Features.FEATURE_POLISH),this.dispatchChangeEvent());return this.model.handBackground}function O(a){return TracingUtils.isFeatureColorBased(a)}function L(a,c,d){"undefined"==typeof d&&(d=!0);var e,f=this.model.defaultFeatureWeight[a],h=this.model.defaultFeatureWeight[c];if(d){for(e=0;e<this.model.defaultFeatureWeight.length;e++)this.model.defaultFeatureWeight[e]>=
f&&this.model.defaultFeatureWeight[e]<h&&(this.model.defaultFeatureWeight[e]+=100);this.model.defaultFeatureWeight[c]=f}else{for(e=0;e<this.model.defaultFeatureWeight.length;e++)this.model.defaultFeatureWeight[e]>f&&this.model.defaultFeatureWeight[e]<=h&&(this.model.defaultFeatureWeight[e]-=100);this.model.defaultFeatureWeight[a]=h}this.normalizeWeights();var f=this.model.looks[this.model.currentLook].stageChildren,h=null,i=NaN;for(e=0;e<f.length;e++)if(h=f[e],h.feature==c&&(isNaN(i)||d&&h.weight<
i||!d&&h.weight>i))i=h.weight;if(!isNaN(i))for(e=0;e<f.length;e++)h=f[e],h.feature==a&&(i=d?i-1:i+1,h.weight=i);this.sortLook();this.dispatchChangeEvent()}function M(a,c,d,e){c||(c=0);d||(d=0);"undefined"==typeof e&&(e=-1);a=TracingUtils.tracedAreaForFeature(a,c,d);if(e>=TracedArea.STATUS_NOT_TRACED&&e<=TracedArea.STATUS_NOT_PRESENT){for(;this.model.photoTrace.length<=a;)this.model.photoTrace.push(new TracedAreaVO);null==this.model.photoTrace[a]&&(this.model.photoTrace[a]=new TracedAreaVO);if(e==
TracedArea.STATUS_TRACED&&(isNaN(this.model.photoTrace[a].scaleX)||isNaN(this.model.photoTrace[a].scaleY)||null==this.model.photoTrace[a].points||0==this.model.photoTrace[a].points.length))this.model.photoTrace[a].status=TracedArea.STATUS_GUESSED,TracingUtils.guessTracedArea(a);this.model.photoTrace[a].status=e;this.dispatchChangeEvent()}e=TracedArea.STATUS_NOT_TRACED;0<a&&(a<=TracedArea.TRACEDAREA_LAST_INDEX&&a<this.model.photoTrace.length)&&null!=this.model.photoTrace[a]&&(e=this.model.photoTrace[a].status);
return e}function P(a,c){if(null!=c){this.model.photoBitmapDataOrig=c;this.model.photoOrigId=getTimer()+":"+c.width+"x"+c.height;this.model.photoWidth=c.width;this.model.photoHeight=c.height;var d=TracingUtils.findStageChildren(Features.FEATURE_PHOTO,0)[0];n(d,"bitmapReceived",1);d.makeoverItem.URL=this.model.photoOrigId}null!=a&&(a instanceof Array&&0<a.length)&&TracingUtils.setTracingCoordinates(a);null!=a&&"string"==typeof a&&(this.model.photoTrace=DataUtils.StringToPhotoTrace(a));(null!=c||null!=
a)&&this.dispatchChangeEvent()}function Q(){var a=TracingUtils.findStageChildren(Features.FEATURE_PHOTO,-1,0,!1);null!=a&&(a=a[0],n(a,"photoTrace",DataUtils.PhotoTraceToString(this.model.photoTrace)));for(var c=0;c<this.model.looks[this.model.currentLook].stageChildren.length;c++)a=this.model.looks[this.model.currentLook].stageChildren[c],a.side=TracingUtils.isFeatureTwoSided(a.feature)?TracingUtils.isFeatureLeftSide(a.feature)?Features.SIDE_LEFT:Features.SIDE_RIGHT:Features.SIDE_BOTH;return this.model.looks[this.model.currentLook]}
function U(a,c){return HairColoring.getRecommendedHairColors(a,c==Features.FEATURE_HAIR?this.model.hairStats:this.model.cyohStats)}function E(a){return JSON2.encode(a)}function R(a){return DataUtils.JSONDecode(a)}function c(a){"boolean"==typeof a&&(this.model.isDebug=a);return this.model.isDebug}this.model=ModelLocator.getInstance();var I=null,J=null,I=a;this.flashOnHtml5_constructor.call(this);this.flashOnHtml5_setDomId("flashOnHtml5_vme");this.flashOnHtml5_makeRootOfNewStage(I);var T=new LookVO;
T.stageChildren=[];this.model.looks=[T];J=new StageMain;this.addChild(J);this.model.stageMain=J;try{this.stage.scaleMode=StageScaleMode.NO_SCALE,this.stage.align=StageAlign.TOP_LEFT}catch(V){alert(V)}TracingUtils.initializeFeatureWeight(Features.FEATURE_PHOTO,Features.FEATURE_FACE_MASK,Features.FEATURE_NOSE,Features.FEATURE_HOT_LOOKS,Features.FEATURE_EYEBROW_THINNING,Features.FEATURE_EYEBROW_THINNING_R,Features.FEATURE_LIP_PLUMPING,Features.FEATURE_FOUNDATION,Features.FEATURE_FACE_POWDER,Features.FEATURE_CONCEALER,
Features.FEATURE_CONCEALER_R,Features.FEATURE_TEETH_WHITENING,Features.FEATURE_LIP_TEXTURE,Features.FEATURE_LIP_BALM,Features.FEATURE_LIPLINER,Features.FEATURE_LIPSTICK,Features.FEATURE_LIPGLOSS,Features.FEATURE_EYE_BRIGHTEN,Features.FEATURE_EYE_BRIGHTEN_R,Features.FEATURE_EYEBROW_PENCIL,Features.FEATURE_EYEBROW_PENCIL_R,Features.FEATURE_EYESHADOW,Features.FEATURE_EYESHADOW_R,Features.FEATURE_EYESHADOWC,Features.FEATURE_EYESHADOWL,Features.FEATURE_EYELINER,Features.FEATURE_EYELINER_R,Features.FEATURE_MASCARA,
Features.FEATURE_MASCARA_R,Features.FEATURE_BLUSH,Features.FEATURE_BLUSH_R,Features.FEATURE_FACIAL_HAIR,Features.FEATURE_CYOH,Features.FEATURE_CONTACTS,Features.FEATURE_CONTACTS_R,Features.FEATURE_NECKLACE,Features.FEATURE_SCARF,Features.FEATURE_EARRING,Features.FEATURE_EARRING_R,Features.FEATURE_GLASSES,Features.FEATURE_SUNGLASSES,Features.FEATURE_HAIR,Features.FEATURE_HAIR_COLOR,Features.FEATURE_HIGHLIGHTS,Features.FEATURE_LOWLIGHTS,Features.FEATURE_VEILS,Features.FEATURE_HAIRCLIPS,Features.FEATURE_HEADWEAR,
Features.FEATURE_POLISH,Features.FEATURE_ACRYLIC,Features.FEATURE_COVER,Features.FEATURE_RESERVED,Features.FEATURE_TRACING_INITIAL,Features.FEATURE_TRACING,Features.FEATURE_TRACING_TARGET,Features.FEATURE_TRACING_DISTORT,Features.FEATURE_TRACING_SPOT_APPLY);try{this.applyMakeoverItem=d,this.applyMakeoverItems=e,this.getAppliedMakeoverItem=f,this.getAppliedMakeoverItemParameter=h,this.getStageChild=i,this.controlStageChild=k,this.startTracingMode=l,this.stopTracingMode=m,this.getIsTracingMode=r,this.getPhotoTrace=
q,this.setPhotoTrace=v,this.modifyPhotoTrace=p,this.setCallback=z,this.isFeatureTwoSided=w,this.getFeatureOtherSide=K,this.getFaceScale=u,this.zoomTo=D,this.setPosition=A,this.getPosition=B,this.captureMakeover=F,this.setTraceStyle=C,this.spotApplyMode=G,this.dragAndZoom=N,this.handBackground=H,this.isFeatureColorBased=O,this.swapFeatures=L,this.setFeatureTraceStatus=M,this.setTracingCoordinates=P,this.getLook=Q,this.getRecommendedHairColors=U,this.JSONencode=E,this.JSONdecode=R}catch(W){alert(W)}this.dispatchChangeEvent=
function(){J.onChange()};this.setMakeoverItem=function(a,c,d,e,f,h,i,j,k){"undefined"==typeof e&&(e=0);"undefined"==typeof f&&(f=null);"undefined"==typeof h&&(h=null);"undefined"==typeof i&&(i=null);"undefined"==typeof j&&(j="");"undefined"==typeof k&&(k="");if(null!=a){null==a.makeoverItem&&(a.makeoverItem=new MakeoverItemVO);a.makeoverItem.feature=c;a.makeoverItem.color=d;a.makeoverItem.URL=j;a.makeoverItem.opacity=50;d="";switch(e){case 1:d="sheer";break;case 5:d="medium";break;case 11:d="layerable";
break;case 15:d="sheer-medium";break;case 20:d="sheer-full";break;case 25:d="medium-full";break;default:d="full"}e={};if(null!=k&&""!=k)try{e=JSON.parse(k)}catch(l){console.log("Failed to JSON.parse: "+k)}if(!(e instanceof Number||"number"==typeof e))if(null!=d&&(e.coverage=d),null!=f&&(e.finish=f),null!=h&&(e.style=h),null!=i&&(e.area=i),a.makeoverItem.parameters=JSON.stringify(e),void 0!=e.opacity)a.makeoverItem.opacity=e.opacity;c==Features.FEATURE_PHOTO&&(this.model.photoTrace=DataUtils.StringToPhotoTrace(e.photoTrace))}};
this.applyMakeoverItem=d;this.applyMakeoverItems=e;this.getAppliedMakeoverItem=f;this.getAppliedMakeoverItemParameter=h;this.getStageChild=i;this.controlStageChild=k;this.startTracingMode=l;this.stopTracingMode=m;this.stopTracingModeInternal=function(){for(var a=this.model.looks[this.model.currentLook].stageChildren,c=null,d=0;d<a.length;d++)c=a[d],TracingUtils.isFeatureTracing(c.feature)&&(c.visible=!1)};this.controlStageChildren=s;this.getIsTracingMode=r;this.getPhotoTrace=q;this.setPhotoTrace=
v;this.modifyPhotoTrace=p;this.setCallback=z;this.isFeatureTwoSided=w;this.getFeatureOtherSide=K;this.getFaceScale=u;this.zoomToPoint=function(a,c,d){J.updateStagePosition(-a*d+this.model.parentWidth/2,-c*d+this.model.parentHeight/2,d,d)};this.zoomToArea=function(a,c,d){"undefined"==typeof c&&(c=25);"undefined"==typeof d&&(d=!0);var e=MathUtils.getBoundingBox(a),f=MathUtils.widthFromBounds(e),h=MathUtils.heightFromBounds(e),a=e[0].x+f/2,e=e[0].y+h/2,f=this.model.parentWidth/f,h=this.model.parentHeight/
h,d=d?Math.min(f,h):Math.max(f,h);this.zoomToPoint(a,e,d*(1-c/100))};this.zoomToFullSize=function(a){if(this.model.hasPhoto){var c=[];c.push(new Point(this.model.photoWidth/-2,this.model.photoHeight/-2));c.push(new Point(this.model.photoWidth/2-1,this.model.photoHeight/2-1));this.zoomToArea(c,0,a)}else this.zoomToPoint(0,0,1)};this.zoom=D;this.setPosition=A;this.getPosition=B;this.captureMakeover=F;this.setTraceStyle=C;this.spotApplyMode=G;this.distortMode=function(a,c,d,e){"undefined"==typeof c&&
(c=-1);d||(d=0);"undefined"==typeof e&&(e=Features.SIDE_BOTH);if(null!=a&&a instanceof Boolean&&this.model.isDistortMode!=a){this.model.isDistortMode=a;var f=null;if(a)a=TracingUtils.findStageChildren(Features.FEATURE_TRACING_DISTORT),null!=a&&0<a.length&&(f=a[0],f.setVisible(!0),null==f.makeoverItem&&(f.makeoverItem=new MakeoverItemVO),a=DataUtils.JSONDecode(f.makeoverItem.parameters),a.feature=c,a.instanceIndex=d,a.side=e,f.makeoverItem.parameters=JSON2.encode(a));else{a=this.model.looks[this.model.currentLook].stageChildren;
for(c=0;c<a.length;c++)f=a[c],f.feature==Features.FEATURE_TRACING_DISTORT&&f.setVisible(!1)}this.dispatchChangeEvent()}return this.model.isDistortMode};this.dragAndZoom=N;this.handBackground=H;this.isFeatureColorBased=O;this.normalizeWeights=function(){for(var a=this.model.looks[this.model.currentLook].stageChildren,c=null,d=0;d<a.length;d++)c=a[d],c.weight=100*(d+1)};this.sortLook=function(){var a=this.model.looks[this.model.currentLook].stageChildren,c,d;for(c=0;c<a.length-1;c++){var e=c;for(d=
c+1;d<a.length;d++){var f=a[e].weight,h=a[d].weight,i=a[e].instanceIndex,j=a[d].instanceIndex;if(f>h||f==h&&i>j)e=d}e!=c&&a.splice(c,0,a.splice(e,1)[0])}};this.swapFeatures=L;this.setFeatureTraceStatus=M;this.setTracingCoordinates=P;this.getLook=Q;this.getRecommendedHairColors=U;this.JSONencode=E;this.JSONdecode=R;this.setPostProcess=function(a){this.model.postProcess!=a&&(this.model.postProcess=a,this.model.stageMain.onRenderCompleted())};this.model.isDebug&&console.log(text);this.onTextFieldClick=
function(){for(var a=numChildren-1;0<=a;a--)getChildAt(a)instanceof TextField&&removeChildAt(a)};this.onStageMouseDown=function(a){J.onMouseDown(a)};this.onStageMouseWheel=function(a){J.onMouseWheel(a)};this.onStageMouseMove=function(a){J.onMouseMove(a)};this.onStageMouseUp=function(a){J.onMouseUp(a)};this.setSmoothing=function(a){J.capturedBitmap.smoothing=a};this.debug=c;this.scanPhoto=function(a){a||(a=!1);var c=null;a?null!=this.model.looks[this.model.currentLook].imageAdjust&&(this.model.stageMain.debug("",
NaN,NaN,!0),this.model.isDebug=!1,this.model.looks[this.model.currentLook].imageAdjust=null,this.dispatchChangeEvent()):(this.model.isDebug=!0,c=TracingUtils.scanPhoto(),this.dispatchChangeEvent());return c};this.setCyohHairBitmapData=function(a){this.model.cyohHairBitmapData=a;this.dispatchChangeEvent()};this.getBoundingBox=function(a){return MathUtils.getBoundingBox(a)};this.extendBoundingBox=function(a,c,d){"undefined"==typeof c&&(c=0);"undefined"==typeof d&&(d=0);return MathUtils.extendBoundingBox(a,
c,d)};this.getTracedAreaPoints=function(a){TracingUtils.guessTracedArea(a);var a=TracingUtils.getTracedAreaVO(a),c=TracingUtils.getCurvePointsTracedArea(a);return c=TracingUtils.pointsToAbsolute(c,a)};this.allowUpdate=function(a){(this.model.allowUpdate=a)&&this.dispatchChangeEvent()};this.zoomIn=function(){if(vmeHtml5){var a=vmeHtml5.getPosition()[2],a=a+0.1;vmeHtml5.setPosition(NaN,NaN,a,a)}else alert("Please load a model image first.")};this.zoomOut=function(){if(vmeHtml5){var a=vmeHtml5.getPosition()[2],
a=a-0.1;vmeHtml5.setPosition(NaN,NaN,a,a)}else alert("Please load a model image first.")}}function flashOnHtml5_castToInt(a){return a?parseInt(a):0};
